var L2=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var DT=L2((QT,Vx)=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();function B2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var jf={exports:{}},Ha={},Hf={exports:{}},Ve={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eg;function W2(){if(eg)return Ve;eg=1;var n=Symbol.for("react.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),s=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;function v(L){return L===null||typeof L!="object"?null:(L=p&&L[p]||L["@@iterator"],typeof L=="function"?L:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,b={};function w(L,X,de){this.props=L,this.context=X,this.refs=b,this.updater=de||g}w.prototype.isReactComponent={},w.prototype.setState=function(L,X){if(typeof L!="object"&&typeof L!="function"&&L!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,L,X,"setState")},w.prototype.forceUpdate=function(L){this.updater.enqueueForceUpdate(this,L,"forceUpdate")};function C(){}C.prototype=w.prototype;function _(L,X,de){this.props=L,this.context=X,this.refs=b,this.updater=de||g}var S=_.prototype=new C;S.constructor=_,y(S,w.prototype),S.isPureReactComponent=!0;var k=Array.isArray,R=Object.prototype.hasOwnProperty,N={current:null},P={key:!0,ref:!0,__self:!0,__source:!0};function F(L,X,de){var pe,me={},ge=null,ke=null;if(X!=null)for(pe in X.ref!==void 0&&(ke=X.ref),X.key!==void 0&&(ge=""+X.key),X)R.call(X,pe)&&!P.hasOwnProperty(pe)&&(me[pe]=X[pe]);var be=arguments.length-2;if(be===1)me.children=de;else if(1<be){for(var Ae=Array(be),qe=0;qe<be;qe++)Ae[qe]=arguments[qe+2];me.children=Ae}if(L&&L.defaultProps)for(pe in be=L.defaultProps,be)me[pe]===void 0&&(me[pe]=be[pe]);return{$$typeof:n,type:L,key:ge,ref:ke,props:me,_owner:N.current}}function D(L,X){return{$$typeof:n,type:L.type,key:X,ref:L.ref,props:L.props,_owner:L._owner}}function A(L){return typeof L=="object"&&L!==null&&L.$$typeof===n}function V(L){var X={"=":"=0",":":"=2"};return"$"+L.replace(/[=:]/g,function(de){return X[de]})}var U=/\/+/g;function re(L,X){return typeof L=="object"&&L!==null&&L.key!=null?V(""+L.key):X.toString(36)}function te(L,X,de,pe,me){var ge=typeof L;(ge==="undefined"||ge==="boolean")&&(L=null);var ke=!1;if(L===null)ke=!0;else switch(ge){case"string":case"number":ke=!0;break;case"object":switch(L.$$typeof){case n:case t:ke=!0}}if(ke)return ke=L,me=me(ke),L=pe===""?"."+re(ke,0):pe,k(me)?(de="",L!=null&&(de=L.replace(U,"$&/")+"/"),te(me,X,de,"",function(qe){return qe})):me!=null&&(A(me)&&(me=D(me,de+(!me.key||ke&&ke.key===me.key?"":(""+me.key).replace(U,"$&/")+"/")+L)),X.push(me)),1;if(ke=0,pe=pe===""?".":pe+":",k(L))for(var be=0;be<L.length;be++){ge=L[be];var Ae=pe+re(ge,be);ke+=te(ge,X,de,Ae,me)}else if(Ae=v(L),typeof Ae=="function")for(L=Ae.call(L),be=0;!(ge=L.next()).done;)ge=ge.value,Ae=pe+re(ge,be++),ke+=te(ge,X,de,Ae,me);else if(ge==="object")throw X=String(L),Error("Objects are not valid as a React child (found: "+(X==="[object Object]"?"object with keys {"+Object.keys(L).join(", ")+"}":X)+"). If you meant to render a collection of children, use an array instead.");return ke}function ee(L,X,de){if(L==null)return L;var pe=[],me=0;return te(L,pe,"","",function(ge){return X.call(de,ge,me++)}),pe}function G(L){if(L._status===-1){var X=L._result;X=X(),X.then(function(de){(L._status===0||L._status===-1)&&(L._status=1,L._result=de)},function(de){(L._status===0||L._status===-1)&&(L._status=2,L._result=de)}),L._status===-1&&(L._status=0,L._result=X)}if(L._status===1)return L._result.default;throw L._result}var q={current:null},W={transition:null},Y={ReactCurrentDispatcher:q,ReactCurrentBatchConfig:W,ReactCurrentOwner:N};function K(){throw Error("act(...) is not supported in production builds of React.")}return Ve.Children={map:ee,forEach:function(L,X,de){ee(L,function(){X.apply(this,arguments)},de)},count:function(L){var X=0;return ee(L,function(){X++}),X},toArray:function(L){return ee(L,function(X){return X})||[]},only:function(L){if(!A(L))throw Error("React.Children.only expected to receive a single React element child.");return L}},Ve.Component=w,Ve.Fragment=e,Ve.Profiler=o,Ve.PureComponent=_,Ve.StrictMode=r,Ve.Suspense=c,Ve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Y,Ve.act=K,Ve.cloneElement=function(L,X,de){if(L==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+L+".");var pe=y({},L.props),me=L.key,ge=L.ref,ke=L._owner;if(X!=null){if(X.ref!==void 0&&(ge=X.ref,ke=N.current),X.key!==void 0&&(me=""+X.key),L.type&&L.type.defaultProps)var be=L.type.defaultProps;for(Ae in X)R.call(X,Ae)&&!P.hasOwnProperty(Ae)&&(pe[Ae]=X[Ae]===void 0&&be!==void 0?be[Ae]:X[Ae])}var Ae=arguments.length-2;if(Ae===1)pe.children=de;else if(1<Ae){be=Array(Ae);for(var qe=0;qe<Ae;qe++)be[qe]=arguments[qe+2];pe.children=be}return{$$typeof:n,type:L.type,key:me,ref:ge,props:pe,_owner:ke}},Ve.createContext=function(L){return L={$$typeof:s,_currentValue:L,_currentValue2:L,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},L.Provider={$$typeof:i,_context:L},L.Consumer=L},Ve.createElement=F,Ve.createFactory=function(L){var X=F.bind(null,L);return X.type=L,X},Ve.createRef=function(){return{current:null}},Ve.forwardRef=function(L){return{$$typeof:u,render:L}},Ve.isValidElement=A,Ve.lazy=function(L){return{$$typeof:d,_payload:{_status:-1,_result:L},_init:G}},Ve.memo=function(L,X){return{$$typeof:f,type:L,compare:X===void 0?null:X}},Ve.startTransition=function(L){var X=W.transition;W.transition={};try{L()}finally{W.transition=X}},Ve.unstable_act=K,Ve.useCallback=function(L,X){return q.current.useCallback(L,X)},Ve.useContext=function(L){return q.current.useContext(L)},Ve.useDebugValue=function(){},Ve.useDeferredValue=function(L){return q.current.useDeferredValue(L)},Ve.useEffect=function(L,X){return q.current.useEffect(L,X)},Ve.useId=function(){return q.current.useId()},Ve.useImperativeHandle=function(L,X,de){return q.current.useImperativeHandle(L,X,de)},Ve.useInsertionEffect=function(L,X){return q.current.useInsertionEffect(L,X)},Ve.useLayoutEffect=function(L,X){return q.current.useLayoutEffect(L,X)},Ve.useMemo=function(L,X){return q.current.useMemo(L,X)},Ve.useReducer=function(L,X,de){return q.current.useReducer(L,X,de)},Ve.useRef=function(L){return q.current.useRef(L)},Ve.useState=function(L){return q.current.useState(L)},Ve.useSyncExternalStore=function(L,X,de){return q.current.useSyncExternalStore(L,X,de)},Ve.useTransition=function(){return q.current.useTransition()},Ve.version="18.3.1",Ve}var tg;function oh(){return tg||(tg=1,Hf.exports=W2()),Hf.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ng;function z2(){if(ng)return Ha;ng=1;var n=oh(),t=Symbol.for("react.element"),e=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function s(u,c,f){var d,p={},v=null,g=null;f!==void 0&&(v=""+f),c.key!==void 0&&(v=""+c.key),c.ref!==void 0&&(g=c.ref);for(d in c)r.call(c,d)&&!i.hasOwnProperty(d)&&(p[d]=c[d]);if(u&&u.defaultProps)for(d in c=u.defaultProps,c)p[d]===void 0&&(p[d]=c[d]);return{$$typeof:t,type:u,key:v,ref:g,props:p,_owner:o.current}}return Ha.Fragment=e,Ha.jsx=s,Ha.jsxs=s,Ha}var rg;function U2(){return rg||(rg=1,jf.exports=z2()),jf.exports}var se=U2(),ie=oh();const Xo=B2(ie);var Pu={},Gf={exports:{}},fn={},qf={exports:{}},Kf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var og;function V2(){return og||(og=1,function(n){function t(W,Y){var K=W.length;W.push(Y);e:for(;0<K;){var L=K-1>>>1,X=W[L];if(0<o(X,Y))W[L]=Y,W[K]=X,K=L;else break e}}function e(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var Y=W[0],K=W.pop();if(K!==Y){W[0]=K;e:for(var L=0,X=W.length,de=X>>>1;L<de;){var pe=2*(L+1)-1,me=W[pe],ge=pe+1,ke=W[ge];if(0>o(me,K))ge<X&&0>o(ke,me)?(W[L]=ke,W[ge]=K,L=ge):(W[L]=me,W[pe]=K,L=pe);else if(ge<X&&0>o(ke,K))W[L]=ke,W[ge]=K,L=ge;else break e}}return Y}function o(W,Y){var K=W.sortIndex-Y.sortIndex;return K!==0?K:W.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var s=Date,u=s.now();n.unstable_now=function(){return s.now()-u}}var c=[],f=[],d=1,p=null,v=3,g=!1,y=!1,b=!1,w=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(W){for(var Y=e(f);Y!==null;){if(Y.callback===null)r(f);else if(Y.startTime<=W)r(f),Y.sortIndex=Y.expirationTime,t(c,Y);else break;Y=e(f)}}function k(W){if(b=!1,S(W),!y)if(e(c)!==null)y=!0,G(R);else{var Y=e(f);Y!==null&&q(k,Y.startTime-W)}}function R(W,Y){y=!1,b&&(b=!1,C(F),F=-1),g=!0;var K=v;try{for(S(Y),p=e(c);p!==null&&(!(p.expirationTime>Y)||W&&!V());){var L=p.callback;if(typeof L=="function"){p.callback=null,v=p.priorityLevel;var X=L(p.expirationTime<=Y);Y=n.unstable_now(),typeof X=="function"?p.callback=X:p===e(c)&&r(c),S(Y)}else r(c);p=e(c)}if(p!==null)var de=!0;else{var pe=e(f);pe!==null&&q(k,pe.startTime-Y),de=!1}return de}finally{p=null,v=K,g=!1}}var N=!1,P=null,F=-1,D=5,A=-1;function V(){return!(n.unstable_now()-A<D)}function U(){if(P!==null){var W=n.unstable_now();A=W;var Y=!0;try{Y=P(!0,W)}finally{Y?re():(N=!1,P=null)}}else N=!1}var re;if(typeof _=="function")re=function(){_(U)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,ee=te.port2;te.port1.onmessage=U,re=function(){ee.postMessage(null)}}else re=function(){w(U,0)};function G(W){P=W,N||(N=!0,re())}function q(W,Y){F=w(function(){W(n.unstable_now())},Y)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(W){W.callback=null},n.unstable_continueExecution=function(){y||g||(y=!0,G(R))},n.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<W?Math.floor(1e3/W):5},n.unstable_getCurrentPriorityLevel=function(){return v},n.unstable_getFirstCallbackNode=function(){return e(c)},n.unstable_next=function(W){switch(v){case 1:case 2:case 3:var Y=3;break;default:Y=v}var K=v;v=Y;try{return W()}finally{v=K}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(W,Y){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var K=v;v=W;try{return Y()}finally{v=K}},n.unstable_scheduleCallback=function(W,Y,K){var L=n.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?L+K:L):K=L,W){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=K+X,W={id:d++,callback:Y,priorityLevel:W,startTime:K,expirationTime:X,sortIndex:-1},K>L?(W.sortIndex=K,t(f,W),e(c)===null&&W===e(f)&&(b?(C(F),F=-1):b=!0,q(k,K-L))):(W.sortIndex=X,t(c,W),y||g||(y=!0,G(R))),W},n.unstable_shouldYield=V,n.unstable_wrapCallback=function(W){var Y=v;return function(){var K=v;v=Y;try{return W.apply(this,arguments)}finally{v=K}}}}(Kf)),Kf}var ig;function j2(){return ig||(ig=1,qf.exports=V2()),qf.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ag;function H2(){if(ag)return fn;ag=1;var n=oh(),t=j2();function e(a){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+a,h=1;h<arguments.length;h++)l+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+a+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,o={};function i(a,l){s(a,l),s(a+"Capture",l)}function s(a,l){for(o[a]=l,a=0;a<l.length;a++)r.add(l[a])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),c=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},p={};function v(a){return c.call(p,a)?!0:c.call(d,a)?!1:f.test(a)?p[a]=!0:(d[a]=!0,!1)}function g(a,l,h,m){if(h!==null&&h.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return m?!1:h!==null?!h.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function y(a,l,h,m){if(l===null||typeof l>"u"||g(a,l,h,m))return!0;if(m)return!1;if(h!==null)switch(h.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function b(a,l,h,m,x,E,I){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=m,this.attributeNamespace=x,this.mustUseProperty=h,this.propertyName=a,this.type=l,this.sanitizeURL=E,this.removeEmptyString=I}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){w[a]=new b(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var l=a[0];w[l]=new b(l,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){w[a]=new b(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){w[a]=new b(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){w[a]=new b(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){w[a]=new b(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){w[a]=new b(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){w[a]=new b(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){w[a]=new b(a,5,!1,a.toLowerCase(),null,!1,!1)});var C=/[\-:]([a-z])/g;function _(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var l=a.replace(C,_);w[l]=new b(l,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var l=a.replace(C,_);w[l]=new b(l,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var l=a.replace(C,_);w[l]=new b(l,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){w[a]=new b(a,1,!1,a.toLowerCase(),null,!1,!1)}),w.xlinkHref=new b("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){w[a]=new b(a,1,!1,a.toLowerCase(),null,!0,!0)});function S(a,l,h,m){var x=w.hasOwnProperty(l)?w[l]:null;(x!==null?x.type!==0:m||!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(y(l,h,x,m)&&(h=null),m||x===null?v(l)&&(h===null?a.removeAttribute(l):a.setAttribute(l,""+h)):x.mustUseProperty?a[x.propertyName]=h===null?x.type===3?!1:"":h:(l=x.attributeName,m=x.attributeNamespace,h===null?a.removeAttribute(l):(x=x.type,h=x===3||x===4&&h===!0?"":""+h,m?a.setAttributeNS(m,l,h):a.setAttribute(l,h))))}var k=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,R=Symbol.for("react.element"),N=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),V=Symbol.for("react.context"),U=Symbol.for("react.forward_ref"),re=Symbol.for("react.suspense"),te=Symbol.for("react.suspense_list"),ee=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),q=Symbol.for("react.offscreen"),W=Symbol.iterator;function Y(a){return a===null||typeof a!="object"?null:(a=W&&a[W]||a["@@iterator"],typeof a=="function"?a:null)}var K=Object.assign,L;function X(a){if(L===void 0)try{throw Error()}catch(h){var l=h.stack.trim().match(/\n( *(at )?)/);L=l&&l[1]||""}return`
`+L+a}var de=!1;function pe(a,l){if(!a||de)return"";de=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(Z){var m=Z}Reflect.construct(a,[],l)}else{try{l.call()}catch(Z){m=Z}a.call(l.prototype)}else{try{throw Error()}catch(Z){m=Z}a()}}catch(Z){if(Z&&m&&typeof Z.stack=="string"){for(var x=Z.stack.split(`
`),E=m.stack.split(`
`),I=x.length-1,M=E.length-1;1<=I&&0<=M&&x[I]!==E[M];)M--;for(;1<=I&&0<=M;I--,M--)if(x[I]!==E[M]){if(I!==1||M!==1)do if(I--,M--,0>M||x[I]!==E[M]){var z=`
`+x[I].replace(" at new "," at ");return a.displayName&&z.includes("<anonymous>")&&(z=z.replace("<anonymous>",a.displayName)),z}while(1<=I&&0<=M);break}}}finally{de=!1,Error.prepareStackTrace=h}return(a=a?a.displayName||a.name:"")?X(a):""}function me(a){switch(a.tag){case 5:return X(a.type);case 16:return X("Lazy");case 13:return X("Suspense");case 19:return X("SuspenseList");case 0:case 2:case 15:return a=pe(a.type,!1),a;case 11:return a=pe(a.type.render,!1),a;case 1:return a=pe(a.type,!0),a;default:return""}}function ge(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case P:return"Fragment";case N:return"Portal";case D:return"Profiler";case F:return"StrictMode";case re:return"Suspense";case te:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case V:return(a.displayName||"Context")+".Consumer";case A:return(a._context.displayName||"Context")+".Provider";case U:var l=a.render;return a=a.displayName,a||(a=l.displayName||l.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case ee:return l=a.displayName||null,l!==null?l:ge(a.type)||"Memo";case G:l=a._payload,a=a._init;try{return ge(a(l))}catch{}}return null}function ke(a){var l=a.type;switch(a.tag){case 24:return"Cache";case 9:return(l.displayName||"Context")+".Consumer";case 10:return(l._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=l.render,a=a.displayName||a.name||"",l.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return l;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ge(l);case 8:return l===F?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l}return null}function be(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Ae(a){var l=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function qe(a){var l=Ae(a)?"checked":"value",h=Object.getOwnPropertyDescriptor(a.constructor.prototype,l),m=""+a[l];if(!a.hasOwnProperty(l)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var x=h.get,E=h.set;return Object.defineProperty(a,l,{configurable:!0,get:function(){return x.call(this)},set:function(I){m=""+I,E.call(this,I)}}),Object.defineProperty(a,l,{enumerable:h.enumerable}),{getValue:function(){return m},setValue:function(I){m=""+I},stopTracking:function(){a._valueTracker=null,delete a[l]}}}}function Ue(a){a._valueTracker||(a._valueTracker=qe(a))}function Ye(a){if(!a)return!1;var l=a._valueTracker;if(!l)return!0;var h=l.getValue(),m="";return a&&(m=Ae(a)?a.checked?"true":"false":a.value),a=m,a!==h?(l.setValue(a),!0):!1}function Ge(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function et(a,l){var h=l.checked;return K({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??a._wrapperState.initialChecked})}function tt(a,l){var h=l.defaultValue==null?"":l.defaultValue,m=l.checked!=null?l.checked:l.defaultChecked;h=be(l.value!=null?l.value:h),a._wrapperState={initialChecked:m,initialValue:h,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function nt(a,l){l=l.checked,l!=null&&S(a,"checked",l,!1)}function on(a,l){nt(a,l);var h=be(l.value),m=l.type;if(h!=null)m==="number"?(h===0&&a.value===""||a.value!=h)&&(a.value=""+h):a.value!==""+h&&(a.value=""+h);else if(m==="submit"||m==="reset"){a.removeAttribute("value");return}l.hasOwnProperty("value")?Lt(a,l.type,h):l.hasOwnProperty("defaultValue")&&Lt(a,l.type,be(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(a.defaultChecked=!!l.defaultChecked)}function wn(a,l,h){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var m=l.type;if(!(m!=="submit"&&m!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+a._wrapperState.initialValue,h||l===a.value||(a.value=l),a.defaultValue=l}h=a.name,h!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,h!==""&&(a.name=h)}function Lt(a,l,h){(l!=="number"||Ge(a.ownerDocument)!==a)&&(h==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+h&&(a.defaultValue=""+h))}var Dn=Array.isArray;function jt(a,l,h,m){if(a=a.options,l){l={};for(var x=0;x<h.length;x++)l["$"+h[x]]=!0;for(h=0;h<a.length;h++)x=l.hasOwnProperty("$"+a[h].value),a[h].selected!==x&&(a[h].selected=x),x&&m&&(a[h].defaultSelected=!0)}else{for(h=""+be(h),l=null,x=0;x<a.length;x++){if(a[x].value===h){a[x].selected=!0,m&&(a[x].defaultSelected=!0);return}l!==null||a[x].disabled||(l=a[x])}l!==null&&(l.selected=!0)}}function An(a,l){if(l.dangerouslySetInnerHTML!=null)throw Error(e(91));return K({},l,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Pn(a,l){var h=l.value;if(h==null){if(h=l.children,l=l.defaultValue,h!=null){if(l!=null)throw Error(e(92));if(Dn(h)){if(1<h.length)throw Error(e(93));h=h[0]}l=h}l==null&&(l=""),h=l}a._wrapperState={initialValue:be(h)}}function Ir(a,l){var h=be(l.value),m=be(l.defaultValue);h!=null&&(h=""+h,h!==a.value&&(a.value=h),l.defaultValue==null&&a.defaultValue!==h&&(a.defaultValue=h)),m!=null&&(a.defaultValue=""+m)}function Fn(a){var l=a.textContent;l===a._wrapperState.initialValue&&l!==""&&l!==null&&(a.value=l)}function si(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ir(a,l){return a==null||a==="http://www.w3.org/1999/xhtml"?si(l):a==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var tn,ui=function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(l,h,m,x){MSApp.execUnsafeLocalFunction(function(){return a(l,h,m,x)})}:a}(function(a,l){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=l;else{for(tn=tn||document.createElement("div"),tn.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=tn.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;l.firstChild;)a.appendChild(l.firstChild)}});function Ro(a,l){if(l){var h=a.firstChild;if(h&&h===a.lastChild&&h.nodeType===3){h.nodeValue=l;return}}a.textContent=l}var Io={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Zl=["Webkit","ms","Moz","O"];Object.keys(Io).forEach(function(a){Zl.forEach(function(l){l=l+a.charAt(0).toUpperCase()+a.substring(1),Io[l]=Io[a]})});function li(a,l,h){return l==null||typeof l=="boolean"||l===""?"":h||typeof l!="number"||l===0||Io.hasOwnProperty(a)&&Io[a]?(""+l).trim():l+"px"}function ci(a,l){a=a.style;for(var h in l)if(l.hasOwnProperty(h)){var m=h.indexOf("--")===0,x=li(h,l[h],m);h==="float"&&(h="cssFloat"),m?a.setProperty(h,x):a[h]=x}}var sa=K({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ec(a,l){if(l){if(sa[a]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(e(137,a));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(e(60));if(typeof l.dangerouslySetInnerHTML!="object"||!("__html"in l.dangerouslySetInnerHTML))throw Error(e(61))}if(l.style!=null&&typeof l.style!="object")throw Error(e(62))}}function tc(a,l){if(a.indexOf("-")===-1)return typeof l.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var nc=null;function rc(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var oc=null,fi=null,di=null;function gp(a){if(a=Na(a)){if(typeof oc!="function")throw Error(e(280));var l=a.stateNode;l&&(l=$s(l),oc(a.stateNode,a.type,l))}}function yp(a){fi?di?di.push(a):di=[a]:fi=a}function xp(){if(fi){var a=fi,l=di;if(di=fi=null,gp(a),l)for(a=0;a<l.length;a++)gp(l[a])}}function wp(a,l){return a(l)}function bp(){}var ic=!1;function Cp(a,l,h){if(ic)return a(l,h);ic=!0;try{return wp(a,l,h)}finally{ic=!1,(fi!==null||di!==null)&&(bp(),xp())}}function ua(a,l){var h=a.stateNode;if(h===null)return null;var m=$s(h);if(m===null)return null;h=m[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(a=a.type,m=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!m;break e;default:a=!1}if(a)return null;if(h&&typeof h!="function")throw Error(e(231,l,typeof h));return h}var ac=!1;if(u)try{var la={};Object.defineProperty(la,"passive",{get:function(){ac=!0}}),window.addEventListener("test",la,la),window.removeEventListener("test",la,la)}catch{ac=!1}function jx(a,l,h,m,x,E,I,M,z){var Z=Array.prototype.slice.call(arguments,3);try{l.apply(h,Z)}catch(ce){this.onError(ce)}}var ca=!1,ks=null,Rs=!1,sc=null,Hx={onError:function(a){ca=!0,ks=a}};function Gx(a,l,h,m,x,E,I,M,z){ca=!1,ks=null,jx.apply(Hx,arguments)}function qx(a,l,h,m,x,E,I,M,z){if(Gx.apply(this,arguments),ca){if(ca){var Z=ks;ca=!1,ks=null}else throw Error(e(198));Rs||(Rs=!0,sc=Z)}}function No(a){var l=a,h=a;if(a.alternate)for(;l.return;)l=l.return;else{a=l;do l=a,(l.flags&4098)!==0&&(h=l.return),a=l.return;while(a)}return l.tag===3?h:null}function Ep(a){if(a.tag===13){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function _p(a){if(No(a)!==a)throw Error(e(188))}function Kx(a){var l=a.alternate;if(!l){if(l=No(a),l===null)throw Error(e(188));return l!==a?null:a}for(var h=a,m=l;;){var x=h.return;if(x===null)break;var E=x.alternate;if(E===null){if(m=x.return,m!==null){h=m;continue}break}if(x.child===E.child){for(E=x.child;E;){if(E===h)return _p(x),a;if(E===m)return _p(x),l;E=E.sibling}throw Error(e(188))}if(h.return!==m.return)h=x,m=E;else{for(var I=!1,M=x.child;M;){if(M===h){I=!0,h=x,m=E;break}if(M===m){I=!0,m=x,h=E;break}M=M.sibling}if(!I){for(M=E.child;M;){if(M===h){I=!0,h=E,m=x;break}if(M===m){I=!0,m=E,h=x;break}M=M.sibling}if(!I)throw Error(e(189))}}if(h.alternate!==m)throw Error(e(190))}if(h.tag!==3)throw Error(e(188));return h.stateNode.current===h?a:l}function Sp(a){return a=Kx(a),a!==null?kp(a):null}function kp(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var l=kp(a);if(l!==null)return l;a=a.sibling}return null}var Rp=t.unstable_scheduleCallback,Ip=t.unstable_cancelCallback,$x=t.unstable_shouldYield,Xx=t.unstable_requestPaint,gt=t.unstable_now,Yx=t.unstable_getCurrentPriorityLevel,uc=t.unstable_ImmediatePriority,Np=t.unstable_UserBlockingPriority,Is=t.unstable_NormalPriority,Qx=t.unstable_LowPriority,Tp=t.unstable_IdlePriority,Ns=null,ar=null;function Jx(a){if(ar&&typeof ar.onCommitFiberRoot=="function")try{ar.onCommitFiberRoot(Ns,a,void 0,(a.current.flags&128)===128)}catch{}}var qn=Math.clz32?Math.clz32:tw,Zx=Math.log,ew=Math.LN2;function tw(a){return a>>>=0,a===0?32:31-(Zx(a)/ew|0)|0}var Ts=64,Ds=4194304;function fa(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function As(a,l){var h=a.pendingLanes;if(h===0)return 0;var m=0,x=a.suspendedLanes,E=a.pingedLanes,I=h&268435455;if(I!==0){var M=I&~x;M!==0?m=fa(M):(E&=I,E!==0&&(m=fa(E)))}else I=h&~x,I!==0?m=fa(I):E!==0&&(m=fa(E));if(m===0)return 0;if(l!==0&&l!==m&&(l&x)===0&&(x=m&-m,E=l&-l,x>=E||x===16&&(E&4194240)!==0))return l;if((m&4)!==0&&(m|=h&16),l=a.entangledLanes,l!==0)for(a=a.entanglements,l&=m;0<l;)h=31-qn(l),x=1<<h,m|=a[h],l&=~x;return m}function nw(a,l){switch(a){case 1:case 2:case 4:return l+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rw(a,l){for(var h=a.suspendedLanes,m=a.pingedLanes,x=a.expirationTimes,E=a.pendingLanes;0<E;){var I=31-qn(E),M=1<<I,z=x[I];z===-1?((M&h)===0||(M&m)!==0)&&(x[I]=nw(M,l)):z<=l&&(a.expiredLanes|=M),E&=~M}}function lc(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function Dp(){var a=Ts;return Ts<<=1,(Ts&4194240)===0&&(Ts=64),a}function cc(a){for(var l=[],h=0;31>h;h++)l.push(a);return l}function da(a,l,h){a.pendingLanes|=l,l!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,l=31-qn(l),a[l]=h}function ow(a,l){var h=a.pendingLanes&~l;a.pendingLanes=l,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=l,a.mutableReadLanes&=l,a.entangledLanes&=l,l=a.entanglements;var m=a.eventTimes;for(a=a.expirationTimes;0<h;){var x=31-qn(h),E=1<<x;l[x]=0,m[x]=-1,a[x]=-1,h&=~E}}function fc(a,l){var h=a.entangledLanes|=l;for(a=a.entanglements;h;){var m=31-qn(h),x=1<<m;x&l|a[m]&l&&(a[m]|=l),h&=~x}}var Ze=0;function Ap(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var Pp,dc,Fp,Op,Mp,hc=!1,Ps=[],Xr=null,Yr=null,Qr=null,ha=new Map,pa=new Map,Jr=[],iw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lp(a,l){switch(a){case"focusin":case"focusout":Xr=null;break;case"dragenter":case"dragleave":Yr=null;break;case"mouseover":case"mouseout":Qr=null;break;case"pointerover":case"pointerout":ha.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":pa.delete(l.pointerId)}}function va(a,l,h,m,x,E){return a===null||a.nativeEvent!==E?(a={blockedOn:l,domEventName:h,eventSystemFlags:m,nativeEvent:E,targetContainers:[x]},l!==null&&(l=Na(l),l!==null&&dc(l)),a):(a.eventSystemFlags|=m,l=a.targetContainers,x!==null&&l.indexOf(x)===-1&&l.push(x),a)}function aw(a,l,h,m,x){switch(l){case"focusin":return Xr=va(Xr,a,l,h,m,x),!0;case"dragenter":return Yr=va(Yr,a,l,h,m,x),!0;case"mouseover":return Qr=va(Qr,a,l,h,m,x),!0;case"pointerover":var E=x.pointerId;return ha.set(E,va(ha.get(E)||null,a,l,h,m,x)),!0;case"gotpointercapture":return E=x.pointerId,pa.set(E,va(pa.get(E)||null,a,l,h,m,x)),!0}return!1}function Bp(a){var l=To(a.target);if(l!==null){var h=No(l);if(h!==null){if(l=h.tag,l===13){if(l=Ep(h),l!==null){a.blockedOn=l,Mp(a.priority,function(){Fp(h)});return}}else if(l===3&&h.stateNode.current.memoizedState.isDehydrated){a.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Fs(a){if(a.blockedOn!==null)return!1;for(var l=a.targetContainers;0<l.length;){var h=vc(a.domEventName,a.eventSystemFlags,l[0],a.nativeEvent);if(h===null){h=a.nativeEvent;var m=new h.constructor(h.type,h);nc=m,h.target.dispatchEvent(m),nc=null}else return l=Na(h),l!==null&&dc(l),a.blockedOn=h,!1;l.shift()}return!0}function Wp(a,l,h){Fs(a)&&h.delete(l)}function sw(){hc=!1,Xr!==null&&Fs(Xr)&&(Xr=null),Yr!==null&&Fs(Yr)&&(Yr=null),Qr!==null&&Fs(Qr)&&(Qr=null),ha.forEach(Wp),pa.forEach(Wp)}function ma(a,l){a.blockedOn===l&&(a.blockedOn=null,hc||(hc=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,sw)))}function ga(a){function l(x){return ma(x,a)}if(0<Ps.length){ma(Ps[0],a);for(var h=1;h<Ps.length;h++){var m=Ps[h];m.blockedOn===a&&(m.blockedOn=null)}}for(Xr!==null&&ma(Xr,a),Yr!==null&&ma(Yr,a),Qr!==null&&ma(Qr,a),ha.forEach(l),pa.forEach(l),h=0;h<Jr.length;h++)m=Jr[h],m.blockedOn===a&&(m.blockedOn=null);for(;0<Jr.length&&(h=Jr[0],h.blockedOn===null);)Bp(h),h.blockedOn===null&&Jr.shift()}var hi=k.ReactCurrentBatchConfig,Os=!0;function uw(a,l,h,m){var x=Ze,E=hi.transition;hi.transition=null;try{Ze=1,pc(a,l,h,m)}finally{Ze=x,hi.transition=E}}function lw(a,l,h,m){var x=Ze,E=hi.transition;hi.transition=null;try{Ze=4,pc(a,l,h,m)}finally{Ze=x,hi.transition=E}}function pc(a,l,h,m){if(Os){var x=vc(a,l,h,m);if(x===null)Ac(a,l,m,Ms,h),Lp(a,m);else if(aw(x,a,l,h,m))m.stopPropagation();else if(Lp(a,m),l&4&&-1<iw.indexOf(a)){for(;x!==null;){var E=Na(x);if(E!==null&&Pp(E),E=vc(a,l,h,m),E===null&&Ac(a,l,m,Ms,h),E===x)break;x=E}x!==null&&m.stopPropagation()}else Ac(a,l,m,null,h)}}var Ms=null;function vc(a,l,h,m){if(Ms=null,a=rc(m),a=To(a),a!==null)if(l=No(a),l===null)a=null;else if(h=l.tag,h===13){if(a=Ep(l),a!==null)return a;a=null}else if(h===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;a=null}else l!==a&&(a=null);return Ms=a,null}function zp(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Yx()){case uc:return 1;case Np:return 4;case Is:case Qx:return 16;case Tp:return 536870912;default:return 16}default:return 16}}var Zr=null,mc=null,Ls=null;function Up(){if(Ls)return Ls;var a,l=mc,h=l.length,m,x="value"in Zr?Zr.value:Zr.textContent,E=x.length;for(a=0;a<h&&l[a]===x[a];a++);var I=h-a;for(m=1;m<=I&&l[h-m]===x[E-m];m++);return Ls=x.slice(a,1<m?1-m:void 0)}function Bs(a){var l=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&l===13&&(a=13)):a=l,a===10&&(a=13),32<=a||a===13?a:0}function Ws(){return!0}function Vp(){return!1}function bn(a){function l(h,m,x,E,I){this._reactName=h,this._targetInst=x,this.type=m,this.nativeEvent=E,this.target=I,this.currentTarget=null;for(var M in a)a.hasOwnProperty(M)&&(h=a[M],this[M]=h?h(E):E[M]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?Ws:Vp,this.isPropagationStopped=Vp,this}return K(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=Ws)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=Ws)},persist:function(){},isPersistent:Ws}),l}var pi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gc=bn(pi),ya=K({},pi,{view:0,detail:0}),cw=bn(ya),yc,xc,xa,zs=K({},ya,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bc,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==xa&&(xa&&a.type==="mousemove"?(yc=a.screenX-xa.screenX,xc=a.screenY-xa.screenY):xc=yc=0,xa=a),yc)},movementY:function(a){return"movementY"in a?a.movementY:xc}}),jp=bn(zs),fw=K({},zs,{dataTransfer:0}),dw=bn(fw),hw=K({},ya,{relatedTarget:0}),wc=bn(hw),pw=K({},pi,{animationName:0,elapsedTime:0,pseudoElement:0}),vw=bn(pw),mw=K({},pi,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),gw=bn(mw),yw=K({},pi,{data:0}),Hp=bn(yw),xw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ww={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cw(a){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(a):(a=bw[a])?!!l[a]:!1}function bc(){return Cw}var Ew=K({},ya,{key:function(a){if(a.key){var l=xw[a.key]||a.key;if(l!=="Unidentified")return l}return a.type==="keypress"?(a=Bs(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?ww[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bc,charCode:function(a){return a.type==="keypress"?Bs(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Bs(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),_w=bn(Ew),Sw=K({},zs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gp=bn(Sw),kw=K({},ya,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bc}),Rw=bn(kw),Iw=K({},pi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Nw=bn(Iw),Tw=K({},zs,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Dw=bn(Tw),Aw=[9,13,27,32],Cc=u&&"CompositionEvent"in window,wa=null;u&&"documentMode"in document&&(wa=document.documentMode);var Pw=u&&"TextEvent"in window&&!wa,qp=u&&(!Cc||wa&&8<wa&&11>=wa),Kp=" ",$p=!1;function Xp(a,l){switch(a){case"keyup":return Aw.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yp(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var vi=!1;function Fw(a,l){switch(a){case"compositionend":return Yp(l);case"keypress":return l.which!==32?null:($p=!0,Kp);case"textInput":return a=l.data,a===Kp&&$p?null:a;default:return null}}function Ow(a,l){if(vi)return a==="compositionend"||!Cc&&Xp(a,l)?(a=Up(),Ls=mc=Zr=null,vi=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return qp&&l.locale!=="ko"?null:l.data;default:return null}}var Mw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Qp(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l==="input"?!!Mw[a.type]:l==="textarea"}function Jp(a,l,h,m){yp(m),l=Gs(l,"onChange"),0<l.length&&(h=new gc("onChange","change",null,h,m),a.push({event:h,listeners:l}))}var ba=null,Ca=null;function Lw(a){mv(a,0)}function Us(a){var l=wi(a);if(Ye(l))return a}function Bw(a,l){if(a==="change")return l}var Zp=!1;if(u){var Ec;if(u){var _c="oninput"in document;if(!_c){var ev=document.createElement("div");ev.setAttribute("oninput","return;"),_c=typeof ev.oninput=="function"}Ec=_c}else Ec=!1;Zp=Ec&&(!document.documentMode||9<document.documentMode)}function tv(){ba&&(ba.detachEvent("onpropertychange",nv),Ca=ba=null)}function nv(a){if(a.propertyName==="value"&&Us(Ca)){var l=[];Jp(l,Ca,a,rc(a)),Cp(Lw,l)}}function Ww(a,l,h){a==="focusin"?(tv(),ba=l,Ca=h,ba.attachEvent("onpropertychange",nv)):a==="focusout"&&tv()}function zw(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Us(Ca)}function Uw(a,l){if(a==="click")return Us(l)}function Vw(a,l){if(a==="input"||a==="change")return Us(l)}function jw(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}var Kn=typeof Object.is=="function"?Object.is:jw;function Ea(a,l){if(Kn(a,l))return!0;if(typeof a!="object"||a===null||typeof l!="object"||l===null)return!1;var h=Object.keys(a),m=Object.keys(l);if(h.length!==m.length)return!1;for(m=0;m<h.length;m++){var x=h[m];if(!c.call(l,x)||!Kn(a[x],l[x]))return!1}return!0}function rv(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ov(a,l){var h=rv(a);a=0;for(var m;h;){if(h.nodeType===3){if(m=a+h.textContent.length,a<=l&&m>=l)return{node:h,offset:l-a};a=m}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=rv(h)}}function iv(a,l){return a&&l?a===l?!0:a&&a.nodeType===3?!1:l&&l.nodeType===3?iv(a,l.parentNode):"contains"in a?a.contains(l):a.compareDocumentPosition?!!(a.compareDocumentPosition(l)&16):!1:!1}function av(){for(var a=window,l=Ge();l instanceof a.HTMLIFrameElement;){try{var h=typeof l.contentWindow.location.href=="string"}catch{h=!1}if(h)a=l.contentWindow;else break;l=Ge(a.document)}return l}function Sc(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l&&(l==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||l==="textarea"||a.contentEditable==="true")}function Hw(a){var l=av(),h=a.focusedElem,m=a.selectionRange;if(l!==h&&h&&h.ownerDocument&&iv(h.ownerDocument.documentElement,h)){if(m!==null&&Sc(h)){if(l=m.start,a=m.end,a===void 0&&(a=l),"selectionStart"in h)h.selectionStart=l,h.selectionEnd=Math.min(a,h.value.length);else if(a=(l=h.ownerDocument||document)&&l.defaultView||window,a.getSelection){a=a.getSelection();var x=h.textContent.length,E=Math.min(m.start,x);m=m.end===void 0?E:Math.min(m.end,x),!a.extend&&E>m&&(x=m,m=E,E=x),x=ov(h,E);var I=ov(h,m);x&&I&&(a.rangeCount!==1||a.anchorNode!==x.node||a.anchorOffset!==x.offset||a.focusNode!==I.node||a.focusOffset!==I.offset)&&(l=l.createRange(),l.setStart(x.node,x.offset),a.removeAllRanges(),E>m?(a.addRange(l),a.extend(I.node,I.offset)):(l.setEnd(I.node,I.offset),a.addRange(l)))}}for(l=[],a=h;a=a.parentNode;)a.nodeType===1&&l.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<l.length;h++)a=l[h],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var Gw=u&&"documentMode"in document&&11>=document.documentMode,mi=null,kc=null,_a=null,Rc=!1;function sv(a,l,h){var m=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Rc||mi==null||mi!==Ge(m)||(m=mi,"selectionStart"in m&&Sc(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),_a&&Ea(_a,m)||(_a=m,m=Gs(kc,"onSelect"),0<m.length&&(l=new gc("onSelect","select",null,l,h),a.push({event:l,listeners:m}),l.target=mi)))}function Vs(a,l){var h={};return h[a.toLowerCase()]=l.toLowerCase(),h["Webkit"+a]="webkit"+l,h["Moz"+a]="moz"+l,h}var gi={animationend:Vs("Animation","AnimationEnd"),animationiteration:Vs("Animation","AnimationIteration"),animationstart:Vs("Animation","AnimationStart"),transitionend:Vs("Transition","TransitionEnd")},Ic={},uv={};u&&(uv=document.createElement("div").style,"AnimationEvent"in window||(delete gi.animationend.animation,delete gi.animationiteration.animation,delete gi.animationstart.animation),"TransitionEvent"in window||delete gi.transitionend.transition);function js(a){if(Ic[a])return Ic[a];if(!gi[a])return a;var l=gi[a],h;for(h in l)if(l.hasOwnProperty(h)&&h in uv)return Ic[a]=l[h];return a}var lv=js("animationend"),cv=js("animationiteration"),fv=js("animationstart"),dv=js("transitionend"),hv=new Map,pv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function eo(a,l){hv.set(a,l),i(l,[a])}for(var Nc=0;Nc<pv.length;Nc++){var Tc=pv[Nc],qw=Tc.toLowerCase(),Kw=Tc[0].toUpperCase()+Tc.slice(1);eo(qw,"on"+Kw)}eo(lv,"onAnimationEnd"),eo(cv,"onAnimationIteration"),eo(fv,"onAnimationStart"),eo("dblclick","onDoubleClick"),eo("focusin","onFocus"),eo("focusout","onBlur"),eo(dv,"onTransitionEnd"),s("onMouseEnter",["mouseout","mouseover"]),s("onMouseLeave",["mouseout","mouseover"]),s("onPointerEnter",["pointerout","pointerover"]),s("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Sa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$w=new Set("cancel close invalid load scroll toggle".split(" ").concat(Sa));function vv(a,l,h){var m=a.type||"unknown-event";a.currentTarget=h,qx(m,l,void 0,a),a.currentTarget=null}function mv(a,l){l=(l&4)!==0;for(var h=0;h<a.length;h++){var m=a[h],x=m.event;m=m.listeners;e:{var E=void 0;if(l)for(var I=m.length-1;0<=I;I--){var M=m[I],z=M.instance,Z=M.currentTarget;if(M=M.listener,z!==E&&x.isPropagationStopped())break e;vv(x,M,Z),E=z}else for(I=0;I<m.length;I++){if(M=m[I],z=M.instance,Z=M.currentTarget,M=M.listener,z!==E&&x.isPropagationStopped())break e;vv(x,M,Z),E=z}}}if(Rs)throw a=sc,Rs=!1,sc=null,a}function it(a,l){var h=l[Bc];h===void 0&&(h=l[Bc]=new Set);var m=a+"__bubble";h.has(m)||(gv(l,a,2,!1),h.add(m))}function Dc(a,l,h){var m=0;l&&(m|=4),gv(h,a,m,l)}var Hs="_reactListening"+Math.random().toString(36).slice(2);function ka(a){if(!a[Hs]){a[Hs]=!0,r.forEach(function(h){h!=="selectionchange"&&($w.has(h)||Dc(h,!1,a),Dc(h,!0,a))});var l=a.nodeType===9?a:a.ownerDocument;l===null||l[Hs]||(l[Hs]=!0,Dc("selectionchange",!1,l))}}function gv(a,l,h,m){switch(zp(l)){case 1:var x=uw;break;case 4:x=lw;break;default:x=pc}h=x.bind(null,l,h,a),x=void 0,!ac||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(x=!0),m?x!==void 0?a.addEventListener(l,h,{capture:!0,passive:x}):a.addEventListener(l,h,!0):x!==void 0?a.addEventListener(l,h,{passive:x}):a.addEventListener(l,h,!1)}function Ac(a,l,h,m,x){var E=m;if((l&1)===0&&(l&2)===0&&m!==null)e:for(;;){if(m===null)return;var I=m.tag;if(I===3||I===4){var M=m.stateNode.containerInfo;if(M===x||M.nodeType===8&&M.parentNode===x)break;if(I===4)for(I=m.return;I!==null;){var z=I.tag;if((z===3||z===4)&&(z=I.stateNode.containerInfo,z===x||z.nodeType===8&&z.parentNode===x))return;I=I.return}for(;M!==null;){if(I=To(M),I===null)return;if(z=I.tag,z===5||z===6){m=E=I;continue e}M=M.parentNode}}m=m.return}Cp(function(){var Z=E,ce=rc(h),fe=[];e:{var le=hv.get(a);if(le!==void 0){var ye=gc,Ce=a;switch(a){case"keypress":if(Bs(h)===0)break e;case"keydown":case"keyup":ye=_w;break;case"focusin":Ce="focus",ye=wc;break;case"focusout":Ce="blur",ye=wc;break;case"beforeblur":case"afterblur":ye=wc;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ye=jp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ye=dw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ye=Rw;break;case lv:case cv:case fv:ye=vw;break;case dv:ye=Nw;break;case"scroll":ye=cw;break;case"wheel":ye=Dw;break;case"copy":case"cut":case"paste":ye=gw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ye=Gp}var Se=(l&4)!==0,yt=!Se&&a==="scroll",$=Se?le!==null?le+"Capture":null:le;Se=[];for(var H=Z,Q;H!==null;){Q=H;var he=Q.stateNode;if(Q.tag===5&&he!==null&&(Q=he,$!==null&&(he=ua(H,$),he!=null&&Se.push(Ra(H,he,Q)))),yt)break;H=H.return}0<Se.length&&(le=new ye(le,Ce,null,h,ce),fe.push({event:le,listeners:Se}))}}if((l&7)===0){e:{if(le=a==="mouseover"||a==="pointerover",ye=a==="mouseout"||a==="pointerout",le&&h!==nc&&(Ce=h.relatedTarget||h.fromElement)&&(To(Ce)||Ce[Nr]))break e;if((ye||le)&&(le=ce.window===ce?ce:(le=ce.ownerDocument)?le.defaultView||le.parentWindow:window,ye?(Ce=h.relatedTarget||h.toElement,ye=Z,Ce=Ce?To(Ce):null,Ce!==null&&(yt=No(Ce),Ce!==yt||Ce.tag!==5&&Ce.tag!==6)&&(Ce=null)):(ye=null,Ce=Z),ye!==Ce)){if(Se=jp,he="onMouseLeave",$="onMouseEnter",H="mouse",(a==="pointerout"||a==="pointerover")&&(Se=Gp,he="onPointerLeave",$="onPointerEnter",H="pointer"),yt=ye==null?le:wi(ye),Q=Ce==null?le:wi(Ce),le=new Se(he,H+"leave",ye,h,ce),le.target=yt,le.relatedTarget=Q,he=null,To(ce)===Z&&(Se=new Se($,H+"enter",Ce,h,ce),Se.target=Q,Se.relatedTarget=yt,he=Se),yt=he,ye&&Ce)t:{for(Se=ye,$=Ce,H=0,Q=Se;Q;Q=yi(Q))H++;for(Q=0,he=$;he;he=yi(he))Q++;for(;0<H-Q;)Se=yi(Se),H--;for(;0<Q-H;)$=yi($),Q--;for(;H--;){if(Se===$||$!==null&&Se===$.alternate)break t;Se=yi(Se),$=yi($)}Se=null}else Se=null;ye!==null&&yv(fe,le,ye,Se,!1),Ce!==null&&yt!==null&&yv(fe,yt,Ce,Se,!0)}}e:{if(le=Z?wi(Z):window,ye=le.nodeName&&le.nodeName.toLowerCase(),ye==="select"||ye==="input"&&le.type==="file")var Ie=Bw;else if(Qp(le))if(Zp)Ie=Vw;else{Ie=zw;var Pe=Ww}else(ye=le.nodeName)&&ye.toLowerCase()==="input"&&(le.type==="checkbox"||le.type==="radio")&&(Ie=Uw);if(Ie&&(Ie=Ie(a,Z))){Jp(fe,Ie,h,ce);break e}Pe&&Pe(a,le,Z),a==="focusout"&&(Pe=le._wrapperState)&&Pe.controlled&&le.type==="number"&&Lt(le,"number",le.value)}switch(Pe=Z?wi(Z):window,a){case"focusin":(Qp(Pe)||Pe.contentEditable==="true")&&(mi=Pe,kc=Z,_a=null);break;case"focusout":_a=kc=mi=null;break;case"mousedown":Rc=!0;break;case"contextmenu":case"mouseup":case"dragend":Rc=!1,sv(fe,h,ce);break;case"selectionchange":if(Gw)break;case"keydown":case"keyup":sv(fe,h,ce)}var Fe;if(Cc)e:{switch(a){case"compositionstart":var Oe="onCompositionStart";break e;case"compositionend":Oe="onCompositionEnd";break e;case"compositionupdate":Oe="onCompositionUpdate";break e}Oe=void 0}else vi?Xp(a,h)&&(Oe="onCompositionEnd"):a==="keydown"&&h.keyCode===229&&(Oe="onCompositionStart");Oe&&(qp&&h.locale!=="ko"&&(vi||Oe!=="onCompositionStart"?Oe==="onCompositionEnd"&&vi&&(Fe=Up()):(Zr=ce,mc="value"in Zr?Zr.value:Zr.textContent,vi=!0)),Pe=Gs(Z,Oe),0<Pe.length&&(Oe=new Hp(Oe,a,null,h,ce),fe.push({event:Oe,listeners:Pe}),Fe?Oe.data=Fe:(Fe=Yp(h),Fe!==null&&(Oe.data=Fe)))),(Fe=Pw?Fw(a,h):Ow(a,h))&&(Z=Gs(Z,"onBeforeInput"),0<Z.length&&(ce=new Hp("onBeforeInput","beforeinput",null,h,ce),fe.push({event:ce,listeners:Z}),ce.data=Fe))}mv(fe,l)})}function Ra(a,l,h){return{instance:a,listener:l,currentTarget:h}}function Gs(a,l){for(var h=l+"Capture",m=[];a!==null;){var x=a,E=x.stateNode;x.tag===5&&E!==null&&(x=E,E=ua(a,h),E!=null&&m.unshift(Ra(a,E,x)),E=ua(a,l),E!=null&&m.push(Ra(a,E,x))),a=a.return}return m}function yi(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function yv(a,l,h,m,x){for(var E=l._reactName,I=[];h!==null&&h!==m;){var M=h,z=M.alternate,Z=M.stateNode;if(z!==null&&z===m)break;M.tag===5&&Z!==null&&(M=Z,x?(z=ua(h,E),z!=null&&I.unshift(Ra(h,z,M))):x||(z=ua(h,E),z!=null&&I.push(Ra(h,z,M)))),h=h.return}I.length!==0&&a.push({event:l,listeners:I})}var Xw=/\r\n?/g,Yw=/\u0000|\uFFFD/g;function xv(a){return(typeof a=="string"?a:""+a).replace(Xw,`
`).replace(Yw,"")}function qs(a,l,h){if(l=xv(l),xv(a)!==l&&h)throw Error(e(425))}function Ks(){}var Pc=null,Fc=null;function Oc(a,l){return a==="textarea"||a==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var Mc=typeof setTimeout=="function"?setTimeout:void 0,Qw=typeof clearTimeout=="function"?clearTimeout:void 0,wv=typeof Promise=="function"?Promise:void 0,Jw=typeof queueMicrotask=="function"?queueMicrotask:typeof wv<"u"?function(a){return wv.resolve(null).then(a).catch(Zw)}:Mc;function Zw(a){setTimeout(function(){throw a})}function Lc(a,l){var h=l,m=0;do{var x=h.nextSibling;if(a.removeChild(h),x&&x.nodeType===8)if(h=x.data,h==="/$"){if(m===0){a.removeChild(x),ga(l);return}m--}else h!=="$"&&h!=="$?"&&h!=="$!"||m++;h=x}while(h);ga(l)}function to(a){for(;a!=null;a=a.nextSibling){var l=a.nodeType;if(l===1||l===3)break;if(l===8){if(l=a.data,l==="$"||l==="$!"||l==="$?")break;if(l==="/$")return null}}return a}function bv(a){a=a.previousSibling;for(var l=0;a;){if(a.nodeType===8){var h=a.data;if(h==="$"||h==="$!"||h==="$?"){if(l===0)return a;l--}else h==="/$"&&l++}a=a.previousSibling}return null}var xi=Math.random().toString(36).slice(2),sr="__reactFiber$"+xi,Ia="__reactProps$"+xi,Nr="__reactContainer$"+xi,Bc="__reactEvents$"+xi,e2="__reactListeners$"+xi,t2="__reactHandles$"+xi;function To(a){var l=a[sr];if(l)return l;for(var h=a.parentNode;h;){if(l=h[Nr]||h[sr]){if(h=l.alternate,l.child!==null||h!==null&&h.child!==null)for(a=bv(a);a!==null;){if(h=a[sr])return h;a=bv(a)}return l}a=h,h=a.parentNode}return null}function Na(a){return a=a[sr]||a[Nr],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function wi(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(e(33))}function $s(a){return a[Ia]||null}var Wc=[],bi=-1;function no(a){return{current:a}}function at(a){0>bi||(a.current=Wc[bi],Wc[bi]=null,bi--)}function rt(a,l){bi++,Wc[bi]=a.current,a.current=l}var ro={},Ht=no(ro),an=no(!1),Do=ro;function Ci(a,l){var h=a.type.contextTypes;if(!h)return ro;var m=a.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===l)return m.__reactInternalMemoizedMaskedChildContext;var x={},E;for(E in h)x[E]=l[E];return m&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=l,a.__reactInternalMemoizedMaskedChildContext=x),x}function sn(a){return a=a.childContextTypes,a!=null}function Xs(){at(an),at(Ht)}function Cv(a,l,h){if(Ht.current!==ro)throw Error(e(168));rt(Ht,l),rt(an,h)}function Ev(a,l,h){var m=a.stateNode;if(l=l.childContextTypes,typeof m.getChildContext!="function")return h;m=m.getChildContext();for(var x in m)if(!(x in l))throw Error(e(108,ke(a)||"Unknown",x));return K({},h,m)}function Ys(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||ro,Do=Ht.current,rt(Ht,a),rt(an,an.current),!0}function _v(a,l,h){var m=a.stateNode;if(!m)throw Error(e(169));h?(a=Ev(a,l,Do),m.__reactInternalMemoizedMergedChildContext=a,at(an),at(Ht),rt(Ht,a)):at(an),rt(an,h)}var Tr=null,Qs=!1,zc=!1;function Sv(a){Tr===null?Tr=[a]:Tr.push(a)}function n2(a){Qs=!0,Sv(a)}function oo(){if(!zc&&Tr!==null){zc=!0;var a=0,l=Ze;try{var h=Tr;for(Ze=1;a<h.length;a++){var m=h[a];do m=m(!0);while(m!==null)}Tr=null,Qs=!1}catch(x){throw Tr!==null&&(Tr=Tr.slice(a+1)),Rp(uc,oo),x}finally{Ze=l,zc=!1}}return null}var Ei=[],_i=0,Js=null,Zs=0,On=[],Mn=0,Ao=null,Dr=1,Ar="";function Po(a,l){Ei[_i++]=Zs,Ei[_i++]=Js,Js=a,Zs=l}function kv(a,l,h){On[Mn++]=Dr,On[Mn++]=Ar,On[Mn++]=Ao,Ao=a;var m=Dr;a=Ar;var x=32-qn(m)-1;m&=~(1<<x),h+=1;var E=32-qn(l)+x;if(30<E){var I=x-x%5;E=(m&(1<<I)-1).toString(32),m>>=I,x-=I,Dr=1<<32-qn(l)+x|h<<x|m,Ar=E+a}else Dr=1<<E|h<<x|m,Ar=a}function Uc(a){a.return!==null&&(Po(a,1),kv(a,1,0))}function Vc(a){for(;a===Js;)Js=Ei[--_i],Ei[_i]=null,Zs=Ei[--_i],Ei[_i]=null;for(;a===Ao;)Ao=On[--Mn],On[Mn]=null,Ar=On[--Mn],On[Mn]=null,Dr=On[--Mn],On[Mn]=null}var Cn=null,En=null,ut=!1,$n=null;function Rv(a,l){var h=zn(5,null,null,0);h.elementType="DELETED",h.stateNode=l,h.return=a,l=a.deletions,l===null?(a.deletions=[h],a.flags|=16):l.push(h)}function Iv(a,l){switch(a.tag){case 5:var h=a.type;return l=l.nodeType!==1||h.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(a.stateNode=l,Cn=a,En=to(l.firstChild),!0):!1;case 6:return l=a.pendingProps===""||l.nodeType!==3?null:l,l!==null?(a.stateNode=l,Cn=a,En=null,!0):!1;case 13:return l=l.nodeType!==8?null:l,l!==null?(h=Ao!==null?{id:Dr,overflow:Ar}:null,a.memoizedState={dehydrated:l,treeContext:h,retryLane:1073741824},h=zn(18,null,null,0),h.stateNode=l,h.return=a,a.child=h,Cn=a,En=null,!0):!1;default:return!1}}function jc(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Hc(a){if(ut){var l=En;if(l){var h=l;if(!Iv(a,l)){if(jc(a))throw Error(e(418));l=to(h.nextSibling);var m=Cn;l&&Iv(a,l)?Rv(m,h):(a.flags=a.flags&-4097|2,ut=!1,Cn=a)}}else{if(jc(a))throw Error(e(418));a.flags=a.flags&-4097|2,ut=!1,Cn=a}}}function Nv(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;Cn=a}function eu(a){if(a!==Cn)return!1;if(!ut)return Nv(a),ut=!0,!1;var l;if((l=a.tag!==3)&&!(l=a.tag!==5)&&(l=a.type,l=l!=="head"&&l!=="body"&&!Oc(a.type,a.memoizedProps)),l&&(l=En)){if(jc(a))throw Tv(),Error(e(418));for(;l;)Rv(a,l),l=to(l.nextSibling)}if(Nv(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(e(317));e:{for(a=a.nextSibling,l=0;a;){if(a.nodeType===8){var h=a.data;if(h==="/$"){if(l===0){En=to(a.nextSibling);break e}l--}else h!=="$"&&h!=="$!"&&h!=="$?"||l++}a=a.nextSibling}En=null}}else En=Cn?to(a.stateNode.nextSibling):null;return!0}function Tv(){for(var a=En;a;)a=to(a.nextSibling)}function Si(){En=Cn=null,ut=!1}function Gc(a){$n===null?$n=[a]:$n.push(a)}var r2=k.ReactCurrentBatchConfig;function Ta(a,l,h){if(a=h.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(e(309));var m=h.stateNode}if(!m)throw Error(e(147,a));var x=m,E=""+a;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===E?l.ref:(l=function(I){var M=x.refs;I===null?delete M[E]:M[E]=I},l._stringRef=E,l)}if(typeof a!="string")throw Error(e(284));if(!h._owner)throw Error(e(290,a))}return a}function tu(a,l){throw a=Object.prototype.toString.call(l),Error(e(31,a==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":a))}function Dv(a){var l=a._init;return l(a._payload)}function Av(a){function l($,H){if(a){var Q=$.deletions;Q===null?($.deletions=[H],$.flags|=16):Q.push(H)}}function h($,H){if(!a)return null;for(;H!==null;)l($,H),H=H.sibling;return null}function m($,H){for($=new Map;H!==null;)H.key!==null?$.set(H.key,H):$.set(H.index,H),H=H.sibling;return $}function x($,H){return $=ho($,H),$.index=0,$.sibling=null,$}function E($,H,Q){return $.index=Q,a?(Q=$.alternate,Q!==null?(Q=Q.index,Q<H?($.flags|=2,H):Q):($.flags|=2,H)):($.flags|=1048576,H)}function I($){return a&&$.alternate===null&&($.flags|=2),$}function M($,H,Q,he){return H===null||H.tag!==6?(H=Lf(Q,$.mode,he),H.return=$,H):(H=x(H,Q),H.return=$,H)}function z($,H,Q,he){var Ie=Q.type;return Ie===P?ce($,H,Q.props.children,he,Q.key):H!==null&&(H.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===G&&Dv(Ie)===H.type)?(he=x(H,Q.props),he.ref=Ta($,H,Q),he.return=$,he):(he=Su(Q.type,Q.key,Q.props,null,$.mode,he),he.ref=Ta($,H,Q),he.return=$,he)}function Z($,H,Q,he){return H===null||H.tag!==4||H.stateNode.containerInfo!==Q.containerInfo||H.stateNode.implementation!==Q.implementation?(H=Bf(Q,$.mode,he),H.return=$,H):(H=x(H,Q.children||[]),H.return=$,H)}function ce($,H,Q,he,Ie){return H===null||H.tag!==7?(H=Uo(Q,$.mode,he,Ie),H.return=$,H):(H=x(H,Q),H.return=$,H)}function fe($,H,Q){if(typeof H=="string"&&H!==""||typeof H=="number")return H=Lf(""+H,$.mode,Q),H.return=$,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case R:return Q=Su(H.type,H.key,H.props,null,$.mode,Q),Q.ref=Ta($,null,H),Q.return=$,Q;case N:return H=Bf(H,$.mode,Q),H.return=$,H;case G:var he=H._init;return fe($,he(H._payload),Q)}if(Dn(H)||Y(H))return H=Uo(H,$.mode,Q,null),H.return=$,H;tu($,H)}return null}function le($,H,Q,he){var Ie=H!==null?H.key:null;if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Ie!==null?null:M($,H,""+Q,he);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case R:return Q.key===Ie?z($,H,Q,he):null;case N:return Q.key===Ie?Z($,H,Q,he):null;case G:return Ie=Q._init,le($,H,Ie(Q._payload),he)}if(Dn(Q)||Y(Q))return Ie!==null?null:ce($,H,Q,he,null);tu($,Q)}return null}function ye($,H,Q,he,Ie){if(typeof he=="string"&&he!==""||typeof he=="number")return $=$.get(Q)||null,M(H,$,""+he,Ie);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case R:return $=$.get(he.key===null?Q:he.key)||null,z(H,$,he,Ie);case N:return $=$.get(he.key===null?Q:he.key)||null,Z(H,$,he,Ie);case G:var Pe=he._init;return ye($,H,Q,Pe(he._payload),Ie)}if(Dn(he)||Y(he))return $=$.get(Q)||null,ce(H,$,he,Ie,null);tu(H,he)}return null}function Ce($,H,Q,he){for(var Ie=null,Pe=null,Fe=H,Oe=H=0,Pt=null;Fe!==null&&Oe<Q.length;Oe++){Fe.index>Oe?(Pt=Fe,Fe=null):Pt=Fe.sibling;var Xe=le($,Fe,Q[Oe],he);if(Xe===null){Fe===null&&(Fe=Pt);break}a&&Fe&&Xe.alternate===null&&l($,Fe),H=E(Xe,H,Oe),Pe===null?Ie=Xe:Pe.sibling=Xe,Pe=Xe,Fe=Pt}if(Oe===Q.length)return h($,Fe),ut&&Po($,Oe),Ie;if(Fe===null){for(;Oe<Q.length;Oe++)Fe=fe($,Q[Oe],he),Fe!==null&&(H=E(Fe,H,Oe),Pe===null?Ie=Fe:Pe.sibling=Fe,Pe=Fe);return ut&&Po($,Oe),Ie}for(Fe=m($,Fe);Oe<Q.length;Oe++)Pt=ye(Fe,$,Oe,Q[Oe],he),Pt!==null&&(a&&Pt.alternate!==null&&Fe.delete(Pt.key===null?Oe:Pt.key),H=E(Pt,H,Oe),Pe===null?Ie=Pt:Pe.sibling=Pt,Pe=Pt);return a&&Fe.forEach(function(po){return l($,po)}),ut&&Po($,Oe),Ie}function Se($,H,Q,he){var Ie=Y(Q);if(typeof Ie!="function")throw Error(e(150));if(Q=Ie.call(Q),Q==null)throw Error(e(151));for(var Pe=Ie=null,Fe=H,Oe=H=0,Pt=null,Xe=Q.next();Fe!==null&&!Xe.done;Oe++,Xe=Q.next()){Fe.index>Oe?(Pt=Fe,Fe=null):Pt=Fe.sibling;var po=le($,Fe,Xe.value,he);if(po===null){Fe===null&&(Fe=Pt);break}a&&Fe&&po.alternate===null&&l($,Fe),H=E(po,H,Oe),Pe===null?Ie=po:Pe.sibling=po,Pe=po,Fe=Pt}if(Xe.done)return h($,Fe),ut&&Po($,Oe),Ie;if(Fe===null){for(;!Xe.done;Oe++,Xe=Q.next())Xe=fe($,Xe.value,he),Xe!==null&&(H=E(Xe,H,Oe),Pe===null?Ie=Xe:Pe.sibling=Xe,Pe=Xe);return ut&&Po($,Oe),Ie}for(Fe=m($,Fe);!Xe.done;Oe++,Xe=Q.next())Xe=ye(Fe,$,Oe,Xe.value,he),Xe!==null&&(a&&Xe.alternate!==null&&Fe.delete(Xe.key===null?Oe:Xe.key),H=E(Xe,H,Oe),Pe===null?Ie=Xe:Pe.sibling=Xe,Pe=Xe);return a&&Fe.forEach(function(M2){return l($,M2)}),ut&&Po($,Oe),Ie}function yt($,H,Q,he){if(typeof Q=="object"&&Q!==null&&Q.type===P&&Q.key===null&&(Q=Q.props.children),typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case R:e:{for(var Ie=Q.key,Pe=H;Pe!==null;){if(Pe.key===Ie){if(Ie=Q.type,Ie===P){if(Pe.tag===7){h($,Pe.sibling),H=x(Pe,Q.props.children),H.return=$,$=H;break e}}else if(Pe.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===G&&Dv(Ie)===Pe.type){h($,Pe.sibling),H=x(Pe,Q.props),H.ref=Ta($,Pe,Q),H.return=$,$=H;break e}h($,Pe);break}else l($,Pe);Pe=Pe.sibling}Q.type===P?(H=Uo(Q.props.children,$.mode,he,Q.key),H.return=$,$=H):(he=Su(Q.type,Q.key,Q.props,null,$.mode,he),he.ref=Ta($,H,Q),he.return=$,$=he)}return I($);case N:e:{for(Pe=Q.key;H!==null;){if(H.key===Pe)if(H.tag===4&&H.stateNode.containerInfo===Q.containerInfo&&H.stateNode.implementation===Q.implementation){h($,H.sibling),H=x(H,Q.children||[]),H.return=$,$=H;break e}else{h($,H);break}else l($,H);H=H.sibling}H=Bf(Q,$.mode,he),H.return=$,$=H}return I($);case G:return Pe=Q._init,yt($,H,Pe(Q._payload),he)}if(Dn(Q))return Ce($,H,Q,he);if(Y(Q))return Se($,H,Q,he);tu($,Q)}return typeof Q=="string"&&Q!==""||typeof Q=="number"?(Q=""+Q,H!==null&&H.tag===6?(h($,H.sibling),H=x(H,Q),H.return=$,$=H):(h($,H),H=Lf(Q,$.mode,he),H.return=$,$=H),I($)):h($,H)}return yt}var ki=Av(!0),Pv=Av(!1),nu=no(null),ru=null,Ri=null,qc=null;function Kc(){qc=Ri=ru=null}function $c(a){var l=nu.current;at(nu),a._currentValue=l}function Xc(a,l,h){for(;a!==null;){var m=a.alternate;if((a.childLanes&l)!==l?(a.childLanes|=l,m!==null&&(m.childLanes|=l)):m!==null&&(m.childLanes&l)!==l&&(m.childLanes|=l),a===h)break;a=a.return}}function Ii(a,l){ru=a,qc=Ri=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&l)!==0&&(un=!0),a.firstContext=null)}function Ln(a){var l=a._currentValue;if(qc!==a)if(a={context:a,memoizedValue:l,next:null},Ri===null){if(ru===null)throw Error(e(308));Ri=a,ru.dependencies={lanes:0,firstContext:a}}else Ri=Ri.next=a;return l}var Fo=null;function Yc(a){Fo===null?Fo=[a]:Fo.push(a)}function Fv(a,l,h,m){var x=l.interleaved;return x===null?(h.next=h,Yc(l)):(h.next=x.next,x.next=h),l.interleaved=h,Pr(a,m)}function Pr(a,l){a.lanes|=l;var h=a.alternate;for(h!==null&&(h.lanes|=l),h=a,a=a.return;a!==null;)a.childLanes|=l,h=a.alternate,h!==null&&(h.childLanes|=l),h=a,a=a.return;return h.tag===3?h.stateNode:null}var io=!1;function Qc(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ov(a,l){a=a.updateQueue,l.updateQueue===a&&(l.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function Fr(a,l){return{eventTime:a,lane:l,tag:0,payload:null,callback:null,next:null}}function ao(a,l,h){var m=a.updateQueue;if(m===null)return null;if(m=m.shared,($e&2)!==0){var x=m.pending;return x===null?l.next=l:(l.next=x.next,x.next=l),m.pending=l,Pr(a,h)}return x=m.interleaved,x===null?(l.next=l,Yc(m)):(l.next=x.next,x.next=l),m.interleaved=l,Pr(a,h)}function ou(a,l,h){if(l=l.updateQueue,l!==null&&(l=l.shared,(h&4194240)!==0)){var m=l.lanes;m&=a.pendingLanes,h|=m,l.lanes=h,fc(a,h)}}function Mv(a,l){var h=a.updateQueue,m=a.alternate;if(m!==null&&(m=m.updateQueue,h===m)){var x=null,E=null;if(h=h.firstBaseUpdate,h!==null){do{var I={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};E===null?x=E=I:E=E.next=I,h=h.next}while(h!==null);E===null?x=E=l:E=E.next=l}else x=E=l;h={baseState:m.baseState,firstBaseUpdate:x,lastBaseUpdate:E,shared:m.shared,effects:m.effects},a.updateQueue=h;return}a=h.lastBaseUpdate,a===null?h.firstBaseUpdate=l:a.next=l,h.lastBaseUpdate=l}function iu(a,l,h,m){var x=a.updateQueue;io=!1;var E=x.firstBaseUpdate,I=x.lastBaseUpdate,M=x.shared.pending;if(M!==null){x.shared.pending=null;var z=M,Z=z.next;z.next=null,I===null?E=Z:I.next=Z,I=z;var ce=a.alternate;ce!==null&&(ce=ce.updateQueue,M=ce.lastBaseUpdate,M!==I&&(M===null?ce.firstBaseUpdate=Z:M.next=Z,ce.lastBaseUpdate=z))}if(E!==null){var fe=x.baseState;I=0,ce=Z=z=null,M=E;do{var le=M.lane,ye=M.eventTime;if((m&le)===le){ce!==null&&(ce=ce.next={eventTime:ye,lane:0,tag:M.tag,payload:M.payload,callback:M.callback,next:null});e:{var Ce=a,Se=M;switch(le=l,ye=h,Se.tag){case 1:if(Ce=Se.payload,typeof Ce=="function"){fe=Ce.call(ye,fe,le);break e}fe=Ce;break e;case 3:Ce.flags=Ce.flags&-65537|128;case 0:if(Ce=Se.payload,le=typeof Ce=="function"?Ce.call(ye,fe,le):Ce,le==null)break e;fe=K({},fe,le);break e;case 2:io=!0}}M.callback!==null&&M.lane!==0&&(a.flags|=64,le=x.effects,le===null?x.effects=[M]:le.push(M))}else ye={eventTime:ye,lane:le,tag:M.tag,payload:M.payload,callback:M.callback,next:null},ce===null?(Z=ce=ye,z=fe):ce=ce.next=ye,I|=le;if(M=M.next,M===null){if(M=x.shared.pending,M===null)break;le=M,M=le.next,le.next=null,x.lastBaseUpdate=le,x.shared.pending=null}}while(!0);if(ce===null&&(z=fe),x.baseState=z,x.firstBaseUpdate=Z,x.lastBaseUpdate=ce,l=x.shared.interleaved,l!==null){x=l;do I|=x.lane,x=x.next;while(x!==l)}else E===null&&(x.shared.lanes=0);Lo|=I,a.lanes=I,a.memoizedState=fe}}function Lv(a,l,h){if(a=l.effects,l.effects=null,a!==null)for(l=0;l<a.length;l++){var m=a[l],x=m.callback;if(x!==null){if(m.callback=null,m=h,typeof x!="function")throw Error(e(191,x));x.call(m)}}}var Da={},ur=no(Da),Aa=no(Da),Pa=no(Da);function Oo(a){if(a===Da)throw Error(e(174));return a}function Jc(a,l){switch(rt(Pa,l),rt(Aa,a),rt(ur,Da),a=l.nodeType,a){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:ir(null,"");break;default:a=a===8?l.parentNode:l,l=a.namespaceURI||null,a=a.tagName,l=ir(l,a)}at(ur),rt(ur,l)}function Ni(){at(ur),at(Aa),at(Pa)}function Bv(a){Oo(Pa.current);var l=Oo(ur.current),h=ir(l,a.type);l!==h&&(rt(Aa,a),rt(ur,h))}function Zc(a){Aa.current===a&&(at(ur),at(Aa))}var lt=no(0);function au(a){for(var l=a;l!==null;){if(l.tag===13){var h=l.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var ef=[];function tf(){for(var a=0;a<ef.length;a++)ef[a]._workInProgressVersionPrimary=null;ef.length=0}var su=k.ReactCurrentDispatcher,nf=k.ReactCurrentBatchConfig,Mo=0,ct=null,Et=null,Dt=null,uu=!1,Fa=!1,Oa=0,o2=0;function Gt(){throw Error(e(321))}function rf(a,l){if(l===null)return!1;for(var h=0;h<l.length&&h<a.length;h++)if(!Kn(a[h],l[h]))return!1;return!0}function of(a,l,h,m,x,E){if(Mo=E,ct=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,su.current=a===null||a.memoizedState===null?u2:l2,a=h(m,x),Fa){E=0;do{if(Fa=!1,Oa=0,25<=E)throw Error(e(301));E+=1,Dt=Et=null,l.updateQueue=null,su.current=c2,a=h(m,x)}while(Fa)}if(su.current=fu,l=Et!==null&&Et.next!==null,Mo=0,Dt=Et=ct=null,uu=!1,l)throw Error(e(300));return a}function af(){var a=Oa!==0;return Oa=0,a}function lr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dt===null?ct.memoizedState=Dt=a:Dt=Dt.next=a,Dt}function Bn(){if(Et===null){var a=ct.alternate;a=a!==null?a.memoizedState:null}else a=Et.next;var l=Dt===null?ct.memoizedState:Dt.next;if(l!==null)Dt=l,Et=a;else{if(a===null)throw Error(e(310));Et=a,a={memoizedState:Et.memoizedState,baseState:Et.baseState,baseQueue:Et.baseQueue,queue:Et.queue,next:null},Dt===null?ct.memoizedState=Dt=a:Dt=Dt.next=a}return Dt}function Ma(a,l){return typeof l=="function"?l(a):l}function sf(a){var l=Bn(),h=l.queue;if(h===null)throw Error(e(311));h.lastRenderedReducer=a;var m=Et,x=m.baseQueue,E=h.pending;if(E!==null){if(x!==null){var I=x.next;x.next=E.next,E.next=I}m.baseQueue=x=E,h.pending=null}if(x!==null){E=x.next,m=m.baseState;var M=I=null,z=null,Z=E;do{var ce=Z.lane;if((Mo&ce)===ce)z!==null&&(z=z.next={lane:0,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null}),m=Z.hasEagerState?Z.eagerState:a(m,Z.action);else{var fe={lane:ce,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null};z===null?(M=z=fe,I=m):z=z.next=fe,ct.lanes|=ce,Lo|=ce}Z=Z.next}while(Z!==null&&Z!==E);z===null?I=m:z.next=M,Kn(m,l.memoizedState)||(un=!0),l.memoizedState=m,l.baseState=I,l.baseQueue=z,h.lastRenderedState=m}if(a=h.interleaved,a!==null){x=a;do E=x.lane,ct.lanes|=E,Lo|=E,x=x.next;while(x!==a)}else x===null&&(h.lanes=0);return[l.memoizedState,h.dispatch]}function uf(a){var l=Bn(),h=l.queue;if(h===null)throw Error(e(311));h.lastRenderedReducer=a;var m=h.dispatch,x=h.pending,E=l.memoizedState;if(x!==null){h.pending=null;var I=x=x.next;do E=a(E,I.action),I=I.next;while(I!==x);Kn(E,l.memoizedState)||(un=!0),l.memoizedState=E,l.baseQueue===null&&(l.baseState=E),h.lastRenderedState=E}return[E,m]}function Wv(){}function zv(a,l){var h=ct,m=Bn(),x=l(),E=!Kn(m.memoizedState,x);if(E&&(m.memoizedState=x,un=!0),m=m.queue,lf(jv.bind(null,h,m,a),[a]),m.getSnapshot!==l||E||Dt!==null&&Dt.memoizedState.tag&1){if(h.flags|=2048,La(9,Vv.bind(null,h,m,x,l),void 0,null),At===null)throw Error(e(349));(Mo&30)!==0||Uv(h,l,x)}return x}function Uv(a,l,h){a.flags|=16384,a={getSnapshot:l,value:h},l=ct.updateQueue,l===null?(l={lastEffect:null,stores:null},ct.updateQueue=l,l.stores=[a]):(h=l.stores,h===null?l.stores=[a]:h.push(a))}function Vv(a,l,h,m){l.value=h,l.getSnapshot=m,Hv(l)&&Gv(a)}function jv(a,l,h){return h(function(){Hv(l)&&Gv(a)})}function Hv(a){var l=a.getSnapshot;a=a.value;try{var h=l();return!Kn(a,h)}catch{return!0}}function Gv(a){var l=Pr(a,1);l!==null&&Jn(l,a,1,-1)}function qv(a){var l=lr();return typeof a=="function"&&(a=a()),l.memoizedState=l.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:a},l.queue=a,a=a.dispatch=s2.bind(null,ct,a),[l.memoizedState,a]}function La(a,l,h,m){return a={tag:a,create:l,destroy:h,deps:m,next:null},l=ct.updateQueue,l===null?(l={lastEffect:null,stores:null},ct.updateQueue=l,l.lastEffect=a.next=a):(h=l.lastEffect,h===null?l.lastEffect=a.next=a:(m=h.next,h.next=a,a.next=m,l.lastEffect=a)),a}function Kv(){return Bn().memoizedState}function lu(a,l,h,m){var x=lr();ct.flags|=a,x.memoizedState=La(1|l,h,void 0,m===void 0?null:m)}function cu(a,l,h,m){var x=Bn();m=m===void 0?null:m;var E=void 0;if(Et!==null){var I=Et.memoizedState;if(E=I.destroy,m!==null&&rf(m,I.deps)){x.memoizedState=La(l,h,E,m);return}}ct.flags|=a,x.memoizedState=La(1|l,h,E,m)}function $v(a,l){return lu(8390656,8,a,l)}function lf(a,l){return cu(2048,8,a,l)}function Xv(a,l){return cu(4,2,a,l)}function Yv(a,l){return cu(4,4,a,l)}function Qv(a,l){if(typeof l=="function")return a=a(),l(a),function(){l(null)};if(l!=null)return a=a(),l.current=a,function(){l.current=null}}function Jv(a,l,h){return h=h!=null?h.concat([a]):null,cu(4,4,Qv.bind(null,l,a),h)}function cf(){}function Zv(a,l){var h=Bn();l=l===void 0?null:l;var m=h.memoizedState;return m!==null&&l!==null&&rf(l,m[1])?m[0]:(h.memoizedState=[a,l],a)}function em(a,l){var h=Bn();l=l===void 0?null:l;var m=h.memoizedState;return m!==null&&l!==null&&rf(l,m[1])?m[0]:(a=a(),h.memoizedState=[a,l],a)}function tm(a,l,h){return(Mo&21)===0?(a.baseState&&(a.baseState=!1,un=!0),a.memoizedState=h):(Kn(h,l)||(h=Dp(),ct.lanes|=h,Lo|=h,a.baseState=!0),l)}function i2(a,l){var h=Ze;Ze=h!==0&&4>h?h:4,a(!0);var m=nf.transition;nf.transition={};try{a(!1),l()}finally{Ze=h,nf.transition=m}}function nm(){return Bn().memoizedState}function a2(a,l,h){var m=co(a);if(h={lane:m,action:h,hasEagerState:!1,eagerState:null,next:null},rm(a))om(l,h);else if(h=Fv(a,l,h,m),h!==null){var x=rn();Jn(h,a,m,x),im(h,l,m)}}function s2(a,l,h){var m=co(a),x={lane:m,action:h,hasEagerState:!1,eagerState:null,next:null};if(rm(a))om(l,x);else{var E=a.alternate;if(a.lanes===0&&(E===null||E.lanes===0)&&(E=l.lastRenderedReducer,E!==null))try{var I=l.lastRenderedState,M=E(I,h);if(x.hasEagerState=!0,x.eagerState=M,Kn(M,I)){var z=l.interleaved;z===null?(x.next=x,Yc(l)):(x.next=z.next,z.next=x),l.interleaved=x;return}}catch{}finally{}h=Fv(a,l,x,m),h!==null&&(x=rn(),Jn(h,a,m,x),im(h,l,m))}}function rm(a){var l=a.alternate;return a===ct||l!==null&&l===ct}function om(a,l){Fa=uu=!0;var h=a.pending;h===null?l.next=l:(l.next=h.next,h.next=l),a.pending=l}function im(a,l,h){if((h&4194240)!==0){var m=l.lanes;m&=a.pendingLanes,h|=m,l.lanes=h,fc(a,h)}}var fu={readContext:Ln,useCallback:Gt,useContext:Gt,useEffect:Gt,useImperativeHandle:Gt,useInsertionEffect:Gt,useLayoutEffect:Gt,useMemo:Gt,useReducer:Gt,useRef:Gt,useState:Gt,useDebugValue:Gt,useDeferredValue:Gt,useTransition:Gt,useMutableSource:Gt,useSyncExternalStore:Gt,useId:Gt,unstable_isNewReconciler:!1},u2={readContext:Ln,useCallback:function(a,l){return lr().memoizedState=[a,l===void 0?null:l],a},useContext:Ln,useEffect:$v,useImperativeHandle:function(a,l,h){return h=h!=null?h.concat([a]):null,lu(4194308,4,Qv.bind(null,l,a),h)},useLayoutEffect:function(a,l){return lu(4194308,4,a,l)},useInsertionEffect:function(a,l){return lu(4,2,a,l)},useMemo:function(a,l){var h=lr();return l=l===void 0?null:l,a=a(),h.memoizedState=[a,l],a},useReducer:function(a,l,h){var m=lr();return l=h!==void 0?h(l):l,m.memoizedState=m.baseState=l,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:l},m.queue=a,a=a.dispatch=a2.bind(null,ct,a),[m.memoizedState,a]},useRef:function(a){var l=lr();return a={current:a},l.memoizedState=a},useState:qv,useDebugValue:cf,useDeferredValue:function(a){return lr().memoizedState=a},useTransition:function(){var a=qv(!1),l=a[0];return a=i2.bind(null,a[1]),lr().memoizedState=a,[l,a]},useMutableSource:function(){},useSyncExternalStore:function(a,l,h){var m=ct,x=lr();if(ut){if(h===void 0)throw Error(e(407));h=h()}else{if(h=l(),At===null)throw Error(e(349));(Mo&30)!==0||Uv(m,l,h)}x.memoizedState=h;var E={value:h,getSnapshot:l};return x.queue=E,$v(jv.bind(null,m,E,a),[a]),m.flags|=2048,La(9,Vv.bind(null,m,E,h,l),void 0,null),h},useId:function(){var a=lr(),l=At.identifierPrefix;if(ut){var h=Ar,m=Dr;h=(m&~(1<<32-qn(m)-1)).toString(32)+h,l=":"+l+"R"+h,h=Oa++,0<h&&(l+="H"+h.toString(32)),l+=":"}else h=o2++,l=":"+l+"r"+h.toString(32)+":";return a.memoizedState=l},unstable_isNewReconciler:!1},l2={readContext:Ln,useCallback:Zv,useContext:Ln,useEffect:lf,useImperativeHandle:Jv,useInsertionEffect:Xv,useLayoutEffect:Yv,useMemo:em,useReducer:sf,useRef:Kv,useState:function(){return sf(Ma)},useDebugValue:cf,useDeferredValue:function(a){var l=Bn();return tm(l,Et.memoizedState,a)},useTransition:function(){var a=sf(Ma)[0],l=Bn().memoizedState;return[a,l]},useMutableSource:Wv,useSyncExternalStore:zv,useId:nm,unstable_isNewReconciler:!1},c2={readContext:Ln,useCallback:Zv,useContext:Ln,useEffect:lf,useImperativeHandle:Jv,useInsertionEffect:Xv,useLayoutEffect:Yv,useMemo:em,useReducer:uf,useRef:Kv,useState:function(){return uf(Ma)},useDebugValue:cf,useDeferredValue:function(a){var l=Bn();return Et===null?l.memoizedState=a:tm(l,Et.memoizedState,a)},useTransition:function(){var a=uf(Ma)[0],l=Bn().memoizedState;return[a,l]},useMutableSource:Wv,useSyncExternalStore:zv,useId:nm,unstable_isNewReconciler:!1};function Xn(a,l){if(a&&a.defaultProps){l=K({},l),a=a.defaultProps;for(var h in a)l[h]===void 0&&(l[h]=a[h]);return l}return l}function ff(a,l,h,m){l=a.memoizedState,h=h(m,l),h=h==null?l:K({},l,h),a.memoizedState=h,a.lanes===0&&(a.updateQueue.baseState=h)}var du={isMounted:function(a){return(a=a._reactInternals)?No(a)===a:!1},enqueueSetState:function(a,l,h){a=a._reactInternals;var m=rn(),x=co(a),E=Fr(m,x);E.payload=l,h!=null&&(E.callback=h),l=ao(a,E,x),l!==null&&(Jn(l,a,x,m),ou(l,a,x))},enqueueReplaceState:function(a,l,h){a=a._reactInternals;var m=rn(),x=co(a),E=Fr(m,x);E.tag=1,E.payload=l,h!=null&&(E.callback=h),l=ao(a,E,x),l!==null&&(Jn(l,a,x,m),ou(l,a,x))},enqueueForceUpdate:function(a,l){a=a._reactInternals;var h=rn(),m=co(a),x=Fr(h,m);x.tag=2,l!=null&&(x.callback=l),l=ao(a,x,m),l!==null&&(Jn(l,a,m,h),ou(l,a,m))}};function am(a,l,h,m,x,E,I){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(m,E,I):l.prototype&&l.prototype.isPureReactComponent?!Ea(h,m)||!Ea(x,E):!0}function sm(a,l,h){var m=!1,x=ro,E=l.contextType;return typeof E=="object"&&E!==null?E=Ln(E):(x=sn(l)?Do:Ht.current,m=l.contextTypes,E=(m=m!=null)?Ci(a,x):ro),l=new l(h,E),a.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=du,a.stateNode=l,l._reactInternals=a,m&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=x,a.__reactInternalMemoizedMaskedChildContext=E),l}function um(a,l,h,m){a=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(h,m),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(h,m),l.state!==a&&du.enqueueReplaceState(l,l.state,null)}function df(a,l,h,m){var x=a.stateNode;x.props=h,x.state=a.memoizedState,x.refs={},Qc(a);var E=l.contextType;typeof E=="object"&&E!==null?x.context=Ln(E):(E=sn(l)?Do:Ht.current,x.context=Ci(a,E)),x.state=a.memoizedState,E=l.getDerivedStateFromProps,typeof E=="function"&&(ff(a,l,E,h),x.state=a.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(l=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),l!==x.state&&du.enqueueReplaceState(x,x.state,null),iu(a,h,x,m),x.state=a.memoizedState),typeof x.componentDidMount=="function"&&(a.flags|=4194308)}function Ti(a,l){try{var h="",m=l;do h+=me(m),m=m.return;while(m);var x=h}catch(E){x=`
Error generating stack: `+E.message+`
`+E.stack}return{value:a,source:l,stack:x,digest:null}}function hf(a,l,h){return{value:a,source:null,stack:h??null,digest:l??null}}function pf(a,l){try{console.error(l.value)}catch(h){setTimeout(function(){throw h})}}var f2=typeof WeakMap=="function"?WeakMap:Map;function lm(a,l,h){h=Fr(-1,h),h.tag=3,h.payload={element:null};var m=l.value;return h.callback=function(){xu||(xu=!0,Nf=m),pf(a,l)},h}function cm(a,l,h){h=Fr(-1,h),h.tag=3;var m=a.type.getDerivedStateFromError;if(typeof m=="function"){var x=l.value;h.payload=function(){return m(x)},h.callback=function(){pf(a,l)}}var E=a.stateNode;return E!==null&&typeof E.componentDidCatch=="function"&&(h.callback=function(){pf(a,l),typeof m!="function"&&(uo===null?uo=new Set([this]):uo.add(this));var I=l.stack;this.componentDidCatch(l.value,{componentStack:I!==null?I:""})}),h}function fm(a,l,h){var m=a.pingCache;if(m===null){m=a.pingCache=new f2;var x=new Set;m.set(l,x)}else x=m.get(l),x===void 0&&(x=new Set,m.set(l,x));x.has(h)||(x.add(h),a=S2.bind(null,a,l,h),l.then(a,a))}function dm(a){do{var l;if((l=a.tag===13)&&(l=a.memoizedState,l=l!==null?l.dehydrated!==null:!0),l)return a;a=a.return}while(a!==null);return null}function hm(a,l,h,m,x){return(a.mode&1)===0?(a===l?a.flags|=65536:(a.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(l=Fr(-1,1),l.tag=2,ao(h,l,1))),h.lanes|=1),a):(a.flags|=65536,a.lanes=x,a)}var d2=k.ReactCurrentOwner,un=!1;function nn(a,l,h,m){l.child=a===null?Pv(l,null,h,m):ki(l,a.child,h,m)}function pm(a,l,h,m,x){h=h.render;var E=l.ref;return Ii(l,x),m=of(a,l,h,m,E,x),h=af(),a!==null&&!un?(l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~x,Or(a,l,x)):(ut&&h&&Uc(l),l.flags|=1,nn(a,l,m,x),l.child)}function vm(a,l,h,m,x){if(a===null){var E=h.type;return typeof E=="function"&&!Mf(E)&&E.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(l.tag=15,l.type=E,mm(a,l,E,m,x)):(a=Su(h.type,null,m,l,l.mode,x),a.ref=l.ref,a.return=l,l.child=a)}if(E=a.child,(a.lanes&x)===0){var I=E.memoizedProps;if(h=h.compare,h=h!==null?h:Ea,h(I,m)&&a.ref===l.ref)return Or(a,l,x)}return l.flags|=1,a=ho(E,m),a.ref=l.ref,a.return=l,l.child=a}function mm(a,l,h,m,x){if(a!==null){var E=a.memoizedProps;if(Ea(E,m)&&a.ref===l.ref)if(un=!1,l.pendingProps=m=E,(a.lanes&x)!==0)(a.flags&131072)!==0&&(un=!0);else return l.lanes=a.lanes,Or(a,l,x)}return vf(a,l,h,m,x)}function gm(a,l,h){var m=l.pendingProps,x=m.children,E=a!==null?a.memoizedState:null;if(m.mode==="hidden")if((l.mode&1)===0)l.memoizedState={baseLanes:0,cachePool:null,transitions:null},rt(Ai,_n),_n|=h;else{if((h&1073741824)===0)return a=E!==null?E.baseLanes|h:h,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:a,cachePool:null,transitions:null},l.updateQueue=null,rt(Ai,_n),_n|=a,null;l.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=E!==null?E.baseLanes:h,rt(Ai,_n),_n|=m}else E!==null?(m=E.baseLanes|h,l.memoizedState=null):m=h,rt(Ai,_n),_n|=m;return nn(a,l,x,h),l.child}function ym(a,l){var h=l.ref;(a===null&&h!==null||a!==null&&a.ref!==h)&&(l.flags|=512,l.flags|=2097152)}function vf(a,l,h,m,x){var E=sn(h)?Do:Ht.current;return E=Ci(l,E),Ii(l,x),h=of(a,l,h,m,E,x),m=af(),a!==null&&!un?(l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~x,Or(a,l,x)):(ut&&m&&Uc(l),l.flags|=1,nn(a,l,h,x),l.child)}function xm(a,l,h,m,x){if(sn(h)){var E=!0;Ys(l)}else E=!1;if(Ii(l,x),l.stateNode===null)pu(a,l),sm(l,h,m),df(l,h,m,x),m=!0;else if(a===null){var I=l.stateNode,M=l.memoizedProps;I.props=M;var z=I.context,Z=h.contextType;typeof Z=="object"&&Z!==null?Z=Ln(Z):(Z=sn(h)?Do:Ht.current,Z=Ci(l,Z));var ce=h.getDerivedStateFromProps,fe=typeof ce=="function"||typeof I.getSnapshotBeforeUpdate=="function";fe||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(M!==m||z!==Z)&&um(l,I,m,Z),io=!1;var le=l.memoizedState;I.state=le,iu(l,m,I,x),z=l.memoizedState,M!==m||le!==z||an.current||io?(typeof ce=="function"&&(ff(l,h,ce,m),z=l.memoizedState),(M=io||am(l,h,M,m,le,z,Z))?(fe||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(l.flags|=4194308)):(typeof I.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=m,l.memoizedState=z),I.props=m,I.state=z,I.context=Z,m=M):(typeof I.componentDidMount=="function"&&(l.flags|=4194308),m=!1)}else{I=l.stateNode,Ov(a,l),M=l.memoizedProps,Z=l.type===l.elementType?M:Xn(l.type,M),I.props=Z,fe=l.pendingProps,le=I.context,z=h.contextType,typeof z=="object"&&z!==null?z=Ln(z):(z=sn(h)?Do:Ht.current,z=Ci(l,z));var ye=h.getDerivedStateFromProps;(ce=typeof ye=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(M!==fe||le!==z)&&um(l,I,m,z),io=!1,le=l.memoizedState,I.state=le,iu(l,m,I,x);var Ce=l.memoizedState;M!==fe||le!==Ce||an.current||io?(typeof ye=="function"&&(ff(l,h,ye,m),Ce=l.memoizedState),(Z=io||am(l,h,Z,m,le,Ce,z)||!1)?(ce||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(m,Ce,z),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(m,Ce,z)),typeof I.componentDidUpdate=="function"&&(l.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof I.componentDidUpdate!="function"||M===a.memoizedProps&&le===a.memoizedState||(l.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||M===a.memoizedProps&&le===a.memoizedState||(l.flags|=1024),l.memoizedProps=m,l.memoizedState=Ce),I.props=m,I.state=Ce,I.context=z,m=Z):(typeof I.componentDidUpdate!="function"||M===a.memoizedProps&&le===a.memoizedState||(l.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||M===a.memoizedProps&&le===a.memoizedState||(l.flags|=1024),m=!1)}return mf(a,l,h,m,E,x)}function mf(a,l,h,m,x,E){ym(a,l);var I=(l.flags&128)!==0;if(!m&&!I)return x&&_v(l,h,!1),Or(a,l,E);m=l.stateNode,d2.current=l;var M=I&&typeof h.getDerivedStateFromError!="function"?null:m.render();return l.flags|=1,a!==null&&I?(l.child=ki(l,a.child,null,E),l.child=ki(l,null,M,E)):nn(a,l,M,E),l.memoizedState=m.state,x&&_v(l,h,!0),l.child}function wm(a){var l=a.stateNode;l.pendingContext?Cv(a,l.pendingContext,l.pendingContext!==l.context):l.context&&Cv(a,l.context,!1),Jc(a,l.containerInfo)}function bm(a,l,h,m,x){return Si(),Gc(x),l.flags|=256,nn(a,l,h,m),l.child}var gf={dehydrated:null,treeContext:null,retryLane:0};function yf(a){return{baseLanes:a,cachePool:null,transitions:null}}function Cm(a,l,h){var m=l.pendingProps,x=lt.current,E=!1,I=(l.flags&128)!==0,M;if((M=I)||(M=a!==null&&a.memoizedState===null?!1:(x&2)!==0),M?(E=!0,l.flags&=-129):(a===null||a.memoizedState!==null)&&(x|=1),rt(lt,x&1),a===null)return Hc(l),a=l.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((l.mode&1)===0?l.lanes=1:a.data==="$!"?l.lanes=8:l.lanes=1073741824,null):(I=m.children,a=m.fallback,E?(m=l.mode,E=l.child,I={mode:"hidden",children:I},(m&1)===0&&E!==null?(E.childLanes=0,E.pendingProps=I):E=ku(I,m,0,null),a=Uo(a,m,h,null),E.return=l,a.return=l,E.sibling=a,l.child=E,l.child.memoizedState=yf(h),l.memoizedState=gf,a):xf(l,I));if(x=a.memoizedState,x!==null&&(M=x.dehydrated,M!==null))return h2(a,l,I,m,M,x,h);if(E){E=m.fallback,I=l.mode,x=a.child,M=x.sibling;var z={mode:"hidden",children:m.children};return(I&1)===0&&l.child!==x?(m=l.child,m.childLanes=0,m.pendingProps=z,l.deletions=null):(m=ho(x,z),m.subtreeFlags=x.subtreeFlags&14680064),M!==null?E=ho(M,E):(E=Uo(E,I,h,null),E.flags|=2),E.return=l,m.return=l,m.sibling=E,l.child=m,m=E,E=l.child,I=a.child.memoizedState,I=I===null?yf(h):{baseLanes:I.baseLanes|h,cachePool:null,transitions:I.transitions},E.memoizedState=I,E.childLanes=a.childLanes&~h,l.memoizedState=gf,m}return E=a.child,a=E.sibling,m=ho(E,{mode:"visible",children:m.children}),(l.mode&1)===0&&(m.lanes=h),m.return=l,m.sibling=null,a!==null&&(h=l.deletions,h===null?(l.deletions=[a],l.flags|=16):h.push(a)),l.child=m,l.memoizedState=null,m}function xf(a,l){return l=ku({mode:"visible",children:l},a.mode,0,null),l.return=a,a.child=l}function hu(a,l,h,m){return m!==null&&Gc(m),ki(l,a.child,null,h),a=xf(l,l.pendingProps.children),a.flags|=2,l.memoizedState=null,a}function h2(a,l,h,m,x,E,I){if(h)return l.flags&256?(l.flags&=-257,m=hf(Error(e(422))),hu(a,l,I,m)):l.memoizedState!==null?(l.child=a.child,l.flags|=128,null):(E=m.fallback,x=l.mode,m=ku({mode:"visible",children:m.children},x,0,null),E=Uo(E,x,I,null),E.flags|=2,m.return=l,E.return=l,m.sibling=E,l.child=m,(l.mode&1)!==0&&ki(l,a.child,null,I),l.child.memoizedState=yf(I),l.memoizedState=gf,E);if((l.mode&1)===0)return hu(a,l,I,null);if(x.data==="$!"){if(m=x.nextSibling&&x.nextSibling.dataset,m)var M=m.dgst;return m=M,E=Error(e(419)),m=hf(E,m,void 0),hu(a,l,I,m)}if(M=(I&a.childLanes)!==0,un||M){if(m=At,m!==null){switch(I&-I){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=(x&(m.suspendedLanes|I))!==0?0:x,x!==0&&x!==E.retryLane&&(E.retryLane=x,Pr(a,x),Jn(m,a,x,-1))}return Of(),m=hf(Error(e(421))),hu(a,l,I,m)}return x.data==="$?"?(l.flags|=128,l.child=a.child,l=k2.bind(null,a),x._reactRetry=l,null):(a=E.treeContext,En=to(x.nextSibling),Cn=l,ut=!0,$n=null,a!==null&&(On[Mn++]=Dr,On[Mn++]=Ar,On[Mn++]=Ao,Dr=a.id,Ar=a.overflow,Ao=l),l=xf(l,m.children),l.flags|=4096,l)}function Em(a,l,h){a.lanes|=l;var m=a.alternate;m!==null&&(m.lanes|=l),Xc(a.return,l,h)}function wf(a,l,h,m,x){var E=a.memoizedState;E===null?a.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:m,tail:h,tailMode:x}:(E.isBackwards=l,E.rendering=null,E.renderingStartTime=0,E.last=m,E.tail=h,E.tailMode=x)}function _m(a,l,h){var m=l.pendingProps,x=m.revealOrder,E=m.tail;if(nn(a,l,m.children,h),m=lt.current,(m&2)!==0)m=m&1|2,l.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=l.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Em(a,h,l);else if(a.tag===19)Em(a,h,l);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}m&=1}if(rt(lt,m),(l.mode&1)===0)l.memoizedState=null;else switch(x){case"forwards":for(h=l.child,x=null;h!==null;)a=h.alternate,a!==null&&au(a)===null&&(x=h),h=h.sibling;h=x,h===null?(x=l.child,l.child=null):(x=h.sibling,h.sibling=null),wf(l,!1,x,h,E);break;case"backwards":for(h=null,x=l.child,l.child=null;x!==null;){if(a=x.alternate,a!==null&&au(a)===null){l.child=x;break}a=x.sibling,x.sibling=h,h=x,x=a}wf(l,!0,h,null,E);break;case"together":wf(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function pu(a,l){(l.mode&1)===0&&a!==null&&(a.alternate=null,l.alternate=null,l.flags|=2)}function Or(a,l,h){if(a!==null&&(l.dependencies=a.dependencies),Lo|=l.lanes,(h&l.childLanes)===0)return null;if(a!==null&&l.child!==a.child)throw Error(e(153));if(l.child!==null){for(a=l.child,h=ho(a,a.pendingProps),l.child=h,h.return=l;a.sibling!==null;)a=a.sibling,h=h.sibling=ho(a,a.pendingProps),h.return=l;h.sibling=null}return l.child}function p2(a,l,h){switch(l.tag){case 3:wm(l),Si();break;case 5:Bv(l);break;case 1:sn(l.type)&&Ys(l);break;case 4:Jc(l,l.stateNode.containerInfo);break;case 10:var m=l.type._context,x=l.memoizedProps.value;rt(nu,m._currentValue),m._currentValue=x;break;case 13:if(m=l.memoizedState,m!==null)return m.dehydrated!==null?(rt(lt,lt.current&1),l.flags|=128,null):(h&l.child.childLanes)!==0?Cm(a,l,h):(rt(lt,lt.current&1),a=Or(a,l,h),a!==null?a.sibling:null);rt(lt,lt.current&1);break;case 19:if(m=(h&l.childLanes)!==0,(a.flags&128)!==0){if(m)return _m(a,l,h);l.flags|=128}if(x=l.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),rt(lt,lt.current),m)break;return null;case 22:case 23:return l.lanes=0,gm(a,l,h)}return Or(a,l,h)}var Sm,bf,km,Rm;Sm=function(a,l){for(var h=l.child;h!==null;){if(h.tag===5||h.tag===6)a.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return;h=h.return}h.sibling.return=h.return,h=h.sibling}},bf=function(){},km=function(a,l,h,m){var x=a.memoizedProps;if(x!==m){a=l.stateNode,Oo(ur.current);var E=null;switch(h){case"input":x=et(a,x),m=et(a,m),E=[];break;case"select":x=K({},x,{value:void 0}),m=K({},m,{value:void 0}),E=[];break;case"textarea":x=An(a,x),m=An(a,m),E=[];break;default:typeof x.onClick!="function"&&typeof m.onClick=="function"&&(a.onclick=Ks)}ec(h,m);var I;h=null;for(Z in x)if(!m.hasOwnProperty(Z)&&x.hasOwnProperty(Z)&&x[Z]!=null)if(Z==="style"){var M=x[Z];for(I in M)M.hasOwnProperty(I)&&(h||(h={}),h[I]="")}else Z!=="dangerouslySetInnerHTML"&&Z!=="children"&&Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&Z!=="autoFocus"&&(o.hasOwnProperty(Z)?E||(E=[]):(E=E||[]).push(Z,null));for(Z in m){var z=m[Z];if(M=x?.[Z],m.hasOwnProperty(Z)&&z!==M&&(z!=null||M!=null))if(Z==="style")if(M){for(I in M)!M.hasOwnProperty(I)||z&&z.hasOwnProperty(I)||(h||(h={}),h[I]="");for(I in z)z.hasOwnProperty(I)&&M[I]!==z[I]&&(h||(h={}),h[I]=z[I])}else h||(E||(E=[]),E.push(Z,h)),h=z;else Z==="dangerouslySetInnerHTML"?(z=z?z.__html:void 0,M=M?M.__html:void 0,z!=null&&M!==z&&(E=E||[]).push(Z,z)):Z==="children"?typeof z!="string"&&typeof z!="number"||(E=E||[]).push(Z,""+z):Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&(o.hasOwnProperty(Z)?(z!=null&&Z==="onScroll"&&it("scroll",a),E||M===z||(E=[])):(E=E||[]).push(Z,z))}h&&(E=E||[]).push("style",h);var Z=E;(l.updateQueue=Z)&&(l.flags|=4)}},Rm=function(a,l,h,m){h!==m&&(l.flags|=4)};function Ba(a,l){if(!ut)switch(a.tailMode){case"hidden":l=a.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?a.tail=null:h.sibling=null;break;case"collapsed":h=a.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?l||a.tail===null?a.tail=null:a.tail.sibling=null:m.sibling=null}}function qt(a){var l=a.alternate!==null&&a.alternate.child===a.child,h=0,m=0;if(l)for(var x=a.child;x!==null;)h|=x.lanes|x.childLanes,m|=x.subtreeFlags&14680064,m|=x.flags&14680064,x.return=a,x=x.sibling;else for(x=a.child;x!==null;)h|=x.lanes|x.childLanes,m|=x.subtreeFlags,m|=x.flags,x.return=a,x=x.sibling;return a.subtreeFlags|=m,a.childLanes=h,l}function v2(a,l,h){var m=l.pendingProps;switch(Vc(l),l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qt(l),null;case 1:return sn(l.type)&&Xs(),qt(l),null;case 3:return m=l.stateNode,Ni(),at(an),at(Ht),tf(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(a===null||a.child===null)&&(eu(l)?l.flags|=4:a===null||a.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,$n!==null&&(Af($n),$n=null))),bf(a,l),qt(l),null;case 5:Zc(l);var x=Oo(Pa.current);if(h=l.type,a!==null&&l.stateNode!=null)km(a,l,h,m,x),a.ref!==l.ref&&(l.flags|=512,l.flags|=2097152);else{if(!m){if(l.stateNode===null)throw Error(e(166));return qt(l),null}if(a=Oo(ur.current),eu(l)){m=l.stateNode,h=l.type;var E=l.memoizedProps;switch(m[sr]=l,m[Ia]=E,a=(l.mode&1)!==0,h){case"dialog":it("cancel",m),it("close",m);break;case"iframe":case"object":case"embed":it("load",m);break;case"video":case"audio":for(x=0;x<Sa.length;x++)it(Sa[x],m);break;case"source":it("error",m);break;case"img":case"image":case"link":it("error",m),it("load",m);break;case"details":it("toggle",m);break;case"input":tt(m,E),it("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!E.multiple},it("invalid",m);break;case"textarea":Pn(m,E),it("invalid",m)}ec(h,E),x=null;for(var I in E)if(E.hasOwnProperty(I)){var M=E[I];I==="children"?typeof M=="string"?m.textContent!==M&&(E.suppressHydrationWarning!==!0&&qs(m.textContent,M,a),x=["children",M]):typeof M=="number"&&m.textContent!==""+M&&(E.suppressHydrationWarning!==!0&&qs(m.textContent,M,a),x=["children",""+M]):o.hasOwnProperty(I)&&M!=null&&I==="onScroll"&&it("scroll",m)}switch(h){case"input":Ue(m),wn(m,E,!0);break;case"textarea":Ue(m),Fn(m);break;case"select":case"option":break;default:typeof E.onClick=="function"&&(m.onclick=Ks)}m=x,l.updateQueue=m,m!==null&&(l.flags|=4)}else{I=x.nodeType===9?x:x.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=si(h)),a==="http://www.w3.org/1999/xhtml"?h==="script"?(a=I.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof m.is=="string"?a=I.createElement(h,{is:m.is}):(a=I.createElement(h),h==="select"&&(I=a,m.multiple?I.multiple=!0:m.size&&(I.size=m.size))):a=I.createElementNS(a,h),a[sr]=l,a[Ia]=m,Sm(a,l,!1,!1),l.stateNode=a;e:{switch(I=tc(h,m),h){case"dialog":it("cancel",a),it("close",a),x=m;break;case"iframe":case"object":case"embed":it("load",a),x=m;break;case"video":case"audio":for(x=0;x<Sa.length;x++)it(Sa[x],a);x=m;break;case"source":it("error",a),x=m;break;case"img":case"image":case"link":it("error",a),it("load",a),x=m;break;case"details":it("toggle",a),x=m;break;case"input":tt(a,m),x=et(a,m),it("invalid",a);break;case"option":x=m;break;case"select":a._wrapperState={wasMultiple:!!m.multiple},x=K({},m,{value:void 0}),it("invalid",a);break;case"textarea":Pn(a,m),x=An(a,m),it("invalid",a);break;default:x=m}ec(h,x),M=x;for(E in M)if(M.hasOwnProperty(E)){var z=M[E];E==="style"?ci(a,z):E==="dangerouslySetInnerHTML"?(z=z?z.__html:void 0,z!=null&&ui(a,z)):E==="children"?typeof z=="string"?(h!=="textarea"||z!=="")&&Ro(a,z):typeof z=="number"&&Ro(a,""+z):E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&E!=="autoFocus"&&(o.hasOwnProperty(E)?z!=null&&E==="onScroll"&&it("scroll",a):z!=null&&S(a,E,z,I))}switch(h){case"input":Ue(a),wn(a,m,!1);break;case"textarea":Ue(a),Fn(a);break;case"option":m.value!=null&&a.setAttribute("value",""+be(m.value));break;case"select":a.multiple=!!m.multiple,E=m.value,E!=null?jt(a,!!m.multiple,E,!1):m.defaultValue!=null&&jt(a,!!m.multiple,m.defaultValue,!0);break;default:typeof x.onClick=="function"&&(a.onclick=Ks)}switch(h){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(l.flags|=4)}l.ref!==null&&(l.flags|=512,l.flags|=2097152)}return qt(l),null;case 6:if(a&&l.stateNode!=null)Rm(a,l,a.memoizedProps,m);else{if(typeof m!="string"&&l.stateNode===null)throw Error(e(166));if(h=Oo(Pa.current),Oo(ur.current),eu(l)){if(m=l.stateNode,h=l.memoizedProps,m[sr]=l,(E=m.nodeValue!==h)&&(a=Cn,a!==null))switch(a.tag){case 3:qs(m.nodeValue,h,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&qs(m.nodeValue,h,(a.mode&1)!==0)}E&&(l.flags|=4)}else m=(h.nodeType===9?h:h.ownerDocument).createTextNode(m),m[sr]=l,l.stateNode=m}return qt(l),null;case 13:if(at(lt),m=l.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(ut&&En!==null&&(l.mode&1)!==0&&(l.flags&128)===0)Tv(),Si(),l.flags|=98560,E=!1;else if(E=eu(l),m!==null&&m.dehydrated!==null){if(a===null){if(!E)throw Error(e(318));if(E=l.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(e(317));E[sr]=l}else Si(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;qt(l),E=!1}else $n!==null&&(Af($n),$n=null),E=!0;if(!E)return l.flags&65536?l:null}return(l.flags&128)!==0?(l.lanes=h,l):(m=m!==null,m!==(a!==null&&a.memoizedState!==null)&&m&&(l.child.flags|=8192,(l.mode&1)!==0&&(a===null||(lt.current&1)!==0?_t===0&&(_t=3):Of())),l.updateQueue!==null&&(l.flags|=4),qt(l),null);case 4:return Ni(),bf(a,l),a===null&&ka(l.stateNode.containerInfo),qt(l),null;case 10:return $c(l.type._context),qt(l),null;case 17:return sn(l.type)&&Xs(),qt(l),null;case 19:if(at(lt),E=l.memoizedState,E===null)return qt(l),null;if(m=(l.flags&128)!==0,I=E.rendering,I===null)if(m)Ba(E,!1);else{if(_t!==0||a!==null&&(a.flags&128)!==0)for(a=l.child;a!==null;){if(I=au(a),I!==null){for(l.flags|=128,Ba(E,!1),m=I.updateQueue,m!==null&&(l.updateQueue=m,l.flags|=4),l.subtreeFlags=0,m=h,h=l.child;h!==null;)E=h,a=m,E.flags&=14680066,I=E.alternate,I===null?(E.childLanes=0,E.lanes=a,E.child=null,E.subtreeFlags=0,E.memoizedProps=null,E.memoizedState=null,E.updateQueue=null,E.dependencies=null,E.stateNode=null):(E.childLanes=I.childLanes,E.lanes=I.lanes,E.child=I.child,E.subtreeFlags=0,E.deletions=null,E.memoizedProps=I.memoizedProps,E.memoizedState=I.memoizedState,E.updateQueue=I.updateQueue,E.type=I.type,a=I.dependencies,E.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),h=h.sibling;return rt(lt,lt.current&1|2),l.child}a=a.sibling}E.tail!==null&&gt()>Pi&&(l.flags|=128,m=!0,Ba(E,!1),l.lanes=4194304)}else{if(!m)if(a=au(I),a!==null){if(l.flags|=128,m=!0,h=a.updateQueue,h!==null&&(l.updateQueue=h,l.flags|=4),Ba(E,!0),E.tail===null&&E.tailMode==="hidden"&&!I.alternate&&!ut)return qt(l),null}else 2*gt()-E.renderingStartTime>Pi&&h!==1073741824&&(l.flags|=128,m=!0,Ba(E,!1),l.lanes=4194304);E.isBackwards?(I.sibling=l.child,l.child=I):(h=E.last,h!==null?h.sibling=I:l.child=I,E.last=I)}return E.tail!==null?(l=E.tail,E.rendering=l,E.tail=l.sibling,E.renderingStartTime=gt(),l.sibling=null,h=lt.current,rt(lt,m?h&1|2:h&1),l):(qt(l),null);case 22:case 23:return Ff(),m=l.memoizedState!==null,a!==null&&a.memoizedState!==null!==m&&(l.flags|=8192),m&&(l.mode&1)!==0?(_n&1073741824)!==0&&(qt(l),l.subtreeFlags&6&&(l.flags|=8192)):qt(l),null;case 24:return null;case 25:return null}throw Error(e(156,l.tag))}function m2(a,l){switch(Vc(l),l.tag){case 1:return sn(l.type)&&Xs(),a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 3:return Ni(),at(an),at(Ht),tf(),a=l.flags,(a&65536)!==0&&(a&128)===0?(l.flags=a&-65537|128,l):null;case 5:return Zc(l),null;case 13:if(at(lt),a=l.memoizedState,a!==null&&a.dehydrated!==null){if(l.alternate===null)throw Error(e(340));Si()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 19:return at(lt),null;case 4:return Ni(),null;case 10:return $c(l.type._context),null;case 22:case 23:return Ff(),null;case 24:return null;default:return null}}var vu=!1,Kt=!1,g2=typeof WeakSet=="function"?WeakSet:Set,we=null;function Di(a,l){var h=a.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(m){vt(a,l,m)}else h.current=null}function Cf(a,l,h){try{h()}catch(m){vt(a,l,m)}}var Im=!1;function y2(a,l){if(Pc=Os,a=av(),Sc(a)){if("selectionStart"in a)var h={start:a.selectionStart,end:a.selectionEnd};else e:{h=(h=a.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&m.rangeCount!==0){h=m.anchorNode;var x=m.anchorOffset,E=m.focusNode;m=m.focusOffset;try{h.nodeType,E.nodeType}catch{h=null;break e}var I=0,M=-1,z=-1,Z=0,ce=0,fe=a,le=null;t:for(;;){for(var ye;fe!==h||x!==0&&fe.nodeType!==3||(M=I+x),fe!==E||m!==0&&fe.nodeType!==3||(z=I+m),fe.nodeType===3&&(I+=fe.nodeValue.length),(ye=fe.firstChild)!==null;)le=fe,fe=ye;for(;;){if(fe===a)break t;if(le===h&&++Z===x&&(M=I),le===E&&++ce===m&&(z=I),(ye=fe.nextSibling)!==null)break;fe=le,le=fe.parentNode}fe=ye}h=M===-1||z===-1?null:{start:M,end:z}}else h=null}h=h||{start:0,end:0}}else h=null;for(Fc={focusedElem:a,selectionRange:h},Os=!1,we=l;we!==null;)if(l=we,a=l.child,(l.subtreeFlags&1028)!==0&&a!==null)a.return=l,we=a;else for(;we!==null;){l=we;try{var Ce=l.alternate;if((l.flags&1024)!==0)switch(l.tag){case 0:case 11:case 15:break;case 1:if(Ce!==null){var Se=Ce.memoizedProps,yt=Ce.memoizedState,$=l.stateNode,H=$.getSnapshotBeforeUpdate(l.elementType===l.type?Se:Xn(l.type,Se),yt);$.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var Q=l.stateNode.containerInfo;Q.nodeType===1?Q.textContent="":Q.nodeType===9&&Q.documentElement&&Q.removeChild(Q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(e(163))}}catch(he){vt(l,l.return,he)}if(a=l.sibling,a!==null){a.return=l.return,we=a;break}we=l.return}return Ce=Im,Im=!1,Ce}function Wa(a,l,h){var m=l.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var x=m=m.next;do{if((x.tag&a)===a){var E=x.destroy;x.destroy=void 0,E!==void 0&&Cf(l,h,E)}x=x.next}while(x!==m)}}function mu(a,l){if(l=l.updateQueue,l=l!==null?l.lastEffect:null,l!==null){var h=l=l.next;do{if((h.tag&a)===a){var m=h.create;h.destroy=m()}h=h.next}while(h!==l)}}function Ef(a){var l=a.ref;if(l!==null){var h=a.stateNode;switch(a.tag){case 5:a=h;break;default:a=h}typeof l=="function"?l(a):l.current=a}}function Nm(a){var l=a.alternate;l!==null&&(a.alternate=null,Nm(l)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(l=a.stateNode,l!==null&&(delete l[sr],delete l[Ia],delete l[Bc],delete l[e2],delete l[t2])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function Tm(a){return a.tag===5||a.tag===3||a.tag===4}function Dm(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Tm(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function _f(a,l,h){var m=a.tag;if(m===5||m===6)a=a.stateNode,l?h.nodeType===8?h.parentNode.insertBefore(a,l):h.insertBefore(a,l):(h.nodeType===8?(l=h.parentNode,l.insertBefore(a,h)):(l=h,l.appendChild(a)),h=h._reactRootContainer,h!=null||l.onclick!==null||(l.onclick=Ks));else if(m!==4&&(a=a.child,a!==null))for(_f(a,l,h),a=a.sibling;a!==null;)_f(a,l,h),a=a.sibling}function Sf(a,l,h){var m=a.tag;if(m===5||m===6)a=a.stateNode,l?h.insertBefore(a,l):h.appendChild(a);else if(m!==4&&(a=a.child,a!==null))for(Sf(a,l,h),a=a.sibling;a!==null;)Sf(a,l,h),a=a.sibling}var Bt=null,Yn=!1;function so(a,l,h){for(h=h.child;h!==null;)Am(a,l,h),h=h.sibling}function Am(a,l,h){if(ar&&typeof ar.onCommitFiberUnmount=="function")try{ar.onCommitFiberUnmount(Ns,h)}catch{}switch(h.tag){case 5:Kt||Di(h,l);case 6:var m=Bt,x=Yn;Bt=null,so(a,l,h),Bt=m,Yn=x,Bt!==null&&(Yn?(a=Bt,h=h.stateNode,a.nodeType===8?a.parentNode.removeChild(h):a.removeChild(h)):Bt.removeChild(h.stateNode));break;case 18:Bt!==null&&(Yn?(a=Bt,h=h.stateNode,a.nodeType===8?Lc(a.parentNode,h):a.nodeType===1&&Lc(a,h),ga(a)):Lc(Bt,h.stateNode));break;case 4:m=Bt,x=Yn,Bt=h.stateNode.containerInfo,Yn=!0,so(a,l,h),Bt=m,Yn=x;break;case 0:case 11:case 14:case 15:if(!Kt&&(m=h.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){x=m=m.next;do{var E=x,I=E.destroy;E=E.tag,I!==void 0&&((E&2)!==0||(E&4)!==0)&&Cf(h,l,I),x=x.next}while(x!==m)}so(a,l,h);break;case 1:if(!Kt&&(Di(h,l),m=h.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=h.memoizedProps,m.state=h.memoizedState,m.componentWillUnmount()}catch(M){vt(h,l,M)}so(a,l,h);break;case 21:so(a,l,h);break;case 22:h.mode&1?(Kt=(m=Kt)||h.memoizedState!==null,so(a,l,h),Kt=m):so(a,l,h);break;default:so(a,l,h)}}function Pm(a){var l=a.updateQueue;if(l!==null){a.updateQueue=null;var h=a.stateNode;h===null&&(h=a.stateNode=new g2),l.forEach(function(m){var x=R2.bind(null,a,m);h.has(m)||(h.add(m),m.then(x,x))})}}function Qn(a,l){var h=l.deletions;if(h!==null)for(var m=0;m<h.length;m++){var x=h[m];try{var E=a,I=l,M=I;e:for(;M!==null;){switch(M.tag){case 5:Bt=M.stateNode,Yn=!1;break e;case 3:Bt=M.stateNode.containerInfo,Yn=!0;break e;case 4:Bt=M.stateNode.containerInfo,Yn=!0;break e}M=M.return}if(Bt===null)throw Error(e(160));Am(E,I,x),Bt=null,Yn=!1;var z=x.alternate;z!==null&&(z.return=null),x.return=null}catch(Z){vt(x,l,Z)}}if(l.subtreeFlags&12854)for(l=l.child;l!==null;)Fm(l,a),l=l.sibling}function Fm(a,l){var h=a.alternate,m=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(Qn(l,a),cr(a),m&4){try{Wa(3,a,a.return),mu(3,a)}catch(Se){vt(a,a.return,Se)}try{Wa(5,a,a.return)}catch(Se){vt(a,a.return,Se)}}break;case 1:Qn(l,a),cr(a),m&512&&h!==null&&Di(h,h.return);break;case 5:if(Qn(l,a),cr(a),m&512&&h!==null&&Di(h,h.return),a.flags&32){var x=a.stateNode;try{Ro(x,"")}catch(Se){vt(a,a.return,Se)}}if(m&4&&(x=a.stateNode,x!=null)){var E=a.memoizedProps,I=h!==null?h.memoizedProps:E,M=a.type,z=a.updateQueue;if(a.updateQueue=null,z!==null)try{M==="input"&&E.type==="radio"&&E.name!=null&&nt(x,E),tc(M,I);var Z=tc(M,E);for(I=0;I<z.length;I+=2){var ce=z[I],fe=z[I+1];ce==="style"?ci(x,fe):ce==="dangerouslySetInnerHTML"?ui(x,fe):ce==="children"?Ro(x,fe):S(x,ce,fe,Z)}switch(M){case"input":on(x,E);break;case"textarea":Ir(x,E);break;case"select":var le=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!E.multiple;var ye=E.value;ye!=null?jt(x,!!E.multiple,ye,!1):le!==!!E.multiple&&(E.defaultValue!=null?jt(x,!!E.multiple,E.defaultValue,!0):jt(x,!!E.multiple,E.multiple?[]:"",!1))}x[Ia]=E}catch(Se){vt(a,a.return,Se)}}break;case 6:if(Qn(l,a),cr(a),m&4){if(a.stateNode===null)throw Error(e(162));x=a.stateNode,E=a.memoizedProps;try{x.nodeValue=E}catch(Se){vt(a,a.return,Se)}}break;case 3:if(Qn(l,a),cr(a),m&4&&h!==null&&h.memoizedState.isDehydrated)try{ga(l.containerInfo)}catch(Se){vt(a,a.return,Se)}break;case 4:Qn(l,a),cr(a);break;case 13:Qn(l,a),cr(a),x=a.child,x.flags&8192&&(E=x.memoizedState!==null,x.stateNode.isHidden=E,!E||x.alternate!==null&&x.alternate.memoizedState!==null||(If=gt())),m&4&&Pm(a);break;case 22:if(ce=h!==null&&h.memoizedState!==null,a.mode&1?(Kt=(Z=Kt)||ce,Qn(l,a),Kt=Z):Qn(l,a),cr(a),m&8192){if(Z=a.memoizedState!==null,(a.stateNode.isHidden=Z)&&!ce&&(a.mode&1)!==0)for(we=a,ce=a.child;ce!==null;){for(fe=we=ce;we!==null;){switch(le=we,ye=le.child,le.tag){case 0:case 11:case 14:case 15:Wa(4,le,le.return);break;case 1:Di(le,le.return);var Ce=le.stateNode;if(typeof Ce.componentWillUnmount=="function"){m=le,h=le.return;try{l=m,Ce.props=l.memoizedProps,Ce.state=l.memoizedState,Ce.componentWillUnmount()}catch(Se){vt(m,h,Se)}}break;case 5:Di(le,le.return);break;case 22:if(le.memoizedState!==null){Lm(fe);continue}}ye!==null?(ye.return=le,we=ye):Lm(fe)}ce=ce.sibling}e:for(ce=null,fe=a;;){if(fe.tag===5){if(ce===null){ce=fe;try{x=fe.stateNode,Z?(E=x.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none"):(M=fe.stateNode,z=fe.memoizedProps.style,I=z!=null&&z.hasOwnProperty("display")?z.display:null,M.style.display=li("display",I))}catch(Se){vt(a,a.return,Se)}}}else if(fe.tag===6){if(ce===null)try{fe.stateNode.nodeValue=Z?"":fe.memoizedProps}catch(Se){vt(a,a.return,Se)}}else if((fe.tag!==22&&fe.tag!==23||fe.memoizedState===null||fe===a)&&fe.child!==null){fe.child.return=fe,fe=fe.child;continue}if(fe===a)break e;for(;fe.sibling===null;){if(fe.return===null||fe.return===a)break e;ce===fe&&(ce=null),fe=fe.return}ce===fe&&(ce=null),fe.sibling.return=fe.return,fe=fe.sibling}}break;case 19:Qn(l,a),cr(a),m&4&&Pm(a);break;case 21:break;default:Qn(l,a),cr(a)}}function cr(a){var l=a.flags;if(l&2){try{e:{for(var h=a.return;h!==null;){if(Tm(h)){var m=h;break e}h=h.return}throw Error(e(160))}switch(m.tag){case 5:var x=m.stateNode;m.flags&32&&(Ro(x,""),m.flags&=-33);var E=Dm(a);Sf(a,E,x);break;case 3:case 4:var I=m.stateNode.containerInfo,M=Dm(a);_f(a,M,I);break;default:throw Error(e(161))}}catch(z){vt(a,a.return,z)}a.flags&=-3}l&4096&&(a.flags&=-4097)}function x2(a,l,h){we=a,Om(a)}function Om(a,l,h){for(var m=(a.mode&1)!==0;we!==null;){var x=we,E=x.child;if(x.tag===22&&m){var I=x.memoizedState!==null||vu;if(!I){var M=x.alternate,z=M!==null&&M.memoizedState!==null||Kt;M=vu;var Z=Kt;if(vu=I,(Kt=z)&&!Z)for(we=x;we!==null;)I=we,z=I.child,I.tag===22&&I.memoizedState!==null?Bm(x):z!==null?(z.return=I,we=z):Bm(x);for(;E!==null;)we=E,Om(E),E=E.sibling;we=x,vu=M,Kt=Z}Mm(a)}else(x.subtreeFlags&8772)!==0&&E!==null?(E.return=x,we=E):Mm(a)}}function Mm(a){for(;we!==null;){var l=we;if((l.flags&8772)!==0){var h=l.alternate;try{if((l.flags&8772)!==0)switch(l.tag){case 0:case 11:case 15:Kt||mu(5,l);break;case 1:var m=l.stateNode;if(l.flags&4&&!Kt)if(h===null)m.componentDidMount();else{var x=l.elementType===l.type?h.memoizedProps:Xn(l.type,h.memoizedProps);m.componentDidUpdate(x,h.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var E=l.updateQueue;E!==null&&Lv(l,E,m);break;case 3:var I=l.updateQueue;if(I!==null){if(h=null,l.child!==null)switch(l.child.tag){case 5:h=l.child.stateNode;break;case 1:h=l.child.stateNode}Lv(l,I,h)}break;case 5:var M=l.stateNode;if(h===null&&l.flags&4){h=M;var z=l.memoizedProps;switch(l.type){case"button":case"input":case"select":case"textarea":z.autoFocus&&h.focus();break;case"img":z.src&&(h.src=z.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(l.memoizedState===null){var Z=l.alternate;if(Z!==null){var ce=Z.memoizedState;if(ce!==null){var fe=ce.dehydrated;fe!==null&&ga(fe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(e(163))}Kt||l.flags&512&&Ef(l)}catch(le){vt(l,l.return,le)}}if(l===a){we=null;break}if(h=l.sibling,h!==null){h.return=l.return,we=h;break}we=l.return}}function Lm(a){for(;we!==null;){var l=we;if(l===a){we=null;break}var h=l.sibling;if(h!==null){h.return=l.return,we=h;break}we=l.return}}function Bm(a){for(;we!==null;){var l=we;try{switch(l.tag){case 0:case 11:case 15:var h=l.return;try{mu(4,l)}catch(z){vt(l,h,z)}break;case 1:var m=l.stateNode;if(typeof m.componentDidMount=="function"){var x=l.return;try{m.componentDidMount()}catch(z){vt(l,x,z)}}var E=l.return;try{Ef(l)}catch(z){vt(l,E,z)}break;case 5:var I=l.return;try{Ef(l)}catch(z){vt(l,I,z)}}}catch(z){vt(l,l.return,z)}if(l===a){we=null;break}var M=l.sibling;if(M!==null){M.return=l.return,we=M;break}we=l.return}}var w2=Math.ceil,gu=k.ReactCurrentDispatcher,kf=k.ReactCurrentOwner,Wn=k.ReactCurrentBatchConfig,$e=0,At=null,bt=null,Wt=0,_n=0,Ai=no(0),_t=0,za=null,Lo=0,yu=0,Rf=0,Ua=null,ln=null,If=0,Pi=1/0,Mr=null,xu=!1,Nf=null,uo=null,wu=!1,lo=null,bu=0,Va=0,Tf=null,Cu=-1,Eu=0;function rn(){return($e&6)!==0?gt():Cu!==-1?Cu:Cu=gt()}function co(a){return(a.mode&1)===0?1:($e&2)!==0&&Wt!==0?Wt&-Wt:r2.transition!==null?(Eu===0&&(Eu=Dp()),Eu):(a=Ze,a!==0||(a=window.event,a=a===void 0?16:zp(a.type)),a)}function Jn(a,l,h,m){if(50<Va)throw Va=0,Tf=null,Error(e(185));da(a,h,m),(($e&2)===0||a!==At)&&(a===At&&(($e&2)===0&&(yu|=h),_t===4&&fo(a,Wt)),cn(a,m),h===1&&$e===0&&(l.mode&1)===0&&(Pi=gt()+500,Qs&&oo()))}function cn(a,l){var h=a.callbackNode;rw(a,l);var m=As(a,a===At?Wt:0);if(m===0)h!==null&&Ip(h),a.callbackNode=null,a.callbackPriority=0;else if(l=m&-m,a.callbackPriority!==l){if(h!=null&&Ip(h),l===1)a.tag===0?n2(zm.bind(null,a)):Sv(zm.bind(null,a)),Jw(function(){($e&6)===0&&oo()}),h=null;else{switch(Ap(m)){case 1:h=uc;break;case 4:h=Np;break;case 16:h=Is;break;case 536870912:h=Tp;break;default:h=Is}h=$m(h,Wm.bind(null,a))}a.callbackPriority=l,a.callbackNode=h}}function Wm(a,l){if(Cu=-1,Eu=0,($e&6)!==0)throw Error(e(327));var h=a.callbackNode;if(Fi()&&a.callbackNode!==h)return null;var m=As(a,a===At?Wt:0);if(m===0)return null;if((m&30)!==0||(m&a.expiredLanes)!==0||l)l=_u(a,m);else{l=m;var x=$e;$e|=2;var E=Vm();(At!==a||Wt!==l)&&(Mr=null,Pi=gt()+500,Wo(a,l));do try{E2();break}catch(M){Um(a,M)}while(!0);Kc(),gu.current=E,$e=x,bt!==null?l=0:(At=null,Wt=0,l=_t)}if(l!==0){if(l===2&&(x=lc(a),x!==0&&(m=x,l=Df(a,x))),l===1)throw h=za,Wo(a,0),fo(a,m),cn(a,gt()),h;if(l===6)fo(a,m);else{if(x=a.current.alternate,(m&30)===0&&!b2(x)&&(l=_u(a,m),l===2&&(E=lc(a),E!==0&&(m=E,l=Df(a,E))),l===1))throw h=za,Wo(a,0),fo(a,m),cn(a,gt()),h;switch(a.finishedWork=x,a.finishedLanes=m,l){case 0:case 1:throw Error(e(345));case 2:zo(a,ln,Mr);break;case 3:if(fo(a,m),(m&130023424)===m&&(l=If+500-gt(),10<l)){if(As(a,0)!==0)break;if(x=a.suspendedLanes,(x&m)!==m){rn(),a.pingedLanes|=a.suspendedLanes&x;break}a.timeoutHandle=Mc(zo.bind(null,a,ln,Mr),l);break}zo(a,ln,Mr);break;case 4:if(fo(a,m),(m&4194240)===m)break;for(l=a.eventTimes,x=-1;0<m;){var I=31-qn(m);E=1<<I,I=l[I],I>x&&(x=I),m&=~E}if(m=x,m=gt()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*w2(m/1960))-m,10<m){a.timeoutHandle=Mc(zo.bind(null,a,ln,Mr),m);break}zo(a,ln,Mr);break;case 5:zo(a,ln,Mr);break;default:throw Error(e(329))}}}return cn(a,gt()),a.callbackNode===h?Wm.bind(null,a):null}function Df(a,l){var h=Ua;return a.current.memoizedState.isDehydrated&&(Wo(a,l).flags|=256),a=_u(a,l),a!==2&&(l=ln,ln=h,l!==null&&Af(l)),a}function Af(a){ln===null?ln=a:ln.push.apply(ln,a)}function b2(a){for(var l=a;;){if(l.flags&16384){var h=l.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var m=0;m<h.length;m++){var x=h[m],E=x.getSnapshot;x=x.value;try{if(!Kn(E(),x))return!1}catch{return!1}}}if(h=l.child,l.subtreeFlags&16384&&h!==null)h.return=l,l=h;else{if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function fo(a,l){for(l&=~Rf,l&=~yu,a.suspendedLanes|=l,a.pingedLanes&=~l,a=a.expirationTimes;0<l;){var h=31-qn(l),m=1<<h;a[h]=-1,l&=~m}}function zm(a){if(($e&6)!==0)throw Error(e(327));Fi();var l=As(a,0);if((l&1)===0)return cn(a,gt()),null;var h=_u(a,l);if(a.tag!==0&&h===2){var m=lc(a);m!==0&&(l=m,h=Df(a,m))}if(h===1)throw h=za,Wo(a,0),fo(a,l),cn(a,gt()),h;if(h===6)throw Error(e(345));return a.finishedWork=a.current.alternate,a.finishedLanes=l,zo(a,ln,Mr),cn(a,gt()),null}function Pf(a,l){var h=$e;$e|=1;try{return a(l)}finally{$e=h,$e===0&&(Pi=gt()+500,Qs&&oo())}}function Bo(a){lo!==null&&lo.tag===0&&($e&6)===0&&Fi();var l=$e;$e|=1;var h=Wn.transition,m=Ze;try{if(Wn.transition=null,Ze=1,a)return a()}finally{Ze=m,Wn.transition=h,$e=l,($e&6)===0&&oo()}}function Ff(){_n=Ai.current,at(Ai)}function Wo(a,l){a.finishedWork=null,a.finishedLanes=0;var h=a.timeoutHandle;if(h!==-1&&(a.timeoutHandle=-1,Qw(h)),bt!==null)for(h=bt.return;h!==null;){var m=h;switch(Vc(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&Xs();break;case 3:Ni(),at(an),at(Ht),tf();break;case 5:Zc(m);break;case 4:Ni();break;case 13:at(lt);break;case 19:at(lt);break;case 10:$c(m.type._context);break;case 22:case 23:Ff()}h=h.return}if(At=a,bt=a=ho(a.current,null),Wt=_n=l,_t=0,za=null,Rf=yu=Lo=0,ln=Ua=null,Fo!==null){for(l=0;l<Fo.length;l++)if(h=Fo[l],m=h.interleaved,m!==null){h.interleaved=null;var x=m.next,E=h.pending;if(E!==null){var I=E.next;E.next=x,m.next=I}h.pending=m}Fo=null}return a}function Um(a,l){do{var h=bt;try{if(Kc(),su.current=fu,uu){for(var m=ct.memoizedState;m!==null;){var x=m.queue;x!==null&&(x.pending=null),m=m.next}uu=!1}if(Mo=0,Dt=Et=ct=null,Fa=!1,Oa=0,kf.current=null,h===null||h.return===null){_t=1,za=l,bt=null;break}e:{var E=a,I=h.return,M=h,z=l;if(l=Wt,M.flags|=32768,z!==null&&typeof z=="object"&&typeof z.then=="function"){var Z=z,ce=M,fe=ce.tag;if((ce.mode&1)===0&&(fe===0||fe===11||fe===15)){var le=ce.alternate;le?(ce.updateQueue=le.updateQueue,ce.memoizedState=le.memoizedState,ce.lanes=le.lanes):(ce.updateQueue=null,ce.memoizedState=null)}var ye=dm(I);if(ye!==null){ye.flags&=-257,hm(ye,I,M,E,l),ye.mode&1&&fm(E,Z,l),l=ye,z=Z;var Ce=l.updateQueue;if(Ce===null){var Se=new Set;Se.add(z),l.updateQueue=Se}else Ce.add(z);break e}else{if((l&1)===0){fm(E,Z,l),Of();break e}z=Error(e(426))}}else if(ut&&M.mode&1){var yt=dm(I);if(yt!==null){(yt.flags&65536)===0&&(yt.flags|=256),hm(yt,I,M,E,l),Gc(Ti(z,M));break e}}E=z=Ti(z,M),_t!==4&&(_t=2),Ua===null?Ua=[E]:Ua.push(E),E=I;do{switch(E.tag){case 3:E.flags|=65536,l&=-l,E.lanes|=l;var $=lm(E,z,l);Mv(E,$);break e;case 1:M=z;var H=E.type,Q=E.stateNode;if((E.flags&128)===0&&(typeof H.getDerivedStateFromError=="function"||Q!==null&&typeof Q.componentDidCatch=="function"&&(uo===null||!uo.has(Q)))){E.flags|=65536,l&=-l,E.lanes|=l;var he=cm(E,M,l);Mv(E,he);break e}}E=E.return}while(E!==null)}Hm(h)}catch(Ie){l=Ie,bt===h&&h!==null&&(bt=h=h.return);continue}break}while(!0)}function Vm(){var a=gu.current;return gu.current=fu,a===null?fu:a}function Of(){(_t===0||_t===3||_t===2)&&(_t=4),At===null||(Lo&268435455)===0&&(yu&268435455)===0||fo(At,Wt)}function _u(a,l){var h=$e;$e|=2;var m=Vm();(At!==a||Wt!==l)&&(Mr=null,Wo(a,l));do try{C2();break}catch(x){Um(a,x)}while(!0);if(Kc(),$e=h,gu.current=m,bt!==null)throw Error(e(261));return At=null,Wt=0,_t}function C2(){for(;bt!==null;)jm(bt)}function E2(){for(;bt!==null&&!$x();)jm(bt)}function jm(a){var l=Km(a.alternate,a,_n);a.memoizedProps=a.pendingProps,l===null?Hm(a):bt=l,kf.current=null}function Hm(a){var l=a;do{var h=l.alternate;if(a=l.return,(l.flags&32768)===0){if(h=v2(h,l,_n),h!==null){bt=h;return}}else{if(h=m2(h,l),h!==null){h.flags&=32767,bt=h;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{_t=6,bt=null;return}}if(l=l.sibling,l!==null){bt=l;return}bt=l=a}while(l!==null);_t===0&&(_t=5)}function zo(a,l,h){var m=Ze,x=Wn.transition;try{Wn.transition=null,Ze=1,_2(a,l,h,m)}finally{Wn.transition=x,Ze=m}return null}function _2(a,l,h,m){do Fi();while(lo!==null);if(($e&6)!==0)throw Error(e(327));h=a.finishedWork;var x=a.finishedLanes;if(h===null)return null;if(a.finishedWork=null,a.finishedLanes=0,h===a.current)throw Error(e(177));a.callbackNode=null,a.callbackPriority=0;var E=h.lanes|h.childLanes;if(ow(a,E),a===At&&(bt=At=null,Wt=0),(h.subtreeFlags&2064)===0&&(h.flags&2064)===0||wu||(wu=!0,$m(Is,function(){return Fi(),null})),E=(h.flags&15990)!==0,(h.subtreeFlags&15990)!==0||E){E=Wn.transition,Wn.transition=null;var I=Ze;Ze=1;var M=$e;$e|=4,kf.current=null,y2(a,h),Fm(h,a),Hw(Fc),Os=!!Pc,Fc=Pc=null,a.current=h,x2(h),Xx(),$e=M,Ze=I,Wn.transition=E}else a.current=h;if(wu&&(wu=!1,lo=a,bu=x),E=a.pendingLanes,E===0&&(uo=null),Jx(h.stateNode),cn(a,gt()),l!==null)for(m=a.onRecoverableError,h=0;h<l.length;h++)x=l[h],m(x.value,{componentStack:x.stack,digest:x.digest});if(xu)throw xu=!1,a=Nf,Nf=null,a;return(bu&1)!==0&&a.tag!==0&&Fi(),E=a.pendingLanes,(E&1)!==0?a===Tf?Va++:(Va=0,Tf=a):Va=0,oo(),null}function Fi(){if(lo!==null){var a=Ap(bu),l=Wn.transition,h=Ze;try{if(Wn.transition=null,Ze=16>a?16:a,lo===null)var m=!1;else{if(a=lo,lo=null,bu=0,($e&6)!==0)throw Error(e(331));var x=$e;for($e|=4,we=a.current;we!==null;){var E=we,I=E.child;if((we.flags&16)!==0){var M=E.deletions;if(M!==null){for(var z=0;z<M.length;z++){var Z=M[z];for(we=Z;we!==null;){var ce=we;switch(ce.tag){case 0:case 11:case 15:Wa(8,ce,E)}var fe=ce.child;if(fe!==null)fe.return=ce,we=fe;else for(;we!==null;){ce=we;var le=ce.sibling,ye=ce.return;if(Nm(ce),ce===Z){we=null;break}if(le!==null){le.return=ye,we=le;break}we=ye}}}var Ce=E.alternate;if(Ce!==null){var Se=Ce.child;if(Se!==null){Ce.child=null;do{var yt=Se.sibling;Se.sibling=null,Se=yt}while(Se!==null)}}we=E}}if((E.subtreeFlags&2064)!==0&&I!==null)I.return=E,we=I;else e:for(;we!==null;){if(E=we,(E.flags&2048)!==0)switch(E.tag){case 0:case 11:case 15:Wa(9,E,E.return)}var $=E.sibling;if($!==null){$.return=E.return,we=$;break e}we=E.return}}var H=a.current;for(we=H;we!==null;){I=we;var Q=I.child;if((I.subtreeFlags&2064)!==0&&Q!==null)Q.return=I,we=Q;else e:for(I=H;we!==null;){if(M=we,(M.flags&2048)!==0)try{switch(M.tag){case 0:case 11:case 15:mu(9,M)}}catch(Ie){vt(M,M.return,Ie)}if(M===I){we=null;break e}var he=M.sibling;if(he!==null){he.return=M.return,we=he;break e}we=M.return}}if($e=x,oo(),ar&&typeof ar.onPostCommitFiberRoot=="function")try{ar.onPostCommitFiberRoot(Ns,a)}catch{}m=!0}return m}finally{Ze=h,Wn.transition=l}}return!1}function Gm(a,l,h){l=Ti(h,l),l=lm(a,l,1),a=ao(a,l,1),l=rn(),a!==null&&(da(a,1,l),cn(a,l))}function vt(a,l,h){if(a.tag===3)Gm(a,a,h);else for(;l!==null;){if(l.tag===3){Gm(l,a,h);break}else if(l.tag===1){var m=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(uo===null||!uo.has(m))){a=Ti(h,a),a=cm(l,a,1),l=ao(l,a,1),a=rn(),l!==null&&(da(l,1,a),cn(l,a));break}}l=l.return}}function S2(a,l,h){var m=a.pingCache;m!==null&&m.delete(l),l=rn(),a.pingedLanes|=a.suspendedLanes&h,At===a&&(Wt&h)===h&&(_t===4||_t===3&&(Wt&130023424)===Wt&&500>gt()-If?Wo(a,0):Rf|=h),cn(a,l)}function qm(a,l){l===0&&((a.mode&1)===0?l=1:(l=Ds,Ds<<=1,(Ds&130023424)===0&&(Ds=4194304)));var h=rn();a=Pr(a,l),a!==null&&(da(a,l,h),cn(a,h))}function k2(a){var l=a.memoizedState,h=0;l!==null&&(h=l.retryLane),qm(a,h)}function R2(a,l){var h=0;switch(a.tag){case 13:var m=a.stateNode,x=a.memoizedState;x!==null&&(h=x.retryLane);break;case 19:m=a.stateNode;break;default:throw Error(e(314))}m!==null&&m.delete(l),qm(a,h)}var Km;Km=function(a,l,h){if(a!==null)if(a.memoizedProps!==l.pendingProps||an.current)un=!0;else{if((a.lanes&h)===0&&(l.flags&128)===0)return un=!1,p2(a,l,h);un=(a.flags&131072)!==0}else un=!1,ut&&(l.flags&1048576)!==0&&kv(l,Zs,l.index);switch(l.lanes=0,l.tag){case 2:var m=l.type;pu(a,l),a=l.pendingProps;var x=Ci(l,Ht.current);Ii(l,h),x=of(null,l,m,a,x,h);var E=af();return l.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(l.tag=1,l.memoizedState=null,l.updateQueue=null,sn(m)?(E=!0,Ys(l)):E=!1,l.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,Qc(l),x.updater=du,l.stateNode=x,x._reactInternals=l,df(l,m,a,h),l=mf(null,l,m,!0,E,h)):(l.tag=0,ut&&E&&Uc(l),nn(null,l,x,h),l=l.child),l;case 16:m=l.elementType;e:{switch(pu(a,l),a=l.pendingProps,x=m._init,m=x(m._payload),l.type=m,x=l.tag=N2(m),a=Xn(m,a),x){case 0:l=vf(null,l,m,a,h);break e;case 1:l=xm(null,l,m,a,h);break e;case 11:l=pm(null,l,m,a,h);break e;case 14:l=vm(null,l,m,Xn(m.type,a),h);break e}throw Error(e(306,m,""))}return l;case 0:return m=l.type,x=l.pendingProps,x=l.elementType===m?x:Xn(m,x),vf(a,l,m,x,h);case 1:return m=l.type,x=l.pendingProps,x=l.elementType===m?x:Xn(m,x),xm(a,l,m,x,h);case 3:e:{if(wm(l),a===null)throw Error(e(387));m=l.pendingProps,E=l.memoizedState,x=E.element,Ov(a,l),iu(l,m,null,h);var I=l.memoizedState;if(m=I.element,E.isDehydrated)if(E={element:m,isDehydrated:!1,cache:I.cache,pendingSuspenseBoundaries:I.pendingSuspenseBoundaries,transitions:I.transitions},l.updateQueue.baseState=E,l.memoizedState=E,l.flags&256){x=Ti(Error(e(423)),l),l=bm(a,l,m,h,x);break e}else if(m!==x){x=Ti(Error(e(424)),l),l=bm(a,l,m,h,x);break e}else for(En=to(l.stateNode.containerInfo.firstChild),Cn=l,ut=!0,$n=null,h=Pv(l,null,m,h),l.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Si(),m===x){l=Or(a,l,h);break e}nn(a,l,m,h)}l=l.child}return l;case 5:return Bv(l),a===null&&Hc(l),m=l.type,x=l.pendingProps,E=a!==null?a.memoizedProps:null,I=x.children,Oc(m,x)?I=null:E!==null&&Oc(m,E)&&(l.flags|=32),ym(a,l),nn(a,l,I,h),l.child;case 6:return a===null&&Hc(l),null;case 13:return Cm(a,l,h);case 4:return Jc(l,l.stateNode.containerInfo),m=l.pendingProps,a===null?l.child=ki(l,null,m,h):nn(a,l,m,h),l.child;case 11:return m=l.type,x=l.pendingProps,x=l.elementType===m?x:Xn(m,x),pm(a,l,m,x,h);case 7:return nn(a,l,l.pendingProps,h),l.child;case 8:return nn(a,l,l.pendingProps.children,h),l.child;case 12:return nn(a,l,l.pendingProps.children,h),l.child;case 10:e:{if(m=l.type._context,x=l.pendingProps,E=l.memoizedProps,I=x.value,rt(nu,m._currentValue),m._currentValue=I,E!==null)if(Kn(E.value,I)){if(E.children===x.children&&!an.current){l=Or(a,l,h);break e}}else for(E=l.child,E!==null&&(E.return=l);E!==null;){var M=E.dependencies;if(M!==null){I=E.child;for(var z=M.firstContext;z!==null;){if(z.context===m){if(E.tag===1){z=Fr(-1,h&-h),z.tag=2;var Z=E.updateQueue;if(Z!==null){Z=Z.shared;var ce=Z.pending;ce===null?z.next=z:(z.next=ce.next,ce.next=z),Z.pending=z}}E.lanes|=h,z=E.alternate,z!==null&&(z.lanes|=h),Xc(E.return,h,l),M.lanes|=h;break}z=z.next}}else if(E.tag===10)I=E.type===l.type?null:E.child;else if(E.tag===18){if(I=E.return,I===null)throw Error(e(341));I.lanes|=h,M=I.alternate,M!==null&&(M.lanes|=h),Xc(I,h,l),I=E.sibling}else I=E.child;if(I!==null)I.return=E;else for(I=E;I!==null;){if(I===l){I=null;break}if(E=I.sibling,E!==null){E.return=I.return,I=E;break}I=I.return}E=I}nn(a,l,x.children,h),l=l.child}return l;case 9:return x=l.type,m=l.pendingProps.children,Ii(l,h),x=Ln(x),m=m(x),l.flags|=1,nn(a,l,m,h),l.child;case 14:return m=l.type,x=Xn(m,l.pendingProps),x=Xn(m.type,x),vm(a,l,m,x,h);case 15:return mm(a,l,l.type,l.pendingProps,h);case 17:return m=l.type,x=l.pendingProps,x=l.elementType===m?x:Xn(m,x),pu(a,l),l.tag=1,sn(m)?(a=!0,Ys(l)):a=!1,Ii(l,h),sm(l,m,x),df(l,m,x,h),mf(null,l,m,!0,a,h);case 19:return _m(a,l,h);case 22:return gm(a,l,h)}throw Error(e(156,l.tag))};function $m(a,l){return Rp(a,l)}function I2(a,l,h,m){this.tag=a,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zn(a,l,h,m){return new I2(a,l,h,m)}function Mf(a){return a=a.prototype,!(!a||!a.isReactComponent)}function N2(a){if(typeof a=="function")return Mf(a)?1:0;if(a!=null){if(a=a.$$typeof,a===U)return 11;if(a===ee)return 14}return 2}function ho(a,l){var h=a.alternate;return h===null?(h=zn(a.tag,l,a.key,a.mode),h.elementType=a.elementType,h.type=a.type,h.stateNode=a.stateNode,h.alternate=a,a.alternate=h):(h.pendingProps=l,h.type=a.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=a.flags&14680064,h.childLanes=a.childLanes,h.lanes=a.lanes,h.child=a.child,h.memoizedProps=a.memoizedProps,h.memoizedState=a.memoizedState,h.updateQueue=a.updateQueue,l=a.dependencies,h.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},h.sibling=a.sibling,h.index=a.index,h.ref=a.ref,h}function Su(a,l,h,m,x,E){var I=2;if(m=a,typeof a=="function")Mf(a)&&(I=1);else if(typeof a=="string")I=5;else e:switch(a){case P:return Uo(h.children,x,E,l);case F:I=8,x|=8;break;case D:return a=zn(12,h,l,x|2),a.elementType=D,a.lanes=E,a;case re:return a=zn(13,h,l,x),a.elementType=re,a.lanes=E,a;case te:return a=zn(19,h,l,x),a.elementType=te,a.lanes=E,a;case q:return ku(h,x,E,l);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case A:I=10;break e;case V:I=9;break e;case U:I=11;break e;case ee:I=14;break e;case G:I=16,m=null;break e}throw Error(e(130,a==null?a:typeof a,""))}return l=zn(I,h,l,x),l.elementType=a,l.type=m,l.lanes=E,l}function Uo(a,l,h,m){return a=zn(7,a,m,l),a.lanes=h,a}function ku(a,l,h,m){return a=zn(22,a,m,l),a.elementType=q,a.lanes=h,a.stateNode={isHidden:!1},a}function Lf(a,l,h){return a=zn(6,a,null,l),a.lanes=h,a}function Bf(a,l,h){return l=zn(4,a.children!==null?a.children:[],a.key,l),l.lanes=h,l.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},l}function T2(a,l,h,m,x){this.tag=l,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cc(0),this.expirationTimes=cc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cc(0),this.identifierPrefix=m,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function Wf(a,l,h,m,x,E,I,M,z){return a=new T2(a,l,h,M,z),l===1?(l=1,E===!0&&(l|=8)):l=0,E=zn(3,null,null,l),a.current=E,E.stateNode=a,E.memoizedState={element:m,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},Qc(E),a}function D2(a,l,h){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:N,key:m==null?null:""+m,children:a,containerInfo:l,implementation:h}}function Xm(a){if(!a)return ro;a=a._reactInternals;e:{if(No(a)!==a||a.tag!==1)throw Error(e(170));var l=a;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(sn(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(l!==null);throw Error(e(171))}if(a.tag===1){var h=a.type;if(sn(h))return Ev(a,h,l)}return l}function Ym(a,l,h,m,x,E,I,M,z){return a=Wf(h,m,!0,a,x,E,I,M,z),a.context=Xm(null),h=a.current,m=rn(),x=co(h),E=Fr(m,x),E.callback=l??null,ao(h,E,x),a.current.lanes=x,da(a,x,m),cn(a,m),a}function Ru(a,l,h,m){var x=l.current,E=rn(),I=co(x);return h=Xm(h),l.context===null?l.context=h:l.pendingContext=h,l=Fr(E,I),l.payload={element:a},m=m===void 0?null:m,m!==null&&(l.callback=m),a=ao(x,l,I),a!==null&&(Jn(a,x,I,E),ou(a,x,I)),I}function Iu(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Qm(a,l){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var h=a.retryLane;a.retryLane=h!==0&&h<l?h:l}}function zf(a,l){Qm(a,l),(a=a.alternate)&&Qm(a,l)}function A2(){return null}var Jm=typeof reportError=="function"?reportError:function(a){console.error(a)};function Uf(a){this._internalRoot=a}Nu.prototype.render=Uf.prototype.render=function(a){var l=this._internalRoot;if(l===null)throw Error(e(409));Ru(a,l,null,null)},Nu.prototype.unmount=Uf.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var l=a.containerInfo;Bo(function(){Ru(null,a,null,null)}),l[Nr]=null}};function Nu(a){this._internalRoot=a}Nu.prototype.unstable_scheduleHydration=function(a){if(a){var l=Op();a={blockedOn:null,target:a,priority:l};for(var h=0;h<Jr.length&&l!==0&&l<Jr[h].priority;h++);Jr.splice(h,0,a),h===0&&Bp(a)}};function Vf(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function Tu(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function Zm(){}function P2(a,l,h,m,x){if(x){if(typeof m=="function"){var E=m;m=function(){var Z=Iu(I);E.call(Z)}}var I=Ym(l,m,a,0,null,!1,!1,"",Zm);return a._reactRootContainer=I,a[Nr]=I.current,ka(a.nodeType===8?a.parentNode:a),Bo(),I}for(;x=a.lastChild;)a.removeChild(x);if(typeof m=="function"){var M=m;m=function(){var Z=Iu(z);M.call(Z)}}var z=Wf(a,0,!1,null,null,!1,!1,"",Zm);return a._reactRootContainer=z,a[Nr]=z.current,ka(a.nodeType===8?a.parentNode:a),Bo(function(){Ru(l,z,h,m)}),z}function Du(a,l,h,m,x){var E=h._reactRootContainer;if(E){var I=E;if(typeof x=="function"){var M=x;x=function(){var z=Iu(I);M.call(z)}}Ru(l,I,a,x)}else I=P2(h,l,a,x,m);return Iu(I)}Pp=function(a){switch(a.tag){case 3:var l=a.stateNode;if(l.current.memoizedState.isDehydrated){var h=fa(l.pendingLanes);h!==0&&(fc(l,h|1),cn(l,gt()),($e&6)===0&&(Pi=gt()+500,oo()))}break;case 13:Bo(function(){var m=Pr(a,1);if(m!==null){var x=rn();Jn(m,a,1,x)}}),zf(a,1)}},dc=function(a){if(a.tag===13){var l=Pr(a,134217728);if(l!==null){var h=rn();Jn(l,a,134217728,h)}zf(a,134217728)}},Fp=function(a){if(a.tag===13){var l=co(a),h=Pr(a,l);if(h!==null){var m=rn();Jn(h,a,l,m)}zf(a,l)}},Op=function(){return Ze},Mp=function(a,l){var h=Ze;try{return Ze=a,l()}finally{Ze=h}},oc=function(a,l,h){switch(l){case"input":if(on(a,h),l=h.name,h.type==="radio"&&l!=null){for(h=a;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<h.length;l++){var m=h[l];if(m!==a&&m.form===a.form){var x=$s(m);if(!x)throw Error(e(90));Ye(m),on(m,x)}}}break;case"textarea":Ir(a,h);break;case"select":l=h.value,l!=null&&jt(a,!!h.multiple,l,!1)}},wp=Pf,bp=Bo;var F2={usingClientEntryPoint:!1,Events:[Na,wi,$s,yp,xp,Pf]},ja={findFiberByHostInstance:To,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},O2={bundleType:ja.bundleType,version:ja.version,rendererPackageName:ja.rendererPackageName,rendererConfig:ja.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Sp(a),a===null?null:a.stateNode},findFiberByHostInstance:ja.findFiberByHostInstance||A2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Au=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Au.isDisabled&&Au.supportsFiber)try{Ns=Au.inject(O2),ar=Au}catch{}}return fn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F2,fn.createPortal=function(a,l){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Vf(l))throw Error(e(200));return D2(a,l,null,h)},fn.createRoot=function(a,l){if(!Vf(a))throw Error(e(299));var h=!1,m="",x=Jm;return l!=null&&(l.unstable_strictMode===!0&&(h=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onRecoverableError!==void 0&&(x=l.onRecoverableError)),l=Wf(a,1,!1,null,null,h,!1,m,x),a[Nr]=l.current,ka(a.nodeType===8?a.parentNode:a),new Uf(l)},fn.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var l=a._reactInternals;if(l===void 0)throw typeof a.render=="function"?Error(e(188)):(a=Object.keys(a).join(","),Error(e(268,a)));return a=Sp(l),a=a===null?null:a.stateNode,a},fn.flushSync=function(a){return Bo(a)},fn.hydrate=function(a,l,h){if(!Tu(l))throw Error(e(200));return Du(null,a,l,!0,h)},fn.hydrateRoot=function(a,l,h){if(!Vf(a))throw Error(e(405));var m=h!=null&&h.hydratedSources||null,x=!1,E="",I=Jm;if(h!=null&&(h.unstable_strictMode===!0&&(x=!0),h.identifierPrefix!==void 0&&(E=h.identifierPrefix),h.onRecoverableError!==void 0&&(I=h.onRecoverableError)),l=Ym(l,null,a,1,h??null,x,!1,E,I),a[Nr]=l.current,ka(a),m)for(a=0;a<m.length;a++)h=m[a],x=h._getVersion,x=x(h._source),l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[h,x]:l.mutableSourceEagerHydrationData.push(h,x);return new Nu(l)},fn.render=function(a,l,h){if(!Tu(l))throw Error(e(200));return Du(null,a,l,!1,h)},fn.unmountComponentAtNode=function(a){if(!Tu(a))throw Error(e(40));return a._reactRootContainer?(Bo(function(){Du(null,null,a,!1,function(){a._reactRootContainer=null,a[Nr]=null})}),!0):!1},fn.unstable_batchedUpdates=Pf,fn.unstable_renderSubtreeIntoContainer=function(a,l,h,m){if(!Tu(h))throw Error(e(200));if(a==null||a._reactInternals===void 0)throw Error(e(38));return Du(a,l,h,!1,m)},fn.version="18.3.1-next-f1338f8080-20240426",fn}var sg;function G2(){if(sg)return Gf.exports;sg=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Gf.exports=H2(),Gf.exports}var ug;function q2(){if(ug)return Pu;ug=1;var n=G2();return Pu.createRoot=n.createRoot,Pu.hydrateRoot=n.hydrateRoot,Pu}var K2=q2();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Fy=function(n,t){return(Fy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(n,t)};function nr(n,t){function e(){this.constructor=n}Fy(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Ee(n,t,e,r){return new(e||(e=Promise))(function(o,i){function s(f){try{c(r.next(f))}catch(d){i(d)}}function u(f){try{c(r.throw(f))}catch(d){i(d)}}function c(f){f.done?o(f.value):new e(function(d){d(f.value)}).then(s,u)}c((r=r.apply(n,[])).next())})}function _e(n,t){var e,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function u(c){return function(f){return function(d){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,r&&(o=2&d[0]?r.return:d[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,d[1])).done)return o;switch(r=0,o&&(d=[2&d[0],o.value]),d[0]){case 0:case 1:o=d;break;case 4:return s.label++,{value:d[1],done:!1};case 5:s.label++,r=d[1],d=[0];continue;case 7:d=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(d[0]===6||d[0]===2)){s=0;continue}if(d[0]===3&&(!o||d[1]>o[0]&&d[1]<o[3])){s.label=d[1];break}if(d[0]===6&&s.label<o[1]){s.label=o[1],o=d;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(d);break}o[2]&&s.ops.pop(),s.trys.pop();continue}d=t.call(n,s)}catch(p){d=[6,p],r=0}finally{e=o=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([c,f])}}}var $2=function(){function n(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(t,e){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},n.prototype.registerFlag=function(t,e,r){if(this.flagRegistry[t]={evaluationFn:e,setHook:r},this.urlFlags[t]!=null){var o=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+o+"."),this.set(t,o)}},n.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},n.prototype.getNumber=function(t){return this.get(t)},n.prototype.getBool=function(t){return this.get(t)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(t,e){if(this.flagRegistry[t]==null)throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(e)},n.prototype.evaluateFlag=function(t){if(this.flagRegistry[t]==null)throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},n.prototype.setFlags=function(t){this.flags=Object.assign({},t)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var t=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var e,r,o=(e=this.global.location.search,r={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(i){for(var s=[],u=1;u<arguments.length;u++)s[u-1]=arguments[u];return X2(r,s[0],s[1]),s.join("=")}),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(i){var s=i.split(":"),u=s[0],c=s[1];t.urlFlags[u]=function(f,d){if((d=d.toLowerCase())==="true"||d==="false")return d==="true";if(""+ +d===d)return+d;throw new Error("Could not parse value flag value "+d+" for flag "+f+".")}(u,c)})}},n}();function X2(n,t,e){n[decodeURIComponent(t)]=decodeURIComponent(e||"")}function ae(){return Oy}var Oy=null,tl=new Map,kd=new Map;function My(n,t){var e=By(n,t);return tl.get(e)}function Y2(n){return kd.get(n)}function lg(n){for(var t=tl.entries(),e=[];;){var r=t.next(),o=r.done,i=r.value;if(o)break;var s=i[0],u=i[1];s.split("_")[0]===n&&e.push(u)}return e}function Ly(n){var t=n.kernelName,e=n.backendName,r=By(t,e);if(tl.has(r))throw new Error("The kernel '"+t+"' for backend '"+e+"' is already registered");tl.set(r,n)}function Q2(n){var t=n.kernelName;kd.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),kd.set(t,n)}function By(n,t){return t+"_"+n}function Rd(n,t,e){return Math.max(n,Math.min(t,e))}function Wy(n){return n%2==0?n:n+1}function J2(n){for(var t=0,e=0;e<n.length;e++)t+=n[e];return t}function O(n,t){if(!n)throw new Error(typeof t=="string"?t:t())}function Je(n,t,e){e===void 0&&(e=""),O(Ot(n,t),function(){return e+" Shapes "+n+" and "+t+" must match"})}function ta(n){O(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Qi(n,t,e){if(t===void 0&&(t=[]),e===void 0&&(e=!1),t==null&&(t=[]),Array.isArray(n)||yr(n)&&!e)for(var r=0;r<n.length;++r)Qi(n[r],t,e);else t.push(n);return t}function Re(n){if(n.length===0)return 1;for(var t=n[0],e=1;e<n.length;e++)t*=n[e];return t}function Ot(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(var e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function xt(n){return n%1==0}function Z2(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var t=Math.exp(2*n);return(t-1)/(t+1)}function Id(n){var t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function ji(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function cg(n,t,e){return t===void 0&&(t=function(r){return 0}),new Promise(function(r,o){var i=0,s=function(){if(n())r();else{i++;var u=t(i);e!=null&&i>=e?o():setTimeout(s,u)}};s()})}function eb(n,t){for(var e=1,r=-1,o=0;o<n.length;++o)if(n[o]>=0)e*=n[o];else if(n[o]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(n[o]<0)throw Error("Shapes can not be < 0. Found "+n[o]+" at dim "+o);if(r===-1){if(t>0&&t!==e)throw Error("Size("+t+") must match the product of shape "+n);return n}if(e===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(t%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+e);var i=n.slice();return i[r]=t/e,i}function Tt(n,t){var e=t.length;return O((n=n==null?t.map(function(r,o){return o}):[].concat(n)).every(function(r){return r>=-e&&r<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+n}),O(n.every(function(r){return xt(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?e+r:r})}function Go(n,t){for(var e=[],r=[],o=t!=null&&Array.isArray(t)&&t.length===0,i=t==null||o?null:Tt(t,n).sort(),s=0,u=0;u<n.length;++u){if(i!=null){if(i[s]===u&&n[u]!==1)throw new Error("Can't squeeze axis "+u+" since its dim '"+n[u]+"' is not 1");(i[s]==null||i[s]>u)&&n[u]===1&&(e.push(n[u]),r.push(u)),i[s]<=u&&s++}n[u]!==1&&(e.push(n[u]),r.push(u))}return{newShape:e,keptDims:r}}function es(n,t){var e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else{if(n!=="bool")throw new Error("Unknown data type "+n);e=new Uint8Array(t)}return e}function nl(n,t){var e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else if(n==="bool")e=new Uint8Array(t);else{if(n!=="string")throw new Error("Unknown data type "+n);e=new Array(t)}return e}function tb(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function nb(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function rb(n,t){return t!=="complex64"&&(t!=="float32"||n==="complex64")&&(t!=="int32"||n==="float32"||n==="complex64")&&(t!=="bool"||n!=="bool")}function yr(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function zy(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function ob(n){if(n==null)return 0;var t=0;return n.forEach(function(e){return t+=e.length}),t}function ih(n){return typeof n=="string"||n instanceof String}function ib(n){return typeof n=="boolean"}function ab(n){return typeof n=="number"}function ls(n){return Array.isArray(n)?ls(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":ab(n)?"float32":ih(n)?"string":ib(n)?"bool":"float32"}function Nd(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Td(n,t){for(var e=t;e<n;++e)if(n%e==0)return e;return n}function xr(n){var t=n.length;if(t<2)return[];var e=new Array(t-1);e[t-2]=n[t-1];for(var r=t-3;r>=0;--r)e[r]=e[r+1]*n[r+1];return e}function Uy(n,t,e){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Qi(n)),e&&tb(n,t),function(i,s){return i instanceof Float32Array&&s==="float32"||i instanceof Int32Array&&s==="int32"||i instanceof Uint8Array&&s==="bool"}(n,t))return n;if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool"){for(var r=new Uint8Array(n.length),o=0;o<r.length;++o)Math.round(n[o])!==0&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function fg(n,t){if(n.length===0)return t[0];var e=n.reduce(function(r,o){return r*o});if(e===0)return[];if(e!==t.length)throw new Error("["+n+"] does not match the input size.");return function r(o,i,s){var u=new Array;if(i.length===1)for(var c=i[0],f=0;f<c;f++)u[f]=s[o+f];else{c=i[0];var d=i.slice(1),p=d.reduce(function(v,g){return v*g});for(f=0;f<c;f++)u[f]=r(o+f*p,d,s)}return u}(0,n,t)}function Vy(n,t){for(var e=cs(n,t),r=0;r<e.length;r++)e[r]=1;return e}function cs(n,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+t)}function pr(){return ae().platform.now()}function jy(n){n.forEach(function(t){O(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function sb(n,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",ae().platform.encode(n,t)}function rl(n,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",ae().platform.decode(n,t)}function dg(n,t,e){if(t===0)return 0;if(t===1)return n[0];for(var r=n[n.length-1],o=0;o<n.length-1;++o)r+=e[o]*n[o];return r}function ub(n,t,e){if(t===0)return[];if(t===1)return[n];for(var r=new Array(t),o=0;o<r.length-1;++o)r[o]=Math.floor(n/e[o]),n-=r[o]*e[o];return r[r.length-1]=n,r}var lb=function(){function n(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new cb)}return n.prototype.profileKernel=function(t,e,r){var o,i=this,s=this.backendTimer.time(function(){o=r()});return o.forEach(function(u){u.data().then(function(c){(function(f,d,p){if(d!=="float32")return!1;for(var v=0;v<f.length;v++){var g=f[v];if(isNaN(g)||!isFinite(g))return console.warn("Found "+g+" in the result of '"+p+"'"),!0}})(c,u.dtype,t),s.then(function(f){var d="";f.getExtraProfileInfo!=null&&(d=f.getExtraProfileInfo()),i.logger.logKernelProfile(t,u,c,f.kernelMs,e,d)})})}),o},n}(),cb=function(){function n(){}return n.prototype.logKernelProfile=function(t,e,r,o,i,s){var u=typeof o=="number"?ji(o+"ms",9):o.error,c=ji(t,25),f=e.rank,d=e.size,p=ji(e.shape.toString(),14),v="";for(var g in i){var y=i[g].shape||e.shape,b=y.length;v+=g+": "+b+"D "+(b>0?y:"")+" "}console.log("%c"+c+"	%c"+u+"	%c"+f+"D "+p+"	%c"+d+"	%c"+v+"	%c"+s,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}(),hg=20,Ga=3,$f=7;function fb(n,t,e,r){var o=xr(t),i=function(f,d,p,v){var g=Re(d),y=v[v.length-1],b=new Array(y).fill(0),w=d.length,C=p==="complex64"?Ka(f):f;if(w>1)for(var _=0;_<g/y;_++)for(var S=_*y,k=0;k<y;k++)b[k]=Math.max(b[k],qa(C[S+k],0,p).length);return b}(n,t,e,o),s=t.length,u=function f(d,p,v,g,y,b){b===void 0&&(b=!0);var w=v==="complex64"?2:1,C=p[0],_=p.length;if(_===0)return v==="complex64"?[qa(Ka(d)[0],0,v)]:v==="bool"?[Hy(d[0])]:[d[0].toString()];if(_===1){if(C>hg){var S=Ga*w,k=Array.from(d.slice(0,S)),R=Array.from(d.slice((C-Ga)*w,C*w));return v==="complex64"&&(k=Ka(k),R=Ka(R)),["["+k.map(function(ee,G){return qa(ee,y[G],v)}).join(", ")+", ..., "+R.map(function(ee,G){return qa(ee,y[C-Ga+G],v)}).join(", ")+"]"]}return["["+(v==="complex64"?Ka(d):Array.from(d)).map(function(ee,G){return qa(ee,y[G],v)}).join(", ")+"]"]}var N=p.slice(1),P=g.slice(1),F=g[0]*w,D=[];if(C>hg){for(var A=0;A<Ga;A++){var V=(U=A*F)+F;D.push.apply(D,f(d.slice(U,V),N,v,P,y,!1))}for(D.push("..."),A=C-Ga;A<C;A++)V=(U=A*F)+F,D.push.apply(D,f(d.slice(U,V),N,v,P,y,A===C-1))}else for(A=0;A<C;A++){var U;V=(U=A*F)+F,D.push.apply(D,f(d.slice(U,V),N,v,P,y,A===C-1))}var re=_===2?",":"";for(D[0]="["+D[0]+re,A=1;A<D.length-1;A++)D[A]=" "+D[A]+re;var te=`,
`;for(A=2;A<_;A++)te+=`
`;return D[D.length-1]=" "+D[D.length-1]+"]"+(b?"":te),D}(n,t,e,o,i),c=["Tensor"];return r&&(c.push("  dtype: "+e),c.push("  rank: "+s),c.push("  shape: ["+t+"]"),c.push("  values:")),c.push(u.map(function(f){return"    "+f}).join(`
`)),c.join(`
`)}function qa(n,t,e){return ji(Array.isArray(n)?parseFloat(n[0].toFixed($f))+" + "+parseFloat(n[1].toFixed($f))+"j":ih(n)?"'"+n+"'":e==="bool"?Hy(n):parseFloat(n.toFixed($f)).toString(),t)}function Hy(n){return n===0?"false":"true"}function Ka(n){for(var t=[],e=0;e<n.length;e+=2)t.push([n[e],n[e+1]]);return t}var ts=function(){function n(t,e,r){var o=this;if(this.dtype=e,this.shape=t.slice(),this.size=Re(t),r!=null){var i=r.length;O(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."})}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||nl(e,this.size),this.strides=xr(t)}return n.prototype.set=function(t){for(var e=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];r.length===0&&(r=[0]),O(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+e.rank+")"});var i=this.locToIndex(r);this.values[i]=t},n.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.length===0&&(t=[0]);for(var r=0,o=0,i=t;o<i.length;o++){var s=i[o];if(s<0||s>=this.shape[r]){var u="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(u)}r++}for(var c=t[t.length-1],f=0;f<t.length-1;++f)c+=this.strides[f]*t[f];return this.values[c]},n.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var e=t[t.length-1],r=0;r<t.length-1;++r)e+=this.strides[r]*t[r];return e},n.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var e=new Array(this.shape.length),r=0;r<e.length-1;++r)e[r]=Math.floor(t/this.strides[r]),t-=e[r]*this.strides[r];return e[e.length-1]=t,e},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return vr().makeTensor(this.values,this.shape,this.dtype)},n}(),vr=null,ne=null,Gy=null,ft=function(){function n(t,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Re(t),this.strides=xr(t),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),O(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},n.prototype.as3D=function(t,e,r){return this.throwIfDisposed(),this.reshape([t,e,r])},n.prototype.as4D=function(t,e,r,o){return this.throwIfDisposed(),this.reshape([t,e,r,o])},n.prototype.as5D=function(t,e,r,o,i){return this.throwIfDisposed(),this.reshape([t,e,r,o,i])},n.prototype.asType=function(t){return this.throwIfDisposed(),ne.cast(this,t)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return Ee(this,void 0,void 0,function(){var t;return _e(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,ne.buffer(this.shape,this.dtype,t)]}})})},n.prototype.bufferSync=function(){return ne.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Ee(this,void 0,void 0,function(){var t;return _e(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,fg(this.shape,t)]}})})},n.prototype.arraySync=function(){return fg(this.shape,this.dataSync())},n.prototype.data=function(){return Ee(this,void 0,void 0,function(){var t,e;return _e(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),t=vr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,t];case 1:e=r.sent();try{return[2,e.map(function(o){return rl(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,t]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var t=vr().readSync(this.dataId);if(this.dtype==="string")try{return t.map(function(e){return rl(e)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},n.prototype.bytes=function(){return Ee(this,void 0,void 0,function(){var t;return _e(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,vr().read(this.dataId)];case 1:return t=e.sent(),this.dtype==="string"?[2,t]:[2,new Uint8Array(t.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(vr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(t){return t===void 0&&(t=!1),ne.print(this,t)},n.prototype.reshape=function(t){return this.throwIfDisposed(),ne.reshape(this,t)},n.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},n.prototype.expandDims=function(t){return t===void 0&&(t=0),ne.expandDims(this,t)},n.prototype.cumsum=function(t,e,r){return t===void 0&&(t=0),e===void 0&&(e=!1),r===void 0&&(r=!1),ne.cumsum(this,t,e,r)},n.prototype.squeeze=function(t){return this.throwIfDisposed(),ne.squeeze(this,t)},n.prototype.clone=function(){return this.throwIfDisposed(),ne.clone(this)},n.prototype.oneHot=function(t,e,r){return this.throwIfDisposed(),ne.oneHot(this,t,e,r)},n.prototype.toString=function(t){return t===void 0&&(t=!1),fb(this.dataSync(),this.shape,this.dtype,t)},n.prototype.tile=function(t){return this.throwIfDisposed(),ne.tile(this,t)},n.prototype.gather=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),ne.gather(this,t,e)},n.prototype.matMul=function(t,e,r){return e===void 0&&(e=!1),r===void 0&&(r=!1),this.throwIfDisposed(),ne.matMul(this,t,e,r)},n.prototype.dot=function(t){return this.throwIfDisposed(),ne.dot(this,t)},n.prototype.norm=function(t,e,r){return t===void 0&&(t="euclidean"),e===void 0&&(e=null),r===void 0&&(r=!1),this.throwIfDisposed(),ne.norm(this,t,e,r)},n.prototype.slice=function(t,e){return this.throwIfDisposed(),ne.slice(this,t,e)},n.prototype.reverse=function(t){return this.throwIfDisposed(),ne.reverse(this,t)},n.prototype.concat=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),t instanceof n&&(t=[t]),ne.concat([this].concat(t),e)},n.prototype.split=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),ne.split(this,t,e)},n.prototype.stack=function(t,e){return e===void 0&&(e=0),ne.stack([this,t],e)},n.prototype.unstack=function(t){return t===void 0&&(t=0),ne.unstack(this,t)},n.prototype.pad=function(t,e){return e===void 0&&(e=0),ne.pad(this,t,e)},n.prototype.batchNormalization=function(t,e,r,o,i){return r===void 0&&(r=.001),Gy("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,i,o,r)},n.prototype.batchNorm=function(t,e,r,o,i){return i===void 0&&(i=.001),this.throwIfDisposed(),ne.batchNorm(this,t,e,r,o,i)},n.prototype.all=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),ne.all(this,t,e)},n.prototype.any=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),ne.any(this,t,e)},n.prototype.logSumExp=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),ne.logSumExp(this,t,e)},n.prototype.sum=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),ne.sum(this,t,e)},n.prototype.prod=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),ne.prod(this,t,e)},n.prototype.mean=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),ne.mean(this,t,e)},n.prototype.min=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),ne.min(this,t,e)},n.prototype.max=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),ne.max(this,t,e)},n.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),ne.argMin(this,t)},n.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),ne.argMax(this,t)},n.prototype.cast=function(t){return this.throwIfDisposed(),ne.cast(this,t)},n.prototype.add=function(t){return this.throwIfDisposed(),ne.add(this,t)},n.prototype.addStrict=function(t){return this.throwIfDisposed(),ne.addStrict(this,t)},n.prototype.atan2=function(t){return this.throwIfDisposed(),ne.atan2(this,t)},n.prototype.sub=function(t){return this.throwIfDisposed(),ne.sub(this,t)},n.prototype.subStrict=function(t){return this.throwIfDisposed(),ne.subStrict(this,t)},n.prototype.pow=function(t){return this.throwIfDisposed(),ne.pow(this,t)},n.prototype.powStrict=function(t){return this.throwIfDisposed(),ne.powStrict(this,t)},n.prototype.mul=function(t){return this.throwIfDisposed(),ne.mul(this,t)},n.prototype.mulStrict=function(t){return this.throwIfDisposed(),ne.mulStrict(this,t)},n.prototype.div=function(t){return this.throwIfDisposed(),ne.div(this,t)},n.prototype.divNoNan=function(t){return this.throwIfDisposed(),ne.divNoNan(this,t)},n.prototype.floorDiv=function(t){return this.throwIfDisposed(),ne.floorDiv(this,t)},n.prototype.divStrict=function(t){return this.throwIfDisposed(),ne.divStrict(this,t)},n.prototype.minimum=function(t){return this.throwIfDisposed(),ne.minimum(this,t)},n.prototype.minimumStrict=function(t){return this.throwIfDisposed(),ne.minimumStrict(this,t)},n.prototype.maximum=function(t){return this.throwIfDisposed(),ne.maximum(this,t)},n.prototype.maximumStrict=function(t){return this.throwIfDisposed(),ne.maximumStrict(this,t)},n.prototype.mod=function(t){return this.throwIfDisposed(),ne.mod(this,t)},n.prototype.modStrict=function(t){return this.throwIfDisposed(),ne.modStrict(this,t)},n.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),ne.squaredDifferenceStrict(this,t)},n.prototype.transpose=function(t){return this.throwIfDisposed(),ne.transpose(this,t)},n.prototype.notEqual=function(t){return this.throwIfDisposed(),ne.notEqual(this,t)},n.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),ne.notEqualStrict(this,t)},n.prototype.less=function(t){return this.throwIfDisposed(),ne.less(this,t)},n.prototype.lessStrict=function(t){return this.throwIfDisposed(),ne.lessStrict(this,t)},n.prototype.equal=function(t){return this.throwIfDisposed(),ne.equal(this,t)},n.prototype.equalStrict=function(t){return this.throwIfDisposed(),ne.equalStrict(this,t)},n.prototype.lessEqual=function(t){return this.throwIfDisposed(),ne.lessEqual(this,t)},n.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),ne.lessEqualStrict(this,t)},n.prototype.greater=function(t){return this.throwIfDisposed(),ne.greater(this,t)},n.prototype.greaterStrict=function(t){return this.throwIfDisposed(),ne.greaterStrict(this,t)},n.prototype.greaterEqual=function(t){return this.throwIfDisposed(),ne.greaterEqual(this,t)},n.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),ne.greaterEqualStrict(this,t)},n.prototype.logicalAnd=function(t){return this.throwIfDisposed(),ne.logicalAnd(this,t)},n.prototype.logicalOr=function(t){return this.throwIfDisposed(),ne.logicalOr(this,t)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),ne.logicalNot(this)},n.prototype.logicalXor=function(t){return this.throwIfDisposed(),ne.logicalXor(this,t)},n.prototype.where=function(t,e){return this.throwIfDisposed(),ne.where(t,this,e)},n.prototype.neg=function(){return this.throwIfDisposed(),ne.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),ne.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),ne.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),ne.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),ne.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),ne.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),ne.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),ne.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),ne.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),ne.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),ne.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),ne.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),ne.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),ne.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),ne.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),ne.abs(this)},n.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),ne.clipByValue(this,t,e)},n.prototype.relu=function(){return this.throwIfDisposed(),ne.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),ne.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),ne.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),ne.selu(this)},n.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),ne.leakyRelu(this,t)},n.prototype.prelu=function(t){return this.throwIfDisposed(),ne.prelu(this,t)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),ne.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),ne.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),ne.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),ne.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),ne.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),ne.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),ne.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),ne.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),ne.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),ne.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),ne.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),ne.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),ne.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),ne.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),ne.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),ne.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),ne.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),ne.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),ne.round(this)},n.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),ne.step(this,t)},n.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),ne.softmax(this,t)},n.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),ne.logSoftmax(this,t)},n.prototype.resizeBilinear=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),ne.image.resizeBilinear(this,t,e)},n.prototype.resizeNearestNeighbor=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),ne.image.resizeNearestNeighbor(this,t,e)},n.prototype.conv1d=function(t,e,r,o,i,s){return o===void 0&&(o="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),ne.conv1d(this,t,e,r,o,i,s)},n.prototype.conv2d=function(t,e,r,o,i,s){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),ne.conv2d(this,t,e,r,o,i,s)},n.prototype.conv2dTranspose=function(t,e,r,o,i){return this.throwIfDisposed(),ne.conv2dTranspose(this,t,e,r,o,i)},n.prototype.depthwiseConv2D=function(t,e,r,o,i,s){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),ne.depthwiseConv2d(this,t,e,r,o,i,s)},n.prototype.separableConv2d=function(t,e,r,o,i,s){return i===void 0&&(i=[1,1]),s===void 0&&(s="NHWC"),this.throwIfDisposed(),ne.separableConv2d(this,t,e,r,o,i,s)},n.prototype.avgPool=function(t,e,r,o){return this.throwIfDisposed(),ne.avgPool(this,t,e,r,o)},n.prototype.maxPool=function(t,e,r,o){return this.throwIfDisposed(),ne.maxPool(this,t,e,r,o)},n.prototype.localResponseNormalization=function(t,e,r,o){return t===void 0&&(t=5),e===void 0&&(e=1),r===void 0&&(r=1),o===void 0&&(o=.5),ne.localResponseNormalization(this,t,e,r,o)},n.prototype.pool=function(t,e,r,o,i){return this.throwIfDisposed(),ne.pool(this,t,e,r,o,i)},n.prototype.variable=function(t,e,r){return t===void 0&&(t=!0),this.throwIfDisposed(),vr().makeVariable(this,t,e,r)},n.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),ne.unsortedSegmentSum(this,t,e)},n.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),ne.batchToSpaceND(this,t,e)},n.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),ne.spaceToBatchND(this,t,e)},n.prototype.topk=function(t,e){return t===void 0&&(t=1),e===void 0&&(e=!0),this.throwIfDisposed(),ne.topk(this,t,e)},n.prototype.stridedSlice=function(t,e,r,o,i,s,u,c){return o===void 0&&(o=0),i===void 0&&(i=0),s===void 0&&(s=0),u===void 0&&(u=0),c===void 0&&(c=0),this.throwIfDisposed(),ne.stridedSlice(this,t,e,r,o,i,s,u,c)},n.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),ne.depthToSpace(this,t,e)},n.prototype.fft=function(){return this.throwIfDisposed(),ne.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),ne.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),ne.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),ne.spectral.irfft(this)},n}();Object.defineProperty(ft,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var pg,Dd,Ad,Pd,Fd,Ji=function(n){function t(e,r,o,i){var s=n.call(this,e.shape,e.dtype,e.dataId,i)||this;return s.trainable=r,s.name=o,s}return nr(t,n),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Ot(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");vr().disposeTensor(this),this.dataId=e.dataId,vr().incRef(this,null)},t.prototype.dispose=function(){vr().disposeVariable(this),this.isDisposedInternal=!0},t}(ft);Object.defineProperty(Ji,Symbol.hasInstance,{value:function(n){return n instanceof ft&&n.assign!=null&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(pg||(pg={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(Dd||(Dd={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(Ad||(Ad={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(Pd||(Pd={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(Fd||(Fd={}));var db={float32:Pd,int32:Dd,bool:Ad,complex64:Fd};function Ut(n,t){if(n==="string"||t==="string"){if(n==="string"&&t==="string")return"string";throw new Error("Can not upcast "+n+" with "+t)}return db[n][t]}function Xf(n){return Ut(n,"int32")}function pt(n,t){if(n.dtype===t.dtype)return[n,t];var e=Ut(n.dtype,t.dtype);return[n.cast(e),t.cast(e)]}function hb(n,t){O(n.dtype===t.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+t.dtype+") input must match"})}function qy(n){var t=[];return function e(r,o,i){if(r!=null){if(r instanceof ft)return void o.push(r);if(s=r,!(!Array.isArray(s)&&typeof s!="object")){var s,u=r;for(var c in u){var f=u[c];i.has(f)||(i.add(f),e(f,o,i))}}}}(n,t,new Set),t}var Yf,vg=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},n}(),pb=function(){function n(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new vg}return n.prototype.ready=function(){return Ee(this,void 0,void 0,function(){var t,e,r;return _e(this,function(o){switch(o.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];t=this.getSortedBackends(),e=0,o.label=1;case 1:return e<t.length?(r=t[e],[4,this.initializeBackend(r).success]):[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(t){return!(t in this.registry)&&(!(t in this.registryFactory)||this.initializeBackend(t).asyncInit)?null:this.registry[t]},n.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},n.prototype.registerBackend=function(t,e,r){return r===void 0&&(r=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:r},!0)},n.prototype.setBackend=function(t){return Ee(this,void 0,void 0,function(){var e,r,o;return _e(this,function(i){switch(i.label){case 0:if(this.registryFactory[t]==null)throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,this.registry[t]!=null?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),r=e.success,e.asyncInit?[4,r]:[3,2]);case 1:return o=i.sent(),[3,3];case 2:o=r,i.label=3;case 3:if(!o)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new lb(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var t=this;lg(this.backendName).forEach(function(e){e.setupFunc!=null&&e.setupFunc(t.backendInstance)})},n.prototype.disposeRegisteredKernels=function(t){var e=this;lg(t).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(e.registry[t])})},n.prototype.initializeBackend=function(t){var e=this,r=this.registryFactory[t];if(r==null)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var i=++this.pendingBackendInitId,s=o.then(function(u){return!(i<e.pendingBackendInitId)&&(e.registry[t]=u,e.pendingBackendInit=null,!0)}).catch(function(u){return!(i<e.pendingBackendInitId)&&(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(u.stack||u.message),!1)});return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[t]=o,{success:!0,asyncInit:!1}}catch(u){return console.warn("Initialization of backend "+t+" failed"),console.warn(u.stack||u.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var t=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,r){return t.registryFactory[r].priority-t.registryFactory[e].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var r=t[e],o=this.initializeBackend(r),i=o.success,s=o.asyncInit;if(s||i)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(t,e){var r=this.state.tensorInfo.get(e),o=r.backend,i=this.readSync(e);o.disposeData(e),r.backend=t,t.move(e,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(t,e){var r,o=this,i=null;if(e==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");e=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun(function(){return o.startScope(i)},function(){return o.endScope(r)},function(){return(r=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(t,e,r){t();try{var o=r();return e(),o}catch(i){throw e(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),r={x:t};return this.addTapeNode(this.state.activeScope.name,r,[e],function(o){return{x:function(){return o.toFloat()}}},[]),e},n.prototype.runKernel=function(t,e,r,o,i){return this.runKernelFunc(null,e,null,t,r,o,i)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(t,e,r){var o=this.backend.numDataIds(),i=0;r.forEach(function(c){i+=c.dtype==="complex64"?3:1});var s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],u=o-e-i-s;if(u>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+u+" data ids) after running '"+t+"'")},n.prototype.runKernelFunc=function(t,e,r,o,i,s,u){var c,f=this;s===void 0&&(s=[]),u===void 0&&(u=[]);var d=[],p=this.isTapeOn();o==null&&(o=this.state.activeScope!=null?this.state.activeScope.name:"");var v,g=function(_){p&&(d=_.map(function(S){return f.keep(f.clone(S))}))},y=this.state.numBytes,b=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var w,C=My(o,this.backendName);return v=C!=null?function(){var _=f.backend.numDataIds();w=C.kernelFunc({inputs:e,attrs:i,backend:f.backend});var S=Array.isArray(w)?w:[w];f.shouldCheckForMemLeaks()&&f.checkKernelForMemLeak(o,_,S);var k=S.map(function(N){var P=N.dataId,F=N.shape,D=N.dtype;return f.makeTensorFromDataId(P,F,D)}),R=k.filter(function(N,P){return u[P]});return g((s||[]).slice().concat(R)),k}:function(){var _=f.backend.numDataIds();w=f.tidy(function(){return t(f.backend,g)});var S=Array.isArray(w)?w:[w];return f.shouldCheckForMemLeaks()&&f.checkKernelForMemLeak(o,_,S),S},this.scopedRun(function(){return f.state.kernelDepth++},function(){return f.state.kernelDepth--},function(){c=f.ENV.getBool("DEBUG")?f.profiler.profileKernel(o,e,function(){return v()}):v()}),p&&this.addTapeNode(o,e,c,r,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-y,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-b,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(_){return e[_].shape}),outputShapes:c.map(function(_){return _.shape})}),Array.isArray(w)?c:c[0]},n.prototype.makeTensor=function(t,e,r,o){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",o=o||this.backend;var i=t;r==="string"&&ih(t[0])&&(i=t.map(function(d){return sb(d)}));var s=o.write(i,e,r),u=new ft(e,r,s,this.nextTensorId());if(this.incRef(u,o),r==="string"){var c=this.state.tensorInfo.get(s),f=ob(i);this.state.numBytes+=f-c.bytes,c.bytes=f}return u},n.prototype.makeTensorFromDataId=function(t,e,r,o){var i=new ft(e,r=r||"float32",t,this.nextTensorId());return this.incRef(i,o),i},n.prototype.makeVariable=function(t,e,r,o){e===void 0&&(e=!0),r=r||this.nextVariableId().toString(),o!=null&&o!==t.dtype&&(t=t.asType(o));var i=new Ji(t,e,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.incRef=function(t,e){var r=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var o=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(o=t.size*zy(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof Ji||this.track(t)},n.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,t.dtype==="string"&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?(t.dtype!=="complex64"&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},n.prototype.disposeVariable=function(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]},n.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},n.prototype.profile=function(t){return Ee(this,void 0,void 0,function(){var e,r;return _e(this,function(o){return this.state.profiling=!0,e=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(t,e,r,o,i){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:r,saved:i},c=Y2(t);c!=null&&(o=c.gradFunc),o!=null&&(u.gradient=function(f){return f=f.map(function(d,p){if(d==null){var v=r[p],g=cs(v.size,v.dtype);return s.makeTensor(g,v.shape,v.dtype)}return d}),o(f.length>1?f:f[0],i)}),this.state.activeTape.push(u)},n.prototype.keep=function(t){return t.kept=!0,t},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},n.prototype.endScope=function(t){for(var e=this,r=qy(t),o=new Set(r.map(function(c){return c.id})),i=0;i<this.state.activeScope.track.length;i++){var s=this.state.activeScope.track[i];s.kept||o.has(s.id)||s.dispose()}var u=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(c){c.kept||c.scopeId!==u.id||e.track(c)})},n.prototype.gradients=function(t,e,r,o){var i=this;if(o===void 0&&(o=!1),O(e.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var s=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",t)});O(s instanceof ft,function(){return"The result y returned by f() must be a tensor."});var u=function(c,f,d){for(var p={},v={},g=0;g<f.length;g++)p[f[g].id]=!0;for(g=0;g<c.length;g++){var y=(N=c[g]).inputs;for(var b in y){for(var w=y[b],C=!1,_=0;_<f.length;_++)if(p[w.id]){N.outputs.forEach(function(A){return p[A.id]=!0}),C=!0,v[N.id]=!0;break}if(C)break}}var S={};S[d.id]=!0;var k={};for(g=c.length-1;g>=0;g--)for(y=(N=c[g]).inputs,_=0;_<N.outputs.length;_++)if(S[N.outputs[_].id]){for(var b in y)S[y[b].id]=!0,k[N.id]=!0;break}var R=[];for(g=0;g<c.length;g++){var N;if(v[(N=c[g]).id]&&k[N.id]){var P={};for(var b in N.inputs){var F=N.inputs[b];p[F.id]&&(P[b]=F)}var D=Object.assign({},N);D.inputs=P,D.outputs=N.outputs,R.push(D)}}return R}(this.state.activeTape,e,s);if(!o&&u.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var c,f,d={};d[s.id]=r??(c=s.shape,f=Vy(Re(c),"float32"),j.makeTensor(f,c,"float32")),function(v,g,y){for(var b=function(C){var _=g[C],S=[];if(_.outputs.forEach(function(P){var F=v[P.id];F!=null?S.push(F):S.push(null)}),_.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+_.kernelName+".");var k=_.gradient(S),R=function(P){if(!(P in k))throw new Error("Cannot backprop through input "+P+". Available gradients found: "+Object.keys(k)+".");var F=y(function(){return k[P]()});if(F.dtype!=="float32")throw new Error("Error in gradient for op "+_.kernelName+". The gradient of input "+P+" must have 'float32' dtype, but has '"+F.dtype+"'");var D=_.inputs[P];if(!Ot(F.shape,D.shape))throw new Error("Error in gradient for op "+_.kernelName+". The gradient of input '"+P+"' has shape '"+F.shape+"', which does not match the shape of the input '"+D.shape+"'");if(v[D.id]==null)v[D.id]=F;else{var A=v[D.id];v[D.id]=A.add(F),A.dispose()}};for(var N in _.inputs)R(N)},w=g.length-1;w>=0;w--)b(w)}(d,u,function(v){return i.tidy(v)});var p=e.map(function(v){return d[v.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(v){for(var g=0,y=v.saved;g<y.length;g++)y[g].dispose()}),i.state.activeTape=null),{value:s,grads:p}})},n.prototype.customGrad=function(t){var e=this;return O(Nd(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];O(o.every(function(u){return u instanceof ft}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var s={};return o.forEach(function(u,c){s[c]=u}),e.runKernelFunc(function(u,c){return O((r=t.apply(void 0,o.concat([c]))).value instanceof ft,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),O(Nd(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},s,function(u,c){var f=r.gradFunc(u,c),d=Array.isArray(f)?f:[f];O(d.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),O(d.every(function(v){return v instanceof ft}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return d.forEach(function(v,g){p[g]=function(){return v}}),p})}},n.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},n.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},n.prototype.time=function(t){return Ee(this,void 0,void 0,function(){var e,r;return _e(this,function(o){switch(o.label){case 0:return e=pr(),[4,this.backend.time(t)];case 1:return(r=o.sent()).wallMs=pr()-e,[2,r]}})})},n.prototype.track=function(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new vg,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),j=function(){var n=function(){if(Yf==null){var e=void 0;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}Yf=e}return Yf}();if(n._tfengine==null){var t=new $2(n);n._tfengine=new pb(t)}return function(e){Oy=e}(n._tfengine.ENV),vr=function(){return n._tfengine},n._tfengine}();function Ky(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Lr=ae();Lr.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Lr.registerFlag("IS_BROWSER",function(){return Ky()}),Lr.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Lr.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Lr.registerFlag("PROD",function(){return!1}),Lr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Lr.getBool("DEBUG")}),Lr.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Lr.registerFlag("IS_TEST",function(){return!1});var ns,Rn,kn,jo={},Qf={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function vb(n,t){jo[n]=t}function Er(n){n in jo||(jo[n]=function(e){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(o){if(typeof OffscreenCanvas<"u"&&o===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return r.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete jo[e]},!1),e===1?r.getContext("webgl",Qf)||r.getContext("experimental-webgl",Qf):r.getContext("webgl2",Qf)}(n));var t=jo[n];return t.isContextLost()?(delete jo[n],Er(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),jo[n])}function Nl(n,t){return[t,n]}function Qa(n){var t=Re(n);return Id(Math.ceil(t/4))}function fs(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function ah(n,t){var e,r,o,i,s,u,c,f,d,p=n;return ae().getNumber("WEBGL_VERSION")===2?(e=p.R32F,r=p.R16F,o=p.RGBA16F,i=p.RGBA32F,s=p.RED,u=4,c=1,f=p.HALF_FLOAT,d=p.FLOAT):(e=n.RGBA,r=n.RGBA,o=n.RGBA,i=p.RGBA,s=n.RGBA,u=4,c=4,f=t!=null?t.HALF_FLOAT_OES:null,d=n.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:s,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:f,textureTypeFloat:d}}function Ne(n,t,e){var r=e();return t&&function(o){var i=o.getError();if(i!==o.NO_ERROR)throw new Error("WebGL Error: "+xb(o,i))}(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(ns||(ns={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(Rn||(Rn={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(kn||(kn={}));var mb=596e-10,gb=65504;function yb(n){return!!(ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||mb<Math.abs(n)&&Math.abs(n)<gb)}function xb(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Fu(n,t,e){return Vr(n,t,function(){return n.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function wb(n,t,e){var r=Vr(n,t,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Ne(n,t,function(){return n.shaderSource(r,e)}),Ne(n,t,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function bb(n,t,e){var r=Vr(n,t,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Ne(n,t,function(){return n.shaderSource(r,e)}),Ne(n,t,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw function(o,i){var s=Cb.exec(i);if(s==null)return console.log("Couldn't parse line number in error: "+i),void console.log(o);for(var u=+s[1],c=o.split(`
`),f=c.length.toString().length+2,d=c.map(function(w,C){return ji((C+1).toString(),f)+w}),p=0,v=0;v<d.length;v++)p=Math.max(d[v].length,p);var g=d.slice(0,u-1),y=d.slice(u-1,u),b=d.slice(u);console.log(g.join(`
`)),console.log(i.split(`
`)[0]),console.log("%c "+ji(y[0],p),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(b.join(`
`))}(e,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Jf,Zf,Cb=/ERROR: [0-9]+:([0-9]+):/g;function Eb(n,t){return Vr(n,t,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function _b(n,t,e){if(Ne(n,t,function(){return n.linkProgram(e)}),n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function ed(n,t,e){if(Ne(n,t,function(){return n.validateProgram(e)}),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function Sb(n,t,e){var r=Vr(n,t,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Ne(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),Ne(n,t,function(){return n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)}),r}function kb(n,t,e){var r=Vr(n,t,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Ne(n,t,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),Ne(n,t,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)}),r}function Rb(n,t){return Vr(n,t,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function Ib(n,t){var e=ae().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){var r="["+n+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>e||t>e)throw r="["+n+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+e+"x"+e+"]")+".")}function Nb(n,t){return Vr(n,t,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function mg(n,t,e,r,o,i,s,u){var c=n.getAttribLocation(e,r);return c!==-1&&(Ne(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,o)}),Ne(n,t,function(){return n.vertexAttribPointer(c,i,n.FLOAT,!1,s,u)}),Ne(n,t,function(){return n.enableVertexAttribArray(c)}),!0)}function Tb(n,t,e,r){Ob(n,r),Ne(n,t,function(){return n.activeTexture(n.TEXTURE0+r)}),Ne(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)})}function Db(n,t,e,r){return Vr(n,t,function(){return n.getUniformLocation(e,r)},'uniform "'+r+'" not present in program.')}function Ab(n,t,e){return n.getUniformLocation(t,e)}function Pb(n,t,e,r,o,i){Ne(n,t,function(){return Tb(n,t,r,i)}),Ne(n,t,function(){return n.uniform1i(o,i)})}function td(n,t,e,r){Ne(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),Ne(n,t,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0)})}function gg(n,t,e){Ne(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,e)}),Ne(n,t,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function Ou(n){var t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Fb(n,t))}function Fb(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Vr(n,t,e,r){var o=Ne(n,t,function(){return e()});if(o==null)throw new Error(r);return o}function Ob(n,t){var e=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+n.TEXTURE0;if(r<n.TEXTURE0||r>e)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+e+"]")+".")}function ol(n,t){return t===void 0&&(t=2),Re(n.slice(0,n.length-t))}function il(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function nd(n){var t=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(t=[ol(n)].concat(il(n))),t}function Mb(n,t){var e;t===void 0&&(t=!1);var r=ae().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,(n=n.map(function(f,d){return d>=n.length-2?Wy(n[d]):n[d]})).length===1&&(n=[2,n[0]])),n.length!==2){var o=Go(n);n=o.newShape}var i=Re(n);if(n.length<=1&&i<=r)return[1,i];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(t){var s=ol(n),u=2,c=2;return n.length&&(u=(e=il(n))[0],c=e[1]),Id(i=s*(u/2)*(c/2)).map(function(f){return 2*f})}return Id(i)}function Mu(n){return n%2==0}function Lu(n,t){if(Ot(n=n.slice(-2),t=t.slice(-2))||!n.length||!t.length||n[0]===0||n[1]===0||t[0]===0||t[1]===0)return!0;if(n.length!==t.length){var e=n.slice(-1)[0],r=t.slice(-1)[0];if(e===r||Mu(e)&&Mu(r)&&(n[0]===1||t[0]===1))return!0}return n[1]===t[1]&&Mu(n[0])&&Mu(t[0])}function Lb(n){if(Jf==null){var t=Er(n);Jf=t.getParameter(t.MAX_TEXTURE_SIZE)}return Jf}function Bb(n){if(Zf==null){var t=Er(n);Zf=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Zf)}function Wb(n){if(n===0)return 0;var t=Er(n);return jn(t,"EXT_disjoint_timer_query_webgl2")&&n===2?2:jn(t,"EXT_disjoint_timer_query")?1:0}function jn(n,t){return n.getExtension(t)!=null}function yg(n){try{if(Er(n)!=null)return!0}catch{return!1}return!1}function zb(n){if(n===0)return!1;var t=Er(n);if(n===1){if(!jn(t,"OES_texture_float"))return!1}else if(!jn(t,"EXT_color_buffer_float"))return!1;return Od(t)}function Ub(n){if(n===0)return!1;var t=Er(n);if(n!==1){if(jn(t,"EXT_color_buffer_float"))return Od(t);if(jn(t,"EXT_color_buffer_half_float")){var e=t.getExtension("EXT_color_buffer_half_float");return function(r,o){var i=ah(r,o),s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var u=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,u),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0);var c=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(s),r.deleteFramebuffer(u),c}(t,e)}return!1}return!!jn(t,"OES_texture_float")&&!!jn(t,"WEBGL_color_buffer_float")&&Od(t)}function Od(n){var t=ah(n),e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);var o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(e),n.deleteFramebuffer(r),o}function Vb(n){return n===2&&Er(n).fenceSync!=null}var Me=ae();function $y(n){ae().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function xe(n,t){return j.tidy(n,t)}function vn(n){qy(n).forEach(function(t){return t.dispose()})}function jb(n){return j.keep(n)}function al(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];ae().getBool("IS_TEST")||console.warn.apply(console,n)}function _o(n,t){var e=n;if(yr(n))return t==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(e)||yr(e)&&t!=="string";)r.push(e.length),e=e[0];return Array.isArray(n)&&ae().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(i,s,u){if(u=u||[],!Array.isArray(i)&&!yr(i))return void O(s.length===0,function(){return"Element arr["+u.join("][")+"] is a primitive, but should be an array/TypedArray of "+s[0]+" elements"});O(s.length>0,function(){return"Element arr["+u.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),O(i.length===s[0],function(){return"Element arr["+u.join("][")+"] should have "+s[0]+" elements, but has "+i.length+" elements"});for(var c=s.slice(1),f=0;f<i.length;++f)o(i[f],c,u.concat(f))}(n,r,[]),r}function xg(n,t,e,r){if(n!=null&&(n!=="numeric"&&n!==t||n==="numeric"&&t==="string"))throw new Error("Argument '"+e+"' passed to '"+r+"' must be "+n+" tensor, but got "+t+" tensor")}function T(n,t,e,r){if(r===void 0&&(r="numeric"),n instanceof ft)return xg(r,n.dtype,t,e),n;var o=ls(n);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),xg(r,o,t,e),n==null||!yr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var i=n==null?"null":n.constructor.name;throw new Error("Argument '"+t+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+i+"'")}var s=_o(n,o);yr(n)||Array.isArray(n)||(n=[n]);var u=o!=="string"?Uy(n,o,ae().getBool("DEBUG")):Qi(n,[],!0);return j.makeTensor(u,s,o)}function sl(n,t,e,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+t+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(o,i){return T(o,t+"["+i+"]",e)},r)}function Xy(n,t){for(var e=0;e<n.length;++e)if(n[n.length-e-1]!==t-1-e)return!1;return!0}function Hb(n,t,e){for(var r=n.length+t.length,o=[],i=0,s=0,u=0;u<r;u++)e.indexOf(u)===-1?o.push(n[i++]):o.push(t[s++]);return o}function $t(n,t){for(var e=[],r=n.length,o=0;o<r;o++)t.indexOf(o)===-1&&e.push(n[o]);return[e,t.map(function(i){return n[i]})]}function yn(n,t){return Hb(n,t.map(function(e){return 1}),t)}function Sn(n,t,e){O(Xy(t,e),function(){return n+" supports only inner-most axes for now. Got axes "+t+" and rank-"+e+" input."})}function _r(n,t){if(Xy(n,t))return null;for(var e=[],r=0;r<t;++r)n.indexOf(r)===-1&&e.push(r);return n.forEach(function(o){return e.push(o)}),e}function sh(n){return n.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function Sr(n,t){for(var e=[],r=t-n;r<t;++r)e.push(r);return e}function Gb(n,t){var e=n[0].length;n.forEach(function(o,i){O(o.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+e+")"})}),O(t>=0&&t<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var r=n[0];n.forEach(function(o,i){for(var s=0;s<e;s++)O(s===t||o[s]===r[s],function(){return"Error in concat"+e+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}function Zi(n,t){for(var e=n[0].slice(),r=1;r<n.length;r++)e[t]+=n[r][t];return e}function B(n){var t=Object.keys(n);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var e=t[0],r=n[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var o=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];j.startScope(e);try{var u=r.apply(void 0,i);return u instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),j.endScope(u),u}catch(c){throw j.endScope(null),c}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}Me.registerFlag("HAS_WEBGL",function(){return Me.getNumber("WEBGL_VERSION")>0}),Me.registerFlag("WEBGL_VERSION",function(){return yg(2)?2:yg(1)?1:0}),Me.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Me.get("WEBGL_VERSION")===2}),Me.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Me.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Me.registerFlag("WEBGL_PACK",function(){return Me.getBool("HAS_WEBGL")}),Me.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Me.getBool("WEBGL_PACK")}),Me.registerFlag("WEBGL_PACK_CLIP",function(){return Me.getBool("WEBGL_PACK")}),Me.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Me.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Me.getBool("WEBGL_PACK")}),Me.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Me.getBool("WEBGL_PACK")}),Me.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Me.getBool("WEBGL_PACK")}),Me.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Me.getBool("WEBGL_PACK")}),Me.registerFlag("WEBGL_PACK_REDUCE",function(){return Me.getBool("WEBGL_PACK")}),Me.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Me.getBool("WEBGL_PACK")}),Me.registerFlag("WEBGL_CONV_IM2COL",function(){return Me.getBool("WEBGL_PACK")}),Me.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Lb(Me.getNumber("WEBGL_VERSION"))}),Me.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Bb(Me.getNumber("WEBGL_VERSION"))}),Me.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=Me.getNumber("WEBGL_VERSION");return n===0?0:Wb(n)}),Me.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Me.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),Me.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return zb(Me.getNumber("WEBGL_VERSION"))}),Me.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Me.getBool("WEBGL_FORCE_F16_TEXTURES")&&Me.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Me.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Ub(Me.getNumber("WEBGL_VERSION"))}),Me.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Vb(Me.getNumber("WEBGL_VERSION"))}),Me.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Me.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Gy=$y;var zt=B({complex_:function(n,t){var e=T(n,"real","complex"),r=T(t,"imag","complex");return Je(e.shape,r.shape,"real and imag shapes, "+e.shape+" and "+r.shape+", must match in call to tf.complex()."),j.runKernelFunc(function(o){return o.complex(e,r)},{$real:e,$imag:r})}}),Vn=B({real_:function(n){var t=T(n,"input","real");return j.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),mr=B({imag_:function(n){var t=T(n,"input","imag");return j.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function Vt(n,t,e){return So(n,t,_o(n,e),e)}function So(n,t,e,r){if(r==null&&(r=ls(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!yr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){jy(t);var o=Re(t),i=Re(e);O(o===i,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+i});for(var s=0;s<e.length;++s){var u=e[s],c=s!==e.length-1||u!==Re(t.slice(s));O(e[s]===t[s]||!c,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+t+"). "})}}return yr(n)||Array.isArray(n)||(n=[n]),t=t||e,n=r!=="string"?Uy(n,r,ae().getBool("DEBUG")):Qi(n,[],!0),j.makeTensor(n,t,r)}function ve(n,t){if((yr(n)&&t!=="string"||Array.isArray(n))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&yr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return So(n,[],[],t)}function Ct(n,t){ta(n);var e=_o(n,t);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return So(n,null,e,t)}function xo(n,t,e){if(ta(n),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=_o(n,e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return So(n,t,r,e)}function uh(n,t,e){if(ta(n),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=_o(n,e);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return So(n,t,r,e)}function dn(n,t,e){if(ta(n),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=_o(n,e);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return So(n,t,r,e)}function qb(n,t,e){if(ta(n),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=_o(n,e);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return So(n,t,r,e)}function Kb(n,t,e){if(ta(n),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=_o(n,e);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return So(n,t=t||r,r,e)}function $b(n,t,e,r){return t===void 0&&(t=!0),j.makeVariable(n,t,e,r)}function na(n,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=na(n,"float32"),r=st(n,"float32");return zt(e,r)}var o=Vy(Re(n),t);return j.makeTensor(o,n,t)}function st(n,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=st(n,"float32"),r=st(n,"float32");return zt(e,r)}var o=cs(Re(n),t);return j.makeTensor(o,n,t)}function wr(n,t,e){return j.runKernelFunc(function(r){return r.fill(n,t,e)},{})}function Xb(n,t,e){if(e<=0)throw new Error("The number of values should be positive.");return j.runKernelFunc(function(r){return r.linspace(n,t,e)},{})}function ul(n,t,e,r){if(e===void 0&&(e=1),r===void 0&&(r="float32"),e===0)throw new Error("Cannot have a step of zero");if(n===t||n<t&&e<0||t<n&&e>1)return st([0],r);var o=cs(Math.abs(Math.ceil((t-n)/e)),r);t<n&&e===1&&(e=-1),o[0]=n;for(var i=1;i<o.length;i++)o[i]=o[i-1]+e;return Ct(o,r)}var Yy=B({onesLike_:function(n){var t=T(n,"x","onesLike");if(t.dtype==="complex64"){var e=Yy(Vn(t)),r=Ke(mr(t));return zt(e,r)}return j.runKernelFunc(function(o){return o.onesLike(t)},{$x:t},function(o,i){return{$x:function(){return Ke(o)}}})}}),Ke=B({zerosLike_:function(n){var t=T(n,"x","zerosLike");return j.runKernelFunc(function(e){return e.zerosLike(t)},{$x:t},function(e,r){return{$x:function(){return Ke(e)}}})}}),kt=B({concat_:function(n,t){t===void 0&&(t=0),O(n.length>=1,function(){return"Pass at least one tensor to concat"});var e=sl(n,"tensors","concat");e[0].dtype==="complex64"&&e.forEach(function(u){if(u.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+u.dtype+". ")}),t=Tt(t,e[0].shape)[0];var r=Zi(e.map(function(u){return u.shape}),t);if(Re(r)===0)return Vt([],r);if((e=e.filter(function(u){return u.size>0})).length===1)return e[0];var o=e.map(function(u){return u.shape});Gb(o,t);var i=e,s={axis:t};return j.runKernelFunc(function(u){return u.concat(e,t)},i,function(u){var c=o.map(function(f){return f[t]});return lh(u,c,t).map(function(f){return function(){return f}})},"Concat",s)}}),Yb=B({concat1d_:function(n){return kt(n,0)}}),Qb=B({concat2d_:function(n,t){return kt(n,t)}}),Jb=B({concat3d_:function(n,t){return kt(n,t)}}),Zb=B({concat4d_:function(n,t){return kt(n,t)}}),lh=B({split_:function(n,t,e){e===void 0&&(e=0);var r,o=T(n,"x","split");return e=Tt(e,o.shape)[0],typeof t=="number"?(O(o.shape[e]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[e]/t)):(O(o.shape[e]===t.reduce(function(i,s){return i+s}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),j.runKernelFunc(function(i){return i.split(o,r,e)},{$x:o},function(i){return{$x:function(){return kt(i,e)}}})}});function ti(n,t){return n(t={exports:{}},t.exports),t.exports}var eC=ti(function(n){(function(t,e,r){function o(u){var c,f=this,d=(c=4022871197,function(p){p=p.toString();for(var v=0;v<p.length;v++){var g=.02519603282416938*(c+=p.charCodeAt(v));g-=c=g>>>0,c=(g*=c)>>>0,c+=4294967296*(g-=c)}return 23283064365386963e-26*(c>>>0)});f.next=function(){var p=2091639*f.s0+23283064365386963e-26*f.c;return f.s0=f.s1,f.s1=f.s2,f.s2=p-(f.c=0|p)},f.c=1,f.s0=d(" "),f.s1=d(" "),f.s2=d(" "),f.s0-=d(u),f.s0<0&&(f.s0+=1),f.s1-=d(u),f.s1<0&&(f.s1+=1),f.s2-=d(u),f.s2<0&&(f.s2+=1),d=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function s(u,c){var f=new o(u),d=c&&c.state,p=f.next;return p.int32=function(){return 4294967296*f.next()|0},p.double=function(){return p()+11102230246251565e-32*(2097152*p()|0)},p.quick=p,d&&(typeof d=="object"&&i(d,f),p.state=function(){return i(f,{})}),p}e&&e.exports?e.exports=s:this.alea=s})(0,n)}),tC=ti(function(n){(function(t,e,r){function o(u){var c=this,f="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var p=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^p^p>>>8},u===(0|u)?c.x=u:f+=u;for(var d=0;d<f.length+64;d++)c.x^=0|f.charCodeAt(d),c.next()}function i(u,c){return c.x=u.x,c.y=u.y,c.z=u.z,c.w=u.w,c}function s(u,c){var f=new o(u),d=c&&c.state,p=function(){return(f.next()>>>0)/4294967296};return p.double=function(){do var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/2097152;while(v===0);return v},p.int32=f.next,p.quick=p,d&&(typeof d=="object"&&i(d,f),p.state=function(){return i(f,{})}),p}e&&e.exports?e.exports=s:this.xor128=s})(0,n)}),nC=ti(function(n){(function(t,e,r){function o(u){var c=this,f="";c.next=function(){var p=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^p^p<<1)|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,u===(0|u)?c.x=u:f+=u;for(var d=0;d<f.length+64;d++)c.x^=0|f.charCodeAt(d),d==f.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function i(u,c){return c.x=u.x,c.y=u.y,c.z=u.z,c.w=u.w,c.v=u.v,c.d=u.d,c}function s(u,c){var f=new o(u),d=c&&c.state,p=function(){return(f.next()>>>0)/4294967296};return p.double=function(){do var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/2097152;while(v===0);return v},p.int32=f.next,p.quick=p,d&&(typeof d=="object"&&i(d,f),p.state=function(){return i(f,{})}),p}e&&e.exports?e.exports=s:this.xorwow=s})(0,n)}),rC=ti(function(n){(function(t,e,r){function o(u){var c=this;c.next=function(){var f,d,p=c.x,v=c.i;return f=p[v],d=(f^=f>>>7)^f<<24,d^=(f=p[v+1&7])^f>>>10,d^=(f=p[v+3&7])^f>>>3,d^=(f=p[v+4&7])^f<<7,f=p[v+7&7],d^=(f^=f<<13)^f<<9,p[v]=d,c.i=v+1&7,d},function(f,d){var p,v=[];if(d===(0|d))v[0]=d;else for(d=""+d,p=0;p<d.length;++p)v[7&p]=v[7&p]<<15^d.charCodeAt(p)+v[p+1&7]<<13;for(;v.length<8;)v.push(0);for(p=0;p<8&&v[p]===0;++p);for(p==8?v[7]=-1:v[p],f.x=v,f.i=0,p=256;p>0;--p)f.next()}(c,u)}function i(u,c){return c.x=u.x.slice(),c.i=u.i,c}function s(u,c){u==null&&(u=+new Date);var f=new o(u),d=c&&c.state,p=function(){return(f.next()>>>0)/4294967296};return p.double=function(){do var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/2097152;while(v===0);return v},p.int32=f.next,p.quick=p,d&&(d.x&&i(d,f),p.state=function(){return i(f,{})}),p}e&&e.exports?e.exports=s:this.xorshift7=s})(0,n)}),oC=ti(function(n){(function(t,e,r){function o(u){var c=this;c.next=function(){var f,d,p=c.w,v=c.X,g=c.i;return c.w=p=p+1640531527|0,d=v[g+34&127],f=v[g=g+1&127],d^=d<<13,f^=f<<17,d^=d>>>15,f^=f>>>12,d=v[g]=d^f,c.i=g,d+(p^p>>>16)|0},function(f,d){var p,v,g,y,b,w=[],C=128;for(d===(0|d)?(v=d,d=null):(d+="\0",v=0,C=Math.max(C,d.length)),g=0,y=-32;y<C;++y)d&&(v^=d.charCodeAt((y+32)%d.length)),y===0&&(b=v),v^=v<<10,v^=v>>>15,v^=v<<4,v^=v>>>13,y>=0&&(b=b+1640531527|0,g=(p=w[127&y]^=v+b)==0?g+1:0);for(g>=128&&(w[127&(d&&d.length||0)]=-1),g=127,y=512;y>0;--y)v=w[g+34&127],p=w[g=g+1&127],v^=v<<13,p^=p<<17,v^=v>>>15,p^=p>>>12,w[g]=v^p;f.w=b,f.X=w,f.i=g}(c,u)}function i(u,c){return c.i=u.i,c.w=u.w,c.X=u.X.slice(),c}function s(u,c){u==null&&(u=+new Date);var f=new o(u),d=c&&c.state,p=function(){return(f.next()>>>0)/4294967296};return p.double=function(){do var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/2097152;while(v===0);return v},p.int32=f.next,p.quick=p,d&&(d.X&&i(d,f),p.state=function(){return i(f,{})}),p}e&&e.exports?e.exports=s:this.xor4096=s})(0,n)}),iC=ti(function(n){(function(t,e,r){function o(u){var c=this,f="";c.next=function(){var p=c.b,v=c.c,g=c.d,y=c.a;return p=p<<25^p>>>7^v,v=v-g|0,g=g<<24^g>>>8^y,y=y-p|0,c.b=p=p<<20^p>>>12^v,c.c=v=v-g|0,c.d=g<<16^v>>>16^y,c.a=y-p|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,u===Math.floor(u)?(c.a=u/4294967296|0,c.b=0|u):f+=u;for(var d=0;d<f.length+20;d++)c.b^=0|f.charCodeAt(d),c.next()}function i(u,c){return c.a=u.a,c.b=u.b,c.c=u.c,c.d=u.d,c}function s(u,c){var f=new o(u),d=c&&c.state,p=function(){return(f.next()>>>0)/4294967296};return p.double=function(){do var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/2097152;while(v===0);return v},p.int32=f.next,p.quick=p,d&&(typeof d=="object"&&i(d,f),p.state=function(){return i(f,{})}),p}e&&e.exports?e.exports=s:this.tychei=s})(0,n)}),Ho=ti(function(n){(function(t,e){var r,o=this,i=256,s=6,u="random",c=e.pow(i,s),f=e.pow(2,52),d=2*f,p=i-1;function v(C,_,S){var k=[],R=b(function F(D,A){var V,U=[],re=typeof D;if(A&&re=="object")for(V in D)try{U.push(F(D[V],A-1))}catch{}return U.length?U:re=="string"?D:D+"\0"}((_=_==1?{entropy:!0}:_||{}).entropy?[C,w(t)]:C??function(){try{var F;return r&&(F=r.randomBytes)?F=F(i):(F=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(F)),w(F)}catch{var D=o.navigator,A=D&&D.plugins;return[+new Date,o,A,o.screen,w(t)]}}(),3),k),N=new g(k),P=function(){for(var F=N.g(s),D=c,A=0;F<f;)F=(F+A)*i,D*=i,A=N.g(1);for(;F>=d;)F/=2,D/=2,A>>>=1;return(F+A)/D};return P.int32=function(){return 0|N.g(4)},P.quick=function(){return N.g(4)/4294967296},P.double=P,b(w(N.S),t),(_.pass||S||function(F,D,A,V){return V&&(V.S&&y(V,N),F.state=function(){return y(N,{})}),A?(e[u]=F,D):F})(P,R,"global"in _?_.global:this==e,_.state)}function g(C){var _,S=C.length,k=this,R=0,N=k.i=k.j=0,P=k.S=[];for(S||(C=[S++]);R<i;)P[R]=R++;for(R=0;R<i;R++)P[R]=P[N=p&N+C[R%S]+(_=P[R])],P[N]=_;(k.g=function(F){for(var D,A=0,V=k.i,U=k.j,re=k.S;F--;)D=re[V=p&V+1],A=A*i+re[p&(re[V]=re[U=p&U+D])+(re[U]=D)];return k.i=V,k.j=U,A})(i)}function y(C,_){return _.i=C.i,_.j=C.j,_.S=C.S.slice(),_}function b(C,_){for(var S,k=C+"",R=0;R<k.length;)_[p&R]=p&(S^=19*_[p&R])+k.charCodeAt(R++);return w(_)}function w(C){return String.fromCharCode.apply(0,C)}if(e["seed"+u]=v,b(e.random(),t),n.exports){n.exports=v;try{r=require("crypto")}catch{}}})([],Math)});Ho.alea=eC,Ho.xor128=tC,Ho.xorwow=nC,Ho.xorshift7=rC,Ho.xor4096=oC,Ho.tychei=iC;var Tl=Ho.alea,ch=function(){function n(t,e,r,o,i){this.mean=t,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=i||Math.random();this.random=Tl(s.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,r,o=!1;!o;){var i=void 0,s=void 0,u=void 0;do u=(i=2*this.random()-1)*i+(s=2*this.random()-1)*s;while(u>=1||u===0);var c=Math.sqrt(-2*Math.log(u)/u);e=this.mean+this.stdDev*i*c,r=this.mean+this.stdDev*s*c,this.truncated&&!this.isValidTruncated(e)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(e)},n.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},n.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},n}(),aC=function(){function n(t,e,r,o){this.alpha=t,this.beta=1/e,this.dtype=r;var i=o||Math.random();this.randu=Tl(i.toString()),this.randn=new ch(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var t,e,r,o,i,s;;){do o=this.randn.nextValue(),s=1+this.c*o;while(s<=0);if(s*=s*s,e=1-.331*(t=o*o)*t,r=.5*t+this.d*(1-s+Math.log(s)),(i=this.randu())<e||Math.log(i)<r)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)},n.prototype.convertValue=function(t){return this.dtype==="float32"?t:Math.round(t)},n}(),sC=function(){function n(t,e,r,o){var i=this;if(t===void 0&&(t=0),e===void 0&&(e=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=t,this.range=e-t,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=Tl(o)}return n.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function Be(n,t,e){return t===void 0&&(t="float32"),t=t||"float32",jy(n),new ts(n,t,e)}function uC(n,t){t===void 0&&(t=!1),console.log(n.toString(t))}var Qy=B({batchToSpaceND_:function(n,t,e){var r=T(n,"x","batchToSpaceND"),o=t.reduce(function(i,s){return i*s});return O(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),O(e.length===t.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+t.length}),O(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),j.runKernelFunc(function(i){return i.batchToSpaceND(r,t,e)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(t,e)}}})}}),lC=B({broadcastTo_:function(n,t){var e=T(n,"broadcastTo","x"),r=e.shape;if(t.some(function(c){return!(c>0)||c%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<e.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+e.rank+".");if(t.length>e.rank){for(var o=e.shape.slice();o.length<t.length;)o.unshift(1);e=e.reshape(o)}for(var i=Array.from(t),s=t.length-1;s>=0;s--)if(e.shape[s]===t[s])i[s]=1;else if(e.shape[s]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var u=i.map(function(c,f){return c>1?f:-1}).filter(function(c){return c>=0});return u.length===0?e.clone():j.runKernelFunc(function(c){return c.tile(e,i)},{input:e},function(c){return{input:function(){return c.sum(u,!0)}}})}}),cC=B({cast_:function(n,t){var e=T(n,"x","cast");if(!nb(t))throw new Error("Failed to cast to unknown dtype "+t);if(t==="string"&&e.dtype!=="string"||t!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:t};return j.runKernelFunc(function(o){return o.cast(e,t)},{x:e},function(o){return{x:function(){return o.clone()}}},"Cast",r)}}),fC=B({clone_:function(n){var t=T(n,"x","clone",null);return j.runKernelFunc(function(){return j.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),dC=B({cumsum_:function(n,t,e,r){t===void 0&&(t=0),e===void 0&&(e=!1),r===void 0&&(r=!1);var o=T(n,"x","cumsum"),i=_r([t|=0],o.rank),s=o;i!=null&&(s=o.transpose(i));var u=Sr(1,o.rank)[0],c=j.runKernelFunc(function(f){return f.cumsum(s,u,e,r)},{permutedX:s},function(f){return{permutedX:function(){return f.cumsum(t,e,!r)}}});return i!=null&&(c=c.transpose(i)),c}}),hC=B({depthToSpace_:function(n,t,e){e===void 0&&(e="NHWC");var r=T(n,"x","depthToSpace"),o=e==="NHWC"?r.shape[1]:r.shape[2],i=e==="NHWC"?r.shape[2]:r.shape[3],s=e==="NHWC"?r.shape[3]:r.shape[1];return O(o*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+t+`  for depthToSpace with input shape
      `+r.shape}),O(i*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+t+` for depthToSpace with input shape
          `+r.shape}),O(s%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+s+" for depthToSpace with input shape "+r.shape}),j.runKernelFunc(function(u){return u.depthToSpace(r,t,e)},{$x:r})}}),Un=B({expandDims_:function(n,t){t===void 0&&(t=0);var e=T(n,"x","expandDims",null);O(t<=e.rank,function(){return"Axis must be <= rank of the tensor"});var r=e.shape.slice();return t<0&&(O(-(e.rank+1)<=t,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),t=e.rank+t+1),r.splice(t,0,1),er(e,r)}}),Jy=B({eye_:function(n,t,e,r){r===void 0&&(r="float32"),t==null&&(t=n);for(var o=Be([n,t],r),i=n<=t?n:t,s=0;s<i;++s)o.set(1,s,s);var u=o.toTensor().as2D(n,t);if(e==null)return u;if(e.length===1)return Hi(Un(u,0),[e[0],1,1]);if(e.length===2)return Hi(Un(Un(u,0),0),[e[0],e[1],1,1]);if(e.length===3)return Hi(Un(Un(Un(u,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),pC=B({multinomial_:function(n,t,e,r){r===void 0&&(r=!1);var o=T(n,"logits","multinomial"),i=o.size,s=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);e=e||Math.random();var u=s===1?o.as2D(1,-1):o,c=j.runKernelFunc(function(f){return f.multinomial(u,r,t,e)},{logits2D:u});return s===1?c.as1D():c}}),Md=B({oneHot_:function(n,t,e,r){if(e===void 0&&(e=1),r===void 0&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=T(n,"indices","oneHot","int32"),i=o.shape.concat([t]);return o=o.flatten(),j.runKernelFunc(function(s){return s.oneHot(o,t,e,r)},{$indices:o},function(s){return{$indices:function(){return st(o.shape,"float32")}}}).reshape(i)}}),ni=B({pad_:function(n,t,e){e===void 0&&(e=0);var r=T(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:e};return j.runKernelFunc(function(i){return i.pad(r,t,e)},{x:r},function(i){var s=t.map(function(u){return u[0]});return{x:function(){return i.slice(s,r.shape)}}},"PadV2",o)}}),vC=B({pad1d_:function(n,t,e){return e===void 0&&(e=0),O(t.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),ni(n,[t],e)}}),mC=B({pad2d_:function(n,t,e){return e===void 0&&(e=0),O(t.length===2&&t[0].length===2&&t[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ni(n,t,e)}}),gC=B({pad3d_:function(n,t,e){return e===void 0&&(e=0),O(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ni(n,t,e)}}),yC=B({pad4d_:function(n,t,e){return e===void 0&&(e=0),O(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ni(n,t,e)}}),xC=B({rand_:function(n,t,e){var r=Re(n),o=null;if(e==null||e==="float32")o=new Float32Array(r);else if(e==="int32")o=new Int32Array(r);else{if(e!=="bool")throw new Error("Unknown data type "+e);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=t();return j.makeTensor(o,n,e)}}),wC=B({randomNormal_:function(n,t,e,r,o){if(t===void 0&&(t=0),e===void 0&&(e=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new ch(t,e,r,!1,o),s=Be(n,r),u=0;u<s.values.length;u++)s.values[u]=i.nextValue();return s.toTensor()}}),bC=B({randomGamma_:function(n,t,e,r,o){if(e===void 0&&(e=1),r===void 0&&(r="float32"),e==null&&(e=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var i=new aC(t,e,r,o),s=Be(n,r),u=0;u<s.values.length;u++)s.values[u]=i.nextValue();return s.toTensor()}}),Zy=B({randomUniform_:function(n,t,e,r,o){t===void 0&&(t=0),e===void 0&&(e=1),r===void 0&&(r="float32");for(var i=Be(n,r),s=new sC(t,e,null,o),u=0;u<i.values.length;u++)i.values[u]=s.nextValue();return i.toTensor()}}),er=B({reshape_:function(n,t){var e=T(n,"x","reshape",null);t=eb(t,e.size),O(e.size===Re(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return j.runKernelFunc(function(o){return o.reshape(e,t)},{x:e},function(o){return{x:function(){return o.reshape(e.shape)}}},"Reshape",r)}}),e0=B({spaceToBatchND_:function(n,t,e){var r=T(n,"x","spaceToBatchND");return O(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),O(e.length===t.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+t.length}),O(r.shape.reduce(function(o,i,s){return s>0&&s<=t.length?o&&(i+e[s-1][0]+e[s-1][1])%t[s-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+t.toString()}),j.runKernelFunc(function(o){return o.spaceToBatchND(r,t,e)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(t,e)}}})}}),t0=B({squeeze_:function(n,t){var e=T(n,"x","squeeze");return er(e,Go(e.shape,t).newShape)}}),Tn=B({stack_:function(n,t){t===void 0&&(t=0);var e=sl(n,"tensors","stack");if(O(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),e.length===1)return e[0].expandDims(t);var r=e[0].rank,o=e[0].shape,i=e[0].dtype;O(t<=r,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(u){Je(o,u.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(u){O(i===u.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=e.map(function(u){return u.expandDims(t)});return kt(s,t)}}),Hi=B({tile_:function(n,t){var e=T(n,"x","tile",null);O(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+t+"."});var r=[e],o={reps:t};return j.runKernelFunc(function(i,s){var u=i.tile(e,t);return s([e]),u},{x:e},function(i,s){var u=s[0];return{x:function(){var c=Ke(u);if(u.rank===1)for(var f=0;f<t[0];++f)c=c.add(i.slice([f*u.shape[0]],[u.shape[0]]));else if(u.rank===2)for(f=0;f<t[0];++f)for(var d=0;d<t[1];++d)c=c.add(i.slice([f*u.shape[0],d*u.shape[1]],[u.shape[0],u.shape[1]]));else if(u.rank===3)for(f=0;f<t[0];++f)for(d=0;d<t[1];++d)for(var p=0;p<t[2];++p)c=c.add(i.slice([f*u.shape[0],d*u.shape[1],p*u.shape[2]],[u.shape[0],u.shape[1],u.shape[2]]));else{if(u.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+u.rank+" tensors yet.");for(f=0;f<t[0];++f)for(d=0;d<t[1];++d)for(p=0;p<t[2];++p)for(var v=0;v<t[3];++v)c=c.add(i.slice([f*u.shape[0],d*u.shape[1],p*u.shape[2],v*u.shape[3]],[u.shape[0],u.shape[1],u.shape[2],u.shape[3]]))}return c}}},"Tile",o,r)}}),CC=B({truncatedNormal_:function(n,t,e,r,o){if(t===void 0&&(t=0),e===void 0&&(e=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new ch(t,e,r,!0,o),s=Be(n,r),u=0;u<s.values.length;u++)s.values[u]=i.nextValue();return s.toTensor()}}),Rt=B({unstack_:function(n,t){t===void 0&&(t=0),t=t||0;var e=T(n,"x","unstack");O(t>=-e.shape.length&&t<e.shape.length,function(){return"Axis = "+t+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),t<0&&(t+=e.shape.length);var r={axis:t};return j.runKernelFunc(function(o){return o.unstack(e,t)},{x:e},function(o){return{x:function(){return Tn(o,t)}}},"Unpack",r)}}),EC=function(n,t){return Ee(this,void 0,void 0,function(){var e,r,o,i,s,u,c,f,d,p;return _e(this,function(v){switch(v.label){case 0:return e=T(n,"x","setdiff1d"),r=T(t,"y","setdiff1d"),O(e.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+r.dtype+")."}),O(e.rank===1,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),O(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,e.data()];case 1:return o=v.sent(),[4,r.data()];case 2:for(i=v.sent(),s=new Set(i),u=0,d=0;d<o.length;d++)s.has(o[d])||u++;for(c=new ts([u],e.dtype),f=new ts([u],"int32"),d=0,p=0;d<o.length;d++)s.has(o[d])||(c.values[p]=o[d],f.values[p]=d,p++);return[2,[c.toTensor(),f.toTensor()]]}})})};function ll(n,t,e,r){r===void 0&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(n[0]/e),o=o.concat(n.slice(1));else{o=o.concat(n[0]);for(var i=t.length,s=0;s<i;++s)o=o.concat([n[s+1]/t[s],t[s]]);o=o.concat(n.slice(i+1))}return o}function cl(n,t,e){e===void 0&&(e=!0);var r=[];if(e){r.push(t);for(var o=t+1;o<n;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var i=[],s=[];for(o=1;o<n;++o)o>=2*t+1||o%2==1?s.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,s)}return r}function fl(n,t,e,r){r===void 0&&(r=!0);var o=[];r?o.push(n[0]/e):o.push(n[0]*e);for(var i=1;i<n.length;++i)i<=t.length?r?o.push(t[i-1]*n[i]):o.push(n[i]/t[i-1]):o.push(n[i]);return o}function n0(n,t){for(var e=[0],r=0;r<t;++r)e.push(n[r][0]);return e}function r0(n,t,e){for(var r=n.slice(0,1),o=0;o<e;++o)r.push(n[o+1]-t[o][0]-t[o][1]);return r}function o0(n,t){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var e=t.shape,r=e[e.length-1],o=1,i=0;i<e.length-1;++i)o*=e[i];var s=n.shape,u=e.slice();u.pop();var c=1;for(i=r;i<n.rank;++i)c*=s[i],u.push(s[i]);var f=xr(n.shape).map(function(d){return d/c}).concat([1]).slice(0,r);return[u,o,c,f]}var i0=30;function rd(n){return n<=i0?n:Td(n,Math.floor(Math.sqrt(n)))}function _C(n,t,e){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+t.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+o+".";if(e.rank<o)throw new Error(i+" update.rank < "+o+". ");if(n.length<r+(e.rank-o))throw new Error(i+" Output shape length < "+(r+(e.rank-o)));if(e.rank!==o+n.length-r)throw new Error(i+" update.rank != "+(o+n.length-r));for(var s=0;s<o;++s)if(e.shape[s]!==t.shape[s])throw new Error(i+" updates.shape["+s+"] ("+e.shape[s]+") != indices.shape["+s+"] ("+t.shape[s]+").");for(s=0;s<e.rank-o;++s)if(e.shape[s+o]!==n[s+r])throw new Error(i+" updates.shape["+(s+o)+"] ("+e.shape[s+o]+") != shape["+(s+o)+"] ("+n[s+o]+")")}function SC(n,t,e){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(e.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}_C(e,t,n)}function dl(n,t,e){for(var r=t.shape.length,o=r>1?t.shape[r-1]:1,i=e.length,s=1,u=o;u<i;++u)s*=e[u];var c=o<1?1:o;return{sliceRank:o,numUpdates:Re(t.shape)/c,sliceSize:s,strides:xr(e.slice(0,o)).concat([1]),outputSize:Re(e)}}function kC(n,t,e){O(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+t+" must match the rank of the array ("+n.rank+")."}),O(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of size "+e+" must match the rank of the array ("+n.rank+")."});for(var r=function(i){O(t[i]+e[i]<=n.shape[i],function(){return"Error in slice"+n.rank+"D: begin["+i+"] + size["+i+"] ("+(t[i]+e[i])+") would overflow input.shape["+i+"] ("+n.shape[i]+")"})},o=0;o<n.rank;++o)r(o)}function wg(n){for(var t=[],e=0;n>0;)1&n&&t.push(e),n/=2,e++;return t}function fh(n,t,e){for(var r=[],o=0;o<n.length;o++)r[o]=Math.ceil((t[o]-n[o])/e[o]);return r}function RC(n,t,e,r,o){var i=t[o],s=e[o]||1;(n&1<<o||i==null)&&(i=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[o];return i<0&&(i+=u),i=Rd(0,i,u-1)}function IC(n,t,e,r,o){var i=t[o],s=e[o]||1;(n&1<<o||i==null)&&(i=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[o];return i<0&&(i+=u),i=s>0?Rd(0,i,u):Rd(-1,i,u-1)}function a0(n,t,e){for(var r=e.length,o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(o=r+1;o<e.length;o++)if(t[o]>0||e[o]!==n[o])return!1;return!0}function s0(n,t){for(var e=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)e+=n[r]*t[r];return e}function NC(n,t){O(Nd(n),function(){return"The f passed in variableGrads(f) must be a function"}),O(t==null||Array.isArray(t)&&t.every(function(d){return d instanceof Ji}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=t!=null;if(!e)for(var r in t=[],j.registeredVariables)t.push(j.registeredVariables[r]);var o=e?t.filter(function(d){return!d.trainable}):null,i=t.length;O((t=t.filter(function(d){return d.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var s=j.gradients(n,t,null,!0),u=s.value,c=s.grads;O(c.some(function(d){return d!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),O(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+u.rank+" tensor"});var f={};return t.forEach(function(d,p){c[p]!=null&&(f[d.name]=c[p])}),o?.forEach(function(d){return f[d.name]=null}),{value:u,grads:f}}function Dl(n){return j.customGrad(n)}var jr=B({softmax_:function(n,t){t===void 0&&(t=-1);var e=T(n,"logits","softmax","float32");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+t);return j.runKernelFunc(function(r,o){var i=r.softmax(e,t);return o([i]),i},{logits:e},function(r,o){var i=o[0],s=r.mul(i);return{logits:function(){return s.sub(s.sum([t],!0).mul(i))}}},"Softmax",{dim:t},[],[!0])}}),TC=B({logSoftmax_:function(n,t){t===void 0&&(t=-1);var e=T(n,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+t);return Dl(function(r,o){var i=r.max(t,!0),s=r.sub(i),u=s.toFloat().sub(s.exp().sum(t,!0).log());return o([u]),{value:u,gradFunc:function(c,f){var d=f[0].exp();return c.sub(c.sum(t,!0).mul(d))}}})(e)}}),u0=function(){function n(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},n.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},n.prototype.has=function(t){return this.data.has(t)},n.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),l0=function(){function n(){}return n.prototype.time=function(t){return J("time")},n.prototype.read=function(t){return J("read")},n.prototype.readSync=function(t){return J("readSync")},n.prototype.numDataIds=function(){return J("numDataIds")},n.prototype.disposeData=function(t){return J("disposeData")},n.prototype.write=function(t,e,r){return J("write")},n.prototype.move=function(t,e,r,o){return J("move")},n.prototype.memory=function(){return J("memory")},n.prototype.floatPrecision=function(){return J("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(t,e,r,o){return J("batchMatMul")},n.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,J("fusedBatchMatMul")},n.prototype.slice=function(t,e,r){return J("slice")},n.prototype.stridedSlice=function(t,e,r,o){return J("stridedSlice")},n.prototype.unstack=function(t,e){return J("unstack")},n.prototype.reverse=function(t,e){return J("reverse")},n.prototype.concat=function(t,e){return J("concat")},n.prototype.neg=function(t){return J("neg")},n.prototype.add=function(t,e){return J("add")},n.prototype.addN=function(t){return J("addN")},n.prototype.subtract=function(t,e){return J("subtract")},n.prototype.multiply=function(t,e){return J("multiply")},n.prototype.realDivide=function(t,e){return J("realDivide")},n.prototype.floorDiv=function(t,e){return J("floorDiv")},n.prototype.sum=function(t,e){return J("sum")},n.prototype.prod=function(t,e){return J("prod")},n.prototype.unsortedSegmentSum=function(t,e,r){return J("unsortedSegmentSum")},n.prototype.argMin=function(t,e){return J("argMin")},n.prototype.argMax=function(t,e){return J("argMax")},n.prototype.equal=function(t,e){return J("equal")},n.prototype.notEqual=function(t,e){return J("notEqual")},n.prototype.less=function(t,e){return J("less")},n.prototype.lessEqual=function(t,e){return J("lessEqual")},n.prototype.greater=function(t,e){return J("greater")},n.prototype.greaterEqual=function(t,e){return J("greaterEqual")},n.prototype.logicalNot=function(t){return J("logicalNot")},n.prototype.logicalAnd=function(t,e){return J("logicalAnd")},n.prototype.logicalOr=function(t,e){return J("logicalOr")},n.prototype.where=function(t){return J("where")},n.prototype.select=function(t,e,r){return J("select")},n.prototype.topk=function(t,e,r){return J("topk")},n.prototype.min=function(t,e){return J("min")},n.prototype.minimum=function(t,e){return J("minimum")},n.prototype.mod=function(t,e){return J("mod")},n.prototype.max=function(t,e){return J("max")},n.prototype.maximum=function(t,e){return J("maximum")},n.prototype.all=function(t,e){return J("all")},n.prototype.any=function(t,e){return J("any")},n.prototype.squaredDifference=function(t,e){return J("squaredDifference")},n.prototype.ceil=function(t){return J("ceil")},n.prototype.floor=function(t){return J("floor")},n.prototype.round=function(t){return J("round")},n.prototype.sign=function(t){return J("sign")},n.prototype.isNaN=function(t){return J("isNaN")},n.prototype.isInf=function(t){return J("isInf")},n.prototype.isFinite=function(t){return J("isFinite")},n.prototype.pow=function(t,e){return J("pow")},n.prototype.exp=function(t){return J("exp")},n.prototype.expm1=function(t){return J("expm1")},n.prototype.softmax=function(t,e){return J("softmax")},n.prototype.log=function(t){return J("log")},n.prototype.log1p=function(t){return J("log1p")},n.prototype.sqrt=function(t){return J("sqrt")},n.prototype.rsqrt=function(t){return J("rsqrt")},n.prototype.square=function(t){return J("square")},n.prototype.reciprocal=function(t){return J("reciprocal")},n.prototype.relu=function(t){return J("relu")},n.prototype.relu6=function(t){return J("relu6")},n.prototype.prelu=function(t,e){return J("prelu")},n.prototype.elu=function(t){return J("elu")},n.prototype.eluDer=function(t,e){return J("eluDer")},n.prototype.selu=function(t){return J("selu")},n.prototype.int=function(t){return J("int")},n.prototype.clip=function(t,e,r){return J("clip")},n.prototype.abs=function(t){return J("abs")},n.prototype.complexAbs=function(t){return J("complexAbs")},n.prototype.sigmoid=function(t){return J("sigmoid")},n.prototype.softplus=function(t){return J("softplus")},n.prototype.sin=function(t){return J("sin")},n.prototype.cos=function(t){return J("cos")},n.prototype.tan=function(t){return J("tan")},n.prototype.asin=function(t){return J("asin")},n.prototype.acos=function(t){return J("acos")},n.prototype.atan=function(t){return J("atan")},n.prototype.atan2=function(t,e){return J("atan2")},n.prototype.sinh=function(t){return J("sinh")},n.prototype.cosh=function(t){return J("cosh")},n.prototype.tanh=function(t){return J("tanh")},n.prototype.asinh=function(t){return J("asinh")},n.prototype.acosh=function(t){return J("acosh")},n.prototype.atanh=function(t){return J("atanh")},n.prototype.erf=function(t){return J("erf")},n.prototype.step=function(t,e){return J("step")},n.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,J("fusedConv2d")},n.prototype.conv2d=function(t,e,r){return J("conv2d")},n.prototype.conv2dDerInput=function(t,e,r){return J("conv2dDerInput")},n.prototype.conv2dDerFilter=function(t,e,r){return J("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,J("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(t,e,r){return J("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(t,e,r){return J("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(t,e,r){return J("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(t,e,r){return J("conv3d")},n.prototype.conv3dDerInput=function(t,e,r){return J("conv3dDerInput")},n.prototype.conv3dDerFilter=function(t,e,r){return J("conv3dDerFilter")},n.prototype.maxPool=function(t,e){return J("maxPool")},n.prototype.maxPoolBackprop=function(t,e,r,o){return J("maxPoolBackprop")},n.prototype.avgPool=function(t,e){return J("avgPool")},n.prototype.avgPoolBackprop=function(t,e,r){return J("avgPoolBackprop")},n.prototype.avgPool3d=function(t,e){return J("avgPool3d")},n.prototype.avgPool3dBackprop=function(t,e,r){return J("avgPool3dBackprop")},n.prototype.maxPool3d=function(t,e){return J("maxPool3d")},n.prototype.maxPool3dBackprop=function(t,e,r,o){return J("maxPool3dBackprop")},n.prototype.reshape=function(t,e){return J("reshape")},n.prototype.cast=function(t,e){return J("cast")},n.prototype.tile=function(t,e){return J("tile")},n.prototype.pad=function(t,e,r){return J("pad")},n.prototype.transpose=function(t,e){return J("transpose")},n.prototype.gather=function(t,e,r){return J("gather")},n.prototype.gatherND=function(t,e){return J("gatherND")},n.prototype.scatterND=function(t,e,r){return J("scatterND")},n.prototype.batchToSpaceND=function(t,e,r){return J("batchToSpaceND")},n.prototype.spaceToBatchND=function(t,e,r){return J("spaceToBatchND")},n.prototype.resizeBilinear=function(t,e,r,o){return J("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(t,e,r){return J("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(t,e,r,o){return J("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(t,e,r){return J("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(t,e,r,o,i,s){return J("batchNormalization")},n.prototype.localResponseNormalization4D=function(t,e,r,o,i){return J("localResponseNormalization4D")},n.prototype.LRNGrad=function(t,e,r,o,i,s,u){return J("LRNGrad")},n.prototype.multinomial=function(t,e,r,o){return J("multinomial")},n.prototype.oneHot=function(t,e,r,o){return J("oneHot")},n.prototype.cumsum=function(t,e,r,o){return J("cumsum")},n.prototype.nonMaxSuppression=function(t,e,r,o,i){return J("nonMaxSuppression")},n.prototype.fft=function(t){return J("fft")},n.prototype.ifft=function(t){return J("ifft")},n.prototype.complex=function(t,e){return J("complex")},n.prototype.real=function(t){return J("real")},n.prototype.imag=function(t){return J("imag")},n.prototype.cropAndResize=function(t,e,r,o,i,s){return J("cropAndResize")},n.prototype.depthToSpace=function(t,e,r){return J("depthToSpace")},n.prototype.split=function(t,e,r){return J("split")},n.prototype.sparseToDense=function(t,e,r,o){return J("sparseToDense")},n.prototype.diag=function(t){return J("diag")},n.prototype.fill=function(t,e,r){return J("fill")},n.prototype.onesLike=function(t){return J("onesLike")},n.prototype.zerosLike=function(t){return J("zerosLike")},n.prototype.linspace=function(t,e,r){return J("linspace")},n.prototype.dispose=function(){return J("dispose")},n}();function J(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function go(n,t){for(var e=n.length,r=[],o=0;o<e;o++){var i=e-1-o,s=n[i]||1;(t[t.length-1-o]||1)>1&&s===1&&r.unshift(i)}return r}function It(n,t){for(var e=[],r=0;r<t.length;r++){var o=n[n.length-r-1],i=t.length-r-1,s=t[i];(o==null||o===1&&s>1)&&e.unshift(i)}return e}function He(n,t){for(var e=[],r=Math.max(n.length,t.length),o=0;o<r;o++){var i=n[n.length-o-1];i==null&&(i=1);var s=t[t.length-o-1];if(s==null&&(s=1),i===1)e.unshift(s);else if(s===1)e.unshift(i);else{if(i!==s)throw Error("Operands could not be broadcast together with shapes "+n+" and "+t+".");e.unshift(i)}}return e}function rs(n,t,e,r,o,i,s){s===void 0&&(s="channelsLast");var u,c=vl(t),f=c[0],d=c[1];if(s==="channelsLast")u=[f,d,n[3],n[3]];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);u=[f,d,n[1],n[1]]}return ri(n,u,e,r,o,i,!1,s)}function hl(n,t,e,r,o,i,s){s===void 0&&(s="NDHWC");var u,c,f=Ld(t),d=f[0],p=f[1],v=f[2];if(s==="NDHWC")c="channelsLast",u=[d,p,v,n[4],n[4]];else{if(s!=="NCDHW")throw new Error("Unknown dataFormat "+s);c="channelsFirst",u=[d,p,v,n[1],n[1]]}return pl(n,u,e,r,o,!1,c,i)}function ri(n,t,e,r,o,i,s,u){s===void 0&&(s=!1),u===void 0&&(u="channelsLast");var c=[-1,-1,-1,-1],f=c[0],d=c[1],p=c[2],v=c[3];if(u==="channelsLast")f=n[0],d=n[1],p=n[2],v=n[3];else{if(u!=="channelsFirst")throw new Error("Unknown dataFormat "+u);f=n[0],v=n[1],d=n[2],p=n[3]}var g,y=t[0],b=t[1],w=t[3],C=vl(e),_=C[0],S=C[1],k=vl(r),R=k[0],N=k[1],P=Gi(y,R),F=Gi(b,N),D=function(te,ee,G,q,W,Y,K,L){var X,de,pe;if(typeof te=="number"){X={top:te,bottom:te,left:te,right:te,type:te===0?"VALID":"NUMBER"};var me=function(Ue,Ye,Ge,et,tt){et==null&&(et=c0(Ue,Ye,Ge));var nt=Ue[0],on=Ue[1],wn=Ja((nt-Ye+2*et)/Ge+1,tt);O(xt(wn),function(){return"The output # of rows ("+wn+") must be an integer. Change the stride and/or zero pad parameters"});var Lt=Ja((on-Ye+2*et)/Ge+1,tt);return O(xt(Lt),function(){return"The output # of columns ("+Lt+") must be an integer. Change the stride and/or zero pad parameters"}),[wn,Lt]}([ee,G],Y,q,te,L);de=me[0],pe=me[1]}else if(te==="same"){de=Math.ceil(ee/q),pe=Math.ceil(G/W);var ge=Math.max(0,(de-1)*q+Y-ee),ke=Math.max(0,(pe-1)*W+K-G),be=Math.floor(ge/2),Ae=ge-be,qe=Math.floor(ke/2);X={top:be,bottom:Ae,left:qe,right:ke-qe,type:"SAME"}}else{if(te!=="valid")throw Error("Unknown padding parameter: "+te);X={top:0,bottom:0,left:0,right:0,type:"VALID"},de=Math.ceil((ee-Y+1)/q),pe=Math.ceil((G-K+1)/W)}return{padInfo:X,outHeight:de,outWidth:pe}}(o,d,p,_,S,P,F,i),A=D.padInfo,V=D.outHeight,U=D.outWidth,re=s?w*v:w;return u==="channelsFirst"?g=[f,re,V,U]:u==="channelsLast"&&(g=[f,V,U,re]),{batchSize:f,dataFormat:u,inHeight:d,inWidth:p,inChannels:v,outHeight:V,outWidth:U,outChannels:re,padInfo:A,strideHeight:_,strideWidth:S,filterHeight:y,filterWidth:b,effectiveFilterHeight:P,effectiveFilterWidth:F,dilationHeight:R,dilationWidth:N,inShape:n,outShape:g,filterShape:t}}function pl(n,t,e,r,o,i,s,u){i===void 0&&(i=!1),s===void 0&&(s="channelsLast");var c=[-1,-1,-1,-1,-1],f=c[0],d=c[1],p=c[2],v=c[3],g=c[4];if(s==="channelsLast")f=n[0],d=n[1],p=n[2],v=n[3],g=n[4];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);f=n[0],g=n[1],d=n[2],p=n[3],v=n[4]}var y,b=t[0],w=t[1],C=t[2],_=t[4],S=Ld(e),k=S[0],R=S[1],N=S[2],P=Ld(r),F=P[0],D=P[1],A=P[2],V=Gi(b,F),U=Gi(w,D),re=Gi(C,A),te=function(K,L,X,de,pe,me,ge,ke,be,Ae,qe){var Ue,Ye,Ge,et;if(typeof K=="number"){Ue={top:K,bottom:K,left:K,right:K,front:K,back:K,type:K===0?"VALID":"NUMBER"};var tt=function(Ir,Fn,si,ir,tn,ui){tn==null&&(tn=c0(Ir,Fn,ir));var Ro=Ir[0],Io=Ir[1],Zl=Ir[2],li=Ja((Ro-Fn+2*tn)/ir+1,ui);O(xt(li),function(){return"The output # of depths ("+li+") must be an integer. Change the stride and/or zero pad parameters"});var ci=Ja((Io-Fn+2*tn)/ir+1,ui);O(xt(ci),function(){return"The output # of rows ("+ci+") must be an integer. Change the stride and/or zero pad parameters"});var sa=Ja((Zl-Fn+2*tn)/ir+1,ui);return O(xt(sa),function(){return"The output # of columns ("+sa+") must be an integer. Change the stride and/or zero pad parameters"}),[li,ci,sa,si]}([L,X,de,1],ke,1,pe,K,qe);Ye=tt[0],Ge=tt[1],et=tt[2]}else if(K==="same"){Ye=Math.ceil(L/pe),Ge=Math.ceil(X/me),et=Math.ceil(de/ge);var nt=(Ye-1)*pe+ke-L,on=(Ge-1)*me+be-X,wn=(et-1)*ge+Ae-de,Lt=Math.floor(nt/2),Dn=nt-Lt,jt=Math.floor(on/2),An=on-jt,Pn=Math.floor(wn/2);Ue={top:jt,bottom:An,left:Pn,right:wn-Pn,front:Lt,back:Dn,type:"SAME"}}else{if(K!=="valid")throw Error("Unknown padding parameter: "+K);Ue={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ye=Math.ceil((L-ke+1)/pe),Ge=Math.ceil((X-be+1)/me),et=Math.ceil((de-Ae+1)/ge)}return{padInfo:Ue,outDepth:Ye,outHeight:Ge,outWidth:et}}(o,d,p,v,k,R,N,V,U,re,u),ee=te.padInfo,G=te.outDepth,q=te.outHeight,W=te.outWidth,Y=i?_*g:_;return s==="channelsFirst"?y=[f,Y,G,q,W]:s==="channelsLast"&&(y=[f,G,q,W,Y]),{batchSize:f,dataFormat:s,inDepth:d,inHeight:p,inWidth:v,inChannels:g,outDepth:G,outHeight:q,outWidth:W,outChannels:Y,padInfo:ee,strideDepth:k,strideHeight:R,strideWidth:N,filterDepth:b,filterHeight:w,filterWidth:C,effectiveFilterDepth:V,effectiveFilterHeight:U,effectiveFilterWidth:re,dilationDepth:F,dilationHeight:D,dilationWidth:A,inShape:n,outShape:y,filterShape:t}}function c0(n,t,e,r){r===void 0&&(r=1);var o=Gi(t,r);return Math.floor((n[0]*(e-1)-e+o)/2)}function vl(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function Ld(n){return typeof n=="number"?[n,n,n]:n}function Gi(n,t){return t<=1?n:n+(n-1)*(t-1)}function Ja(n,t){if(!t)return n;switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+t)}}function ea(n){var t=vl(n),e=t[0],r=t[1],o=t[2];return e===1&&r===1&&o===1}function xn(n,t){return ea(n)||ea(t)}function dh(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function f0(n,t,e){if(t==="complex64"){if(n.dtype==="complex64")return n.clone();var r=st(n.shape),o=n.toFloat(),i=e.complex(o,r);return r.dispose(),o.dispose(),i}if(!rb(n.dtype,t))return j.makeTensorFromDataId(n.dataId,n.shape,t);if(n.dtype==="complex64"){var s=e.real(n);return i=s.cast(t),s.dispose(),i}if(t==="int32")return e.int(n);if(t==="bool"){var u=ve(0,n.dtype);return i=e.notEqual(n,u),u.dispose(),i}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+t)}function Bd(n,t){return j.makeTensorFromDataId(n.dataId,t,n.dtype)}function d0(n,t,e){var r=(t-n)/(e-1),o=cs(e,"float32");o[0]=n;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return Ct(o,"float32")}function Wd(n,t){if(n.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+t.length+".");for(var e=new Float32Array(2*n.length),r=0;r<e.length;r+=2)e[r]=n[r/2],e[r+1]=t[r/2];return e}function bg(n,t){return{real:n[2*t],imag:n[2*t+1]}}function DC(n,t,e,r){n[2*r]=t,n[2*r+1]=e}function AC(n,t,e){var r=(e?2:-2)*Math.PI*(n/t);return{real:Math.cos(r),imag:Math.sin(r)}}function PC(n,t,e){var r=function(i,s,u){return function(c,f,d){for(var p=0,v=c.length,g=0,y=!1;p<v;){var b=d(f,c[g=p+(v-p>>>1)]);b>0?p=g+1:(v=g,y=!b)}return y?p:-p-1}(i,s,u||FC)}(n,t,e),o=r<0?-(r+1):r;n.splice(o,0,t)}function FC(n,t){return n>t?1:n<t?-1:0}function hh(n,t,e,r,o){return h0(n,t,e,r,o,0).selectedIndices}function ph(n,t,e,r,o,i){var s=h0(n,t,e,r,o,i);return s.numValidOutputs.dispose(),{selectedIndices:s.selectedIndices,selectedScores:s.selectedScores}}function h0(n,t,e,r,o,i,s,u){u===void 0&&(u=!1);for(var c=Array.from(t).map(function(k,R){return{score:k,boxIndex:R,suppressBeginIndex:0}}).filter(function(k){return k.score>o}).sort(Cg),f=i>0?-.5/i:0,d=[],p=[];d.length<e&&c.length>0;){var v=c.pop(),g=v.score,y=v.boxIndex,b=v.suppressBeginIndex;if(g<o)break;for(var w=!1,C=d.length-1;C>=b;--C){var _=OC(n,y,d[C]);if(_>=r){w=!0;break}if(v.score=v.score*MC(r,f,_),v.score<=o)break}v.suppressBeginIndex=d.length,w||(v.score===g?(d.push(y),p.push(v.score)):v.score>o&&PC(c,v,Cg))}var S=d.length;return u&&(d.fill(0,S),p.fill(0,S)),{selectedIndices:Ct(d,"int32"),selectedScores:Ct(p,"float32"),numValidOutputs:ve(S,"int32")}}function OC(n,t,e){var r=n.subarray(4*t,4*t+4),o=n.subarray(4*e,4*e+4),i=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),u=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),f=Math.min(o[0],o[2]),d=Math.min(o[1],o[3]),p=Math.max(o[0],o[2]),v=Math.max(o[1],o[3]),g=(u-i)*(c-s),y=(p-f)*(v-d);if(g<=0||y<=0)return 0;var b=Math.max(i,f),w=Math.max(s,d),C=Math.min(u,p),_=Math.min(c,v),S=Math.max(C-b,0)*Math.max(_-w,0);return S/(g+y-S)}function MC(n,t,e){var r=Math.exp(t*e*e);return e<=n?r:0}function Cg(n,t){return n.score-t.score||n.score===t.score&&t.boxIndex-n.boxIndex}function p0(n,t,e){var r=new Array(n.rank).fill(0),o=n.shape.slice();return t.map(function(i){o[e]=i;var s=n.slice(r,o);return r[e]+=i,s})}function v0(n,t){for(var e=new Array(n.rank),r=0;r<e.length;r++)e[r]=n.shape[r]*t[r];var o=Be(e,n.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),s=new Array(n.rank),u=0;u<s.length;u++)s[u]=i[u]%n.shape[u];var c=n.locToIndex(s);o.values[r]=n.values[c]}return o.toTensor()}function m0(n,t,e,r,o){for(var i=t[t.length-1],s=[n.length/i,i],u=s[0],c=s[1],f=es(e,u*r),d=es("int32",u*r),p=0;p<u;p++){for(var v=p*c,g=n.subarray(v,v+c),y=[],b=0;b<g.length;b++)y.push({value:g[b],index:b});y.sort(function(k,R){return R.value-k.value});var w=p*r,C=f.subarray(w,w+r),_=d.subarray(w,w+r);for(b=0;b<r;b++)C[b]=y[b].value,_[b]=y[b].index}var S=t.slice();return S[S.length-1]=r,[Vt(f,S,e),Vt(d,S,"int32")]}function vh(n,t){for(var e=[],r=0;r<t.length;r++)t[r]&&e.push(r);var o=Be(n,"int32"),i=Be([e.length,n.length],"int32");for(r=0;r<e.length;r++){var s=o.indexToLoc(e[r]),u=r*n.length;i.values.set(s,u)}return i.toTensor()}var LC=function(n,t){this.outputShape=[],this.outputShape=n,this.variableNames=t.map(function(o,i){return"T"+i});var e=[];this.variableNames.forEach(function(o){e.push("float v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},BC=function(n,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=t.map(function(o,i){return"T"+i});var e=[];this.variableNames.forEach(function(o){e.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},WC=function(n,t,e){this.variableNames=["A"];var r=n.windowSize,o=n.batchSize,i=n.inSize,s=Math.ceil(i/r);e||this.variableNames.push("bestIndicesA"),this.outputShape=[o,s];var u=t==="max"?">":"<",c=e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+c+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+u+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function g0(n,t){return["x","y","z","w","u","v"].slice(0,t).map(function(e){return n+"."+e})}function hn(n,t){return t===1?[n]:g0(n,t)}function Yt(){var n,t,e,r,o,i,s,u,c,f;return ae().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",t="in",e="out",r="in",o="texture",i="outputColor",s="out vec4 outputColor;",u=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,c="",f=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",t="attribute",e="varying",r="varying",o="texture2D",i="gl_FragColor",s="",u=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,f=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:t,varyingVs:e,varyingFs:r,texture2D:o,output:i,defineOutput:s,defineSpecialNaN:u,defineSpecialInf:c,defineRound:f}}function qo(n,t,e){e===void 0&&(e="index");var r=xr(t);return r.map(function(o,i){return"int "+n[i]+" = "+e+" / "+o+"; "+(i===r.length-1?"int "+n[i+1]+" = "+e+" - "+n[i]+" * "+o:"index -= "+n[i]+" * "+o)+";"}).join("")}function mh(n){var t=xr(n).map(function(e){return e.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+t[0]+" + coords.y * "+t[1]+` + coords.z;
  }
`}var y0=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function zC(n,t,e,r){var o=[];n.forEach(function(g){var y=Re(g.shapeInfo.logicalShape);g.shapeInfo.isUniform?o.push("uniform float "+g.name+(y>1?"["+y+"]":"")+";"):(o.push("uniform sampler2D "+g.name+";"),o.push("uniform int offset"+g.name+";"))});var i,s,u=o.join(`
`),c=n.map(function(g){return function(y,b,w){w===void 0&&(w=!1);var C="";C+=w?x0(y):Wi(y);var _=y.shapeInfo.logicalShape,S=b.logicalShape;return _.length<=S.length&&(C+=w?function(k,R){var N,P=k.name,F=P.charAt(0).toUpperCase()+P.slice(1),D="get"+F+"AtOutCoords",A=k.shapeInfo.logicalShape.length,V=R.logicalShape.length,U=go(k.shapeInfo.logicalShape,R.logicalShape),re=ot(V),te=V-A,ee=["x","y","z","w","u","v"];N=A===0?"":V<2&&U.length>=1?"coords = 0;":U.map(function(X){return"coords."+ee[X+te]+" = 0;"}).join(`
`);var G="";G=V<2&&A>0?"coords":k.shapeInfo.logicalShape.map(function(X,de){return"coords."+ee[de+te]}).join(", ");var q="return outputValue;",W=Re(k.shapeInfo.logicalShape)===1,Y=Re(R.logicalShape)===1;if(A!==1||W||Y){if(W&&!Y)q=V===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(U.length){var K=A-2,L=A-1;U.indexOf(K)>-1&&U.indexOf(L)>-1?q="return vec4(outputValue.x);":U.indexOf(K)>-1?q="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":U.indexOf(L)>-1&&(q="return vec4(outputValue.xx, outputValue.zz);")}}else q=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+D+`() {
      `+re+` coords = getOutputCoords();
      `+N+`
      vec4 outputValue = get`+F+"("+G+`);
      `+q+`
    }
  `}(y,b):function(k,R){var N=k.name,P=N.charAt(0).toUpperCase()+N.slice(1),F="get"+P+"AtOutCoords",D=R.texShape,A=k.shapeInfo.texShape,V=k.shapeInfo.logicalShape.length,U=R.logicalShape.length;if(!k.shapeInfo.isUniform&&V===U&&k.shapeInfo.flatOffset==null&&Ot(A,D))return`
      float `+F+`() {
        return sampleTexture(`+N+`, resultUV);
      }
    `;var re,te=ot(U),ee=go(k.shapeInfo.logicalShape,R.logicalShape),G=U-V,q=["x","y","z","w","u","v"];re=V===0?"":U<2&&ee.length>=1?"coords = 0;":ee.map(function(Y){return"coords."+q[Y+G]+" = 0;"}).join(`
`);var W="";return W=U<2&&V>0?"coords":k.shapeInfo.logicalShape.map(function(Y,K){return"coords."+q[K+G]}).join(", "),`
    float `+F+`() {
      `+te+` coords = getOutputCoords();
      `+re+`
      return get`+P+"("+W+`);
    }
  `}(y,b)),C}(g,t,r)}).join(`
`),f=t.texShape,d=Yt(),p=function(g){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+g.texture2D+`(textureSampler, uv).r;
    }
  `}(d),v=function(g){return g.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+g.varyingFs+` vec2 resultUV;
    `+g.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+g.defineSpecialNaN+`
    `+g.defineSpecialInf+`
    `+g.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+UC+`
    `+VC+`
    `+jC+`
  `}(d);return t.isPacked?(i=function(g,y){switch(g.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(k,R){var N=[Math.ceil(R[0]/2),Math.ceil(R[1]/2)];return N[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+N[1]+`.0);
      }
    `:N[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+N[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+N[0]+", "+N[1]+`));
      return 2 * (resTexRC.x * `+N[1]+` + resTexRC.y);
    }
  `}(0,y);case 2:return function(k,R){var N=[Math.ceil(R[0]/2),Math.ceil(R[1]/2)];if(Ot(k,R))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+N[0]+", "+N[1]+`));
      }
    `;var P=Math.ceil(k[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+N[0]+", "+N[1]+`));

      int index = resTexRC.x * `+N[1]+` + resTexRC.y;
      int r = 2 * (index / `+P+`);
      int c = imod(index, `+P+`) * 2;

      return ivec2(r, c);
    }
  `}(g,y);case 3:return b=g,w=y,C=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)],_=Math.ceil(b[2]/2),S=_*Math.ceil(b[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      int b = index / `+S+`;
      index -= b * `+S+`;

      int r = 2 * (index / `+_+`);
      int c = imod(index, `+_+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(k,R){for(var N=[Math.ceil(R[0]/2),Math.ceil(R[1]/2)],P=Math.ceil(k[k.length-1]/2),F=P*Math.ceil(k[k.length-2]/2),D=F,A="",V="b, r, c",U=2;U<k.length-1;U++)D*=k[k.length-U-1],A=`
      int b`+U+" = index / "+D+`;
      index -= b`+U+" * "+D+`;
    `+A,V="b"+U+", "+V;return`
    ivec`+k.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+N[0]+", "+N[1]+`));
      int index = resTexRC.x * `+N[1]+` + resTexRC.y;

      `+A+`

      int b = index / `+F+`;
      index -= b * `+F+`;

      int r = 2 * (index / `+P+`);
      int c = imod(index, `+P+`) * 2;

      return ivec`+k.length+"("+V+`);
    }
  `}(g,y)}var b,w,C,_,S}(t.logicalShape,f),s=function(g){return`
    void setOutput(vec4 val) {
      `+g.output+` = val;
    }
  `}(d)):(i=function(g,y){switch(g.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(C,_){return _[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+_[1]+`.0);
      }
    `:_[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+_[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      return resTexRC.x * `+_[1]+` + resTexRC.y;
    }
  `}(0,y);case 2:return function(C,_){return Ot(C,_)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+_[0]+", "+_[1]+`));
      }
    `:C[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+_[0]+", "+_[1]+`));
        int index = resTexRC.x * `+_[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:C[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+_[0]+", "+_[1]+`));
        int index = resTexRC.x * `+_[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      int r = index / `+C[1]+`;
      int c = index - r * `+C[1]+`;
      return ivec2(r, c);
    }
  `}(g,y);case 3:return b=y,w=qo(["r","c","d"],g),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      `+w+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(C,_){var S=qo(["r","c","d","d2"],C);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      `+S+`
      return ivec4(r, c, d, d2);
    }
  `}(g,y);case 5:return function(C,_){var S=qo(["r","c","d","d2","d3"],C);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+_[0]+`,
                             `+_[1]+`));

      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+S+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(g,y);case 6:return function(C,_){var S=qo(["r","c","d","d2","d3","d4"],C);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+S+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(g,y);default:throw new Error(g.length+"-D output sampling is not yet supported")}var b,w}(t.logicalShape,f),s=function(g){return`
    void setOutput(float val) {
      `+g.output+` = vec4(val, 0, 0, 0);
    }
  `}(d)),r&&(v+=HC),[v,p,s,u,i,c,e].join(`
`)}function Wi(n){var t=n.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var i=e.shapeInfo.texShape,s=i[0],u=i[1];if(s===1&&u===1)return`
      float `+o+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var c=e.shapeInfo.texShape,f=c[0],d=c[1],p=Vo(r);return`
    float `+o+`() {
      vec2 uv = uvFromFlat(`+f+", "+d+", "+p+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 1:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return`
      float `+o+`(int index) {
        `+Oi(e)+`
      }
    `;var i=e.shapeInfo.texShape,s=i[0],u=i[1];if(u===1&&s===1)return`
      float `+o+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var c=Vo(r);return u===1?`
      float `+o+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+c+") + 0.5) / "+s+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:s===1?`
      float `+o+`(int index) {
        vec2 uv = vec2((float(index + `+c+") + 0.5) / "+u+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+o+`(int index) {
      vec2 uv = uvFromFlat(`+s+", "+u+", index + "+c+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 2:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),s=e.shapeInfo.texShape;if(s!=null&&Ot(r,s)){var u=s[0],c=s[1];return`
    float `+i+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+u+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `}var f=Go(r),d=f.newShape,p=f.keptDims,v=d;if(v.length<r.length){var g=zi(e,v);return`
      `+Wi(g)+`
      float `+i+`(int row, int col) {
        return `+i+"("+Ui(["row","col"],p)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Oi(e)+`
      }
    `;var y=s[0],b=s[1],w=Vo(o);return b===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+w+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+y+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `:y===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+w+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+b+`.0, 0.5);
      return sampleTexture(`+o+`, uv);
    }
  `:`
  float `+i+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+w+`;
    vec2 uv = uvFromFlat(`+y+", "+b+`, index);
    return sampleTexture(`+o+`, uv);
  }
`}(n);case 3:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),s=r[1]*r[2],u=r[2],c=Go(r),f=c.newShape,d=c.keptDims,p=f;if(p.length<r.length){var v=zi(e,p);return`
        `+Wi(v)+`
        float `+i+`(int row, int col, int depth) {
          return `+i+"("+Ui(["row","col","depth"],d)+`);
        }
      `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+s+", "+u+`, 1)));
        `+Oi(e)+`
      }
    `;var g=e.shapeInfo.texShape,y=g[0],b=g[1],w=e.shapeInfo.flatOffset;if(b===s&&w==null)return`
        float `+i+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+u+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+b+".0, "+y+`.0);
          return sampleTexture(`+o+`, uv);
        }
      `;if(b===u&&w==null)return`
    float `+i+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+b+".0, "+y+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `;var C=Vo(o);return`
      float `+i+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+s+" + col * "+u+" + depth + "+C+`;
        vec2 uv = uvFromFlat(`+y+", "+b+`, index);
        return sampleTexture(`+o+`, uv);
      }
  `}(n);case 4:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),s=r[3],u=r[2]*s,c=r[1]*u,f=Go(r),d=f.newShape,p=f.keptDims;if(d.length<r.length){var v=zi(e,d);return`
      `+Wi(v)+`
      float `+i+`(int row, int col, int depth, int depth2) {
        return `+i+"("+Ui(["row","col","depth","depth2"],p)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+c+", "+u+", "+s+`, 1)));
        `+Oi(e)+`
      }
    `;var g=e.shapeInfo.flatOffset,y=e.shapeInfo.texShape,b=y[0],w=y[1];if(w===c&&g==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+u+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+w+".0, "+b+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(w===s&&g==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+w+".0, "+b+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var C=Vo(o);return`
    float `+i+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+u+` +
          depth * `+s+` + depth2;
      vec2 uv = uvFromFlat(`+b+", "+w+", index + "+C+`);
      return sampleTexture(`+o+`, uv);
    }
  `}(n);case 5:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),s=r[4],u=r[3]*s,c=r[2]*u,f=r[1]*c,d=Go(r),p=d.newShape,v=d.keptDims;if(p.length<r.length){var g=zi(e,p);return`
      `+Wi(g)+`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        return `+i+"("+Ui(["row","col","depth","depth2","depth3"],v)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+f+", "+c+", "+u+", "+s+`)) +
          depth3;
        `+Oi(e)+`
      }
    `;var y=e.shapeInfo.flatOffset,b=e.shapeInfo.texShape,w=b[0],C=b[1];if(C===f&&y==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+c+", "+u+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+C+".0, "+w+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(C===s&&y==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+C+".0, "+w+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var _=Vo(o);return`
    float `+i+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+f+" + col * "+c+" + depth * "+u+` +
          depth2 * `+s+" + depth3 + "+_+`;
      vec2 uv = uvFromFlat(`+w+", "+C+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(n);case 6:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),s=Go(r),u=s.newShape,c=s.keptDims;if(u.length<r.length){var f=zi(e,u);return`
      `+Wi(f)+`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+i+"("+Ui(["row","col","depth","depth2","depth3","depth4"],c)+`);
      }
    `}var d=r[5],p=r[4]*d,v=r[3]*p,g=r[2]*v,y=r[1]*g;if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+y+", "+g+", "+v+", "+p+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+d+`, 1)));
        `+Oi(e)+`
      }
    `;var b=e.shapeInfo.flatOffset,w=e.shapeInfo.texShape,C=w[0],_=w[1];if(_===y&&b==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+g+", "+v+", "+p+", "+d+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+_+".0, "+C+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(_===d&&b==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+_+".0, "+C+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var S=Vo(o);return`
    float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+y+" + col * "+g+" + depth * "+v+` +
          depth2 * `+p+" + depth3 * "+d+" + depth4 + "+S+`;
      vec2 uv = uvFromFlat(`+C+", "+_+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(n);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function x0(n){var t,e,r;switch(n.shapeInfo.logicalShape.length){case 0:return t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Yt(),`
    vec4 `+e+`() {
      return `+r.texture2D+"("+t+`, halfCR);
    }
  `;case 1:return function(o){var i=o.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),u=o.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],f=Yt();return`
    vec4 `+s+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+c[0]+", "+c[1]+`, index);
      return `+f.texture2D+"("+i+`, uv);
    }
  `}(n);case 2:return function(o){var i=o.shapeInfo.logicalShape,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=o.shapeInfo.texShape,f=c[0],d=c[1],p=Yt();if(c!=null&&Ot(i,c))return`
      vec4 `+u+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+d+".0, "+f+`.0);

        return `+p.texture2D+"("+s+`, uv);
      }
    `;var v=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],g=Math.ceil(i[1]/2);return`
    vec4 `+u+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+g+", "+v[0]+", "+v[1]+`, row, col);
      return `+p.texture2D+"("+s+`, uv);
    }
  `}(n);case 3:return function(o){var i=o.shapeInfo.logicalShape,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=o.shapeInfo.texShape,f=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];if(i[0]===1){var d=i.slice(1),p=zi(o,d);return`
        `+x0(p)+`
        vec4 `+u+`(int b, int row, int col) {
          return `+u+"("+Ui(["b","row","col"],[1,2])+`);
        }
      `}var v=f[0],g=f[1],y=Math.ceil(i[2]/2),b=y*Math.ceil(i[1]/2),w=Yt();return`
    vec4 `+u+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+v+", "+g+", "+b+", "+y+`, b, row, col);
      return `+w.texture2D+"("+s+`, uv);
    }
  `}(n);default:return function(o){for(var i=o.shapeInfo.logicalShape,s=i.length,u=o.name,c="get"+u.charAt(0).toUpperCase()+u.slice(1),f=o.shapeInfo.texShape,d=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)],p=d[0],v=d[1],g=Math.ceil(i[s-1]/2),y=g*Math.ceil(i[s-2]/2),b="int b, int row, int col",w="b * "+y+" + (row / 2) * "+g+" + (col / 2)",C=2;C<s-1;C++)b="int b"+C+", "+b,y*=i[s-C-1],w="b"+C+" * "+y+" + "+w;var _=Yt();return`
    vec4 `+c+"("+b+`) {
      int index = `+w+`;
      int texR = index / `+v+`;
      int texC = index - texR * `+v+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+", "+p+`);
      return `+_.texture2D+"("+u+`, uv);
    }
  `}(n)}}var UC=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,VC=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,jC=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,HC=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Vo(n){return"offset"+n}function Oi(n){var t=n.name,e=Re(n.shapeInfo.logicalShape);return e<2?"return "+t+";":`
    for (int i = 0; i < `+e+`; i++) {
      if (i == index) {
        return `+t+`[i];
      }
    }
  `}function ot(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function zi(n,t){var e=JSON.parse(JSON.stringify(n));return e.shapeInfo.logicalShape=t,e}function Ui(n,t){return t.map(function(e){return n[e]}).join(", ")}var GC=function(n,t,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,O(n.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var o=n[n.length-1],i=Math.ceil(o/t);this.outputShape=n.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,f=c.length,d=ot(f),p=hn("coords",f);if(i===1){var v=ot(u=f+1);s=`
        `+v+" sourceLocR = "+v+"("+p.join()+`, 0);
        ++`+p[f-1]+`;
        `+v+" sourceLocG = "+v+"("+p.join()+`, 0);
        ++`+p[f-2]+`;
        `+v+" sourceLocA = "+v+"("+p.join()+`, 0);
        --`+p[f-1]+`;
        `+v+" sourceLocB = "+v+"("+p.join()+`, 0);
        --`+p[f-2]+";"}else u=f,s=`
        `+d+` sourceLocR = coords;
        ++`+p[f-1]+`;
        `+d+` sourceLocG = coords;
        ++`+p[f-2]+`;
        `+d+` sourceLocA = coords;
        --`+p[f-1]+`;
        `+d+` sourceLocB = coords;
        --`+p[f-2]+";";var g=["x","y","z","w","u","v"].slice(0,u),y="."+g[u-1],b=g.map(function(F){return"int "+F}),w=hn("sourceLocR",u-1).concat("inIdx.r"),C=hn("sourceLocG",u-1).concat("inIdx.g"),_=hn("sourceLocB",u-1).concat("inIdx.b"),S=hn("sourceLocA",u-1).concat("inIdx.a"),k=e==="max"?"greaterThan":"lessThan",R=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+w.join()+`),
                             getBestIndicesAChannel(`+C.join()+`),
                             getBestIndicesAChannel(`+_.join()+`),
                             getBestIndicesAChannel(`+S.join()+")));",N=`vec4(
            getAChannel(`+w.join()+`),
            hasNextCol ? getAChannel(`+C.join()+`) : 0.,
            hasNextRow ? getAChannel(`+_.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+S.join()+") : 0.)",P=r?"":`
      float getBestIndicesAChannel(`+b.join()+`) {
        return getChannel(getBestIndicesA(`+g.join()+`),
                                          vec2(`+g.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+b.join()+`) {
        return getChannel(getA(`+g.join()+`),
                               vec2(`+g.slice(-2).join()+`));
      }
      `+P+`
      void main() {
        `+d+` coords = getOutputCoords();
        bool hasNextCol = `+p[f-1]+" < "+(c[f-1]-1)+`;
        bool hasNextRow = `+p[f-2]+" < "+(c[f-2]-1)+`;
        `+s+`
        ivec4 srcIdx = ivec4(sourceLocR`+y+", sourceLocG"+y+`,
          sourceLocB`+y+", sourceLocA"+y+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+N+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+R+`
          vec4 candidate = `+N+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+k+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},qC=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,r=n.strideHeight,o=n.strideWidth,i=n.dilationHeight,s=n.dilationWidth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth,f=u-1-n.padInfo.top,d=c-1-n.padInfo.left,p=1/(t*e);this.userCode=`
      const ivec2 pads = ivec2(`+f+", "+d+`);
      const float avgMultiplier = float(`+p+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+u+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+c+`;
            wC+= `+s+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},KC=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var t=n.filterDepth,e=n.filterHeight,r=n.filterWidth,o=n.strideDepth,i=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,f=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,v=n.effectiveFilterWidth,g=d-1-n.padInfo.front,y=p-1-n.padInfo.top,b=v-1-n.padInfo.left,w=1/(t*e*r);this.userCode=`
      const ivec3 pads = ivec3(`+g+", "+y+", "+b+`);
      const float avgMultiplier = float(`+w+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+u+`) {
          float dyD = float(dyDCorner + wD) / `+o+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+p+`;
              wR += `+c+`) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+v+`;
                wC += `+f+`) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},$C=function(n,t,e,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],He(n,t),He(n,e);var s="0.0";r!=null&&(He(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";o!=null&&(He(n,o),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+s+`;
        float scale = `+u+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},XC=function(n,t,e,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],He(n,t),He(n,e);var s="vec4(0.0)";r!=null&&(He(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";o!=null&&(He(n,o),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+s+`;
        vec4 scale = `+u+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `},YC="return areal * breal - aimag * bimag;",QC="return areal * bimag + aimag * breal;",Eg=function(n,t,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=He(t,e),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},od="return a + b;",id="return a - b;",_g="return a * b;",w0="return (a < 0.) ? b * a : a;",mt=function(n,t,e){this.variableNames=["A","B"],this.outputShape=He(t,e),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},b0=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Br=function(n,t,e,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=He(t,e);var o=this.outputShape.length,i="";if(r)if(o===0||Re(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          `+ot(o)+` coords = getOutputCoords();
        `,o===1)i+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var s=hn("coords",o);i+=`
            bool nextRowOutOfBounds =
              (`+s[o-2]+" + 1) >= "+this.outputShape[o-2]+`;
            bool nextColOutOfBounds =
              (`+s[o-1]+" + 1) >= "+this.outputShape[o-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+i+`

        setOutput(result);
      }
    `},JC=function(){function n(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,e)}},n}(),ZC=function(){function n(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,e)}},n}(),eE=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},tE=function(n){this.outputShape=[],this.outputShape=Zi(n,1),this.variableNames=n.map(function(u,c){return"T"+c});var t=new Array(n.length-1);t[0]=n[0][1];for(var e=1;e<t.length;e++)t[e]=t[e-1]+n[e][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<t.length;e++){var o=t[e-1];r.push("else if (yC < "+t[e]+") setOutput(getT"+e+"(yR, yC-"+o+"));")}var i=t.length,s=t[t.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+s+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},nE=function(n,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Zi(n,t);var e=this.outputShape,r=e.length,o=ot(r),i=hn("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(w,C){return"T"+C});var u=new Array(n.length-1);u[0]=n[0][t];for(var c=1;c<u.length;c++)u[c]=u[c-1]+n[c][t];var f=s[t],d=s.slice(-2),p=s.join(),v="if ("+f+" < "+u[0]+`) {
        return getChannel(
            getT0(`+p+"), vec2("+d.join()+`));
        }`;for(c=1;c<u.length;c++){var g=u[c-1];v+=`
        if (`+f+" < "+u[c]+"  && "+f+" >= "+u[c-1]+`) {
          return getChannel(
            getT`+c+"("+Bu(s,f,g)+`),
            vec2(`+Bu(d,f,g)+`));
        }`}var y=u.length,b=u[u.length-1];v+=`
        return getChannel(
          getT`+y+"("+Bu(s,f,b)+`),
          vec2(`+Bu(d,f,b)+"));",this.userCode=`
      float getValue(`+s.map(function(w){return"int "+w})+`) {
        `+v+`
      }

      void main() {
        `+o+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+i+`), 0., 0., 0.);

        `+i[r-1]+" = "+i[r-1]+` + 1;
        if (`+i[r-1]+" < "+e[r-1]+`) {
          result.g = getValue(`+i+`);
        }

        `+i[r-2]+" = "+i[r-2]+` + 1;
        if (`+i[r-2]+" < "+e[r-2]+`) {
          result.a = getValue(`+i+`);
        }

        `+i[r-1]+" = "+i[r-1]+` - 1;
        if (`+i[r-2]+" < "+e[r-2]+` &&
            `+i[r-1]+" < "+e[r-1]+`) {
          result.b = getValue(`+i+`);
        }
        setOutput(result);
      }
    `};function Bu(n,t,e){var r=n.indexOf(t);return n.map(function(o,i){return i===r?o+" - "+e:o}).join()}var rE=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideHeight,e=n.strideWidth,r=n.padInfo.top,o=n.padInfo.left,i=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+o+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+i+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},oE=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,r=n.strideHeight,o=n.strideWidth,i=n.dataFormat==="channelsLast",s=t-1-n.padInfo.top,u=e-1-n.padInfo.left,c=i?1:2,f=i?2:3,d=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+d+`];

        ivec2 dyCorner = ivec2(coords[`+c+"], coords["+f+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+i+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},iE=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideDepth,e=n.strideHeight,r=n.strideWidth,o=n.padInfo.front,i=n.padInfo.top,s=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+o+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+e+" - "+i+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+s+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},aE=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterDepth,e=n.filterHeight,r=n.filterWidth,o=n.strideDepth,i=n.strideHeight,s=n.strideWidth,u=t-1-n.padInfo.front,c=e-1-n.padInfo.top,f=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+u+", "+c+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+e+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+e+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},sE=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideHeight,e=n.strideWidth,r=n.padInfo.top,o=n.padInfo.left,i=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+o+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},uE=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,r=n.strideHeight,o=n.strideWidth,i=t-1-n.padInfo.top,s=e-1-n.padInfo.left,u=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+u+`; dm++) {
              int d2 = d1 * `+u+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Sg=function(n,t,e,r){t===void 0&&(t=!1),e===void 0&&(e=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var o=n.padInfo.top,i=n.padInfo.left,s=n.strideHeight,u=n.strideWidth,c=n.dilationHeight,f=n.dilationWidth,d=n.filterHeight,p=n.filterWidth,v=4*Math.floor(n.inChannels/4),g=n.inChannels%4,y=n.dataFormat==="channelsLast",b=y?1:2,w=y?2:3,C=y?3:1,_="",S="";e&&(_=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,S="result = activation(result);");var k=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+_+`

      const ivec2 strides = ivec2(`+s+", "+u+`);
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+C+`];

        ivec2 xRCCorner =
            ivec2(coords[`+b+"], coords["+w+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+f+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+v+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+y+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(g===1)+`) {

              if (`+y+`) {
                dotProd +=
                    getX(batch, xR, xC, `+v+`) *
                    getW(wR, wC, `+v+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+v+`, xR, xC) *
                    getW(wR, wC, `+v+`, d2);
              }

            } else if (`+(g===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+v+`, d2),
                getW(wR, wC, `+v+` + 1, d2)
              );

              if (`+y+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+v+`),
                  getX(batch, xR, xC, `+v+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+v+`, xR, xC),
                  getX(batch, `+v+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(g===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+v+`, d2),
                getW(wR, wC, `+v+` + 1, d2),
                getW(wR, wC, `+v+` + 2, d2)
              );

              if (`+y+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+v+`),
                  getX(batch, xR, xC, `+v+` + 1),
                  getX(batch, xR, xC, `+v+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+v+`, xR, xC),
                  getX(batch, `+v+` + 1, xR, xC),
                  getX(batch, `+v+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+k+`
        `+S+`
        setOutput(result);
      }
    `},lE=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var t=n.padInfo.front,e=n.padInfo.top,r=n.padInfo.left,o=n.strideDepth,i=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,f=n.dilationWidth,d=n.filterDepth,p=n.filterHeight,v=n.filterWidth,g=4*Math.floor(n.inChannels/4),y=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+i+", "+s+`);
      const ivec3 pads = ivec3(`+t+", "+e+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+d+`; wF++) {
          int xF = xFCorner + wF * `+u+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`; wR++) {
            int xR = xRCorner + wR * `+c+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+v+`; wC++) {
              int xC = xCCorner + wC * `+f+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+g+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(y===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+g+`) *
                  getW(wF, wR, wC, `+g+`, d2);
              } else if (`+(y===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+g+`),
                  getX(batch, xF, xR, xC, `+g+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+g+`, d2),
                  getW(wF, wR, wC, `+g+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(y===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+g+`),
                  getX(batch, xF, xR, xC, `+g+` + 1),
                  getX(batch, xF, xR, xC, `+g+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+g+`, d2),
                  getW(wF, wR, wC, `+g+` + 1, d2),
                  getW(wF, wR, wC, `+g+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},kg=function(n,t,e,r){t===void 0&&(t=!1),e===void 0&&(e=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var o=n.inHeight,i=n.inWidth,s=n.padInfo.top,u=n.padInfo.left,c=n.strideHeight,f=n.strideWidth,d=n.dilationHeight,p=n.dilationWidth,v=n.filterHeight,g=n.filterWidth,y=n.outChannels/n.inChannels,b="",w="";e&&(b=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,w="result = activation(result);");var C=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+c+", "+f+`);
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+y+`;
        int q = d2 - d1 * `+y+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+v+`; wR++) {
          int xR = xRCorner + wR * `+d+`;

          if (xR < 0 || xR >= `+o+`) {
            continue;
          }

          for (int wC = 0; wC < `+g+`; wC++) {
            int xC = xCCorner + wC * `+p+`;

            if (xC < 0 || xC >= `+i+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+C+`
        `+w+`
        setOutput(result);
      }
    `},Rg=function(n,t,e,r){t===void 0&&(t=!1),e===void 0&&(e=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var o=n.inHeight,i=n.inWidth,s=n.padInfo.top,u=n.padInfo.left,c=n.strideHeight,f=n.strideWidth,d=n.dilationHeight,p=n.dilationWidth,v=n.filterHeight,g=n.filterWidth,y=g,b="int xR; int xC; int xCOffset;",w=0;w<v;w++)for(var C=0;C<g;C++)b+=`
          vec4 xTexelR`+w+"C"+2*C+` = vec4(0.);
          vec4 wR`+w+"C"+C+` = vec4(0.);
          vec4 xR`+w+"C"+C+" = vec4(0.);";for(w=0;w<v;w++)for(var _=0;_<y;_++){if(b+=`
          xR = xRCorner + `+w*d+`;
          xC = xCCorner + `+(C=2*_)*p+`;
        `,f===1){if(C<g&&(b+=u%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  xTexelR`+w+"C"+C+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    xTexelR`+w+"C"+C+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+w+"C"+C+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+w+"C"+C+" = vec4(previous.zw, xTexelR"+w+"C"+C+`.xy);
                } else {
                  xR`+w+"C"+C+" = vec4(0, 0, xTexelR"+w+"C"+C+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+o+" && xC >= 0 && xC < "+i+`) {
                  xTexelR`+w+"C"+C+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+w+"C"+C+` = vec4(0.);
                }

                xR`+w+"C"+C+" = xTexelR"+w+"C"+C+`;
              `,C+1<g)){var S=u%2==0?Wy(p):p;p%2==0&&u%2==1||p%2!=0&&u%2!=1?(b+=`
                  xCOffset = xC + `+u%2+" + "+S+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+w+"C"+(C+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,p>1&&(b+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+o+` &&
                      xCOffset >= 0 && xCOffset < `+i+`) {
                      xTexelR`+w+"C"+C+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+w+"C"+C+` = vec4(0.);
                    }
                  `),b+=`
                  xR`+w+"C"+(C+1)+` = vec4(
                    xTexelR`+w+"C"+C+".zw, xTexelR"+w+"C"+(C+2)+`.xy);
                `):b+=`
                  xCOffset = xC + `+S+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+w+"C"+(C+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+w+"C"+(C+1)+" = xTexelR"+w+"C"+(C+2)+`;
                `}}else C<g&&(b+=`
              if(xR >= 0 && xR < `+o+`) {
            `,u%2==1?(b+=`
                xCOffset = xC + 1 - `+f+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+w+"C"+C+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+w+"C"+C+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+i+`) {
                  xTexelR`+w+"C"+(C+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+w+"C"+(C+2)+` = vec4(0.);
                }

                xR`+w+"C"+C+` = vec4(
                  xTexelR`+w+"C"+C+".zw, xTexelR"+w+"C"+(C+2)+`.zw);
              `,C+1<g&&(b+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+f+`;
                  if(xCOffset >= 0 && xCOffset < `+i+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+w+"C"+(C+1)+" = vec4(xTexelR"+w+"C"+(C+2)+`.xy, final.xy);
                `)):(b+=`
                if(xC >= 0 && xC < `+i+`) {
                  xTexelR`+w+"C"+C+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+w+"C"+C+` = vec4(0.);
                }

                xCOffset = xC + `+f+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+w+"C"+(C+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+w+"C"+(C+2)+` = vec4(0.);
                }

                xR`+w+"C"+C+` = vec4(
                  xTexelR`+w+"C"+C+".xy, xTexelR"+w+"C"+(C+2)+`.xy);
              `,C+1<g&&(b+=`
                  xR`+w+"C"+(C+1)+` = vec4(
                    xTexelR`+w+"C"+C+".zw, xTexelR"+w+"C"+(C+2)+`.zw);
                `)),b+="}");C<g&&(b+=`
            vec4 wTexelR`+w+"C"+C+" = getW("+w+", "+C+`, d1, q);
            wR`+w+"C"+C+" = vec4(wTexelR"+w+"C"+C+".xz, wTexelR"+w+"C"+C+`.xz);
          `,C+1<g&&(b+=`
              vec4 wTexelR`+w+"C"+(C+1)+" = getW("+w+", "+(C+1)+`, d1, q);
              wR`+w+"C"+(C+1)+` =
                vec4(wTexelR`+w+"C"+(C+1)+".xz, wTexelR"+w+"C"+(C+1)+".xz);"))}for(w=0;w<v;w++)for(C=0;C<g;C++)b+="dotProd += xR"+w+"C"+C+" * wR"+w+"C"+C+";";var k="",R="";e&&(k=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`vec4 activation(vec4 x) {
          `+e+`
        }`,R="result = activation(result);");var N=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+k+`

      const ivec2 strides = ivec2(`+c+", "+f+`);
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+b+`

        vec4 result = dotProd;
        `+N+`
        `+R+`
        setOutput(result);
      }
    `},cE=function(n,t,e,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=n[0],s=n[1],u=n[2],c=n[3],f=t[0],d=e[0],p=e[1];this.outputShape=[f,d,p,c];var v=r==="bilinear"?1:0,g=[s-1+".0",u-1+".0"],y=g[0],b=g[1],w=d>1?[""+(s-1)/(d-1),"(y2-y1) * height_ratio","y1*"+y+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+y],C=w[0],_=w[1],S=w[2],k=p>1?[""+(u-1)/(p-1),"(x2-x1) * width_ratio","x1*"+b+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+b],R=k[0],N=k[1],P=k[2];this.userCode=`
      const float height_ratio = float(`+C+`);
      const float width_ratio = float(`+R+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+_+`;
        float width_scale = `+N+`;

        float in_y = `+S+`;
        if( in_y < 0.0 || in_y > `+y+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+P+`;
        if( in_x < 0.0 || in_x > `+b+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+v+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},fE=function(n,t,e){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=n[n.length-1],i=e?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(e?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+ot(r)+` coords = getOutputCoords();
        int end = `+Ig(r,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+Ig(r,"coords")+` = idx;
          val += getX(`+function(s,u){if(s===1)return""+u;if(s===2)return u+".x, "+u+".y";if(s===3)return u+".x, "+u+".y, "+u+".z";if(s===4)return u+".x, "+u+".y, "+u+".z, "+u+".w";throw Error("Cumulative sum for rank "+s+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function Ig(n,t){if(n===1)return""+t;if(n===2)return t+".y";if(n===3)return t+".z";if(n===4)return t+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var dE=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=ns.DENSE;var t=Qa(n),e=Yt();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+qo(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+e.output+` = result;
      }
    `},hE=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=ns.DENSE;var t=Qa(n),e=Yt();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+qo(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+e.output+` = result;
      }
    `},pE=function(){function n(t,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+e+`;
      int offset_h = imod(h, `+e+`);
      int in_w = w / `+e+`;
      int offset_w = imod(w, `+e+`);
      int offset_d = (offset_h * `+e+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),vE=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},mE=function(n){this.variableNames=["A"],this.outTexUsage=Rn.DOWNLOAD;var t=Yt();this.outputShape=n,this.userCode=`
      `+y0+`

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `},gE=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Rn.DOWNLOAD;var t=Yt();this.outputShape=n,this.userCode=`
      `+y0+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+t.output+` = encode_float(x);
      }
    `},yE=function(n,t,e){e===void 0&&(e=!1),this.variableNames=["A"];var r=Yt(),o=t[0],i=t[1];this.outputShape=n;var s="result";e&&(s="floor(result * 255. + 0.5)"),this.userCode=`
      `+mh(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+i+`;
        int c = imod(flatIndex, `+i+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+s+`, 0., 0., 0.);
      }
    `},xE=function(n,t,e){e===void 0&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Yt(),o=t[0],i=t[1];this.outputShape=n;var s="",u="result";e&&(u="floor(result * 255. + 0.5)");for(var c=0;c<=1;c++)for(var f=0;f<=1;f++){var d=2*c+f;s+=`
          localCoords = coords;
          if(localCoords[2] + `+f+" < "+n[2]+`) {
            localCoords[2] += `+f+`;
            if(localCoords[1] + `+c+" < "+n[1]+`) {
              localCoords[1] += `+c+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+i+`;
              c = imod(flatIndex, `+i+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+d+`] = values[0];
              } else if(offset == 1) {
                result[`+d+`] = values[1];
              } else if(offset == 2) {
                result[`+d+`] = values[2];
              } else {
                result[`+d+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+mh(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+s+`

        `+r.output+" = "+u+`;
      }
    `},wE="return real * expR - imag * expI;",bE="return real * expI + imag * expR;",Ng=function(n,t,e){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=e?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},CE=function(){function n(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,o){e.valueLoc==null&&(e.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(e.valueLoc,t)}},n}(),EE=function(n,t,e){this.variableNames=["A","indices"];var r=n.slice();r[e]=t,this.outputShape=r,this.rank=r.length;var o=ot(this.rank),i=function(s,u){var c=s.length;if(c>4)throw Error("Gather for rank "+c+" is not yet supported");if(c===1)return"int(getIndices(resRC))";for(var f=["resRC.x","resRC.y","resRC.z","resRC.w"],d=[],p=0;p<s.length;p++)p===u?d.push("int(getIndices("+f[p]+"))"):d.push(""+f[p]);return d.join()}(n,e);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},_E=function(n,t,e){this.sliceDim=n,this.strides=t,this.variableNames=["x","indices"],this.outputShape=e;var r=ot(t.length),o=ot(e.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function SE(n,t){var e=Yt();return wb(n,t,e.version+`
    precision highp float;
    `+e.attribute+` vec3 clipSpacePos;
    `+e.attribute+` vec2 uv;
    `+e.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function kE(n,t){return Sb(n,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function RE(n,t){return kb(n,t,new Uint16Array([0,1,2,2,1,3]))}function ds(n,t,e,r,o,i,s){Ib(e,r);var u=Rb(n,t),c=n.TEXTURE_2D;return Ne(n,t,function(){return n.bindTexture(c,u)}),Ne(n,t,function(){return n.texParameteri(c,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),Ne(n,t,function(){return n.texParameteri(c,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),Ne(n,t,function(){return n.texParameteri(c,n.TEXTURE_MIN_FILTER,n.NEAREST)}),Ne(n,t,function(){return n.texParameteri(c,n.TEXTURE_MAG_FILTER,n.NEAREST)}),Ne(n,t,function(){return n.texImage2D(c,0,o,e,r,0,i,s,null)}),Ne(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)}),u}function IE(n,t,e,r,o){var i=Nl(e,r);return ds(n,t,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,n.FLOAT)}function NE(n,t,e,r,o){var i=Nl(e,r);return ds(n,t,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function TE(n,t,e,r,o){var i=Nl(e,r);return ds(n,t,i[0],i[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function DE(n,t,e,r,o){var i=fs(e,r);return ds(n,t,i[0],i[1],o.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function AE(n,t,e,r,o){var i=fs(e,r);return ds(n,t,i[0],i[1],o.internalFormatPackedHalfFloat,n.RGBA,o.textureTypeHalfFloat)}function PE(n,t,e,r){return Ne(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),mg(n,t,e,"clipSpacePos",r,3,20,0)&&mg(n,t,e,"uv",r,2,20,12)}function FE(n,t,e,r,o,i,s){var u,c,f;Ne(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)}),i instanceof Uint8Array?(u=new Uint8Array(r*o*4),c=n.UNSIGNED_BYTE,f=n.RGBA):(u=new Float32Array(r*o*4),c=n.FLOAT,f=s.internalFormatPackedFloat),u.set(i),Ne(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,f,r,o,0,n.RGBA,c,u)}),Ne(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function OE(n,t,e,r){Ne(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)}),r.data instanceof Uint8Array?Ne(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):Ne(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),Ne(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function ME(n,t,e,r,o){var i=n.createBuffer();Ne(n,t,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,i)});var s=16*e*r;return Ne(n,t,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,s,n.STREAM_READ)}),Ne(n,t,function(){return n.readPixels(0,0,r,e,n.RGBA,n.FLOAT,0)}),Ne(n,t,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),i}function LE(n,t,e){var r=n,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function BE(n,t,e,r,o){var i=Nl(e,r),s=i[0],u=i[1],c=new Uint8Array(e*r*4);return Ne(n,t,function(){return n.readPixels(0,0,s,u,o.downloadTextureFormat,n.UNSIGNED_BYTE,c)}),new Float32Array(c.buffer)}function WE(n,t,e,r,o,i,s,u){var c=n,f=new Float32Array(function(d,p){var v=fs(d,p);return v[0]*v[1]*4}(i,s));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,f),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),f}function zE(n,t,e,r){var o=new Float32Array(e*r*4);return Ne(n,t,function(){return n.readPixels(0,0,r,e,n.RGBA,n.FLOAT,o)}),o}var UE=function(){function n(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=ae().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,vb(e,t)):this.gl=Er(e);var r="WEBGL_color_buffer_float";if(ae().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Fu(this.gl,this.debug,"OES_texture_float"),jn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Fu(this.gl,this.debug,"OES_texture_half_float");else if(ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),jn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Fu(this.gl,this.debug,"EXT_color_buffer_half_float");else if(ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",jn(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!jn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=kE(this.gl,this.debug),this.indexBuffer=RE(this.gl,this.debug),this.framebuffer=Nb(this.gl,this.debug),this.textureConfig=ah(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return ae().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Ne(e,this.debug,function(){return e.finish()}),Ne(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Ne(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),Ne(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),Ne(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),Ne(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),IE(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),NE(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),TE(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),OE(this.gl,this.debug,t,e)},n.prototype.uploadDenseMatrixToTexture=function(t,e,r,o){this.throwIfDisposed(),FE(this.gl,this.debug,t,e,r,o,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),AE(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),DE(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(gg(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Ne(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,r){var o=this;return this.downloadMatrixDriver(t,function(){return BE(o.gl,o.debug,e,r,o.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(t,e,r,o,i,s){return WE(this.gl,t,0,0,0,i,s,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return LE(this.gl,t,e)},n.prototype.createBufferFromTexture=function(t,e,r){this.bindTextureToFrameBuffer(t);var o=ME(this.gl,this.debug,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},n.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},n.prototype.createFence=function(t){var e,r,o=this;if(ae().getBool("WEBGL_FENCE_API_ENABLED")){var i=t,s=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var u=i.clientWaitSync(s,0,0);return u===i.ALREADY_SIGNALED||u===i.CONDITION_SATISFIED},e=s}else ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(e,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:e,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(t,e,r){var o=this;return this.downloadMatrixDriver(t,function(){return zE(o.gl,o.debug,e,r)})},n.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,r=bb(e,this.debug,t),o=SE(e,this.debug),i=Eb(e,this.debug);return Ne(e,this.debug,function(){return e.attachShader(i,o)}),Ne(e,this.debug,function(){return e.attachShader(i,r)}),_b(e,this.debug,i),this.debug&&ed(e,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=PE(e,this.debug,this.program,this.vertexBuffer)),i},n.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&Ne(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},n.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&ed(this.gl,this.debug,this.program),Ne(this.gl,this.debug,function(){return e.gl.useProgram(t)})},n.prototype.getUniformLocation=function(t,e,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?Db(this.gl,this.debug,t,e):Ab(this.gl,t,e)},n.prototype.getAttributeLocation=function(t,e){var r=this;return this.throwIfDisposed(),Ne(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,e)})},n.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},n.prototype.setInputMatrixTexture=function(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),Pb(this.gl,this.debug,this.program,t,e,r)},n.prototype.setOutputMatrixTexture=function(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)},n.prototype.setOutputPackedMatrixTexture=function(t,e,r){this.throwIfDisposed();var o=fs(e,r),i=o[0],s=o[1];this.setOutputMatrixTextureDriver(t,i,s)},n.prototype.setOutputMatrixWriteRegion=function(t,e,r,o){this.setOutputMatrixWriteRegionDriver(r,t,o,e)},n.prototype.setOutputPackedMatrixWriteRegion=function(t,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&ed(this.gl,this.debug,this.program),Ou(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),Ne(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),Ne(this.gl,this.debug,function(){return t.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Fu(this.gl,this.debug,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},n.prototype.endQuery=function(){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(t){return Ee(this,void 0,void 0,function(){var e=this;return _e(this,function(r){switch(r.label){case 0:return[4,cg(function(){return e.disposed||e.isQueryAvailable(t,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(t,e){if(e===0)return null;if(e===2){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(t,e){if(e===0)return!0;if(e===2){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},n.prototype.pollFence=function(t){var e=this;return new Promise(function(r){e.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var t=function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},n.prototype.addItemToPoll=function(t,e){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||cg(function(){return r.pollItems(),r.itemsToPoll.length===0})},n.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),td(this.gl,this.debug,t,this.framebuffer),this.debug&&Ou(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(td(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ou(this.gl)):gg(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var r=e();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(t,e,r){this.throwIfDisposed();var o=this.gl;td(o,this.debug,t,this.framebuffer),this.debug&&Ou(o),this.outputTexture=t,Ne(o,this.debug,function(){return o.viewport(0,0,e,r)}),Ne(o,this.debug,function(){return o.scissor(0,0,e,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(t,e,r,o){var i=this;this.throwIfDisposed(),Ne(this.gl,this.debug,function(){return i.gl.scissor(t,e,r,o)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function Tg(n,t){if(n.length!==t.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+t.length+" inputs");n.forEach(function(e,r){var o=e.logicalShape,i=t[r],s=i.shape;if(!Ot(o,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+s+" must match");if(!e.isUniform||!i.isUniform){var u=e.texShape,c=i.isUniform?null:i.texData.texShape;if(!Ot(u,c))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+u+" and "+c+" must match")}})}var VE=function(n,t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=e.filterWidth,o=e.inChannels,i=e.strideWidth,s=e.strideHeight,u=e.padInfo,c=e.outWidth,f=e.dilationWidth,d=e.dilationHeight,p=e.dataFormat,v=u.left,g=u.top,y=o*r,b=Yt(),w=p==="channelsLast",C=w?0:1,_=w?1:2,S="",k=0;k<=1;k++)for(var R=0;R<=1;R++)S+=`
          blockIndex = rc.y + `+R+`;
          pos = rc.x + `+k+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+c+")) * "+s+" - "+g+`;
            d0 = offsetY + `+d+" * (pos / "+y+`);

            if(d0 < `+t[C]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+c+".) * "+i+". - "+v+`.);
              d1 = offsetX + `+f+" * (int(mod(float(pos), "+y+".) / "+o+`.));

              if(d1 < `+t[_]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+o+`.));

                if (`+w+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*k+R)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*k+R)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+S+`

        `+b.output+` = result;
      }
    `},jE=function(n,t,e,r,o){this.variableNames=["x"],this.outputShape=[];var i,s=t,u=n[3]-1;this.outputShape=n;var c="float("+e+") + float("+r+") * sum";i=o===.5?"inversesqrt("+c+")":o===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+s+"; j <= "+s+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+u+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `},HE=function(n,t,e,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=t,this.bias=e,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+e+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},GE=function(n,t,e,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,s=t,u=n[3]-1;this.outputShape=n;var c="float("+e+") + float("+r+") * sum";i=o===.5?"inversesqrt("+c+")":o===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+s+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+s+"; j <= "+s+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+u+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+i+`;
        setOutput(result);
      }
    `},qE=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var t=n.strideHeight,e=n.strideWidth,r=n.dilationHeight,o=n.effectiveFilterHeight,i=n.effectiveFilterWidth,s=o-1-n.padInfo.top,u=i-1-n.padInfo.left,c=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+e+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+c+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},KE=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var t=n.strideDepth,e=n.strideHeight,r=n.strideWidth,o=n.dilationDepth,i=n.dilationHeight,s=n.dilationWidth,u=n.effectiveFilterDepth,c=n.effectiveFilterHeight,f=n.effectiveFilterWidth,d=u-1-n.padInfo.front,p=c-1-n.padInfo.top,v=f-1-n.padInfo.left,g=u*c*f-1;this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+p+", "+v+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+u+`;
           wD += `+o+`) {
          float dyD = float(dyDCorner + wD) / `+t+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+c+`;
              wR += `+i+`) {
            float dyR = float(dyRCorner + wR) / `+e+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+s+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+g+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+c+" * "+f+` +
                  wR * `+f+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},ad=function(n,t,e,r,o,i,s){e===void 0&&(e=!1),r===void 0&&(r=!1),o===void 0&&(o=!1),i===void 0&&(i=null),s===void 0&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var u=e?n[1]:n[2],c=Math.ceil(u/2),f=e?"i * 2, rc.y":"rc.y, i * 2",d=r?"rc.z, i * 2":"i * 2, rc.z",p=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",y="";i&&(g=s?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+i+`
        }`:`vec4 activation(vec4 x) {
          `+i+`
        }`,y="result = activation(result);");var b=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+g+`

      const float sharedDimension = `+c+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+c+`; i++) {
          vec4 a = getMatrixA(rc.x, `+f+`);
          vec4 b = getMatrixB(rc.x, `+d+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+p[0]+" * "+v[0]+`);
          result += (`+p[1]+" * "+v[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+b+`

        `+y+`

        setOutput(result);
      }
    `},$E=function(){function n(t,e,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(e-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(e-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,o){e.seedLoc==null&&(e.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(e.seedLoc,t)}},n}(),XE=function(n,t,e,r){this.variableNames=["indices"],this.outputShape=[n,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+e+`),
                      float(index == coords.y)));
      }
    `},YE=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var t=n.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var e=hn("rc",t),r=ot(t),o=function(u,c,f){if(u===1)return"rc > "+c[0];for(var d="",p=u-2;p<u;p++)d+=f[p]+" >= "+c[p],p<u-1&&(d+="||");return d}(t,n,e),i=function(u,c,f,d){if(u===1)return"";var p=d.slice(-2);return`
    int r = `+p[0]+`;
    int c = `+p[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+c+`;
    bool rEdge = rp1 >= `+f+`;
  `}(t,n[n.length-1],n[n.length-2],e),s=function(u,c){var f=u.length,d=function(p,v){for(var g=[],y=0;y<=1;y++)for(var b=0;b<=1;b++){for(var w=(y===0?"r":"rp1")+", "+(b===0?"c":"cp1"),C=2;C<p;C++)w=v[v.length-1-C]+","+w;g.push(w)}return g}(f,c);return f===1?`getA(rc),
            rc + 1 >= `+u[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+d[0]+`),
          cEdge ? 0. : getA(`+d[1]+`),
          rEdge ? 0. : getA(`+d[2]+`),
          rEdge || cEdge ? 0. : getA(`+d[3]+")"}(n,e);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+s+`));
          }
        }
      `}},QE=function(n,t,e){this.variableNames=["x"],this.outputShape=t.map(function(c,f){return c[0]+n[f]+c[1]});var r=n.length,o=ot(r),i=t.map(function(c){return c[0]}).join(","),s=t.map(function(c,f){return c[0]+n[f]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+o+" start = "+o+"("+i+`);
      `+o+" end = "+o+"("+s+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+e+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+u+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+s+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+e+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},JE=function(n,t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(w,C){return w[0]+n[C]+w[1]});for(var r=n.length,o=ot(r),i=t.map(function(w){return w[0]}).join(","),s=t.map(function(w,C){return w[0]+n[C]}).join(","),u=hn("rc",r),c=hn("source",r),f=u[r-1]+" < "+this.outputShape[r-1],d=r===1?"source":"vec2("+c.slice(-2).join()+")",p=[o+" rc = outputLoc;",u[r-1]+` += 1;
       if(`+f+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+u[r-2]+` += 1;
       if(`+u[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+u[r-1]+` += 1;
         if(`+f+") {"],v=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",g="",y=0,b=r===1?2:4;y<b;y++)g+=`
        `+p[y]+`
        if (`+v+`) {
          result[`+y+"] = float("+e+`);
        } else {
          `+o+` source = rc - start;
          result[`+y+"] = getChannel(getX("+c.join()+"), "+d+`);
        }
      `;g+=r===1?"} ":"}}",this.userCode=`
      const `+o+" start = "+o+"("+i+`);
      const `+o+" end = "+o+"("+s+`);

      void main() {
        `+o+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+g+`
        setOutput(result);
      }
    `},sd=function(n,t,e){if(this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,f=n.effectiveFilterWidth,d=n.padInfo.top,p=n.padInfo.left;this.outputShape=n.outShape;var v=t==="avg",g="0.0";if(v||(g="-1.0 / 1e-20"),e)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+i+`);
        const ivec2 pads = ivec2(`+d+", "+p+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+c+`;
              wR += `+s+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`;
                wC += `+u+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+f+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(y="avgValue / count");var b=4*Math.floor(r/4),w=r%4,C=`
      if (`+v+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+i+`);
      const ivec2 pads = ivec2(`+d+", "+p+`);
      const float initializationValue = `+g+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+g+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+c+`;
            wR += `+s+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+b+`; wC += 4) {
            int xC = xCCorner + wC * `+u+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              getValue(batch, xR, xC + 2 * `+u+`, d),
              getValue(batch, xR, xC + 3 * `+u+`, d)
            );

            `+C+`
          }

          int xC = xCCorner + `+b+`;
          if (`+(w===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+C+`
          } else if (`+(w===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              initializationValue,
              initializationValue
            );

            `+C+`
          } else if (`+(w===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              getValue(batch, xR, xC + 2 * `+u+`, d),
              initializationValue
            );

            `+C+`
          }
        }
        setOutput(`+y+`);
      }
    `}},ud=function(n,t,e){if(this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,o=n.strideDepth,i=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,f=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,v=n.effectiveFilterWidth,g=n.padInfo.front,y=n.padInfo.top,b=n.padInfo.left;this.outputShape=n.outShape;var w=t==="avg",C="0.0";if(w||(C="-1.0 / 1e-20"),e)this.userCode=`
        const ivec3 strides =
            ivec3(`+o+", "+i+", "+s+`);
        const ivec3 pads = ivec3(`+g+", "+y+", "+b+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+d+`;
              wD += `+u+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+p+`;
                wR += `+c+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+v+`;
                  wC += `+f+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+p+" * "+v+` +
                      wR * `+v+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var _=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(_="avgValue / count");var S=4*Math.floor(r/4),k=r%4,R=`
      if (`+w+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+o+", "+i+", "+s+`);
      const ivec3 pads = ivec3(`+g+", "+y+", "+b+`);
      const float initializationValue = `+C+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+C+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+u+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`;
            wR += `+c+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+S+`; wC += 4) {
              int xC = xCCorner + wC * `+f+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+f+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+f+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+f+`, ch)
              );

              `+R+`
            }

            int xC = xCCorner + `+S+`;
            if (`+(k===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+R+`
            } else if (`+(k===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+f+`, ch),
                initializationValue,
                initializationValue
              );

              `+R+`
            } else if (`+(k===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+f+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+f+`, ch),
                initializationValue
              );

              `+R+`
            }
          }
          setOutput(`+_+`);
        }
      }
    `}},ZE=function(n,t){this.variableNames=["x"];var e=n.windowSize,r=n.batchSize,o=n.inSize,i=Math.ceil(o/e);this.outputShape=[r,i];var s="0.0",u="";t==="prod"?s="1.0":t==="min"?(s="1.0 / 1e-20",u="min"):t==="max"&&(s="-1.0 / 1e-20",u="max");var c=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");var f=4*Math.floor(e/4),d=e%4,p=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+u+`(values, minMaxValue);
      }
    `,v="vec4";t==="all"?(s="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,v="bvec4"):t==="any"&&(s="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,v="bvec4");var g="";o%e>0&&(g=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+s+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+g+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+e+`;

        vec4 minMaxValue = vec4(`+s+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+f+`; i += 4) {
          int inIdx = inOffset + i;
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+p+`
        }

        int inIdx = inOffset + `+f+`;
        if (`+(d===1)+`) {
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(d===2)+`) {
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(d===3)+`) {
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+p+`
        }
        setOutput(`+c+`);
      }
    `},e_=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var e="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),e+=`
        `+o+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+qo(["r","c","d"],t)+`
      return ivec3(r, c, d);
    }
  
      `+mh(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+e+`

        setOutput(result);
      }
    `},t_=function(n,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],s=n.shape,u=s[1],c=s[2],f=[e&&u>1?o-1:o,e&&c>1?i-1:i],d=[e&&u>1?u-1:u,e&&c>1?c-1:c],p=f[0]/d[0],v=f[1]/d[1],g=1/p,y=1/v,b=2*Math.ceil(g)+2,w=2*Math.ceil(y)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+v+`);

        const float invHeightScale = float(`+g+`);
        const float invWidthScale = float(`+y+`);

        const int winHeight = int(`+b+`);
        const int winWidth = int(`+w+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},n_=function(n,t,e,r){this.variableNames=["A"],this.outputShape=[];var o=n[0],i=n[1],s=n[2],u=n[3];this.outputShape=[o,t,e,u];var c=[r&&t>1?i-1:i,r&&e>1?s-1:s],f=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/f[0]+`,
          `+c[1]/f[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},r_=function(n,t,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=n[0],i=n[1],s=n[2],u=n[3];this.outputShape=[o,t,e,u];var c=[r&&t>1?i-1:i,r&&e>1?s-1:s],f=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+c[0]/f[0]+`,
          `+c[1]/f[1]+`,
          `+c[1]/f[1]+`);
      const vec3 inputShapeRC = vec3(`+i+".0, "+s+`.0,
                                     `+s+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(u-1)+`;
        bool hasNextRow = coords.z < `+(e-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},o_=function(n,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],s=n.shape,u=s[1],c=s[2],f=[e&&u>1?o-1:o,e&&c>1?i-1:i],d=[e&&u>1?u-1:u,e&&c>1?c-1:c],p=f[0]/d[0],v=f[1]/d[1],g=1/p,y=1/v,b=2*Math.ceil(g)+2,w=2*Math.ceil(y)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+v+`);

        const float invHeightScale = float(`+g+`);
        const float invWidthScale = float(`+y+`);

        const int winHeight = int(`+b+`);
        const int winWidth = int(`+w+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float sourceFracRow =
              float(`+f[0]+`) *
                (float(dyR) / float(`+d[0]+`));

            float sourceFracCol =
                float(`+f[1]+`) *
                  (float(dyC) / float(`+d[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+e+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+e+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},i_=function(n,t,e,r){this.variableNames=["A"],this.outputShape=[];var o=n[0],i=n[1],s=n[2],u=n[3];this.outputShape=[o,t,e,u];var c=[r&&t>1?i-1:i,r&&e>1?s-1:s],f=[r&&t>1?t-1:t,r&&e>1?e-1:e],d=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/f[0]+`,
          `+c[1]/f[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+d+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},a_=function(n,t){this.variableNames=["x"];var e=n.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=n,e!==1){var r=n.map(function(i,s){return function(u){return t.indexOf(u)!==-1&&n[u]!==1?n[u]+" - coords["+u+"] - 1":"coords["+u+"]"}(s)}).join(","),o=ot(e);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},s_=function(n,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=n.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=n;var r=hn("rc",e),o=r[e-1]+" + 1 < "+this.outputShape[e-1],i=r[e-2]+" + 1 < "+this.outputShape[e-2],s=ot(e);function u(c){var f=n.map(function(d,p){return function(v,g){return t.indexOf(v)!==-1&&n[v]!==1?n[v]+" - "+g[v]+" - 1":""+g[v]}(p,c)});return"getChannel(getX("+f.join(",")+"), vec2("+f.slice(-2).join(",")+"))"}this.userCode=e===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+o+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+s+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(c){return u(c)}(r.slice())+`;
          if(`+o+`){
            result.g = `+function(c){return c[e-1]="("+c[e-1]+" + 1)",u(c)}(r.slice())+`;
          }
          if(`+i+`) {
            result.b = `+function(c){return c[e-2]="("+c[e-2]+" + 1)",u(c)}(r.slice())+`;
            if(`+o+`) {
              result.a = `+function(c){return c[e-1]="("+c[e-1]+" + 1)",c[e-2]="("+c[e-2]+" + 1)",u(c)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},Dg=function(n,t,e,r,o,i,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var u=ot(o.length),c=ot(i.length),f="";e===1?f="i":e===2&&(f="i, j");var d="getIndices("+f+")",p="";r===1?p="i":r===2&&(p="i, coords[1]");var v="getUpdates("+p+")",g=t>1?"strides[j]":"strides";this.userCode=`
        `+u+" strides = "+u+"("+o+`);

        void main() {
          `+c+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+d+`);
              flattenedIndex += index * `+g+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+v+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},u_=function(n,t){this.variableNames=["x","segmentIds"];var e=n.windowSize,r=n.batchSize,o=n.inSize,i=n.numSegments,s=i*Math.ceil(o/e);this.outputShape=[r,s];var u=4*Math.floor(e/4),c=e%4,f=`
        sumValue += dot(values, segFilter);
    `,d="";o%e>0&&(d=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var p="";o%e>0&&(p=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+p+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+e+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+u+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+f+`
        }

        int inIdx = inOffset + `+u+`;
        if (`+(c===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+f+`
        } else if (`+(c===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+f+`
        } else if (`+(c===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+f+`
        }
        setOutput(sumValue);
      }
    `},l_=function(n,t,e){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,e>4)throw Error("Where for rank "+e+" is not yet supported");if(e===1)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<t.length;c++)u.push(""+i[c]),c<n&&s.push(""+i[c]);r=s.join(),o=u.join()}var f=ot(e);this.userCode=`
      void main() {
        `+f+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `},c_=function(){function n(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,r=ot(this.rank),o="uniform int start["+this.rank+"];",i=function(s){if(s===1)return"sourceLoc";if(s<=6)return ld.slice(0,s).map(function(u){return"sourceLoc."+u}).join(",");throw Error("Slicing for rank "+s+" is not yet supported")}(this.rank);e=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+t.map(function(s,u){return"sourceLoc."+ld[u]+" = start["+u+"] + coords."+ld[u]+";"}).join(`
`)+`
      `,this.userCode=`
      `+o+`
      void main() {
        `+e+`
        setOutput(getSource(`+i+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){e.startLoc==null&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),e.startLoc==null)||r.gl.uniform1iv(e.startLoc,t)}},n}(),ld=["x","y","z","w","u","v"],f_=function(){function n(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=ot(this.rank),r=hn("coords",this.rank),o=hn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+o.slice(-2).join()+")",s="getChannel(getSource("+o.join()+"), "+i+")",u=`
      result.x = `+s+`;
      if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
        ++`+o[this.rank-1]+`;
        result.y = `+s+`;
        --`+o[this.rank-1]+`;
      }
    `,c=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+t[this.rank-2]+`) {
        ++`+o[this.rank-2]+`;
        result.z = `+s+`;
        if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
          ++`+o[this.rank-1]+`;
          result.w = `+s+`;
        }
      }
    `,f=this.rank<=4?`sourceLoc = coords +
            `+e+"("+t.map(function(d,p){return"start["+p+"]"}).join()+");":t.map(function(d,p){return o[p]+" = "+r[p]+" + start["+p+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+e+` coords = getOutputCoords();
        `+e+` sourceLoc;
        `+f+`
        vec4 result = vec4(0.);
        `+u+`
        `+c+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){e.startLoc==null&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),e.startLoc==null)||r.gl.uniform1iv(e.startLoc,t)}},n}(),d_=function(n,t,e){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=ot(e.length),i=ot(e.length),s="";if(r===1)s="coords * strides + begin";else{var u=0;s=e.map(function(c,f){return u++,e.length===1?"coords * strides["+f+"] + begin["+f+"]":"coords["+(u-1)+"] * strides["+f+"] + begin["+f+"]"}).join(",")}this.userCode=`
      `+o+" begin = "+o+"("+n+`);
      `+o+" strides = "+o+"("+t+`);

      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+s+`));
      }
    `},h_=function(){function n(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(t,e,r){var o,i=Ag(e,r),s=Pg(t,i,r);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var u=this.freeTextures[s].shift();return this.usedTextures[s].push(u),u}return this.numUsedTextures++,this.log(),i===kn.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===kn.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===kn.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===kn.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===kn.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[s].push(o),o},n.prototype.releaseTexture=function(t,e,r,o){if(this.freeTextures!=null){var i=Pg(e,Ag(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(t),this.numFreeTextures++,this.numUsedTextures--;var s=this.usedTextures[i],u=s.indexOf(t);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");s.splice(u,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(o){t.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function Ag(n,t){if(n===Rn.UPLOAD)return kn.PACKED_2X2_FLOAT32;if(n===Rn.RENDER||n==null)return function(e){return ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?kn.PACKED_2X2_FLOAT32:kn.UNPACKED_FLOAT32:e?kn.PACKED_2X2_FLOAT16:kn.UNPACKED_FLOAT16}(t);if(n===Rn.DOWNLOAD||n===Rn.PIXELS)return kn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function Pg(n,t,e){return n[0]+"_"+n[1]+"_"+t+"_"+e}var p_=function(n,t){this.variableNames=["A"];for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[r]*t[r];this.outputShape=e,this.rank=e.length;var o=ot(this.rank),i=function(s){var u=s.length;if(u>5)throw Error("Tile for rank "+u+" is not yet supported");if(u===1)return"imod(resRC, "+s[0]+")";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],f=[],d=0;d<s.length;d++)f.push("imod("+c[d]+", "+s[d]+")");return f.join()}(n);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},v_=function(n,t){this.variableNames=["A"];for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[t[r]];this.outputShape=e,this.rank=e.length;var o=ot(this.rank),i=function(s){var u=s.length;if(u>6)throw Error("Transpose for rank "+u+" is not yet supported");for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],f=new Array(u),d=0;d<s.length;d++)f[s[d]]=c[d];return f.join()}(t);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `},m_=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[t[r]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=ot(this.rank),i=g0("rc",this.rank),s=new Array(this.rank);for(r=0;r<t.length;r++)s[t[r]]=i[r];var u="vec2("+s.slice(-2).join()+")",c="++"+i[this.rank-1]+" < "+e[this.rank-1],f="getChannel(getA("+s.join()+"), "+u+")";this.userCode=`
    void main() {
      `+o+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+f+`;
      if(`+c+`) {
        result[1] = `+f+`;
      }
      --`+i[this.rank-1]+`;
      if(++`+i[this.rank-2]+" < "+e[this.rank-2]+`) {
        result[2] = `+f+`;
        if(`+c+`) {
          result[3] = `+f+`;
        }
      }
      setOutput(result);
    }
    `},gh=1.7580993408473768,yh=1.0507009873554805,ze=function(n,t){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},rr="if (isnan(x)) return x;",g_="return x;",Fg="return abs(x);",C0=rr+`
  return (x < 0.0) ? 0.0 : x;
`,E0=rr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,_0="return (x >= 0.0) ? x : (exp(x) - 1.0);",y_=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+gh+`;
  float scale = `+yh+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Og="return -x;",Mg="return ceil(x);",Lg="return floor(x);",Bg="return exp(x);",Wg="return exp(x) - 1.0;",x_=rr+`
  return sin(x);
`,w_=rr+`
  return cos(x);
`,b_=rr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,C_=rr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,E_=rr+`
  return atan(x);
`,__=rr+"return log(x + sqrt(x * x + 1.0));",S_=rr+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,k_=rr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Wu="return x;",R_="return x;",S0=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,k0=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,R0=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,$a=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},I_=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var t=n.length,e=hn("rc",t),r=ot(t),o=function(u,c){if(u===1)return"rc";for(var f="",d=0;d<u;d++)f+=c[d],d<u-1&&(f+=",");return f}(t,e),i=e.slice(-2),s=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+s+`));
      }
    `},zu={};function Uu(n,t){if(t===void 0&&(t=!1),n==="linear")return t?R_:g_;if(n==="relu")return t?S0:C0;if(n==="elu")return t?R0:_0;if(n==="relu6")return t?k0:E0;if(n==="prelu")return t?b0:w0;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var N_=600,T_=function(n){function t(e){var r,o=n.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!ae().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){var i=Er(ae().getNumber("WEBGL_VERSION"));o.binaryCache=((r=ae().getNumber("WEBGL_VERSION"))in zu||(zu[r]={}),zu[r]),o.gpgpu=new UE(i),o.canvas=i.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=e,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=e.gl.canvas;return o.textureManager=new h_(o.gpgpu),o.numMBBeforeWarning=ae().global.screen==null?1024:ae().global.screen.height*ae().global.screen.width*window.devicePixelRatio*N_/1024/1024,o.texData=new u0(o,j),o}return nr(t,n),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,r,o){if(ae().getBool("DEBUG")&&this.checkNumericalProblems(e),o==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:r,dtype:o,values:e,usage:Rn.UPLOAD}),i},t.prototype.move=function(e,r,o,i){if(ae().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:i,values:r,usage:Rn.UPLOAD})},t.prototype.readSync=function(e){var r=this.texData.get(e),o=r.values,i=r.dtype,s=r.complexTensors,u=r.slice,c=r.shape,f=r.isPacked;if(u!=null){var d=void 0;d=f?new $a(c,Wu):new ze(c,Wu);var p=this.runWebGLProgram(d,[{dataId:e,shape:c,dtype:i}],i),v=this.readSync(p.dataId);return this.disposeData(p.dataId),v}if(o!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return o;var g,y,b=this.activeTimers!=null;return b&&(g=pr()),i==="complex64"?y=Wd(s.real.dataSync(),s.imag.dataSync()):y=this.getValuesFromTexture(e),b&&(this.downloadWaitMs+=pr()-g),this.convertAndCacheOnCPU(e,y)},t.prototype.read=function(e){return Ee(this,void 0,void 0,function(){var r,o,i,s,u,c,f,d,p,v,g,y,b,w,C,_,S,k,R,N,P,F;return _e(this,function(D){switch(D.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function(A){return r.push(A)})];if(o=this.texData.get(e),i=o.values,s=o.shape,u=o.slice,c=o.dtype,f=o.complexTensors,d=o.isPacked,u!=null)return p=void 0,p=d?new $a(s,Wu):new ze(s,Wu),v=this.runWebGLProgram(p,[{dataId:e,shape:s,dtype:c}],c),g=this.read(v.dataId),this.disposeData(v.dataId),[2,g];if(i!=null)return[2,this.convertAndCacheOnCPU(e)];if(!ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ae().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return y=null,c!=="complex64"&&ae().get("WEBGL_BUFFER_SUPPORTED")&&(b=this.decode(e),w=this.texData.get(b.dataId),y=(F=this.gpgpu).createBufferFromTexture.apply(F,[w.texture].concat(Qa(s)))),this.pendingRead.set(e,[]),c==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:D.sent(),D.label=2;case 2:return c!=="complex64"?[3,4]:[4,Promise.all([f.real.data(),f.imag.data()])];case 3:return _=D.sent(),S=_[0],k=_[1],C=Wd(S,k),[3,5];case 4:y==null?C=this.getValuesFromTexture(e):(R=Re(s),C=this.gpgpu.downloadFloat32MatrixFromBuffer(y,R)),D.label=5;case 5:return b!=null&&this.disposeData(b.dataId),N=this.convertAndCacheOnCPU(e,C),P=this.pendingRead.get(e),this.pendingRead.delete(e),P.forEach(function(A){return A(N)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,N]}})})},t.prototype.checkNumericalProblems=function(e){if(e!=null)for(var r=0;r<e.length;r++){var o=e[r];if(!yb(o))throw ae().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(e){var r,o=this.texData.get(e),i=o.shape,s=o.dtype,u=o.isPacked,c=Re(i);if(ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var f=this.decode(e),d=this.texData.get(f.dataId),p=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[d.texture].concat(Qa(i))).subarray(0,c);return this.disposeData(f.dataId),p}var v=ae().getBool("WEBGL_PACK")&&u===!0,g=v?nd(i):i,y=v?new gE(g):new mE(g),b=this.runWebGLProgram(y,[{shape:g,dtype:s,dataId:e}],"float32"),w=this.texData.get(b.dataId),C=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(w.texture,w.texShape[0],w.texShape[1]).subarray(0,c);return this.disposeData(b.dataId),C},t.prototype.time=function(e){return Ee(this,void 0,void 0,function(){var r,o,i,s,u,c,f;return _e(this,function(d){switch(d.label){case 0:return r=this.activeTimers,o=[],i=!1,this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e(),s=Qi(this.activeTimers.map(function(p){return p.query})).filter(function(p){return p!=null}),u=Qi(this.activeTimers.map(function(p){return p.name})).filter(function(p){return p!=null}),this.activeTimers=r,i&&(this.programTimersStack=null),c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return f=d.sent(),c.kernelMs=J2(f),c.getExtraProfileInfo=function(){return f.map(function(p,v){return{name:u[v],ms:p}}).map(function(p){return p.name+": "+p.ms}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},d.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:pr(),endMs:null}},t.prototype.endTimer=function(e){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=pr(),e)},t.prototype.getQueryTime=function(e){return Ee(this,void 0,void 0,function(){var r;return _e(this,function(o){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(r=e).endMs-r.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var r=this.texData.get(e).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var r=this.texData.get(e),o=r.texture,i=r.dtype,s=r.texShape,u=r.usage,c=r.isPacked,f=r.slice,d=f&&f.origDataId||e,p=this.dataRefCount.get(d);p>1?this.dataRefCount.set(d,p-1):(this.dataRefCount.delete(d),o!=null&&(this.numBytesInGPU-=this.computeBytes(s,i),this.textureManager.releaseTexture(o,s,u,c)));var v=this.texData.get(e);v.texture=null,v.texShape=null,v.isPacked=!1,v.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return ae().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=j.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,r){var o=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&e.every(function(i){return o.texData.get(i.dataId).texture==null&&i.size<r})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,r){var o=this.makeOutput(e.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:j.keep(e.clone()),imag:j.keep(r.clone())},o},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,r,o){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,r,o);if(Re(o)===0)return Vt([],o,e.dtype);var i=this.texData.get(e.dataId).isPacked,s=a0(e.shape,r,o);if(i||!s){var u=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new f_(o):new c_(o),c=u.getCustomSetupFunc(r);return this.compileAndRun(u,[e],null,c)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,r,o)},t.prototype.shallowSlice=function(e,r,o){var i=this.texData.get(e.dataId),s=this.makeOutput(o,e.dtype),u=this.texData.get(s.dataId);Object.assign(u,i),u.shape=o,u.dtype=e.dtype;var c=s0(r,e.strides);i.slice&&(c+=i.slice.flatOffset),u.slice={flatOffset:c,origDataId:i.slice&&i.slice.origDataId||e.dataId};var f=this.dataRefCount.get(u.slice.origDataId)||1;return this.dataRefCount.set(u.slice.origDataId,f+1),s},t.prototype.stridedSlice=function(e,r,o,i){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,r,o,i);var s=fh(r,o,i);if(s.some(function(c){return c===0}))return Vt([],s);var u=new d_(r,i,s);return this.compileAndRun(u,[e])},t.prototype.reverse=function(e,r){var o=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new s_(e.shape,r):new a_(e.shape,r);return this.compileAndRun(o,[e])},t.prototype.concat=function(e,r){if(e[0].dtype==="complex64"){var o=e.map(function(g){return Vn(g)}),i=e.map(function(g){return mr(g)});return zt(this.concat(o,r),this.concat(i,r))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,r);if(e.length===1)return e[0];if(e.length>ae().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var s=Math.floor(e.length/2),u=this.concat(e.slice(0,s),r),c=this.concat(e.slice(s),r);return this.concat([u,c],r)}if(ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var f=new nE(e.map(function(g){return g.shape}),r);return this.compileAndRun(f,e)}var d=Zi(e.map(function(g){return g.shape}),r),p=e.map(function(g){return g.as2D(-1,Re(g.shape.slice(r)))}),v=new tE(p.map(function(g){return g.shape}));return this.compileAndRun(v,p).reshape(d)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Og,e.dtype);var r=new ze(e.shape,Og);return this.compileAndRun(r,[e])},t.prototype.batchMatMul=function(e,r,o,i){var s=o?e.shape[2]:e.shape[1],u=i?r.shape[1]:r.shape[2],c=o?e.shape[1]:e.shape[2],f=e.shape[0];if((s===1||u===1)&&c>1e3){o&&(e=e.transpose([0,2,1])),i&&(r=r.transpose([0,2,1]));var d=u===1?e:e.as3D(f,c,1),p=u===1?2:1,v=u===1?r.as3D(f,1,c):r;return this.multiply(d,v).sum(p,!0)}var g=Ut(e.dtype,r.dtype),y=new ad(e.shape,[f,s,u],o,i);return this.compileAndRun(y,[e,r],g)},t.prototype.fusedBatchMatMul=function(e){var r=e.a,o=e.b,i=e.transposeA,s=e.transposeB,u=e.bias,c=e.activation,f=e.preluActivationWeights,d=i?r.shape[2]:r.shape[1],p=s?o.shape[1]:o.shape[2],v=r.shape[0],g=Ut(r.dtype,o.dtype),y=u!=null,b=f!=null,w=c?Uu(c,!0):null,C=new ad(r.shape,[v,d,p],i,s,y,w,b),_=[r,o];return u&&_.push(u),f&&_.push(f),this.compileAndRun(C,_,g)},t.prototype.multiply=function(e,r){if(e.dtype==="complex64"){var o=this.texData.get(e.dataId),i=this.texData.get(r.dataId),s=new Eg(YC,e.shape,r.shape),u=new Eg(QC,e.shape,r.shape),c=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,i.complexTensors.real),this.makeComplexComponentTensorInfo(r,i.complexTensors.imag)],f=this.compileAndRun(s,c),d=this.compileAndRun(u,c),p=this.complex(f,d);return f.dispose(),d.dispose(),p}if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.multiply(e,r);if(ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,_g,e.dtype);var v=new mt(_g,e.shape,r.shape);return this.compileAndRun(v,[e,r],e.dtype)},t.prototype.batchNormalization=function(e,r,o,i,s,u){var c=[e,r,o],f=null;u!=null&&(f=u.shape,c.push(u));var d=null;if(s!=null&&(d=s.shape,c.push(s)),ae().getBool("WEBGL_PACK_NORMALIZATION")){var p=new XC(e.shape,r.shape,o.shape,f,d,i);return this.compileAndRun(p,c)}var v=new $C(e.shape,r.shape,o.shape,f,d,i);return this.compileAndRun(v,c)},t.prototype.localResponseNormalization4D=function(e,r,o,i,s){var u=ae().getBool("WEBGL_PACK_NORMALIZATION")?new GE(e.shape,r,o,i,s):new jE(e.shape,r,o,i,s);return this.compileAndRun(u,[e])},t.prototype.LRNGrad=function(e,r,o,i,s,u,c){var f=new HE(r.shape,i,s,u,c);return this.compileAndRun(f,[r,o,e])},t.prototype.tile=function(e,r){if(e.dtype==="string"){var o=this.readSync(e.dataId).map(function(s){return rl(s)});return v0(Be(e.shape,e.dtype,o),r)}var i=new p_(e.shape,r);return this.compileAndRun(i,[e])},t.prototype.pad=function(e,r,o){var i=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new JE(e.shape,r,o):new QE(e.shape,r,o);return this.compileAndRun(i,[e])},t.prototype.transpose=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,r);var o=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new m_(e.shape,r):new v_(e.shape,r);return this.compileAndRun(o,[e])},t.prototype.gather=function(e,r,o){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.gather(e,r,o);var i=new EE(e.shape,r.size,o);return this.compileAndRun(i,[e,r])},t.prototype.batchToSpaceND=function(e,r,o){O(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(p,v){return p*v}),s=ll(e.shape,r,i),u=cl(s.length,r.length),c=fl(e.shape,r,i),f=n0(o,r.length),d=r0(c,o,r.length);return e.reshape(s).transpose(u).reshape(c).slice(f,d)},t.prototype.spaceToBatchND=function(e,r,o){O(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(v,g){return v*g}),s=[[0,0]];s.push.apply(s,o);for(var u=1+r.length;u<e.shape.length;++u)s.push([0,0]);var c=e.pad(s),f=ll(c.shape,r,i,!1),d=cl(f.length,r.length,!1),p=fl(c.shape,r,i,!1);return c.reshape(f).transpose(d).reshape(p)},t.prototype.reduce=function(e,r,o){var i=e.shape[0],s=e.shape[1],u=rd(s),c=new ZE({windowSize:u,inSize:s,batchSize:i},r),f=this.compileAndRun(c,[e],o);return f.shape[1]===1?f:this.reduce(f,r,o)},t.prototype.argReduce=function(e,r,o){o===void 0&&(o=null);var i=e.shape[0],s=e.shape[1];o!=null&&(i=o.shape[0],s=o.shape[1]);var u=rd(s),c=new WC({windowSize:u,inSize:s,batchSize:i},r,o==null),f=[e];o!=null&&f.push(o);var d=this.compileAndRun(c,f,"int32");return d.shape[1]===1?d:this.argReduce(e,r,d)},t.prototype.argReducePacked=function(e,r,o){o===void 0&&(o=null);var i=o!=null?o.shape:e.shape,s=rd(i[i.length-1]),u=new GC(i,s,r,o==null),c=o==null?[e]:[e,o],f=this.compileAndRun(u,c,"int32");return f.rank===e.rank?this.argReducePacked(e,r,f):f},t.prototype.sum=function(e,r){Sn("sum",r,e.rank);var o=$t(e.shape,r),i=o[0],s=Re(o[1]),u=e.as2D(-1,s),c=Xf(e.dtype);return this.reduce(u,"sum",c).reshape(i)},t.prototype.prod=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,r);var o=$t(e.shape,r),i=o[0],s=Re(o[1]),u=e.as2D(-1,s),c=Xf(e.dtype);return this.reduce(u,"prod",c).reshape(i)},t.prototype.unsortedSegmentSum=function(e,r,o){var i=0,s=_r([i],e.rank),u=e;s!=null&&(u=e.transpose(s),i=Sr(1,e.rank)[0]);var c=function(g,y,b){for(var w=[],C=g.length,_=0;_<C;_++)_!==y?w.push(g[_]):w.push(b);return w}(u.shape,i,o),f=Re([u.shape[i]]),d=u.as2D(-1,f),p=Xf(e.dtype),v=this.segOpCompute(d,"unsortedSegmentSum",r,p,o).reshape(c);return s!=null&&(v=v.transpose(sh(s))),v},t.prototype.segOpCompute=function(e,r,o,i,s){var u=e.shape[0],c=e.shape[1],f=function(v,g){var y,b=!1;for(v<=i0?(y=v,b=!0):y=Td(v,Math.floor(Math.sqrt(v)));!b;)y>g||y===v?b=!0:y=Td(v,y+1);return y}(c,s),d=new u_({windowSize:f,inSize:c,batchSize:u,numSegments:s}),p=this.compileAndRun(d,[e,o],i);return p.shape[1]===s?p:(o=ul(0,s).tile([c/f]),this.segOpCompute(p,r,o,i,s))},t.prototype.argMinMaxReduce=function(e,r,o){var i=[r];if(Sn("arg"+o.charAt(0).toUpperCase()+o.slice(1),i,e.rank),!ae().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var s=$t(e.shape,i),u=s[0],c=Re(s[1]),f=e.as2D(-1,c);return this.argReduce(f,o).reshape(u)}return this.argReducePacked(e,o)},t.prototype.argMin=function(e,r){return this.argMinMaxReduce(e,r,"min")},t.prototype.argMax=function(e,r){return this.argMinMaxReduce(e,r,"max")},t.prototype.cumsum=function(e,r,o,i){if(r!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+r);var s=new fE(e.shape,o,i);return this.compileAndRun(s,[e])},t.prototype.equal=function(e,r){if(ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(equal(a, b));
`,"bool");var o=new mt("return float(a == b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.notEqual=function(e,r){if(ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(notEqual(a, b));
`,"bool");var o=new mt("return float(a != b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.less=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.less(e,r);if(ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(lessThan(a, b));
`,"bool");var o=new mt("return float(a < b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.lessEqual=function(e,r){if(ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var o=new mt("return float(a <= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.greater=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.greater(e,r);if(ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(greaterThan(a, b));
`,"bool");var o=new mt("return float(a > b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.greaterEqual=function(e,r){if(ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var o=new mt("return float(a >= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.logicalNot=function(e){var r=new ze(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[e])},t.prototype.logicalAnd=function(e,r){if(ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var o=new mt("return float(a >= 1.0 && b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.logicalOr=function(e,r){if(ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var o=new mt("return float(a >= 1.0 || b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.select=function(e,r,o){var i=new l_(e.rank,r.shape,r.rank);return this.compileAndRun(i,[e,r,o],Ut(r.dtype,o.dtype))},t.prototype.where=function(e){al("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=e.dataSync();return vh(e.shape,r)},t.prototype.topk=function(e,r,o){return m0(e.dataSync(),e.shape,e.dtype,r)},t.prototype.min=function(e,r){Sn("min",r,e.rank);var o=$t(e.shape,r),i=o[0],s=Re(o[1]),u=e.as2D(-1,s);return this.reduce(u,"min",u.dtype).reshape(i)},t.prototype.minimum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.minimum(e,r);var o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Br(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new mt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.mod=function(e,r){var o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Br(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new mt(`if (b == 0.0) return NAN;
  return mod(a, b);`,e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.max=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,r);Sn("max",r,e.rank);var o=$t(e.shape,r),i=o[0],s=Re(o[1]),u=e.as2D(-1,s);return this.reduce(u,"max",u.dtype).reshape(i)},t.prototype.maximum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.maximum(e,r);var o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Br(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new mt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.all=function(e,r){Sn("all",r,e.rank);var o=$t(e.shape,r),i=o[0],s=Re(o[1]),u=e.as2D(-1,s);return this.reduce(u,"all",u.dtype).reshape(i)},t.prototype.any=function(e,r){Sn("any",r,e.rank);var o=$t(e.shape,r),i=o[0],s=Re(o[1]),u=e.as2D(-1,s);return this.reduce(u,"any",u.dtype).reshape(i)},t.prototype.realDivide=function(e,r){if(ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var o=new mt(`
if (a == b) {
  return 1.0;
};
return a / b;`,e.shape,r.shape);return this.compileAndRun(o,[e,r],"float32")},t.prototype.floorDiv=function(e,r){if(ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var o=new mt(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,e.shape,r.shape);return this.compileAndRun(o,[e,r],"int32")},t.prototype.add=function(e,r){if(e.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(e,r,od);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.add(e,r);var o=Ut(e.dtype,r.dtype);if(ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,od,o);var i=new mt(od,e.shape,r.shape);return this.compileAndRun(i,[e,r],o)},t.prototype.packedUnaryOp=function(e,r,o){var i=new $a(e.shape,r);return this.compileAndRun(i,[e],o)},t.prototype.packedBinaryOp=function(e,r,o,i,s){s===void 0&&(s=!1);var u=new Br(o,e.shape,r.shape,s);return this.compileAndRun(u,[e,r],i)},t.prototype.complexSeparableBinaryOp=function(e,r,o){var i=this,s=this.texData.get(e.dataId),u=this.texData.get(r.dataId),c=[[s.complexTensors.real,u.complexTensors.real],[s.complexTensors.imag,u.complexTensors.imag]].map(function(v){var g=v[0],y=v[1],b=i.makeComplexComponentTensorInfo(e,g),w=i.makeComplexComponentTensorInfo(r,y),C=new mt(o,e.shape,r.shape);return i.compileAndRun(C,[b,w],Ut(g.dtype,y.dtype))}),f=c[0],d=c[1],p=this.complex(f,d);return f.dispose(),d.dispose(),p},t.prototype.makeComplexComponentTensorInfo=function(e,r){return{dataId:r.dataId,dtype:r.dtype,shape:e.shape}},t.prototype.addN=function(e){if(e.length===1)return e[0];if(e.length>ae().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),o=this.addN(e.slice(0,r)),i=this.addN(e.slice(r));return this.addN([o,i])}var s=e.map(function(f){return f.dtype}).reduce(function(f,d){return Ut(f,d)}),u=e.map(function(f){return f.shape}),c=ae().getBool("WEBGL_PACK")?new BC(e[0].shape,u):new LC(e[0].shape,u);return this.compileAndRun(c,e,s)},t.prototype.subtract=function(e,r){if(e.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(e,r,id);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.subtract(e,r);var o=Ut(e.dtype,r.dtype);if(ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,id,e.dtype);var i=new mt(id,e.shape,r.shape);return this.compileAndRun(i,[e,r],o)},t.prototype.pow=function(e,r){var o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Br(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new mt(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,e.shape,r.shape),i=Ut(e.dtype,r.dtype);return this.compileAndRun(o,[e,r],i)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Mg,e.dtype);var r=new ze(e.shape,Mg);return this.compileAndRun(r,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Lg,e.dtype);var r=new ze(e.shape,Lg);return this.compileAndRun(r,[e])},t.prototype.sign=function(e){var r=new ze(e.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[e])},t.prototype.isNaN=function(e){var r=new ze(e.shape,"return float(isnan(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.isInf=function(e){var r=new ze(e.shape,"return float(isinf(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.isFinite=function(e){var r=new ze(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.round=function(e){var r=new ze(e.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Bg,e.dtype);var r=new ze(e.shape,Bg);return this.compileAndRun(r,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Wg,e.dtype);var r=new ze(e.shape,Wg);return this.compileAndRun(r,[e])},t.prototype.softmax=function(e,r){var o=Tt([r],e.shape),i=this.max(e,o),s=yn(i.shape,o),u=this.subtract(e,i.reshape(s)),c=this.exp(u),f=this.sum(c,o).reshape(s);return this.realDivide(c,f)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,e.dtype);var r=new ze(e.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[e])},t.prototype.log1p=function(e){var r=new ze(e.shape,"return log(1.0 + x);");return this.compileAndRun(r,[e])},t.prototype.sqrt=function(e){var r=new ze(e.shape,"return sqrt(x);");return this.compileAndRun(r,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var r=new ze(e.shape,"return inversesqrt(x);");return this.compileAndRun(r,[e])},t.prototype.reciprocal=function(e){var r=new ze(e.shape,"return 1.0 / x;");return this.compileAndRun(r,[e])},t.prototype.relu=function(e){var r;return r=ae().getBool("WEBGL_PACK")?new $a(e.shape,S0):new ze(e.shape,C0),this.compileAndRun(r,[e])},t.prototype.relu6=function(e){var r;return r=ae().getBool("WEBGL_PACK")?new $a(e.shape,k0):new ze(e.shape,E0),this.compileAndRun(r,[e])},t.prototype.prelu=function(e,r){var o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Br(b0,e.shape,r.shape):new mt(w0,e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.elu=function(e){if(ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,R0,e.dtype);var r=new ze(e.shape,_0);return this.compileAndRun(r,[e])},t.prototype.eluDer=function(e,r){var o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Br(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,e.shape,r.shape):new mt("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.selu=function(e){var r=new ze(e.shape,y_);return this.compileAndRun(r,[e])},t.prototype.int=function(e){var r=new ze(e.shape,"return float(int(x));");return this.compileAndRun(r,[e],"int32")},t.prototype.clip=function(e,r,o){var i,s=(i=ae().getBool("WEBGL_PACK_CLIP")?new ZC(e.shape):new JC(e.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(i,[e],null,s)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Fg,e.dtype);var r=new ze(e.shape,Fg);return this.compileAndRun(r,[e])},t.prototype.complexAbs=function(e){var r=this.texData.get(e.dataId),o=new eE(e.shape),i=[this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)];return this.compileAndRun(o,i)},t.prototype.sigmoid=function(e){var r=new ze(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[e])},t.prototype.softplus=function(e){var r=new ze(e.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[e])},t.prototype.sin=function(e){var r=new ze(e.shape,x_);return this.compileAndRun(r,[e])},t.prototype.cos=function(e){var r=new ze(e.shape,w_);return this.compileAndRun(r,[e])},t.prototype.tan=function(e){var r=new ze(e.shape,"return tan(x);");return this.compileAndRun(r,[e])},t.prototype.asin=function(e){var r=new ze(e.shape,b_);return this.compileAndRun(r,[e])},t.prototype.acos=function(e){var r=new ze(e.shape,C_);return this.compileAndRun(r,[e])},t.prototype.atan=function(e){var r=new ze(e.shape,E_);return this.compileAndRun(r,[e])},t.prototype.atan2=function(e,r){var o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Br(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new mt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.sinh=function(e){var r=new ze(e.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[e])},t.prototype.cosh=function(e){var r=new ze(e.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[e])},t.prototype.tanh=function(e){var r=new ze(e.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[e])},t.prototype.asinh=function(e){var r=new ze(e.shape,__);return this.compileAndRun(r,[e])},t.prototype.acosh=function(e){var r=new ze(e.shape,S_);return this.compileAndRun(r,[e])},t.prototype.atanh=function(e){var r=new ze(e.shape,k_);return this.compileAndRun(r,[e])},t.prototype.erf=function(e){var r=new ze(e.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[e])},t.prototype.step=function(e,r){var o=new ze(e.shape,function(i){return i===void 0&&(i=0),rr+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `}(r));return this.compileAndRun(o,[e])},t.prototype.conv2dByMatMul=function(e,r,o,i,s,u){var c=e.shape,f=this.texData.get(e.dataId),d=o.inChannels,p=c[0]*c[1]*c[2],v=o.outChannels,g=o.dataFormat==="channelsLast",y=(p===1||v===1)&&d>1e3,b=c[2]%2!=0&&!!f.isPacked;if(y||!ae().getBool("WEBGL_LAZILY_UNPACK")||!ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!b){var w=g?c[0]*c[1]*c[2]:c[0]*c[2]*c[3],C=this.reshape(e,[1,w,o.inChannels]),_=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:C,b:_,transposeA:!1,transposeB:!1,bias:i,activation:s,preluActivationWeights:u}),o.outShape)}var S=g?c[0]*c[1]*(c[2]+1):c[0]*c[2]*(c[3]+1),k={dataId:e.dataId,shape:[1,S,o.inChannels],dtype:e.dtype},R=f.shape;f.shape=f.shape.slice(),f.shape[f.shape.length-2]++,O(Lu(f.shape,k.shape),function(){return"packed reshape "+f.shape+" to "+k.shape+" isn't free"});var N=this.reshape(r,[1,o.inChannels,o.outChannels]),P=this.fusedBatchMatMul({a:k,b:N,transposeA:!1,transposeB:!1,bias:i,activation:s,preluActivationWeights:u}),F=this.texData.get(P.dataId);return O(F.isPacked,function(){return"batchMatMul result is expected to be packed"}),f.shape=R,F.shape=o.outShape,j.makeTensorFromDataId(P.dataId,o.outShape,P.dtype)},t.prototype.conv2dWithIm2Row=function(e,r,o,i,s,u){var c=o.filterWidth,f=o.filterHeight,d=o.inChannels,p=o.outWidth,v=o.outHeight,g=o.dataFormat==="channelsLast",y=c*f*d,b=v*p,w=[y,b],C=e.squeeze([0]),_=r.reshape([1,y,-1]),S=new VE(w,C.shape,o),k=this.compileAndRun(S,[C]).reshape([1,w[0],w[1]]),R=i!=null,N=u!=null,P=s?Uu(s,!0):null,F=new ad(k.shape,[1,b,o.outChannels],!0,!1,R,P,N),D=[k,_];i&&D.push(i),N&&D.push(u);var A=this.compileAndRun(F,D);return g?A.reshape([1,v,p,o.outChannels]):A.reshape([1,o.outChannels,v,p])},t.prototype.fusedConv2d=function(e){var r=e.input,o=e.filter,i=e.convInfo,s=e.bias,u=e.activation,c=e.preluActivationWeights;if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(r,o,i,s,u,c);if(ae().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,o,i,s,u,c);var f=s!=null,d=c!=null,p=u?Uu(u,!1):null,v=new Sg(i,f,p,d),g=[r,o];return s&&g.push(s),c&&g.push(c),this.compileAndRun(v,g)},t.prototype.conv2d=function(e,r,o){if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(e,r,o);if(ae().getBool("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,r,o);var i=new Sg(o);return this.compileAndRun(i,[e,r])},t.prototype.conv2dDerInput=function(e,r,o){var i=new oE(o);return this.compileAndRun(i,[e,r])},t.prototype.conv2dDerFilter=function(e,r,o){var i=new rE(o);return this.compileAndRun(i,[e,r])},t.prototype.fusedDepthwiseConv2D=function(e){var r,o=e.input,i=e.filter,s=e.convInfo,u=e.bias,c=e.activation,f=e.preluActivationWeights,d=ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1,p=c?Uu(c,d):null,v=[o,i],g=u!=null,y=f!=null;return g&&v.push(u),y&&v.push(f),d?(r=new Rg(s,g,p,y),this.compileAndRun(r,v)):(r=new kg(s,g,p,y),this.compileAndRun(r,v))},t.prototype.depthwiseConv2D=function(e,r,o){var i;return ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(i=new Rg(o),this.compileAndRun(i,[e,r])):(i=new kg(o),this.compileAndRun(i,[e,r]))},t.prototype.depthwiseConv2DDerInput=function(e,r,o){var i=new uE(o);return this.compileAndRun(i,[e,r])},t.prototype.depthwiseConv2DDerFilter=function(e,r,o){var i=new sE(o);return this.compileAndRun(i,[e,r])},t.prototype.conv3d=function(e,r,o){var i=new lE(o);return this.compileAndRun(i,[e,r])},t.prototype.conv3dDerInput=function(e,r,o){var i=new aE(o);return this.compileAndRun(i,[e,r])},t.prototype.conv3dDerFilter=function(e,r,o){var i=new iE(o);return this.compileAndRun(i,[e,r])},t.prototype.maxPool=function(e,r){var o=new sd(r,"max",!1);return this.compileAndRun(o,[e])},t.prototype.avgPool=function(e,r){var o=new sd(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},t.prototype.maxPoolBackprop=function(e,r,o,i){var s=new sd(i,"max",!0),u=this.compileAndRun(s,[r]),c=new qE(i),f=this.compileAndRun(c,[e,u],r.dtype);return u.dispose(),f},t.prototype.avgPoolBackprop=function(e,r,o){var i=new qC(o);return this.compileAndRun(i,[e],r.dtype)},t.prototype.cast=function(e,r){return f0(e,r,this)},t.prototype.unstack=function(e,r){for(var o=e.shape[r],i=new Array(e.rank-1),s=0,u=0;u<e.rank;u++)u!==r&&(i[s++]=e.shape[u]);var c=new Array(e.rank).fill(0),f=e.shape.slice();f[r]=1;var d=new Array(o);for(u=0;u<d.length;u++)c[r]=u,d[u]=this.slice(e,c,f).reshape(i);return d},t.prototype.avgPool3d=function(e,r){var o=new ud(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,r,o){var i=new KC(o);return this.compileAndRun(i,[e],r.dtype)},t.prototype.maxPool3d=function(e,r){var o=new ud(r,"max",!1);return this.compileAndRun(o,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,r,o,i){var s=new ud(i,"max",!0),u=this.compileAndRun(s,[r]),c=new KE(i),f=this.compileAndRun(c,[e,u],r.dtype);return u.dispose(),f},t.prototype.reshape=function(e,r){var o=this.texData.get(e.dataId);if(o.isPacked&&!Lu(e.shape,r)&&(o.texture===null||!Lu(o.shape,r))){var i=this.packedReshape(e,r);return j.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return Bd(e,r)},t.prototype.resizeBilinear=function(e,r,o,i){var s=ae().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new r_(e.shape,r,o,i):new n_(e.shape,r,o,i);return this.compileAndRun(s,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,r,o){var i=new t_(e,r,o);return this.compileAndRun(i,[e])},t.prototype.resizeNearestNeighbor=function(e,r,o,i){var s=new i_(e.shape,r,o,i);return this.compileAndRun(s,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,r,o){var i=new o_(e,r,o);return this.compileAndRun(i,[e])},t.prototype.multinomial=function(e,r,o,i){var s=r?e:jr(e),u=s.shape[0],c=s.shape[1],f=new $E(u,c,o),d=f.getCustomSetupFunc(i);return this.compileAndRun(f,[s],"int32",d)},t.prototype.oneHot=function(e,r,o,i){var s=new XE(e.size,r,o,i);return this.compileAndRun(s,[e])},t.prototype.diag=function(e){var r=new vE(e.size);return this.compileAndRun(r,[e])},t.prototype.nonMaxSuppression=function(e,r,o,i,s){return al("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),hh(e.dataSync(),r.dataSync(),o,i,s)},t.prototype.cropAndResize=function(e,r,o,i,s,u){var c=new cE(e.shape,r.shape,i,s,u);return this.compileAndRun(c,[e,r,o],"float32")},t.prototype.depthToSpace=function(e,r,o){O(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var i=e.shape[0],s=o==="NHWC"?e.shape[1]:e.shape[2],u=o==="NHWC"?e.shape[2]:e.shape[3],c=o==="NHWC"?e.shape[3]:e.shape[1],f=s*r,d=u*r,p=c/(r*r),v=new pE(o==="NHWC"?[i,f,d,p]:[i,p,f,d],r,o);return this.compileAndRun(v,[e])},t.prototype.split=function(e,r,o){return p0(e,r,o)},t.prototype.scatterND=function(e,r,o){var i=dl(0,e,o),s=i.sliceRank,u=i.numUpdates,c=i.sliceSize,f=i.strides,d=i.outputSize,p=[d/c,c],v=e.reshape([u,s]),g=r.reshape([u,c]);if(d===0)return Bd(Vt([]),o);var y=ve(0),b=new Dg(u,s,v.rank,g.rank,f,p);return this.compileAndRun(b,[g,v,y]).reshape(o)},t.prototype.sparseToDense=function(e,r,o,i){var s=dl(0,e,o),u=s.sliceRank,c=s.numUpdates,f=s.strides,d=s.outputSize,p=new Dg(c,u,e.rank,r.rank,f,[d,1]);return this.compileAndRun(p,[r,e,i]).reshape(o)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,r){var o=this.texData.get(e.dataId),i=new Ng(wE,e.shape,r),s=new Ng(bE,e.shape,r),u=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag)],c=this.compileAndRun(i,u),f=this.compileAndRun(s,u),d=this.complex(c,f).as2D(e.shape[0],e.shape[1]);return c.dispose(),f.dispose(),d},t.prototype.gatherND=function(e,r){var o=r.shape,i=o[o.length-1],s=o0(e,r),u=s[0],c=s[1],f=s[2],d=s[3],p=r.reshape([c,i]),v=e.reshape([e.size/f,f]),g=new _E(i,d,[c,f]);return this.compileAndRun(g,[v,p]).reshape(u)},t.prototype.fill=function(e,r,o){if((o=o||ls(r))==="string"){var i=nl(o,Re(e));return i.fill(r),j.makeTensor(i,e,o,this)}var s=new CE(e,r),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[],o,u)},t.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,e.dtype==="string"?"":0,e.dtype)},t.prototype.linspace=function(e,r,o){return d0(e,r,o)},t.prototype.makeTensorInfo=function(e,r){var o=this.write(null,e,r);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:r}},t.prototype.makeOutput=function(e,r){var o=this.makeTensorInfo(e,r).dataId;return j.makeTensorFromDataId(o,e,r,this)},t.prototype.unpackTensor=function(e){var r=new I_(e.shape);return this.runWebGLProgram(r,[e],e.dtype)},t.prototype.packTensor=function(e){var r=new YE(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,r){var o=[ol(e.shape)].concat(il(e.shape)),i={dtype:e.dtype,shape:o,dataId:e.dataId},s=[ol(r)].concat(il(r)),u=new e_(s,o),c=this.runWebGLProgram(u,[i],e.dtype,null,!0);return{dataId:c.dataId,shape:r,dtype:c.dtype}},t.prototype.decode=function(e){var r,o=this.texData.get(e),i=o.isPacked,s=o.shape,u=o.dtype,c=nd(s);return r=i?new hE(c):new dE(c),{dtype:u,shape:s,dataId:this.runWebGLProgram(r,[{shape:c,dtype:u,dataId:e}],u,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,r,o,i,s){var u=this;s===void 0&&(s=!1);var c=this.makeTensorInfo(e.outputShape,o),f=this.texData.get(c.dataId);if(e.packedOutput&&(f.isPacked=!0),e.outPackingScheme===ns.DENSE){var d=Qa(e.outputShape);f.texShape=d.map(function(S){return 2*S})}if(e.outTexUsage!=null&&(f.usage=e.outTexUsage),Re(c.shape)===0)return f.values=es(c.dtype,0),c;var p=[],v=r.map(function(S){if(S.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var k=u.texData.get(S.dataId);if(k.texture==null){if(!e.packedInputs&&Re(S.shape)<=ae().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:S.shape,texData:null,isUniform:!0,uniformValues:k.values};e.packedInputs&&(k.isPacked=!0,k.shape=S.shape)}else if(!!k.isPacked!=!!e.packedInputs)S=k.isPacked?u.unpackTensor(S):u.packTensor(S),p.push(S),k=u.texData.get(S.dataId);else if(k.isPacked&&!Lu(k.shape,S.shape)){var R=S,N=S.shape;S.shape=k.shape,S=u.packedReshape(S,N),p.push(S),k=u.texData.get(S.dataId),R.shape=N}return u.uploadToGPU(S.dataId),{shape:S.shape,texData:k,isUniform:!1}});this.uploadToGPU(c.dataId);var g,y={shape:c.shape,texData:f,isUniform:!1},b=function(S,k,R){var N="";k.concat(R).forEach(function(D){var A=D.texData!=null&&D.texData.slice!=null&&D.texData.slice.flatOffset>0,V=D.isUniform?"uniform":D.texData.texShape;N+=D.shape+"_"+V+"_"+A});var P=S.userCode,F=S.constructor.name;return F+="_"+N+"_"+P}(e,v,y),w=this.getAndSaveBinary(b,function(){return function(S,k,R,N){var P=k.userCode,F=R.map(function(W,Y){var K={logicalShape:W.shape,texShape:W.isUniform?null:W.texData.texShape,isUniform:W.isUniform,isPacked:!W.isUniform&&W.texData.isPacked,flatOffset:null};return W.texData!=null&&W.texData.slice!=null&&W.texData.slice.flatOffset>0&&(K.flatOffset=W.texData.slice.flatOffset),{name:k.variableNames[Y],shapeInfo:K}}),D=F.map(function(W){return W.shapeInfo}),A={logicalShape:N.shape,texShape:N.texData.texShape,isUniform:!1,isPacked:N.texData.isPacked,flatOffset:null},V=zC(F,A,P,k.packedInputs),U=S.createProgram(V),re=null,te=S.getUniformLocation(U,"NAN",!1);ae().getNumber("WEBGL_VERSION")===1&&(re=S.getUniformLocation(U,"INFINITY",!1));for(var ee={},G=0;G<k.variableNames.length;G++){var q=k.variableNames[G];ee[q]=S.getUniformLocation(U,q,!1),ee["offset"+q]=S.getUniformLocation(U,"offset"+q,!1)}return{program:k,source:V,webGLProgram:U,uniformLocations:ee,inShapeInfos:D,outShapeInfo:A,infLoc:re,nanLoc:te}}(u.gpgpu,e,v,y)}),C=this.activeTimers!=null;if(C&&(g=this.startTimer()),function(S,k,R,N,P){Tg(k.inShapeInfos,R),Tg([k.outShapeInfo],[N]);var F=N.texData.texture,D=N.texData.texShape;N.texData.isPacked?S.setOutputPackedMatrixTexture(F,D[0],D[1]):S.setOutputMatrixTexture(F,D[0],D[1]),S.setProgram(k.webGLProgram),ae().getNumber("WEBGL_VERSION")===1&&k.infLoc!==null&&S.gl.uniform1f(k.infLoc,1/0),k.nanLoc!==null&&S.gl.uniform1f(k.nanLoc,NaN),R.forEach(function(A,V){var U=k.program.variableNames[V],re=k.uniformLocations[U],te=k.uniformLocations["offset"+U];if(re!=null)if(A.isUniform)if(Re(A.shape)<2)S.gl.uniform1f(re,A.uniformValues[0]);else{var ee=A.uniformValues;ee instanceof Float32Array||(ee=new Float32Array(ee)),S.gl.uniform1fv(re,ee)}else A.texData.slice!=null&&te!=null&&S.gl.uniform1i(te,A.texData.slice.flatOffset),S.setInputMatrixTexture(A.texData.texture,re,V)}),P?.(S,k.webGLProgram),S.executeProgram()}(this.gpgpu,w,v,y,i),p.forEach(function(S){return u.disposeData(S.dataId)}),C&&(g=this.endTimer(g),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(g)})),!ae().getBool("WEBGL_LAZILY_UNPACK")&&f.isPacked&&s===!1){var _=this.unpackTensor(c);return this.disposeData(c.dataId),_}return c},t.prototype.compileAndRun=function(e,r,o,i,s){s===void 0&&(s=!1),o=o||r[0].dtype;var u=this.runWebGLProgram(e,r,o,i,s);return j.makeTensorFromDataId(u.dataId,u.shape,u.dtype)},t.prototype.getAndSaveBinary=function(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(ae().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){e.gpgpu.deleteProgram(e.binaryCache[r].webGLProgram),delete e.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=xe(function(){if(!ae().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=ae().getBool("DEBUG");ae().set("DEBUG",!1);var o=e.abs(ve(1e-8)).dataSync()[0];if(ae().set("DEBUG",r),o>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var r,o=this.texData.get(e),i=o.shape,s=o.dtype,u=o.values,c=o.texture,f=o.usage,d=o.isPacked;if(c==null){var p,v=this.activeTimers!=null;v&&(p=pr());var g=o.texShape;if(g==null&&(g=Mb(i,d),o.texShape=g),u!=null){var y=nd(i),b=void 0,w=g[1],C=g[0],_=u instanceof Uint8Array;d?(w=(r=fs(g[0],g[1]))[0],C=r[1],b=new xE(y,[C,w],_)):b=new yE(y,[C,w],_);var S=this.makeTensorInfo([C,w],s);this.texData.get(S.dataId).usage=_?Rn.PIXELS:Rn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(S.dataId),w,C,u);var k=this.runWebGLProgram(b,[S],s,null,!0),R=this.texData.get(k.dataId);o.texture=R.texture,o.texShape=R.texShape,o.isPacked=R.isPacked,o.usage=R.usage,this.disposeData(S.dataId),this.texData.delete(k.dataId),o.values=null,v&&(this.uploadWaitMs+=pr()-p)}else{var N=this.acquireTexture(g,f,s,d);o.texture=N}}},t.prototype.convertAndCacheOnCPU=function(e,r){var o=this.texData.get(e),i=o.dtype;return this.releaseGPUData(e),r!=null&&(o.values=function(s,u){if(u==="float32"||u==="complex64")return s;if(u==="int32"||u==="bool"){for(var c=u==="int32"?new Int32Array(s.length):new Uint8Array(s.length),f=0;f<c.length;++f)c[f]=Math.round(s[f]);return c}throw new Error("Unknown dtype "+u)}(r,i)),o.values},t.prototype.acquireTexture=function(e,r,o,i){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+s+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,r,i)},t.prototype.computeBytes=function(e,r){return e[0]*e[1]*zy(r)},t}(l0);Ky()&&j.registerBackend("webgl",function(){return new T_},2);var D_=B({square_:function(n){var t=T(n,"x","square"),e=[t];return j.runKernelFunc(function(r,o){return o([t]),r.square(t)},{x:t},null,"Square",{},e,[])}}),os="SquaredDifference",I0=B({squaredDifference_:function(n,t){var e,r=T(n,"a","squaredDifference"),o=T(t,"b","squaredDifference");e=pt(r,o),r=e[0],o=e[1],He(r.shape,o.shape);var i={a:r,b:o},s=[r,o];return j.runKernelFunc(function(u,c){var f=u.squaredDifference(r,o);return c([r,o]),f},i,function(u,c){var f=c[0],d=c[1],p=ve(2);return{a:function(){return u.mul(f.sub(d).mul(p))},b:function(){return u.mul(d.sub(f).mul(p))}}},os,{},s,[])}}),A_=B({abs_:function(n){var t=T(n,"x","abs");return t.dtype==="complex64"?j.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):j.runKernelFunc(function(e,r){var o=e.abs(t);return r([t]),o},{x:t},function(e,r){var o=r[0];return{x:function(){return e.mul(o.toFloat().step(-1))}}},"Abs")}}),P_=B({acos_:function(n){var t=T(n,"x","acos");return j.runKernelFunc(function(e,r){var o=e.acos(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(ve(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),F_=B({acosh_:function(n){var t=T(n,"x","acosh");return j.runKernelFunc(function(e,r){var o=e.acosh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),O_=B({asin_:function(n){var t=T(n,"x","asin");return j.runKernelFunc(function(e,r){var o=e.asin(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(ve(1).sub(o.toFloat().square()).sqrt())}}})}}),M_=B({asinh_:function(n){var t=T(n,"x","asinh");return j.runKernelFunc(function(e,r){var o=e.asinh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(ve(1).add(o.toFloat().square()).sqrt())}}})}}),L_=B({atan_:function(n){var t=T(n,"x","atan");return j.runKernelFunc(function(e,r){var o=e.atan(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().square().add(1))}}})}}),B_=B({atanh_:function(n){var t=T(n,"x","atanh");return j.runKernelFunc(function(e,r){var o=e.atanh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(ve(1).sub(o.toFloat().square()))}}})}}),W_=B({ceil_:function(n){var t=T(n,"x","ceil");return j.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return Ke(e)}}})}}),xh=B({clipByValue_:function(n,t,e){var r=T(n,"x","clipByValue");O(t<=e,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+e+")."});var o=[r],i={min:t,max:e};return j.runKernelFunc(function(s,u){var c=s.clip(r,t,e);return u([r]),c},{x:r},function(s,u){var c=u[0];return{x:function(){return s.where(c.greaterEqual(t).logicalAnd(c.lessEqual(e)),Ke(s))}}},"ClipByValue",i,o)}}),z_=B({cos_:function(n){var t=T(n,"x","cos"),e=[t];return j.runKernelFunc(function(r,o){var i=r.cos(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return i.toFloat().sin().neg().mul(r)}}},"Cos",{},e)}}),U_=B({cosh_:function(n){var t=T(n,"x","cosh");return j.runKernelFunc(function(e,r){var o=e.cosh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(e)}}})}}),V_=B({erf_:function(n){var t=T(n,"x","erf");return O(t.dtype==="int32"||t.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),t.dtype==="int32"&&(t=t.toFloat()),j.runKernelFunc(function(e,r){var o=e.erf(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),zd=B({exp_:function(n){var t=T(n,"x","exp");return j.runKernelFunc(function(e,r){var o=e.exp(t);return r([o]),o},{x:t},function(e,r){return{x:function(){return e.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),j_=B({expm1_:function(n){var t=T(n,"x","expm1");return j.runKernelFunc(function(e,r){var o=e.expm1(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.exp())}}})}}),H_=B({floor_:function(n){var t=T(n,"x","floor");return j.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return Ke(e)}}})}}),G_=B({log_:function(n){var t=T(n,"x","log"),e=[t];return j.runKernelFunc(function(r,o){var i=r.log(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return r.div(i.toFloat())}}},"Log",{},e)}}),q_=B({log1p_:function(n){var t=T(n,"x","log1p");return j.runKernelFunc(function(e,r){var o=e.log1p(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.add(1))}}})}}),K_=B({logSigmoid_:function(n){var t=T(n,"x","logSigmoid");return j.runKernelFunc(function(e,r){var o=e.softplus(t.neg()).neg();return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.neg().sigmoid())}}})}}),ml=B({neg_:function(n){var t=T(n,"x","neg"),e=[t];return j.runKernelFunc(function(r){return r.neg(t)},{x:t},function(r){return{x:function(){return r.neg()}}},"Neg",{},e)}}),$_=B({reciprocal_:function(n){var t=T(n,"x","reciprocal");return j.runKernelFunc(function(e,r){var o=e.reciprocal(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.square().neg())}}})}}),X_=B({round_:function(n){var t=T(n,"x","round");return j.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return Ke(e)}}})}}),N0=B({rsqrt_:function(n){var t=T(n,"x","rsqrt"),e=[t];return j.runKernelFunc(function(r,o){var i=r.rsqrt(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return r.div(i.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},e)}}),T0=B({sigmoid_:function(n){var t=T(n,"x","sigmoid");return j.runKernelFunc(function(e,r){var o=e.sigmoid(t);return r([o]),o},{x:t},function(e,r){var o=r[0];return{x:function(){return e.mul(o.mul(ve(1).sub(o)))}}},"Sigmoid")}}),Y_=B({sign_:function(n){var t=T(n,"x","sign");return j.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return Ke(e)}}})}}),Q_=B({isNaN_:function(n){var t=T(n,"x","isNaN");return j.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return Ke(e)}}})}}),J_=B({isInf_:function(n){var t=T(n,"x","isInf");return j.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return Ke(e)}}})}}),Z_=B({isFinite_:function(n){var t=T(n,"x","isFinite");return j.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return Ke(e)}}})}}),eS=B({sin_:function(n){var t=T(n,"x","sin"),e=[t];return j.runKernelFunc(function(r,o){var i=r.sin(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return i.toFloat().cos().mul(r)}}},"Sin",{},e)}}),tS=B({sinh_:function(n){var t=T(n,"x","sinh");return j.runKernelFunc(function(e,r){var o=e.sinh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(e)}}})}}),nS=B({softplus_:function(n){var t=T(n,"x","softplus");return j.runKernelFunc(function(e,r){var o=e.softplus(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.sigmoid())}}})}}),rS=B({sqrt_:function(n){var t=T(n,"x","sqrt");return j.runKernelFunc(function(e,r){var o=e.sqrt(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().sqrt().mul(2))}}})}}),oS=B({step_:function(n,t){t===void 0&&(t=0);var e=T(n,"x","step");return j.runKernelFunc(function(r){return r.step(e,t)},{$x:e},function(r){return{$x:function(){return Ke(r)}}})}}),iS=B({tan_:function(n){var t=T(n,"x","tan");return j.runKernelFunc(function(e,r){var o=e.tan(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.cos().square())}}})}}),aS=B({tanh_:function(n){var t=T(n,"x","tanh");return j.runKernelFunc(function(e,r){var o=e.tanh(t);return r([o]),o},{x:t},function(e,r){var o=r[0];return{x:function(){return ve(1).sub(o.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function D0(n,t,e,r,o,i){var s,u,c=T(n,"x","batchNorm"),f=T(t,"mean","batchNorm"),d=T(e,"variance","batchNorm");return o!=null&&(s=T(o,"scale","batchNorm")),r!=null&&(u=T(r,"offset","batchNorm")),O(c.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),O(f.rank===2||f.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+f.rank+"."}),O(d.rank===2||d.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+d.rank+"."}),s!=null&&O(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."}),u!=null&&O(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+u.rank+"."}),hs(c,f,d,u,s,i)}function A0(n,t,e,r,o,i){var s,u,c=T(n,"x","batchNorm"),f=T(t,"mean","batchNorm"),d=T(e,"variance","batchNorm");return o!=null&&(s=T(o,"scale","batchNorm")),r!=null&&(u=T(r,"offset","batchNorm")),O(c.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),O(f.rank===3||f.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+f.rank+"."}),O(d.rank===3||d.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+d.rank+"."}),s!=null&&O(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."}),u!=null&&O(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+u.rank+"."}),hs(c,f,d,u,s,i)}function P0(n,t,e,r,o,i){var s,u,c=T(n,"x","batchNorm"),f=T(t,"mean","batchNorm"),d=T(e,"variance","batchNorm");return o!=null&&(s=T(o,"scale","batchNorm")),r!=null&&(u=T(r,"offset","batchNorm")),O(c.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+c.rank+"."}),O(f.rank===4||f.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+f.rank+"."}),O(d.rank===4||d.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+d.rank+"."}),s!=null&&O(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."}),u!=null&&O(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+u.rank+"."}),hs(c,f,d,u,s,i)}function hs(n,t,e,r,o,i){i==null&&(i=.001);var s,u,c,f=T(n,"x","batchNorm"),d=T(t,"mean","batchNorm"),p=T(e,"variance","batchNorm");o!=null&&(s=T(o,"scale","batchNorm")),r!=null&&(u=T(r,"offset","batchNorm")),O(d.rank===p.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),O(u==null||d.rank===u.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),O(s==null||d.rank===s.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),c=f.rank===0||f.rank===1?f.as4D(1,1,1,f.size):f.rank===2?f.as4D(1,1,f.shape[0],f.shape[1]):f.rank===3?f.as4D(1,f.shape[0],f.shape[1],f.shape[2]):f;var v=[f,d,p,s];return j.runKernelFunc(function(g,y){var b=g.batchNormalization(c,Vu(d),Vu(p),i,Vu(s),Vu(u));return y([f,d,p,s]),b},{x:f,mean:d,variance:p,scale:s,offset:u},function(g,y){var b=y,w=b[0],C=b[1],_=b[2],S=b[3],k=S??ve(1),R=It(C.shape,c.shape),N=[];if(C.rank===1){for(var P=0;P<c.shape.length-1;++P)N.push(c.shape[P]);N.push(1)}var F=w.sub(C),D=g.mul(k),A=N0(_.add(ve(i))),V=A.mul(A).mul(A).mul(ve(-.5));return{x:function(){return C.rank===1?g.mul(Hi(A.as4D(1,1,1,C.shape[0]),N)).mul(k).reshape(w.shape):g.mul(A).mul(k).reshape(w.shape)},mean:function(){var U=A.mul(ve(-1)).mul(D);return C.rank===1&&(U=U.sum(R)),U.reshape(C.shape)},variance:function(){var U=V.mul(F).mul(D);return C.rank===1&&(U=U.sum(R)),U.reshape(C.shape)},scale:function(){var U=F.mul(A),re=g.mul(U);return C.rank===1&&(re=re.sum(R)),re.reshape(C.shape)},offset:function(){var U=g;return C.rank===1&&(U=U.sum(R)),U.reshape(C.shape)}}},"BatchNormalization",{varianceEpsilon:i},v).reshape(f.shape)}function Vu(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function Al(){$y("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var sS=B({batchNormalization2d_:function(n,t,e,r,o,i){return r===void 0&&(r=.001),Al(),D0(n,t,e,i,o,r)}}),uS=B({batchNormalization3d_:function(n,t,e,r,o,i){return r===void 0&&(r=.001),Al(),A0(n,t,e,i,o,r)}}),lS=B({batchNormalization4d_:function(n,t,e,r,o,i){return r===void 0&&(r=.001),Al(),P0(n,t,e,i,o,r)}}),cS=B({batchNormalization_:function(n,t,e,r,o,i){return r===void 0&&(r=.001),Al(),hs(n,t,e,i,o,r)}}),F0=B({batchNorm_:hs}),fS=B({batchNorm2d_:D0}),dS=B({batchNorm3d_:A0}),hS=B({batchNorm4d_:P0}),Pl=B({logicalAnd_:function(n,t){var e=T(n,"a","logicalAnd","bool"),r=T(t,"b","logicalAnd","bool");return He(e.shape,r.shape),j.runKernelFunc(function(o){return o.logicalAnd(e,r)},{a:e,b:r},null,"LogicalAnd")}}),pS=B({logicalNot_:function(n){var t=T(n,"x","logicalNot","bool");return j.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),O0=B({logicalOr_:function(n,t){var e=T(n,"a","logicalOr","bool"),r=T(t,"b","logicalOr","bool");return He(e.shape,r.shape),j.runKernelFunc(function(o){return o.logicalOr(e,r)},{$a:e,$b:r})}}),vS=B({logicalXor_:function(n,t){var e=T(n,"a","logicalXor","bool"),r=T(t,"b","logicalXor","bool");return He(e.shape,r.shape),O0(n,t).logicalAnd(Pl(n,t).logicalNot())}}),Jo=B({where_:function(n,t,e){var r=T(t,"a","where"),o=T(e,"b","where"),i=T(n,"condition","where","bool");return Je(r.shape,o.shape,"Error in where: "),i.rank===1?O(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Je(i.shape,o.shape,"Error in where: "),j.runKernelFunc(function(s,u){var c=s.select(i,r,o);return u([i]),c},{$condition:i,$a:r,$b:o},function(s,u){var c=u[0];return{$condition:function(){return Ke(c).toFloat()},$a:function(){return s.mul(c.cast(s.dtype))},$b:function(){return s.mul(c.logicalNot().cast(s.dtype))}}})}}),M0=function(n){return Ee(this,void 0,void 0,function(){var t,e,r;return _e(this,function(o){switch(o.label){case 0:return[4,(t=T(n,"condition","whereAsync","bool")).data()];case 1:return e=o.sent(),r=vh(t.shape,e),n!==t&&t.dispose(),[2,r]}})})},je=B({add_:function(n,t){var e,r=T(n,"a","add"),o=T(t,"b","add");e=pt(r,o),r=e[0],o=e[1];var i=He(r.shape,o.shape);return j.runKernelFunc(function(s){return s.add(r,o)},{a:r,b:o},function(s){return{a:function(){var u=s,c=It(r.shape,i);return c.length>0&&(u=u.sum(c)),u.reshape(r.shape)},b:function(){var u=s,c=It(o.shape,i);return c.length>0&&(u=u.sum(c)),u.reshape(o.shape)}}},"Add")}}),mS=B({addN_:function(n){O(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),O(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var t=n.map(function(o,i){return T(o,"tensors"+i,"addN")}),e=t[0];t.forEach(function(o){if(o.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(o){if(!Ot(o.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return j.runKernelFunc(function(o){return o.addN(t)},r,function(o){var i={};return t.forEach(function(s,u){i[u]=function(){return o.clone()}}),i},"AddN")}}),gS=B({addStrict_:function(n,t){var e=T(n,"a","addStrict"),r=T(t,"b","addStrict");return Je(e.shape,r.shape,"Error in addStrict: "),e.add(r)}}),yS=B({atan2_:function(n,t){var e,r=T(n,"a","atan2"),o=T(t,"b","atan2");e=pt(r,o),r=e[0],o=e[1];var i=He(r.shape,o.shape);return j.runKernelFunc(function(s,u){var c=s.atan2(r,o);return u([r,o]),c},{$a:r,$b:o},function(s,u){var c=u[0],f=u[1];return{$a:function(){var d=je(c.square(),f.square()),p=s.mul(f.div(d)),v=It(c.shape,i);return v.length>0&&(p=p.sum(v)),p.reshape(c.shape)},$b:function(){var d=je(c.square(),f.square()),p=ml(s.mul(c.div(d))),v=It(f.shape,i);return v.length>0&&(p=p.sum(v)),p.reshape(f.shape)}}})}}),Zn=B({div_:function(n,t){var e,r=T(n,"a","div"),o=T(t,"b","div");if(e=pt(r,o),r=e[0],o=e[1],r.dtype==="int32"&&o.dtype==="int32")return L0(r,o);var i=He(r.shape,o.shape);return j.runKernelFunc(function(s,u){var c=s.realDivide(r,o);return u([r,o]),c},{a:r,b:o},function(s,u){var c=u[0],f=u[1];return{a:function(){var d=s.div(f.toFloat()),p=It(c.shape,i);return p.length>0?d.sum(p).reshape(c.shape):d},b:function(){var d=s.mul(c.toFloat()),p=It(f.shape,i);p.length>0&&(d=d.sum(p).reshape(f.shape));var v=f.square();return d.div(v.toFloat()).neg()}}},"Div")}}),xS=B({divNoNan_:function(n,t){var e,r=T(n,"a","div"),o=T(t,"b","div");r=(e=pt(r,o))[0],o=e[1];var i=Zn(r,o),s=Ke(i),u=o.equal(s);return Jo(u,s,i)}}),wS=B({divStrict_:function(n,t){var e=T(n,"a","div"),r=T(t,"b","div");return Je(e.shape,r.shape,"Error in divideStrict: "),e.div(r)}}),L0=B({floorDiv_:function(n,t){var e,r=T(n,"a","floorDiv"),o=T(t,"b","floorDiv");e=pt(r,o),r=e[0],o=e[1];var i=He(r.shape,o.shape);return j.runKernelFunc(function(s,u){var c=s.floorDiv(r,o);return u([r,o]),c},{a:r,b:o},function(s,u){var c=u[0],f=u[1];return{a:function(){var d=s.div(f.toFloat()),p=It(c.shape,i);return p.length>0?d.sum(p).reshape(c.shape):d},b:function(){var d=s.mul(c.toFloat()),p=It(f.shape,i);p.length>0&&(d=d.sum(p).reshape(f.shape));var v=f.square();return d.div(v.toFloat()).neg()}}},"FloorDiv")}}),wh=B({maximum_:function(n,t){var e,r=T(n,"a","maximum"),o=T(t,"b","maximum");return e=pt(r,o),r=e[0],o=e[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),He(r.shape,o.shape),j.runKernelFunc(function(i,s){var u=i.maximum(r,o);return s([r,o]),u},{a:r,b:o},function(i,s){var u=s[0],c=s[1];return{a:function(){return i.mul(u.greaterEqual(c).toFloat())},b:function(){return i.mul(u.less(c).toFloat())}}},"Maximum")}}),bS=B({maximumStrict_:function(n,t){var e=T(n,"a","maximumStrict"),r=T(t,"b","maximumStrict");return Je(e.shape,r.shape,"Error in maximumStrict: "),e.maximum(r)}}),B0=B({minimum_:function(n,t){var e,r=T(n,"a","minimum"),o=T(t,"b","minimum");return e=pt(r,o),r=e[0],o=e[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),He(r.shape,o.shape),j.runKernelFunc(function(i,s){var u=i.minimum(r,o);return s([r,o]),u},{a:r,b:o},function(i,s){var u=s[0],c=s[1];return{a:function(){return i.mul(u.lessEqual(c).toFloat())},b:function(){return i.mul(u.greater(c).toFloat())}}},"Minimum")}}),CS=B({minimumStrict_:function(n,t){var e=T(n,"a","minimumStrict"),r=T(t,"b","minimumStrict");return Je(e.shape,r.shape,"Error in minimumStrict: "),e.minimum(r)}}),ES=B({mod_:function(n,t){var e,r=T(n,"a","mod"),o=T(t,"b","mod");e=pt(r,o),r=e[0],o=e[1];var i=He(r.shape,o.shape);return j.runKernelFunc(function(s,u){var c=s.mod(r,o);return u([r,o]),c},{$a:r,$b:o},function(s,u){var c=u[0],f=u[1];return{$a:function(){var d=It(c.shape,i);return d.length>0?s.sum(d).reshape(c.shape):s},$b:function(){var d=s.mul(c.div(f).floor().neg()),p=It(f.shape,i);return p.length>0?d.sum(p).reshape(f.shape):d}}})}}),_S=B({modStrict_:function(n,t){var e=T(n,"a","modStrict"),r=T(t,"b","modStrict");return Je(e.shape,r.shape,"Error in modStrict: "),e.mod(r)}}),Zt=B({mul_:function(n,t){var e,r=T(n,"a","mul"),o=T(t,"b","mul");e=pt(r,o),r=e[0],o=e[1];var i=He(r.shape,o.shape);return j.runKernelFunc(function(s,u){var c=s.multiply(r,o);return u([r,o]),c},{a:r,b:o},function(s,u){var c=u[0],f=u[1];return{a:function(){var d=s.mul(f.toFloat()),p=It(c.shape,i);return p.length>0?d.sum(p).reshape(c.shape):d},b:function(){var d=s.mul(c.toFloat()),p=It(f.shape,i);return p.length>0?d.sum(p).reshape(f.shape):d}}},"Mul")}}),SS=B({mulStrict_:function(n,t){var e=T(n,"a","mul"),r=T(t,"b","mul");return Je(e.shape,r.shape,"Error in multiplyStrict: "),e.mul(r)}}),gl=B({pow_:function(n,t){var e,r=T(n,"base","pow"),o=T(t,"exp","pow");e=pt(r,o),r=e[0],o=e[1];var i=He(r.shape,o.shape),s=[r,o];return j.runKernelFunc(function(u,c){var f=u.pow(r,o);return c([r,o,f]),f},{a:r,b:o},function(u,c){var f=c[0],d=c[1],p=c[2];return{a:function(){var v=d.toFloat(),g=u.mul(v.mul(f.pow(v.sub(ve(1))))),y=It(f.shape,i);return y.length>0&&(g=g.sum(y)),g.reshape(f.shape)},b:function(){var v=f.greater(0),g=f.log().where(v,Ke(f)),y=u.mul(p.mul(g)),b=It(d.shape,i);return b.length>0&&(y=y.sum(b)),y.reshape(d.shape)}}},"Pow",{},s,[!0])}}),kS=B({powStrict_:function(n,t){return Je(n.shape,t.shape,"Error in powStrict: "),n.pow(t)}}),RS=B({squaredDifferenceStrict_:function(n,t){var e=T(n,"a","squaredDifferenceStrict"),r=T(t,"b","squaredDifferenceStrict");return Je(e.shape,r.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(r)}}),Nt=B({sub_:function(n,t){var e,r=T(n,"a","sub"),o=T(t,"b","sub");e=pt(r,o),r=e[0],o=e[1];var i=He(r.shape,o.shape);return j.runKernelFunc(function(s){return s.subtract(r,o)},{a:r,b:o},function(s){return{a:function(){var u=s,c=It(r.shape,i);return c.length>0&&(u=u.sum(c)),u.reshape(r.shape)},b:function(){var u=s,c=It(o.shape,i);return c.length>0&&(u=u.sum(c)),u.neg().reshape(o.shape)}}},"Sub")}}),IS=B({subStrict_:function(n,t){var e=T(n,"a","subStrict"),r=T(t,"b","subStrict");return Je(e.shape,r.shape,"Error in subStrict: "),e.sub(r)}}),W0=B({equal_:function(n,t){var e,r=T(n,"a","equal"),o=T(t,"b","equal");return e=pt(r,o),r=e[0],o=e[1],He(r.shape,o.shape),j.runKernelFunc(function(i){return i.equal(r,o)},{$a:r,$b:o})}}),NS=B({equalStrict_:function(n,t){var e=T(n,"a","equalStrict"),r=T(t,"b","equalStrict");return Je(e.shape,r.shape,"Error in equalStrict: "),e.equal(r)}}),TS=B({greater_:function(n,t){var e,r=T(n,"a","greater"),o=T(t,"b","greater");return e=pt(r,o),r=e[0],o=e[1],He(r.shape,o.shape),j.runKernelFunc(function(i){return i.greater(r,o)},{a:r,b:o},null,"Greater")}}),z0=B({greaterEqual_:function(n,t){var e,r=T(n,"a","greaterEqual"),o=T(t,"b","greaterEqual");return e=pt(r,o),r=e[0],o=e[1],He(r.shape,o.shape),j.runKernelFunc(function(i,s){var u=i.greaterEqual(r,o);return s([r,o]),u},{a:r,b:o},function(i,s){var u=s[0],c=s[1];return{a:function(){return Ke(u)},b:function(){return Ke(c)}}},"GreaterEqual")}}),DS=B({greaterEqualStrict_:function(n,t){var e=T(n,"a","greaterEqualStrict"),r=T(t,"b","greaterEqualStrict");return Je(e.shape,r.shape,"Error in greaterEqualStrict: "),e.greaterEqual(r)}}),AS=B({greaterStrict_:function(n,t){var e=T(n,"a","greaterStrict"),r=T(t,"b","greaterStrict");return Je(e.shape,r.shape,"Error in greaterStrict: "),e.greater(r)}}),PS=B({less_:function(n,t){var e,r=T(n,"a","less"),o=T(t,"b","less");return e=pt(r,o),r=e[0],o=e[1],He(r.shape,o.shape),j.runKernelFunc(function(i){return i.less(r,o)},{a:r,b:o},null,"Less")}}),FS=B({lessEqual_:function(n,t){var e,r=T(n,"a","lessEqual"),o=T(t,"b","lessEqual");return e=pt(r,o),r=e[0],o=e[1],He(r.shape,o.shape),j.runKernelFunc(function(i,s){var u=i.lessEqual(r,o);return s([r,o]),u},{a:r,b:o},null,"LessEqual")}}),OS=B({lessEqualStrict_:function(n,t){var e=T(n,"a","lessEqualStrict"),r=T(t,"b","lessEqualStrict");return Je(e.shape,r.shape,"Error in lessEqualStrict: "),e.lessEqual(r)}}),MS=B({lessStrict_:function(n,t){var e=T(n,"a","lessStrict"),r=T(t,"b","lessStrict");return Je(e.shape,r.shape,"Error in lessStrict: "),e.less(r)}}),LS=B({notEqual_:function(n,t){var e,r=T(n,"a","notEqual"),o=T(t,"b","notEqual");return e=pt(r,o),r=e[0],o=e[1],He(r.shape,o.shape),j.runKernelFunc(function(i){return i.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),BS=B({notEqualStrict_:function(n,t){var e=T(n,"a","notEqualStrict"),r=T(t,"b","notEqualStrict");return Je(e.shape,r.shape,"Error in notEqualStrict: "),e.notEqual(r)}});function zg(n,t){for(var e=[],r=n;r<t;++r)e.push(r);return e}function Ug(n){for(var t=[],e=0;e<n.length;++e)for(var r=0;r<n[e].length;++r)t.push(n[e][r]);return t}var bh=B({gather_:function(n,t,e){e===void 0&&(e=0);var r=T(n,"x","gather"),o=T(t,"indices","gather","int32");e=Tt(e,r.shape)[0];var i=function(s,u,c){for(var f=s.shape[c],d=[],p=1,v=1,g=0;g<c;g++)d.push(s.shape[g]),p*=s.shape[g];for(g=0;g<u.rank;g++)d.push(u.shape[g]);for(g=c+1;g<s.rank;g++)d.push(s.shape[g]),v*=s.shape[g];return{batchSize:p,sliceSize:v,dimSize:f,outputShape:d}}(r,o,e);return j.runKernelFunc(function(s,u){var c=s.gather(r,o.flatten(),e);return u([o]),c},{x:r,indices:o},function(s,u){var c=u[0];return{x:function(){var f=r.shape,d=c.size,p=f.slice(0,e),v=p.length,g=f.slice(e,f.length).slice(1),y=g.length,b=zg(0,v),w=zg(v+1,v+1+y),C=Ug([p,[d],g]),_=s.reshape(C),S=c.reshape([d]),k=Ug([[v],b,w]),R=_.transpose(k),N=U0(R,S,r.shape[e]),P=sh(k);return N=N.transpose(P)},indices:function(){return c}}},"Gather",{axis:e}).reshape(i.outputShape)}}),U0=B({unsortedSegmentSum_:function(n,t,e){var r=T(n,"x","unsortedSegmentSum"),o=T(t,"segmentIds","unsortedSegmentSum","int32");return O(xt(e),function(){return"numSegments must be of dtype int"}),j.runKernelFunc(function(i,s){var u=i.unsortedSegmentSum(r,o,e);return s([o]),u},{$x:r},function(i,s){var u=s[0];return{$x:function(){return function(c,f){for(var d=wh(f,Ke(f)),p=bh(c,d),v=z0(f,ve(0,"int32")),g=p.rank-v.rank,y=0;y<g;++y)v=Un(v,y+1);v=Pl(v,na(p.shape,"bool"));var b=Ke(p);return Jo(v,p,b)}(i,u)}}})}}),WS=function(n,t,e){return Ee(this,void 0,void 0,function(){var r,o,i,s,u,c,f,d,p,v,g,y,b;return _e(this,function(w){switch(w.label){case 0:for(r=T(n,"tensor","boolMask"),o=T(t,"mask","boolMask","bool"),i=e??0,s=o.rank,u=r.shape,O(s>0,function(){return"mask cannot be scalar"}),Je(u.slice(i,i+s),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,f=i;f<i+s;f++)c*=u[f];return d=u.slice(0,i).concat([c],u.slice(i+s)),p=r.reshape(d),v=o.reshape([-1]),[4,M0(v)];case 1:return g=w.sent(),y=g.squeeze([1]),b=bh(p,y,i),n!==r&&r.dispose(),t!==o&&o.dispose(),y.dispose(),p.dispose(),v.dispose(),g.dispose(),[2,b]}})})};function V0(n,t,e,r,o,i,s){i===void 0&&(i="NHWC"),O(n.length===t.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"});var u=n,c=t,f=!1;t.rank===3&&(f=!0,c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),u=[1,n[0],n[1],n[2]]),O(u.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+u.length+"."}),O(c.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank}),O(e.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var d=i==="NHWC"?u[3]:u[1],p=i==="NHWC"?c.shape[3]:c.shape[1];O(d===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+d+") must match input depth for filter "+e.shape[2]+"."}),O(p===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+p+") must match output depth for filter "+e.shape[3]+"."}),s!=null&&O(xt(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."});var v=dh(i),g=ri(u,e.shape,r,1,o,s,!1,v),y=j.runKernelFunc(function(b,w){var C=b.conv2dDerInput(c,e,g);return w([e,c]),C},{dy4D:c,filter:e},function(b,w){var C=w[0],_=w[1];return{dy4D:function(){return Hn(b,C,r,o,i,1,s)},filter:function(){return Ch(b,_,C.shape,r,o,i,s)}}});return f?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}function cd(n){var t=function(i){return typeof i=="number"?[i,i,i]:i.length===2?[i[0],i[1],1]:i}(n),e=t[0],r=t[1],o=t[2];return e===1&&r===1&&o===1}function j0(n,t,e,r,o){O(n.length===t.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"});var i=n,s=t,u=!1;t.rank===4&&(u=!0,s=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,n[0],n[1],n[2],n[3]]);var c=i[4],f=s.shape[4];O(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),O(s.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank}),O(e.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),O(c===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+c+") must match input depth for filter "+e.shape[3]+"."}),O(f===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+f+") must match output depth for filter "+e.shape[4]+"."});var d=pl(i,e.shape,r,1,o),p=j.runKernelFunc(function(v){return v.conv3dDerInput(s,e,d)},{dy5D:s});return u?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}var zS=B({conv1d_:function(n,t,e,r,o,i,s){o===void 0&&(o="NWC"),i===void 0&&(i=1);var u=T(n,"x","conv1d"),c=T(t,"filter","conv1d"),f=u,d=!1;u.rank===2&&(d=!0,f=u.as3D(1,u.shape[0],u.shape[1])),O(f.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+f.rank+"."}),O(c.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+c.rank+"."}),s!=null&&O(xt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}),O(f.shape[2]===c.shape[1],function(){return"Error in conv1d: depth of input ("+f.shape[2]+") must match input depth for filter "+c.shape[1]+"."}),O(xn(e,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+i+"'"}),O(o==="NWC",function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var p=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),v=f.as4D(f.shape[0],1,f.shape[1],f.shape[2]),g=Hn(v,p,[1,e],r,"NHWC",[1,i],s);return d?g.as2D(g.shape[2],g.shape[3]):g.as3D(g.shape[0],g.shape[2],g.shape[3])}}),Hn=B({conv2d_:function(n,t,e,r,o,i,s){o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]);var u=T(n,"x","conv2d"),c=T(t,"filter","conv2d"),f=u,d=!1;u.rank===3&&(d=!0,f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),O(f.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+f.rank+"."}),O(c.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."}),s!=null&&O(xt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var p=o==="NHWC"?f.shape[3]:f.shape[1];O(p===c.shape[2],function(){return"Error in conv2d: depth of input ("+p+") must match input depth for filter "+c.shape[2]+"."}),O(xn(e,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"});var v=dh(o),g=ri(f.shape,c.shape,e,i,r,s,!1,v),y=[c,f],b=j.runKernelFunc(function(w,C){var _=w.conv2d(f,c,g);return C([c,f]),_},{x:f,filter:c},function(w,C){var _=C,S=_[0],k=_[1];return O(ea(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return H0(k.shape,w,S,e,r,o)},filter:function(){return Ch(k,w,S.shape,e,r,o)}}},"Conv2D",g,y);return d?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),US=B({conv3d_:function(n,t,e,r,o,i){o===void 0&&(o="NDHWC"),i===void 0&&(i=[1,1,1]);var s=T(n,"x","conv3d"),u=T(t,"filter","conv3d"),c=s,f=!1;s.rank===4&&(f=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),O(c.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."}),O(u.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+u.rank+"."}),O(c.shape[4]===u.shape[3],function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+u.shape[3]+"."}),O(function(v,g){return cd(v)||cd(g)}(e,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),O(o==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var d=pl(c.shape,u.shape,e,i,r),p=j.runKernelFunc(function(v,g){var y=v.conv3d(c,u,d);return g([c,u]),y},{x:c,$filter:u},function(v,g){O(cd(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var y=g[0],b=g[1];return{x:function(){return j0(y.shape,v,b,e,r)},$filter:function(){return function(w,C,_,S,k){var R=w;w.rank===4&&(R=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3]));var N=C;N.rank===4&&(N=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3])),O(R.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+R.shape+"."}),O(N.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+N.shape+"."}),O(_.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+_+"."}),O(R.shape[4]===_[3],function(){return"Error in conv3dDerFilter: depth of input "+R.shape[4]+") must match input depth in filter ("+_[3]+"."}),O(N.shape[4]===_[4],function(){return"Error in conv3dDerFilter: depth of dy ("+N.shape[4]+") must match output depth for filter ("+_[4]+")."});var P=pl(R.shape,_,S,1,k);return j.runKernelFunc(function(F){return F.conv3dDerFilter(R,N,P)},{x5D:R,dy5D:N})}(y,v,b.shape,e,r)}}});return f?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Ch=B({conv2dDerFilter_:function(n,t,e,r,o,i,s){i===void 0&&(i="NHWC");var u=n;n.rank===3&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var c=t;c.rank===3&&(c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),O(u.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+u.shape+"."}),O(c.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."}),O(e.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var f=i==="NHWC"?u.shape[3]:u.shape[1],d=i==="NHWC"?c.shape[3]:c.shape[1];O(f===e[2],function(){return"Error in conv2dDerFilter: depth of input "+f+") must match input depth in filter ("+e[2]+"."}),O(d===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+d+") must match output depth for filter ("+e[3]+")."}),s!=null&&O(xt(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."});var p=dh(i),v=ri(u.shape,e,r,1,o,s,!1,p);return j.runKernelFunc(function(g){return g.conv2dDerFilter(u,c,v)},{x4D:u,dy4D:c})}}),H0=B({conv2dDerInput_:V0}),Fl=B({depthwiseConv2d_:function(n,t,e,r,o,i,s){i===void 0&&(i=[1,1]);var u=T(n,"x","depthwiseConv2d"),c=T(t,"filter","depthwiseConv2d"),f=u,d=!1;u.rank===3&&(d=!0,f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),O(f.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+f.rank+"."}),O(c.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."}),O(f.shape[3]===c.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+f.shape[3]+") must match the inChannels dimension in filter "+c.shape[2]+"."}),i==null&&(i=[1,1]),O(xn(e,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),s!=null&&O(xt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var p=ri(f.shape,c.shape,e,i,r,s,!0),v=[f,c],g=j.runKernelFunc(function(y,b){var w=y.depthwiseConv2D(f,c,p);return b([f,c]),w},{x:f,filter:c},function(y,b){O(ea(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var w=b[0],C=b[1];return{x:function(){return G0(w.shape,y,C,p)},filter:function(){return q0(w,y,C.shape,p)}}},"DepthwiseConv2dNative",p,v);return d?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),G0=B({depthwiseConv2dDerInput_:function(n,t,e,r){var o=t,i=!1;t.rank===3&&(i=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var s=j.runKernelFunc(function(u){return u.depthwiseConv2DDerInput(o,e,r)},{dy4D:o});return i?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),q0=B({depthwiseConv2dDerFilter_:function(n,t,e,r){var o=n;n.rank===3&&(o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var i=t;return i.rank===3&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),j.runKernelFunc(function(s){return s.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}}),Eh=B({separableConv2d_:function(n,t,e,r,o,i,s){i===void 0&&(i=[1,1]),s===void 0&&(s="NHWC");var u=T(n,"x","separableConv2d"),c=T(t,"depthwiseFilter","separableConv2d"),f=T(e,"pointwiseFilter","separableConv2d"),d=u,p=!1;if(u.rank===3&&(p=!0,d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");O(d.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+d.rank+"."}),O(c.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+c.rank+"."}),O(f.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+c.rank+"."}),O(f.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+f.shape[0]+"."}),O(f.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+f.shape[1]+"."});var v=c.shape[2],g=c.shape[3];O(f.shape[2]===v*g,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+v*g+", but got "+f.shape[2]+"."});var y=Fl(d,c,r,o,s,i),b=Hn(y,f,1,"valid",s);return p?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),VS=B({conv2dTranspose_:function(n,t,e,r,o,i){return V0(e,T(n,"x","conv2dTranspose"),T(t,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),jS=B({conv3dTranspose_:function(n,t,e,r,o){return j0(e,T(n,"x","conv3dTranspose"),T(t,"filter","conv3dTranspose"),r,o)}}),Ol=B({matMul_:function(n,t,e,r){var o;e===void 0&&(e=!1),r===void 0&&(r=!1);var i=T(n,"a","matMul"),s=T(t,"b","matMul");o=pt(i,s),i=o[0],s=o[1];var u=e?i.shape[i.rank-2]:i.shape[i.rank-1],c=r?s.shape[s.rank-1]:s.shape[s.rank-2],f=e?i.shape[i.rank-1]:i.shape[i.rank-2],d=r?s.shape[s.rank-2]:s.shape[s.rank-1],p=i.shape.slice(0,-2),v=s.shape.slice(0,-2),g=Re(p),y=Re(v);O(i.rank>=2&&s.rank>=2&&i.rank===s.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+s.rank+"."}),O(Ot(p,v),function(){return"Error in matMul: outer dimensions ("+p+") and ("+v+") of Tensors with shapes "+i.shape+" and "+s.shape+" must match."}),O(u===c,function(){return"Error in matMul: inner shapes ("+u+") and ("+c+") of Tensors with shapes "+i.shape+" and "+s.shape+" and transposeA="+e+" and transposeB="+r+" must match."});var b=i.shape.slice(0,-2).concat([f,d]),w=e?i.as3D(g,u,f):i.as3D(g,f,u),C=r?s.as3D(y,d,c):s.as3D(y,c,d),_={transposeA:e,transposeB:r};return j.runKernelFunc(function(S,k){var R=S.batchMatMul(w,C,e,r);return k([w,C]),R},{a:w,b:C},function(S,k){var R=k,N=R[0],P=R[1];return e||r?!e&&r?{a:function(){return S.matMul(P,!1,!1)},b:function(){return S.matMul(N,!0,!1)}}:e&&!r?{a:function(){return P.matMul(S,!1,!0)},b:function(){return N.matMul(S,!1,!1)}}:{a:function(){return P.matMul(S,!0,!0)},b:function(){return S.matMul(N,!0,!0)}}:{a:function(){return S.matMul(P,!1,!0)},b:function(){return N.matMul(S,!0,!1)}}},"BatchMatMul",_).reshape(b)}}),HS=B({dot_:function(n,t){var e=T(n,"t1","dot"),r=T(t,"t2","dot");O(!(e.rank!==1&&e.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+r.rank+"."});var o=e.rank===1?e.size:e.shape[1],i=r.rank===1?r.size:r.shape[0];return O(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),e.rank===1&&r.rank===1?e.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():e.rank===1&&r.rank===2?e.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():e.rank===2&&r.rank===1?e.matMul(r.as2D(-1,1)).as1D():e.matMul(r.as2D(r.shape[0],r.shape[1]))}}),GS=B({outerProduct_:function(n,t){var e=T(n,"v1","outerProduct"),r=T(t,"v2","outerProduct");return O(e.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+r.rank+"."}),e.as2D(-1,1).matMul(r.as2D(1,-1))}}),ps=B({reverse_:function(n,t){var e=T(n,"x","reverse");if(e.rank===0)return e.clone();var r=Tt(t,e.shape);return j.runKernelFunc(function(o){return o.reverse(e,r)},{$x:e},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(e)}}),qS=B({reverse1d_:function(n){var t=T(n,"x","reverse");return O(t.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),ps(t,0)}}),KS=B({reverse2d_:function(n,t){var e=T(n,"x","reverse");return O(e.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),ps(e,t)}}),$S=B({reverse3d_:function(n,t){var e=T(n,"x","reverse");return O(e.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),ps(e,t)}}),XS=B({reverse4d_:function(n,t){var e=T(n,"x","reverse");return O(e.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),ps(e,t)}});function K0(n,t,e,r,o,i){var s=T(n,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),O(u.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+u.rank+"."}),O(xn(e,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"}),i!=null&&O(xt(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var f=rs(u.shape,t,e,r,o,i);if(f.filterWidth===1&&f.filterHeight===1&&Ot(f.inShape,f.outShape))return s.clone();var d=[u],p=j.runKernelFunc(function(v,g){var y=v.maxPool(u,f);return g([u,y]),y},{x:u},function(v,g){var y=g[0],b=g[1];return{x:function(){return function(w,C,_,S,k,R,N,P){var F=T(w,"dy","maxPoolBackprop"),D=T(C,"input","maxPoolBackprop"),A=T(_,"output","maxPoolBackprop");O(D.rank===F.rank,function(){return"Rank of input ("+D.rank+") does not match rank of dy ("+F.rank+")"}),O(xn(k,R),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+k+" and dilations '"+R+"'"}),O(F.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+F.rank+"."}),O(D.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+D.rank+"."});var V=rs(D.shape,S,k,R,N,P);return j.runKernelFunc(function(U){return U.maxPoolBackprop(F,D,A,V)},{$dy:F,$input:D})}(v,y,b,t,e,r,o)}}},"MaxPool",f,d);return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function $0(n,t,e,r,o,i){var s=T(n,"x","avgPool","float32");O(xn(e,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"});var u=s,c=!1;s.rank===3&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),O(u.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+u.rank+"."}),i!=null&&O(xt(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var f=rs(u.shape,t,e,r,o,i);if(f.filterWidth===1&&f.filterHeight===1&&Ot(f.inShape,f.outShape))return s.clone();var d=j.runKernelFunc(function(p){return p.avgPool(u,f)},{x:u},function(p){return{x:function(){return function(v,g,y,b,w,C){var _=T(v,"dy","avgPoolBackprop"),S=T(g,"input","avgPoolBackprop");O(S.rank===_.rank,function(){return"Rank of input ("+S.rank+") does not match rank of dy ("+_.rank+")"}),O(xn(b,w),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+w+"'"});var k=S,R=_,N=!1;S.rank===3&&(N=!0,k=S.as4D(1,S.shape[0],S.shape[1],S.shape[2]),R=_.as4D(1,_.shape[0],_.shape[1],_.shape[2])),O(R.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+R.rank+"."}),O(k.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+k.rank+"."});var P=rs(k.shape,y,b,w,C),F=j.runKernelFunc(function(D){return D.avgPoolBackprop(R,k,P)},{dy4D:R,input4D:k});return N?F.as3D(F.shape[1],F.shape[2],F.shape[3]):F}(p,u,t,e,r,o)}}},"AvgPool",f);return d=d.cast(s.dtype),c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}var Ft=B({maxPool_:function(n,t,e,r,o){return K0(n,t,e,1,r,o)}}),vs=B({avgPool_:function(n,t,e,r,o){return $0(n,t,e,1,r,o)}}),YS=B({pool_:function(n,t,e,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");var s=T(n,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),O(xn(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var f,d=rs(u.shape,t,i,o,r),p=[d.dilationHeight,d.dilationWidth];f=r==="same"?function(k,R){var N=k.map(function(D,A){return D+(D-1)*(R[A]-1)}).map(function(D){return D-1}),P=N.map(function(D){return Math.floor(D/2)}),F=N.map(function(D,A){return D-P[A]});return N.map(function(D,A){return[P[A],F[A]]})}([d.filterHeight,d.filterWidth],p):[[0,0],[0,0]];var v=p[0]===1&&p[1]===1,g=function(k,R,N){var P=N.map(function(te){return te[0]}),F=N.map(function(te){return te[1]}),D=k.concat(P,F),A=R.map(function(te,ee){return(te-D[ee]%te)%te}),V=F.map(function(te,ee){return te+A[ee]}),U=R.map(function(te,ee){return[P[ee],V[ee]]}),re=R.map(function(te,ee){return[0,A[ee]]});return[U,re]}([d.inHeight,d.inWidth],p,f),y=g[0],b=g[1],w=v?r:"valid",C=v?u:e0(u,p,y),_=(e==="avg"?function(){return $0(C,t,i,1,w)}:function(){return K0(C,t,i,1,w)})(),S=v?_:Qy(_,p,b);return c?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),QS=B({maxPool3d_:function(n,t,e,r,o,i,s){i===void 0&&(i="NDHWC");var u=T(n,"x","maxPool3d"),c=u,f=!1;u.rank===4&&(f=!0,c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),s==null&&(s=[1,1,1]),O(c.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+c.rank+"."}),O(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),O(xn(e,s),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+s+"'"}),o!=null&&O(xt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var d=hl(c.shape,t,e,s,r,o,i),p=j.runKernelFunc(function(v,g){var y=v.maxPool3d(c,d);return g([c,y]),y},{x:c},function(v,g){var y=g[0],b=g[1];return{x:function(){return function(w,C,_,S,k,R,N,P){var F=T(w,"dy","maxPool3dBackprop"),D=T(C,"input","maxPool3dBackprop"),A=T(_,"output","maxPool3dBackprop"),V=F,U=D,re=A,te=!1;D.rank===4&&(te=!0,V=F.as5D(1,F.shape[0],F.shape[1],F.shape[2],F.shape[3]),U=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3]),re=A.as5D(1,A.shape[0],A.shape[1],A.shape[2],A.shape[3])),O(V.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+V.rank+"."}),O(U.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+U.rank+"."}),O(re.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+re.rank+"."}),R==null&&(R=[1,1,1]),O(xn(k,R),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+k+" and dilations '"+R+"'"}),P!=null&&O(xt(N),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+P+" but got pad "+N+"."});var ee=hl(U.shape,S,k,R,N,P),G=j.runKernelFunc(function(q){return q.maxPool3dBackprop(V,U,re,ee)},{dy5D:V,input5D:U});return te?G.as4D(G.shape[1],G.shape[2],G.shape[3],G.shape[4]):G}(v,y,b,t,e,s,r,o)}}});return f?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),JS=B({avgPool3d_:function(n,t,e,r,o,i,s){i===void 0&&(i="NDHWC");var u=T(n,"x","avgPool3d","float32"),c=u,f=!1;u.rank===4&&(f=!0,c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),s==null&&(s=[1,1,1]),O(c.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+c.rank+"."}),O(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),O(xn(e,s),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+s+"'"}),o!=null&&O(xt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var d=hl(c.shape,t,e,s,r,o,i),p=j.runKernelFunc(function(v){return v.avgPool3d(c,d)},{x:c},function(v){return{x:function(){return function(g,y,b,w,C,_,S){var k=T(g,"dy","avgPool3dBackprop"),R=T(y,"input","avgPool3dBackprop"),N=k,P=R,F=!1;R.rank===4&&(F=!0,N=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3]),P=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3])),O(N.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."}),O(P.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+P.rank+"."}),C==null&&(C=[1,1,1]),O(xn(w,C),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+C+"'"}),S!=null&&O(xt(_),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+_+"."});var D=hl(P.shape,b,w,C,_,S),A=j.runKernelFunc(function(V){return V.avgPool3dBackprop(N,P,D)},{dy5D:N,input5D:P});return F?A.as4D(A.shape[1],A.shape[2],A.shape[3],A.shape[4]):A}(v,c,t,e,s,r,o)}}});return p=p.cast(c.dtype),f?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),br=B({slice_:function(n,t,e){var r,o,i=T(n,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof t=="number"?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice()).forEach(function(c){O(c!==-1,function(){return"slice() does not support negative begin indexing."})}),o=(o=e==null?new Array(i.rank).fill(-1):typeof e=="number"?[e].concat(new Array(i.rank-1).fill(-1)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(-1)):e).map(function(c,f){return c>=0?c:(O(c===-1,function(){return"Negative size values should be exactly -1 but got "+c+" for the slice() size at index "+f+"."}),i.shape[f]-r[f])}),kC(i,r,o);var s=i.shape,u={begin:r,size:o};return j.runKernelFunc(function(c){return c.slice(i,r,o)},{x:i},function(c){for(var f=[],d=0;d<c.rank;d++)f.push([r[d],s[d]-r[d]-o[d]]);return{x:function(){return c.pad(f)}}},"Slice",u)}}),ZS=B({slice1d_:function(n,t,e){var r=T(n,"x","slice1d");return O(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),br(r,[t],[e])}}),ek=B({slice2d_:function(n,t,e){var r=T(n,"x","slice2d");return O(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),br(r,t,e)}}),X0=B({slice3d_:function(n,t,e){var r=T(n,"x","slice3d");return O(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),br(r,t,e)}}),tk=B({slice4d_:function(n,t,e){var r=T(n,"x","slice4d");return O(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),br(r,t,e)}});function Y0(n,t,e,r,o){return t.rank<e.rank&&(t=t.reshape(yn(t.shape,r))),n.rank<e.rank&&(n=n.reshape(yn(n.shape,r))),{x:function(){var i=n.mul(e.equal(t).cast(n.dtype));return o==null?i:i.transpose(o)}}}var nk=B({all_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=T(n,"x","all","bool"),o=Tt(t,r.shape),i=o,s=_r(i,r.rank);s!=null&&(r=r.transpose(s),i=Sr(i.length,r.rank));var u=j.runKernelFunc(function(f){return f.all(r,i)},{$x:r});if(e){var c=yn(u.shape,o);return u.reshape(c)}return u}}),rk=B({any_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=T(n,"x","any","bool"),o=Tt(t,r.shape),i=o,s=_r(i,r.rank);s!=null&&(r=r.transpose(s),i=Sr(i.length,r.rank));var u=j.runKernelFunc(function(f){return f.any(r,i)},{$x:r});if(e){var c=yn(u.shape,o);return u.reshape(c)}return u}}),ok=B({argMax_:function(n,t){t===void 0&&(t=0);var e=T(n,"x","argMax");t==null&&(t=0);var r=Tt(t,e.shape),o=_r(r,e.rank);o!=null&&(e=e.transpose(o),r=Sr(r.length,e.rank));var i={axis:r[0]},s=[e];return j.runKernelFunc(function(u,c){var f=u.argMax(e,r[0]);return c([e]),f},{x:e},function(u,c){var f=c[0];return{x:function(){return Ke(f)}}},"ArgMax",i,s)}}),ik=B({argMin_:function(n,t){t===void 0&&(t=0);var e=T(n,"x","argMin");t==null&&(t=0);var r=Tt(t,e.shape),o=_r(r,e.rank);return o!=null&&(e=e.transpose(o),r=Sr(r.length,e.rank)),j.runKernelFunc(function(i,s){var u=i.argMin(e,r[0]);return s([e]),u},{$x:e},function(i,s){var u=s[0];return{$x:function(){return Ke(u)}}})}}),ak=B({logSumExp_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=T(n,"x","logSumExp"),o=Tt(t,r.shape),i=r.max(o,!0),s=r.sub(i).exp().sum(o).log(),u=i.reshape(s.shape).add(s);if(e){var c=yn(u.shape,o);return u.reshape(c)}return u}}),Ml=B({max_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=T(n,"x","max"),o=r,i=Tt(t,r.shape),s=i,u=_r(s,r.rank);u!=null&&(r=r.transpose(u),s=Sr(s.length,r.rank));var c=[r],f=j.runKernelFunc(function(p,v){var g=p.max(r,s);return v([o,g]),g},{x:r},function(p,v){return Y0(p,v[1],v[0],i,u)},"Max",{axes:s},c,[!0]);if(e){var d=yn(f.shape,i);f=f.reshape(d)}return f}}),sk=B({mean_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=T(n,"x","mean"),o=Tt(t,r.shape),i=Re($t(r.shape,o)[1]);return Dl(function(s){var u=ve(i);return{value:(u.dtype===s.dtype?s:s.cast(u.dtype)).div(u).sum(t,e),gradFunc:function(c){var f=s.shape.slice();return o.forEach(function(d){f[d]=1}),c.reshape(f).mul(na(s.shape,"float32")).div(i)}}})(r)}}),uk=B({min_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=T(n,"x","min"),o=r,i=Tt(t,r.shape),s=i,u=_r(s,r.rank);u!=null&&(r=r.transpose(u),s=Sr(s.length,r.rank));var c=[r],f=j.runKernelFunc(function(p,v){var g=p.min(r,s);return v([o,g]),g},{x:r},function(p,v){return Y0(p,v[1],v[0],i,u)},"Min",{axes:s},c,[!0]);if(e){var d=yn(f.shape,i);f=f.reshape(d)}return f}}),lk=B({moments_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=Tt(t,(n=T(n,"x","moments")).shape),o=n.mean(r,e),i=o.shape;e||(i=yn(o.shape,r));var s=n.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:s.mean(r,e)}}}),Q0=B({sum_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=T(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var o=Tt(t,r.shape);return Dl(function(i){var s=_r(o,i.rank),u=o,c=i;s!=null&&(c=i.transpose(s),u=Sr(u.length,i.rank));var f=function(g){var y=i.shape.slice();return o.forEach(function(b){y[b]=1}),g.reshape(y).mul(na(i.shape,"float32"))},d={axes:u},p=j.runKernelFunc(function(g){return g.sum(c,u)},{x:c},function(g){return{x:function(){return f(g)}}},"Sum",d);if(e){var v=yn(p.shape,o);p=p.reshape(v)}return{value:p,gradFunc:f}})(r)}}),ck=B({prod_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=T(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var o=Tt(t,r.shape),i=_r(o,r.rank),s=o,u=r;i!=null&&(u=r.transpose(i),s=Sr(s.length,r.rank));var c=j.runKernelFunc(function(d){return d.prod(u,s)},{permutedX:u});if(e){var f=yn(c.shape,o);c=c.reshape(f)}return c}}),J0=B({elu_:function(n){var t=T(n,"x","elu");return j.runKernelFunc(function(e,r){var o=e.elu(t);return r([o]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return j.runKernelFunc(function(i){return i.eluDer(e,o)},{dy:e,y:o})}}})}}),fk=B({leakyRelu_:function(n,t){t===void 0&&(t=.2);var e=T(n,"x","leakyRelu");return wh(ve(t).mul(e),e)}}),Z0=B({prelu_:function(n,t){var e=T(n,"x","prelu"),r=T(t,"alpha","prelu");return j.runKernelFunc(function(o,i){var s=o.prelu(e,r);return i([e,r]),s},{x:e,alpha:r},function(o,i){var s=i[0],u=i[1],c=s.greater(0);return{x:function(){return Jo(c,o,o.mul(u))},alpha:function(){var f=Jo(c,Ke(o),o.mul(s)),d=It(u.shape,o.shape);return d.length>0&&(f=f.sum(d)),f.reshape(u.shape)}}},"Prelu")}}),dt=B({relu_:function(n){var t=T(n,"x","relu");return t.dtype==="bool"?t.toInt():j.runKernelFunc(function(e,r){var o=e.relu(t);return r([t]),o},{x:t},function(e,r){var o=r[0];return{x:function(){return e.mulStrict(o.step().toFloat())}}},"Relu")}}),e1=B({relu6_:function(n){var t=T(n,"x","relu6");return t.dtype==="bool"?t.toInt():j.runKernelFunc(function(e,r){var o=e.relu6(t);return r([t]),o},{x:t},function(e,r){var o=r[0],i=o.lessEqual(6).mul(o.step());return{x:function(){return e.mulStrict(i.toFloat())}}},"Relu6")}}),dk=B({selu_:function(n){var t=T(n,"x","selu");return j.runKernelFunc(function(e,r){var o=e.selu(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){var i=o.greater(ve(0)),s=ve(gh),u=ve(yh),c=e.mul(u),f=e.mul(s).mul(o.toFloat().exp());return Jo(i,c,f)}}})}}),Co=B({transpose_:function(n,t){var e=T(n,"x","transpose");if(t==null&&(t=e.shape.map(function(o,i){return i}).reverse()),O(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+t+"."}),t.forEach(function(o){O(o>=0&&o<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+t})}),e.rank<=1)return e.clone();var r={perm:t};return j.runKernelFunc(function(o){return o.transpose(e,t)},{x:e},function(o){var i=sh(t);return{x:function(){return o.transpose(i)}}},"Transpose",r)}}),hk=B({localResponseNormalization_:function(n,t,e,r,o){t===void 0&&(t=5),e===void 0&&(e=1),r===void 0&&(r=1),o===void 0&&(o=.5);var i=T(n,"x","localResponseNormalization");O(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),O(xt(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var s=i,u=!1;i.rank===3&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var c=j.runKernelFunc(function(f,d){var p=f.localResponseNormalization4D(s,t,e,r,o);return d([s,p]),p},{x4D:s},function(f,d){var p=d[0],v=d[1];return{x4D:function(){return j.runKernelFunc(function(g){return g.LRNGrad(f,p,v,t,e,r,o)},{})}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),t1=B({norm_:function(n,t,e,r){t===void 0&&(t="euclidean"),e===void 0&&(e=null),r===void 0&&(r=!1);var o=function u(c,f,d){if(d===void 0&&(d=null),c.rank===0)return c.abs();if(c.rank!==1&&d===null)return u(c.reshape([-1]),f,d);if(c.rank===1||typeof d=="number"||Array.isArray(d)&&d.length===1){if(f===1)return c.abs().sum(d);if(f===1/0)return c.abs().max(d);if(f===-1/0)return c.abs().min(d);if(f==="euclidean"||f===2)return c.abs().pow(ve(2,"int32")).sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+f)}if(Array.isArray(d)&&d.length===2){if(f===1)return c.abs().sum(d[0]).max(d[1]-1);if(f===1/0)return c.abs().sum(d[1]).max(d[0]);if(f===-1/0)return c.abs().sum(d[1]).min(d[0]);if(f==="fro"||f==="euclidean")return c.square().sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+f)}throw new Error("Error in norm: invalid axis: "+d)}(n=T(n,"x","norm"),t,e),i=o.shape;if(r){var s=Tt(e,n.shape);i=yn(o.shape,s)}return o.reshape(i)}}),pk=B({basicLSTMCell_:function(n,t,e,r,o,i){var s=T(n,"forgetBias","basicLSTMCell"),u=T(t,"lstmKernel","basicLSTMCell"),c=T(e,"lstmBias","basicLSTMCell"),f=T(r,"data","basicLSTMCell"),d=T(o,"c","basicLSTMCell"),p=T(i,"h","basicLSTMCell"),v=f.concat(p,1).matMul(u).add(c),g=v.shape[0],y=v.shape[1]/4,b=[g,y],w=v.slice([0,0],b),C=v.slice([0,y],b),_=v.slice([0,2*y],b),S=v.slice([0,3*y],b),k=w.sigmoid().mulStrict(C.tanh()).addStrict(d.mulStrict(s.add(_).sigmoid())),R=k.tanh().mulStrict(S.sigmoid());return[k,R]}}),vk=B({multiRNNCell_:function(n,t,e,r){for(var o=T(t,"data","multiRNNCell"),i=sl(e,"c","multiRNNCell"),s=sl(r,"h","multiRNNCell"),u=o,c=[],f=0;f<n.length;f++){var d=n[f](u,i[f],s[f]);c.push(d[0]),c.push(d[1]),u=d[1]}var p=[],v=[];for(f=0;f<c.length;f+=2)p.push(c[f]),v.push(c[f+1]);return[p,v]}}),mk=B({movingAverage_:function(n,t,e,r,o){o===void 0&&(o=!0);var i=T(n,"v","movingAverage"),s=T(t,"x","movingAverage"),u=T(e,"decay","movingAverage");hb(i,s),O(Ot(i.shape,s.shape),function(){return"Shape mismatch in v and x"});var c=ve(1),f=c.sub(u),d=s.sub(i).mul(f);if(o){O(r!=null,function(){return"When using zeroDebias: true, step is required."});var p=T(r,"step","movingAverage");d=d.div(c.sub(gl(u,p)))}return i.add(d)}}),gk=B({stridedSlice_:function(n,t,e,r,o,i,s,u,c){if(o===void 0&&(o=0),i===void 0&&(i=0),s===void 0&&(s=0),u===void 0&&(u=0),c===void 0&&(c=0),r==null&&(r=new Array(t.length)),s!==0)throw new Error("ellipsis mask is not yet supported");var f=T(n,"x","stridedSlice"),d=wg(u),p=f.shape.slice();d.forEach(function(w){t[w]=0,e[w]=1,p.splice(w,0,1)}),f=f.reshape(p);for(var v=0;v<f.rank;v++)t[v]=RC(o,t,r,f.shape,v),e[v]=IC(i,e,r,f.shape,v),r[v]=r[v]||1;var g=wg(c);g.forEach(function(w){e[w]=t[w]+1,r[w]=1});var y=fh(t,e,r),b=y.filter(function(w,C){return g.indexOf(C)===-1});return r.every(function(w){return w===1})?br(f,t,y).reshape(b):j.runKernelFunc(function(w){return w.stridedSlice(f,t,e,r)},{$x:f}).reshape(b)}}),yk=B({topk_:function(n,t,e){t===void 0&&(t=1),e===void 0&&(e=!0);var r=T(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var i=j.runKernelFunc(function(s){return s.topk(r,t,e)},{$x:r});return{values:i[0],indices:i[1]}}}),xk=B({scatterND_:function(n,t,e){var r=T(n,"indices","scatterND","int32"),o=T(t,"updates","scatterND");return SC(o,r,e),j.runKernelFunc(function(i){return i.scatterND(r,o,e)},{indices:r,updates:o},null,"ScatterNd",{shape:e})}}),_h=B({fft_:function(n){O(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var t=n.shape[n.shape.length-1],e=n.size/t,r=n.as2D(e,t);return j.runKernelFunc(function(o){return o.fft(r)},{input:n}).reshape(n.shape)}}),yl=B({ifft_:function(n){O(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var t=n.shape[n.shape.length-1],e=n.size/t,r=n.as2D(e,t);return j.runKernelFunc(function(o){return o.ifft(r)},{input:n}).reshape(n.shape)}}),Sh=B({rfft_:function(n,t){O(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+n.dtype});var e,r=n.shape[n.shape.length-1],o=n.size/r;if(t!=null&&t<r){var i=n.shape.map(function(C){return 0}),s=n.shape.map(function(C){return C});s[n.shape.length-1]=t,e=n.slice(i,s),r=t}else if(t!=null&&t>r){var u=n.shape.map(function(C){return C});u[n.shape.length-1]=t-r,e=n.concat(st(u),n.shape.length-1),r=t}else e=n;var c=e.zerosLike(),f=zt(e,c).as2D(o,r),d=_h(f),p=Math.floor(r/2)+1,v=Vn(d),g=mr(d),y=v.split([p,r-p],v.shape.length-1),b=g.split([p,r-p],g.shape.length-1),w=e.shape.slice();return w[e.shape.length-1]=p,zt(y[0],b[0]).reshape(w)}}),n1=B({irfft_:function(n){var t=n.shape[n.shape.length-1],e=n.size/t;if(t<=2){var r=n.as2D(e,t),o=yl(r);return Vn(o)}var i=[e,2*(t-1)],s=Vn(n).as2D(e,t),u=mr(n).as2D(e,t),c=s.slice([0,1],[e,t-2]).reverse(1),f=u.slice([0,1],[e,t-2]).reverse(1).mul(ve(-1)),d=s.concat(c,1),p=u.concat(f,1);return r=zt(d,p).as2D(i[0],i[1]),o=yl(r),Vn(o)}}),wk=Object.freeze({fft:_h,ifft:yl,rfft:Sh,irfft:n1}),bk=B({sparseToDense_:function(n,t,e,r){r===void 0&&(r=0);var o=T(n,"sparseIndices","sparseToDense","int32"),i=T(t,"sparseValues","sparseToDense"),s=T(r,"defaultValue","sparseToDense",i.dtype);return function(u,c,f,d){if(u.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+u.dtype+".");if(u.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+u.shape+".");var p=u.rank>0?u.shape[0]:1,v=u.rank>1?u.shape[1]:1;if(f.length!==v)throw new Error("outputShape has incorrect number of elements:, "+f.length+", should be: "+v+".");var g=c.size;if(c.rank!==0&&(c.rank!==1||g!==p))throw new Error("sparseValues has incorrect shape "+c.shape+", should be [] or ["+p+"]");if(c.dtype!==d.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,e,s),j.runKernelFunc(function(u){return u.sparseToDense(o,i,e,s)},{$sparseIndices:o,$sparseValues:i,$defaultValue:s})}}),Ck=B({gatherND_:function(n,t){var e=T(t,"indices","gatherND","int32"),r=T(n,"x","gatherND");return j.runKernelFunc(function(o){return o.gatherND(r,e)},{x:r,indices:e},null,"GatherNd")}}),Ek=B({diag_:function(n){var t=T(n,"x","diag").flatten(),e=n.shape.concat(n.shape);return j.runKernelFunc(function(r){return r.diag(t)},{$x:t}).reshape(e)}}),_k=B({dropout_:function(n,t,e,r){var o=T(n,"x","dropout");if(O(o.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),O(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),t===0)return n instanceof ft?o.clone():o;var i=function(c,f){if(f==null)return c.shape.slice();if(Ot(c.shape,f))return f;if(c.shape.length===f.length){for(var d=[],p=0;p<c.shape.length;p++)f[p]==null&&c.shape[p]!=null?d.push(c.shape[p]):d.push(f[p]);return d}return f}(o,e),s=1-t,u=Zy(i,0,1,"float32",r).add(s).floor().div(s);return o.mul(u)}});function r1(n,t,e){for(var r=1-n%2,o=new Float32Array(n),i=0;i<n;++i){var s=2*Math.PI*i/(n+r-1);o[i]=t-e*Math.cos(s)}return Ct(o,"float32")}var kh=B({hannWindow_:function(n){return r1(n,.5,.5)}}),o1=B({hammingWindow_:function(n){return r1(n,.54,.46)}}),Rh=B({frame_:function(n,t,e,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);for(var i=0,s=[];i+t<=n.size;)s.push(br(n,i,t)),i+=e;if(r)for(;i<n.size;){var u=i+t-n.size,c=kt([br(n,i,t-u),wr([u],o)]);s.push(c),i+=e}return s.length===0?xo([],[0,t]):kt(s).as2D(s.length,t)}}),i1=B({stft_:function(n,t,e,r,o){var i;o===void 0&&(o=kh),r==null&&(i=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var s=Rh(n,t,e),u=Zt(s,o(t)),c=[],f=0;f<s.shape[0];f++)c.push(Sh(u.slice([f,0],[1,t]),r));return kt(c)}}),Sk=Object.freeze({hannWindow:kh,hammingWindow:o1,frame:Rh,stft:i1}),Qt,kk=function(n,t,e){return e===void 0&&(e=1),Ee(this,void 0,void 0,function(){var r,o,i,s,u,c,f,d,p,v,g,y,b,w;return _e(this,function(C){switch(C.label){case 0:return r=T(n,"predictions","inTopK"),o=T(t,"targets","inTopK"),O(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),O(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),Je(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],O(e>0&&e<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+e}),[4,r.data()];case 1:return s=C.sent(),[4,o.data()];case 2:for(u=C.sent(),c=[s.length/i,i],d=c[1],p=es("bool",f=c[0]),v=0;v<f;v++){for(g=v*d,y=s.subarray(g,g+d),b=[],w=0;w<y.length;w++)b.push({value:y[w],index:w});for(b.sort(function(_,S){return S.value-_.value}),p[v]=0,w=0;w<e;w++)if(b[w].index===u[v]){p[v]=1;break}}return n!==r&&r.dispose(),t!==o&&o.dispose(),[2,Vt(p,o.shape,"bool")]}})})};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Qt||(Qt={}));var Rk=B({absoluteDifference_:function(n,t,e,r){r===void 0&&(r=Qt.SUM_BY_NONZERO_WEIGHTS);var o=T(n,"labels","absoluteDifference"),i=T(t,"predictions","absoluteDifference"),s=null;e!=null&&(s=T(e,"weights","absoluteDifference")),Je(o.shape,i.shape,"Error in absoluteDifference: ");var u=o.sub(i).abs();return Hr(u,s,r)}}),Hr=B({computeWeightedLoss_:function(n,t,e){e===void 0&&(e=Qt.SUM_BY_NONZERO_WEIGHTS);var r=T(n,"losses","computeWeightedLoss"),o=null;t!=null&&(o=T(t,"weights","computeWeightedLoss"));var i=o==null?r:r.mul(o);if(e===Qt.NONE)return i;if(e===Qt.SUM)return i.sum();if(e===Qt.MEAN){if(o==null)return i.mean();var s=r.size/o.size,u=i.sum().div(o.sum());return s>1?u.div(ve(s)):u}if(e===Qt.SUM_BY_NONZERO_WEIGHTS){if(o==null)return i.sum().div(ve(r.size));var c=o.mul(na(r.shape)).notEqual(ve(0)).sum().toFloat();return i.sum().div(c)}throw Error("Unknown reduction: "+e)}}),Ik=B({cosineDistance_:function(n,t,e,r,o){o===void 0&&(o=Qt.SUM_BY_NONZERO_WEIGHTS);var i=T(n,"labels","cosineDistance"),s=T(t,"predictions","cosineDistance"),u=null;r!=null&&(u=T(r,"weights","cosineDistance")),Je(i.shape,s.shape,"Error in cosineDistance: ");var c=ve(1).sub(i.mul(s).sum(e,!0));return Hr(c,u,o)}}),Nk=B({hingeLoss_:function(n,t,e,r){r===void 0&&(r=Qt.SUM_BY_NONZERO_WEIGHTS);var o=T(n,"labels","hingeLoss"),i=T(t,"predictions","hingeLoss"),s=null;e!=null&&(s=T(e,"weights","hingeLoss")),Je(o.shape,i.shape,"Error in hingeLoss: ");var u=ve(1);o=ve(2).mul(o).sub(u);var c=u.sub(o.mul(i)).relu();return Hr(c,s,r)}}),Tk=B({huberLoss_:function(n,t,e,r,o){r===void 0&&(r=1),o===void 0&&(o=Qt.SUM_BY_NONZERO_WEIGHTS);var i=T(n,"labels","huberLoss"),s=T(t,"predictions","huberLoss"),u=null;e!=null&&(u=T(e,"weights","huberLoss")),Je(i.shape,s.shape,"Error in huberLoss: ");var c=ve(r),f=s.sub(i).abs(),d=B0(f,c),p=f.sub(d),v=ve(.5).mul(d.square()).add(c.mul(p));return Hr(v,u,o)}}),Dk=B({logLoss_:function(n,t,e,r,o){r===void 0&&(r=1e-7),o===void 0&&(o=Qt.SUM_BY_NONZERO_WEIGHTS);var i=T(n,"labels","logLoss"),s=T(t,"predictions","logLoss"),u=null;e!=null&&(u=T(e,"weights","logLoss")),Je(i.shape,s.shape,"Error in logLoss: ");var c=ve(1),f=ve(r),d=i.mul(s.add(f).log()).neg().sub(c.sub(i).mul(c.sub(s).add(f).log()));return Hr(d,u,o)}}),Ak=B({meanSquaredError_:function(n,t,e,r){r===void 0&&(r=Qt.SUM_BY_NONZERO_WEIGHTS);var o=T(n,"labels","meanSquaredError"),i=T(t,"predictions","meanSquaredError"),s=null;e!=null&&(s=T(e,"weights","meanSquaredError")),Je(o.shape,i.shape,"Error in meanSquaredError: ");var u=o.squaredDifference(i);return Hr(u,s,r)}}),Pk=B({sigmoidCrossEntropy_:function(n,t,e,r,o){r===void 0&&(r=0),o===void 0&&(o=Qt.SUM_BY_NONZERO_WEIGHTS);var i=T(n,"multiClassLabels","sigmoidCrossEntropy"),s=T(t,"logits","sigmoidCrossEntropy"),u=null;if(e!=null&&(u=T(e,"weights","sigmoidCrossEntropy")),Je(i.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){var c=ve(r),f=ve(1),d=ve(.5);i=i.mul(f.sub(c)).add(d.mul(c))}var p=function(v,g){var y=T(v,"labels","sigmoidCrossEntropyWithLogits"),b=T(g,"logits","sigmoidCrossEntropyWithLogits");Je(y.shape,b.shape,"Error in sigmoidCrossEntropyWithLogits: ");var w=b.relu(),C=b.mul(y),_=b.abs().neg().exp().log1p();return w.sub(C).add(_)}(i,s);return Hr(p,u,o)}}),Fk=B({softmaxCrossEntropy_:function(n,t,e,r,o){r===void 0&&(r=0),o===void 0&&(o=Qt.SUM_BY_NONZERO_WEIGHTS);var i=T(n,"onehotLabels","softmaxCrossEntropy"),s=T(t,"logits","softmaxCrossEntropy"),u=null;if(e!=null&&(u=T(e,"weights","softmaxCrossEntropy")),Je(i.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var c=ve(r),f=ve(1),d=ve(i.shape[1]);i=i.mul(f.sub(c)).add(c.div(d))}var p=function(v,g,y){if(y===void 0&&(y=-1),y===-1&&(y=g.rank-1),y!==g.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+g.rank+" and dim was "+y);return Dl(function(b,w,C){var _=w.logSumExp([y],!0),S=w.toFloat().sub(_);return C([b,S]),{value:S.mul(b).neg().sum([y]),gradFunc:function(k,R){var N=R[0],P=R[1],F=yn(k.shape,[y]);return[k.reshape(F).mul(N.toFloat().sub(P.exp())),k.reshape(F).mul(P.exp().sub(N.toFloat()))]}}})(v,g)}(i,s);return Hr(p,u,o)}}),Ok=Object.freeze({get Reduction(){return Qt},absoluteDifference:Rk,computeWeightedLoss:Hr,cosineDistance:Ik,hingeLoss:Nk,huberLoss:Tk,logLoss:Dk,meanSquaredError:Ak,sigmoidCrossEntropy:Pk,softmaxCrossEntropy:Fk});function Vg(n,t){return t===void 0&&(t=!1),j.tidy(function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var e=n.shape[0],r=n.shape[1],o=Jy(e),i=n.clone(),s=xo([[1]],[1,1]),u=s.clone(),c=e>=r?r:e,f=function(p){var v,g=i,y=u,b=o;v=j.tidy(function(){var w=i.slice([p,p],[e-p,1]),C=w.norm(),_=i.slice([p,p],[1,1]),S=xo([[-1]]).where(_.greater(0),xo([[1]])),k=_.sub(S.mul(C)),R=w.div(k);u=R.shape[0]===1?s.clone():s.concat(R.slice([1,0],[R.shape[0]-1,R.shape[1]]),0);var N=S.matMul(k).div(C).neg(),P=i.slice([p,0],[e-p,r]),F=N.mul(u);if(p===0)i=P.sub(F.matMul(u.transpose().matMul(P)));else{var D=P.sub(F.matMul(u.transpose().matMul(P)));i=i.slice([0,0],[p,r]).concat(D,0)}var A=o.slice([0,p],[e,o.shape[1]-p]);if(p===0)o=A.sub(A.matMul(u).matMul(F.transpose()));else{var V=A.sub(A.matMul(u).matMul(F.transpose()));o=o.slice([0,0],[e,p]).concat(V,1)}return[u,i,o]}),u=v[0],i=v[1],o=v[2],vn([g,y,b])},d=0;d<c;++d)f(d);return!t&&e>r&&(o=o.slice([0,0],[e,r]),i=i.slice([0,0],[r,r])),[o,i]})}var Mk=B({bandPart_:function(n,t,e){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var r=T(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),s=i[0],u=i[1];if(!(t<=s))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+s+").");if(!(e<=u))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+u+").");t<0&&(t=s),e<0&&(e=u);var c=ul(0,s,1,"int32").reshape([-1,1]),f=ul(0,u,1,"int32"),d=Nt(c,f),p=Pl(d.lessEqual(ve(+t,"int32")),d.greaterEqual(ve(-e,"int32"))),v=st([s,u],r.dtype);return Tn(Rt(r.reshape([-1,s,u])).map(function(g){return Jo(p,g,v)})).reshape(o)}}),Lk=B({gramSchmidt_:function(n){var t;if(Array.isArray(n)){t=!1,O(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=n[0].shape[0],r=function(c){O(n[c].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[c].shape[0]+" vs. "+e+")"})},o=1;o<n.length;++o)r(o)}else t=!0,n=lh(n,n.shape[0],0).map(function(c){return t0(c,[0])});O(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var i=[],s=n,u=function(c){i.push(j.tidy(function(){var f=s[c];if(c>0)for(var d=0;d<c;++d){var p=Q0(i[d].mulStrict(f)).mul(i[d]);f=f.sub(p)}return f.div(t1(f,"euclidean"))}))};for(o=0;o<n.length;++o)u(o);return t?Tn(i,0):i}}),Bk=B({qr_:function(n,t){if(t===void 0&&(t=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return Vg(n,t);var e=n.shape.slice(0,n.shape.length-2).reduce(function(s,u){return s*u}),r=Rt(n.reshape([e,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),o=[],i=[];return r.forEach(function(s){var u=Vg(s,t),c=u[0],f=u[1];o.push(c),i.push(f)}),[Tn(o,0).reshape(n.shape),Tn(i,0).reshape(n.shape)]}}),Wk=Object.freeze({bandPart:Mk,gramSchmidt:Lk,qr:Bk});function Ll(n,t,e,r,o,i){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),i==null&&(i=0);var s=n.shape[0];return e=Math.min(e,s),O(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),O(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),O(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),O(t.rank===1,function(){return"scores must be a 1D tensor"}),O(t.shape[0]===s,function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+t.shape[0]}),O(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var zk=B({resizeBilinear_:function(n,t,e){e===void 0&&(e=!1);var r=T(n,"images","resizeBilinear");O(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),O(t.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=t[0],u=t[1],c=j.runKernelFunc(function(f,d){return d([o]),f.resizeBilinear(o,s,u,e)},{x:o},function(f,d){return{x:function(){return j.runKernelFunc(function(p){return p.resizeBilinearBackprop(f,d[0],e)},{})}}},"ResizeBilinear",{alignCorners:e,newHeight:s,newWidth:u});return i?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),Uk=B({resizeNearestNeighbor_:function(n,t,e){e===void 0&&(e=!1);var r=T(n,"images","resizeNearestNeighbor");O(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),O(t.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),O(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=t[0],u=t[1],c=j.runKernelFunc(function(f,d){return d([o]),f.resizeNearestNeighbor(o,s,u,e)},{batchImages:o},function(f,d){return{batchImages:function(){return j.runKernelFunc(function(p){return p.resizeNearestNeighborBackprop(f,d[0],e)},{})}}});return i?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),Vk=B({nonMaxSuppression_:function(n,t,e,r,o){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var i=T(n,"boxes","nonMaxSuppression"),s=T(t,"scores","nonMaxSuppression"),u=Ll(i,s,e,r,o);e=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold;var c={maxOutputSize:e,iouThreshold:r,scoreThreshold:o};return j.runKernelFunc(function(f){return f.nonMaxSuppression(i,s,e,r,o)},{boxes:i,scores:s},null,"NonMaxSuppressionV3",c)}}),jk=function(n,t,e,r,o){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),Ee(this,void 0,void 0,function(){var i,s,u,c,f,d,p;return _e(this,function(v){switch(v.label){case 0:return i=T(n,"boxes","nonMaxSuppressionAsync"),s=T(t,"scores","nonMaxSuppressionAsync"),u=Ll(i,s,e,r,o),e=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,[4,Promise.all([i.data(),s.data()])];case 1:return c=v.sent(),f=c[0],d=c[1],p=hh(f,d,e,r,o),i!==n&&i.dispose(),s!==t&&s.dispose(),[2,p]}})})},Hk=B({nonMaxSuppressionWithScore_:function(n,t,e,r,o,i){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var s=T(n,"boxes","nonMaxSuppression"),u=T(t,"scores","nonMaxSuppression"),c=Ll(s,u,e,r,o,i),f={maxOutputSize:e=c.maxOutputSize,iouThreshold:r=c.iouThreshold,scoreThreshold:o=c.scoreThreshold,softNmsSigma:i=c.softNmsSigma},d=j.runKernel("NonMaxSuppressionV5",{boxes:s,scores:u},f);return{selectedIndices:d[0],selectedScores:d[1]}}}),Gk=function(n,t,e,r,o,i){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),Ee(this,void 0,void 0,function(){var s,u,c,f,d,p,v;return _e(this,function(g){switch(g.label){case 0:return s=T(n,"boxes","nonMaxSuppressionAsync"),u=T(t,"scores","nonMaxSuppressionAsync"),c=Ll(s,u,e,r,o,i),e=c.maxOutputSize,r=c.iouThreshold,o=c.scoreThreshold,i=c.softNmsSigma,[4,Promise.all([s.data(),u.data()])];case 1:return f=g.sent(),d=f[0],p=f[1],v=ph(d,p,e,r,o,i),s!==n&&s.dispose(),u!==t&&u.dispose(),[2,v]}})})},qk=B({cropAndResize_:function(n,t,e,r,o,i){var s=T(n,"image","cropAndResize"),u=T(t,"boxes","cropAndResize","float32"),c=T(e,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var f=u.shape[0];return O(s.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."}),O(u.rank===2&&u.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+f+",4] but had shape "+u.shape+"."}),O(c.rank===1&&c.shape[0]===f,function(){return"Error in cropAndResize: boxInd must be have size ["+f+"] but had shape "+u.shape+"."}),O(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),O(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),O(o==="bilinear"||o==="nearest",function(){return"method must be bilinear or nearest, but was "+o}),j.runKernelFunc(function(d,p){return d.cropAndResize(s,u,c,r,o,i)},{images:s,boxes:u,boxInd:c},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),Ih=Object.freeze({resizeBilinear:zk,resizeNearestNeighbor:Uk,nonMaxSuppression:Vk,nonMaxSuppressionAsync:jk,nonMaxSuppressionWithScore:Hk,nonMaxSuppressionWithScoreAsync:Gk,cropAndResize:qk}),Nh=function(n,t){return!(n>0)||t==="linear"},Th=function(n,t,e){if(e==null||e==="linear")return n;if(e==="relu")return n.mul(t.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},Dh=function(n,t){var e=t,r=It(n.shape,t.shape);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},Ah=function(n,t,e){if(t==="linear")return n;if(t==="relu")return dt(n);if(t==="elu")return J0(n);if(t==="relu6")return e1(n);if(t==="prelu")return Z0(n,e);throw new Error("Unknown fused activation "+t+".")},Kk=B({fusedMatMul_:function(n){var t,e=n.a,r=n.b,o=n.transposeA,i=o!==void 0&&o,s=n.transposeB,u=s!==void 0&&s,c=n.bias,f=n.activation,d=f===void 0?"linear":f,p=n.preluActivationWeights;if(Nh(j.state.gradientDepth,d)===!1){var v=Ol(e,r,i,u);return c!=null&&(v=je(v,c)),Ah(v,d,p)}var g=T(e,"a","fused matMul"),y=T(r,"b","fused matMul");t=pt(g,y),g=t[0],y=t[1];var b=i?g.shape[g.rank-2]:g.shape[g.rank-1],w=u?y.shape[y.rank-1]:y.shape[y.rank-2],C=i?g.shape[g.rank-1]:g.shape[g.rank-2],_=u?y.shape[y.rank-2]:y.shape[y.rank-1],S=g.shape.slice(0,-2),k=y.shape.slice(0,-2),R=Re(S),N=Re(k);O(g.rank>=2&&y.rank>=2&&g.rank===y.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+g.rank+" and "+y.rank+"."}),O(Ot(S,k),function(){return"Error in fused matMul: outer dimensions ("+S+") and ("+k+") of Tensors with shapes "+g.shape+" and "+y.shape+" must match."}),O(b===w,function(){return"Error in fused matMul: inner shapes ("+b+") and ("+w+") of Tensors with shapes "+g.shape+" and "+y.shape+" and transposeA="+i+" and transposeB="+u+" must match."});var P,F,D=g.shape.slice(0,-2).concat([C,_]),A=i?g.as3D(R,b,C):g.as3D(R,C,b),V=u?y.as3D(N,_,w):y.as3D(N,w,_);c!=null&&He(D,(P=pt(P=T(c,"bias","fused matMul"),g)[0]).shape),p!=null&&(F=T(p,"prelu weights","fused matMul"));var U={a:A,b:V};c!=null&&(U.bias=P),p!=null&&(U.preluActivationWeights=F);var re=[A,V];return j.runKernelFunc(function(te,ee){var G=te.fusedBatchMatMul({a:A,b:V,transposeA:i,transposeB:u,bias:P,activation:d,preluActivationWeights:F});return ee([A,V,G]),G},U,function(te,ee){var G=ee[0],q=ee[1],W=ee[2],Y=Th(te,W,d),K={};return c!=null&&(K={bias:function(){return Dh(P,Y)}}),Object.assign(i||u?!i&&u?{a:function(){return Y.matMul(q,!1,!1)},b:function(){return Y.matMul(G,!0,!1)}}:i&&!u?{a:function(){return q.matMul(Y,!1,!0)},b:function(){return G.matMul(Y,!1,!1)}}:{a:function(){return q.matMul(Y,!0,!0)},b:function(){return Y.matMul(G,!0,!0)}}:{a:function(){return Y.matMul(q,!1,!0)},b:function(){return G.matMul(Y,!0,!1)}},K)},"_FusedMatMul",{transposeA:i,transposeB:u,activation:d},re,[!0]).reshape(D)}}),$k=B({fusedConv2d_:function(n){var t=n.x,e=n.filter,r=n.strides,o=n.pad,i=n.dataFormat,s=i===void 0?"NHWC":i,u=n.dilations,c=u===void 0?[1,1]:u,f=n.dimRoundingMode,d=n.bias,p=n.activation,v=p===void 0?"linear":p,g=n.preluActivationWeights;if(v=v||"linear",Nh(j.state.gradientDepth,v)===!1){var y=Hn(t,e,r,o,s,c,f);return d!=null&&(y=je(y,d)),Ah(y,v,g)}var b=T(t,"x","conv2d"),w=T(e,"filter","conv2d"),C=b,_=!1;b.rank===3&&(_=!0,C=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),O(C.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+C.rank+"."}),O(w.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+w.rank+"."}),f!=null&&O(xt(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+f+" but got pad "+o+"."}),O(C.shape[3]===w.shape[2],function(){return"Error in conv2d: depth of input ("+C.shape[3]+") must match input depth for filter "+w.shape[2]+"."}),O(xn(r,c),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"}),O(s==="NHWC",function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."});var S,k,R=ri(C.shape,w.shape,r,c,o,f);d!=null&&(S=pt(S=T(d,"bias","fused conv2d"),b)[0],He(R.outShape,S.shape)),g!=null&&(k=T(g,"prelu weights","fused conv2d"));var N={x:C,filter:w};d!=null&&(N.bias=S),g!=null&&(N.preluActivationWeights=k);var P=[w,C],F=j.runKernelFunc(function(D,A){var V=D.fusedConv2d({input:C,filter:w,convInfo:R,bias:S,activation:v,preluActivationWeights:k});return A([w,C,V]),V},N,function(D,A){var V=A,U=V[0],re=V[1],te=V[2],ee=Th(D,te,v);O(ea(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+c+"'"});var G={};return d!=null&&(G={bias:function(){return Dh(S,ee)}}),Object.assign({x:function(){return H0(re.shape,ee,U,r,o)},filter:function(){return Ch(re,ee,U.shape,r,o)}},G)},"FusedConv2D",{convInfo:R,activation:v},P,[!0]);return _?F.as3D(F.shape[1],F.shape[2],F.shape[3]):F}}),Xk=B({fusedDepthwiseConv2d_:function(n){var t=n.x,e=n.filter,r=n.strides,o=n.pad,i=n.dataFormat,s=i===void 0?"NHWC":i,u=n.dilations,c=u===void 0?[1,1]:u,f=n.dimRoundingMode,d=n.bias,p=n.activation,v=p===void 0?"linear":p,g=n.preluActivationWeights;if(Nh(j.state.gradientDepth,v)===!1){var y=Fl(t,e,r,o,s,c,f);return d!=null&&(y=je(y,d)),Ah(y,v,g)}var b=T(t,"x","depthwiseConv2d"),w=T(e,"filter","depthwiseConv2d"),C=b,_=!1;b.rank===3&&(_=!0,C=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),O(C.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+C.rank+"."}),O(w.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+w.rank+"."}),O(C.shape[3]===w.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+C.shape[3]+") must match the inChannels dimension in filter "+w.shape[2]+"."}),c==null&&(c=[1,1]),O(xn(r,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"}),f!=null&&O(xt(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+f+" but got pad "+o+"."});var S,k,R=ri(C.shape,w.shape,r,c,o,f,!0);d!=null&&(S=pt(S=T(d,"bias","fused conv2d"),b)[0],He(R.outShape,S.shape)),g!=null&&(k=T(g,"prelu weights","fused depthwiseConv2d"));var N={x:C,filter:w};d!=null&&(N.bias=S),g!=null&&(N.preluActivationWeights=k);var P=[w,C],F=j.runKernelFunc(function(D,A){var V=D.fusedDepthwiseConv2D({input:C,filter:w,convInfo:R,bias:S,activation:v,preluActivationWeights:k});return A([w,C,V]),V},N,function(D,A){O(ea(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+c+"'"});var V=A[0],U=A[1],re=A[2],te=Th(D,re,v),ee={};return d!=null&&(ee={bias:function(){return Dh(S,te)}}),Object.assign({x:function(){return G0(U.shape,te,V,R)},filter:function(){return q0(U,te,V.shape,R)}},ee)},"FusedDepthwiseConv2D",{convInfo:R,activation:v},P,[!0]);return _?F.as3D(F.shape[1],F.shape[2],F.shape[3]):F}}),Yk=Object.freeze({matMul:Kk,conv2d:$k,depthwiseConv2d:Xk}),Qk=Object.freeze({image:Ih,linalg:Wk,losses:Ok,spectral:wk,fused:Yk,signal:Sk,square:D_,squaredDifference:I0,conv1d:zS,conv2d:Hn,conv3d:US,depthwiseConv2d:Fl,separableConv2d:Eh,conv2dTranspose:VS,conv3dTranspose:jS,op:B,batchNormalization2d:sS,batchNormalization3d:uS,batchNormalization4d:lS,batchNormalization:cS,batchNorm:F0,batchNorm2d:fS,batchNorm3d:dS,batchNorm4d:hS,booleanMaskAsync:WS,complex:zt,real:Vn,imag:mr,concat:kt,concat1d:Yb,concat2d:Qb,concat3d:Jb,concat4d:Zb,split:lh,matMul:Ol,dot:HS,outerProduct:GS,reverse:ps,reverse1d:qS,reverse2d:KS,reverse3d:$S,reverse4d:XS,maxPool:Ft,avgPool:vs,pool:YS,maxPool3d:QS,avgPool3d:JS,slice:br,slice1d:ZS,slice2d:ek,slice3d:X0,slice4d:tk,abs:A_,acos:P_,acosh:F_,asin:O_,asinh:M_,atan:L_,atanh:B_,ceil:W_,clipByValue:xh,cos:z_,cosh:U_,erf:V_,exp:zd,expm1:j_,floor:H_,log:G_,log1p:q_,logSigmoid:K_,neg:ml,reciprocal:$_,round:X_,rsqrt:N0,sigmoid:T0,sign:Y_,isNaN:Q_,isInf:J_,isFinite:Z_,sin:eS,sinh:tS,softplus:nS,sqrt:rS,step:oS,tan:iS,tanh:aS,all:nk,any:rk,argMax:ok,argMin:ik,logSumExp:ak,max:Ml,mean:sk,min:uk,moments:lk,sum:Q0,prod:ck,equal:W0,equalStrict:NS,greater:TS,greaterEqual:z0,greaterEqualStrict:DS,greaterStrict:AS,less:PS,lessEqual:FS,lessEqualStrict:OS,lessStrict:MS,notEqual:LS,notEqualStrict:BS,add:je,addN:mS,addStrict:gS,atan2:yS,div:Zn,divNoNan:xS,divStrict:wS,floorDiv:L0,maximum:wh,maximumStrict:bS,minimum:B0,minimumStrict:CS,mod:ES,modStrict:_S,mul:Zt,mulStrict:SS,pow:gl,powStrict:kS,squaredDifferenceStrict:RS,sub:Nt,subStrict:IS,elu:J0,leakyRelu:fk,prelu:Z0,relu:dt,relu6:e1,selu:dk,logicalAnd:Pl,logicalNot:pS,logicalOr:O0,logicalXor:vS,where:Jo,whereAsync:M0,buffer:Be,print:uC,batchToSpaceND:Qy,broadcastTo:lC,cast:cC,clone:fC,cumsum:dC,depthToSpace:hC,expandDims:Un,eye:Jy,multinomial:pC,oneHot:Md,pad:ni,pad1d:vC,pad2d:mC,pad3d:gC,pad4d:yC,rand:xC,randomNormal:wC,randomGamma:bC,randomUniform:Zy,reshape:er,spaceToBatchND:e0,squeeze:t0,stack:Tn,tile:Hi,truncatedNormal:CC,unstack:Rt,setdiff1dAsync:EC,fill:wr,linspace:Xb,ones:na,range:ul,scalar:ve,tensor:Vt,tensor1d:Ct,tensor2d:xo,tensor3d:uh,tensor4d:dn,tensor5d:qb,tensor6d:Kb,variable:$b,zeros:st,onesLike:Yy,zerosLike:Ke,transpose:Co,softmax:jr,logSoftmax:TC,localResponseNormalization:hk,norm:t1,gather:bh,unsortedSegmentSum:U0,basicLSTMCell:pk,multiRNNCell:vk,movingAverage:mk,stridedSlice:gk,topk:yk,scatterND:xk,fft:_h,ifft:yl,rfft:Sh,irfft:n1,sparseToDense:bk,gatherND:Ck,diag:Ek,dropout:_k,hannWindow:kh,hammingWindow:o1,frame:Rh,stft:i1,inTopKAsync:kk});function ue(n,t){Array.isArray(n)||(n=[n]),n.forEach(function(e){e!=null&&O(e.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})}function fd(n,t,e,r){if(e==="linear")return n.linear(t);if(e==="relu")return n.relu(t);if(e==="elu")return n.elu(t);if(e==="relu6")return n.relu6(t);if(e==="prelu")return n.prelu(t,r);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var Jk=function(n){function t(){var e=n.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new u0(e,j),e}return nr(t,n),t.prototype.write=function(e,r,o){this.firstUse&&(this.firstUse=!1,ae().get("IS_NODE")&&al(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var i={};return this.data.set(i,{values:e,dtype:o}),i},t.prototype.move=function(e,r,o,i){this.data.set(e,{values:r,dtype:i})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return Ee(this,void 0,void 0,function(){return _e(this,function(r){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var r=this.data.get(e),o=r.dtype,i=r.complexTensors;return o==="complex64"?Wd(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var r=this.readSync(e.dataId),o=r;if(e.dtype==="string")try{o=r.map(function(i){return rl(i)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Be(e.shape,e.dtype,o)},t.prototype.makeOutput=function(e,r,o){var i=this.write(e,r,o);return j.makeTensorFromDataId(i,r,o,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var r=this.data.get(e).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return Ee(this,void 0,void 0,function(){var r;return _e(this,function(o){return r=pr(),e(),[2,{kernelMs:pr()-r}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,r){var o=this.makeOutput(null,e.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:j.keep(e.clone()),imag:j.keep(r.clone())},o},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,r,o){if(ue(e,"slice"),a0(e.shape,r,o)){var i=s0(r,e.strides),s=Re(o);return Vt(this.readSync(e.dataId).subarray(i,i+s),o,e.dtype)}for(var u=Be(o,e.dtype),c=this.bufferSync(e),f=0;f<u.size;++f){var d=u.indexToLoc(f).map(function(p,v){return p+r[v]});u.values[f]=c.get.apply(c,d)}return u.toTensor()},t.prototype.stridedSlice=function(e,r,o,i){ue(e,"stridedSlice");var s=fh(r,o,i);if(s.some(function(g){return g===0}))return Vt([],s);for(var u=Be(s,e.dtype),c=this.bufferSync(e),f=0;f<u.size;f++){for(var d=u.indexToLoc(f),p=new Array(d.length),v=0;v<p.length;v++)p[v]=d[v]*i[v]+r[v];u.set.apply(u,[c.get.apply(c,p)].concat(d))}return u.toTensor()},t.prototype.diag=function(e){for(var r=this.readSync(e.dataId),o=Be([e.size,e.size],e.dtype),i=o.values,s=0;s<r.length;s++)i[s*e.size+s]=r[s];return o.toTensor()},t.prototype.unstack=function(e,r){for(var o=e.shape[r],i=new Array(e.rank-1),s=0,u=0;u<e.rank;u++)u!==r&&(i[s++]=e.shape[u]);var c=new Array(e.rank).fill(0),f=e.shape.slice();f[r]=1;var d=new Array(o);for(u=0;u<d.length;u++)c[r]=u,d[u]=this.slice(e,c,f).reshape(i);return d},t.prototype.reverse=function(e,r){ue(e,"reverse");for(var o=Be(e.shape,e.dtype),i=this.bufferSync(e),s=function(c){var f=o.indexToLoc(c),d=f.slice();r.forEach(function(p){return d[p]=e.shape[p]-1-d[p]}),o.set.apply(o,[i.get.apply(i,d)].concat(f))},u=0;u<o.size;u++)s(u);return o.toTensor()},t.prototype.concat=function(e,r){var o=this;if(e[0].dtype==="complex64"){var i=e.map(function(g){return Vn(g)}),s=e.map(function(g){return mr(g)});return zt(this.concat(i,r),this.concat(s,r))}var u=e.map(function(g){var y=Re(g.shape.slice(r));return g.as2D(-1,y)}),c=Zi(u.map(function(g){return g.shape}),1),f=Be(c,e[0].dtype).values;if(u[0].shape[0]===1){var d=0;u.forEach(function(g){f.set(o.readSync(g.dataId),d),d+=g.size})}else{var p=0;u.forEach(function(g){for(var y=o.readSync(g.dataId),b=0,w=0;w<g.shape[0];++w)for(var C=w*c[1]+p,_=0;_<g.shape[1];++_)f[C+_]=y[b++];p+=g.shape[1]})}var v=Zi(e.map(function(g){return g.shape}),r);return Vt(f,v,e[0].dtype)},t.prototype.neg=function(e){return ue(e,"neg"),this.multiply(ve(-1),e)},t.prototype.add=function(e,r){return e.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,s,u){return{real:o+s,imag:i+u}}):this.broadcastedBinaryOp(e,r,Ut(e.dtype,r.dtype),function(o,i){return o+i})},t.prototype.addN=function(e){var r=this;ue(e,"addN");for(var o=e.map(function(d){return r.readSync(d.dataId)}),i=Be(e[0].shape,e[0].dtype),s=i.values,u=0;u<e.length;u++)for(var c=o[u],f=0;f<s.length;f++)s[f]+=c[f];return i.toTensor()},t.prototype.softmax=function(e,r){var o=Tt([r],e.shape),i=this.max(e,o),s=yn(i.shape,o),u=this.subtract(e,i.reshape(s)),c=this.exp(u),f=this.sum(c,o).reshape(s);return this.realDivide(c,f)},t.prototype.subtract=function(e,r){return e.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,s,u){return{real:o-s,imag:i-u}}):this.broadcastedBinaryOp(e,r,Ut(e.dtype,r.dtype),function(o,i){return o-i})},t.prototype.pow=function(e,r){return ue([e,r],"pow"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.pow(o,i)})},t.prototype.batchMatMul=function(e,r,o,i){ue([e,r],"matMul");for(var s=o?e.shape[1]:e.shape[2],u=o?e.shape[2]:e.shape[1],c=i?r.shape[1]:r.shape[2],f=e.shape[0],d=this.readSync(e.dataId),p=this.readSync(r.dataId),v=o?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],g=v[0],y=v[1],b=v[2],w=i?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],C=w[0],_=w[1],S=w[2],k=u*c,R=Be([f,u,c],e.dtype),N=R.values,P=this.blockSize,F=0;F<f;F++)for(var D=0;D<u;D+=P)for(var A=0;A<c;A+=P)for(var V=0;V<s;V+=P)for(var U=Math.min(D+P,u),re=Math.min(A+P,c),te=Math.min(V+P,s),ee=D;ee<U;ee++)for(var G=A;G<re;G++){for(var q=0,W=V;W<te;W++)q+=d[F*g+ee*y+W*b]*p[W*C+G*_+F*S];N[F*k+(ee*c+G)]+=q}return R.toTensor()},t.prototype.fusedBatchMatMul=function(e){var r=e.a,o=e.b,i=e.transposeA,s=e.transposeB,u=e.bias,c=e.activation,f=e.preluActivationWeights,d=this.batchMatMul(r,o,i,s);return u&&(d=this.add(d,u)),c&&(d=fd(this,d,c,f)),d},t.prototype.multiply=function(e,r){return e.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,s,u){return{real:o*s-i*u,imag:o*u+i*s}}):this.broadcastedBinaryOp(e,r,Ut(e.dtype,r.dtype),function(o,i){return o*i})},t.prototype.realDivide=function(e,r){return ue([e,r],"realDivide"),this.broadcastedBinaryOp(e,r,"float32",function(o,i){return o/i})},t.prototype.floorDiv=function(e,r){return ue([e,r],"floorDiv"),this.broadcastedBinaryOp(e,r,"int32",function(o,i){return Math.floor(o/i)})},t.prototype.sum=function(e,r){ue(e,"sum"),Sn("sum",r,e.rank);for(var o=$t(e.shape,r),i=o[0],s=o[1],u=st(i,Ut(e.dtype,"int32")),c=Re(s),f=this.readSync(u.dataId),d=this.readSync(e.dataId),p=0;p<f.length;++p){for(var v=p*c,g=0,y=0;y<c;++y)g+=d[v+y];f[p]=g}return u},t.prototype.prod=function(e,r){ue(e,"sum");for(var o=$t(e.shape,r),i=o[0],s=o[1],u=st(i,Ut(e.dtype,"int32")),c=Re(s),f=this.readSync(u.dataId),d=this.readSync(e.dataId),p=0;p<f.length;++p){for(var v=p*c,g=1,y=0;y<c;++y)g*=d[v+y];f[p]=g}return u},t.prototype.unsortedSegmentSum=function(e,r,o){ue(e,"unsortedSegmentSum");for(var i=[],s=e.rank-r.rank,u=0;u<s;++u)r=r.expandDims(u+1);for(u=0;u<o;++u){var c=ve(u,"int32"),f=W0(c,r).asType("float32").mul(e).sum(0);i.push(f)}return Tn(i)},t.prototype.argMin=function(e,r){ue(e,"argMin");var o=[r];Sn("argMin",o,e.rank);for(var i=$t(e.shape,o),s=i[0],u=i[1],c=st(s,"int32"),f=Re(u),d=this.readSync(c.dataId),p=this.readSync(e.dataId),v=0;v<d.length;++v){for(var g=v*f,y=p[g],b=0,w=0;w<f;++w){var C=p[g+w];C<y&&(y=C,b=w)}d[v]=b}return c},t.prototype.argMax=function(e,r){ue(e,"argMax");var o=[r];Sn("argMax",o,e.rank);for(var i=$t(e.shape,o),s=i[0],u=i[1],c=st(s,"int32"),f=Re(u),d=this.readSync(c.dataId),p=this.readSync(e.dataId),v=0;v<d.length;++v){for(var g=v*f,y=p[g],b=0,w=0;w<f;++w){var C=p[g+w];C>y&&(y=C,b=w)}d[v]=b}return c},t.prototype.cumsum=function(e,r,o,i){if(ue(e,"cumsum"),r!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+r);for(var s=Ut(e.dtype,"int32"),u=st(e.shape,s),c=this.readSync(u.dataId),f=this.readSync(e.dataId),d=e.shape[e.rank-1],p=i?function(w,C){return w+d-C-1}:function(w,C){return w+C},v=0;v<f.length;v+=d)for(var g=0;g<d;g++){var y=p(v,g);if(g===0)c[y]=o?0:f[y];else{var b=p(v,g-1);c[y]=o?f[b]+c[b]:f[y]+c[b]}}return u},t.prototype.equal=function(e,r){return ue([e,r],"equal"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o===i?1:0})},t.prototype.notEqual=function(e,r){return ue([e,r],"notEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o!==i?1:0})},t.prototype.less=function(e,r){return ue([e,r],"less"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o<i?1:0})},t.prototype.lessEqual=function(e,r){return ue([e,r],"lessEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o<=i?1:0})},t.prototype.greater=function(e,r){return ue([e,r],"greater"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o>i?1:0})},t.prototype.greaterEqual=function(e,r){return ue([e,r],"greaterEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o>=i?1:0})},t.prototype.logicalNot=function(e){ue(e,"logicalNot");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)o[i]=r[i]?0:1;return this.makeOutput(o,e.shape,"bool")},t.prototype.logicalAnd=function(e,r){return ue([e,r],"logicalAnd"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o&&i})},t.prototype.logicalOr=function(e,r){return ue([e,r],"logicalOr"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o||i})},t.prototype.select=function(e,r,o){ue([e,r,o],"select");for(var i=this.readSync(e.dataId),s=this.readSync(r.dataId),u=this.readSync(o.dataId),c=st(r.shape,Ut(r.dtype,o.dtype)),f=this.readSync(c.dataId),d=0,p=e.rank===0||e.rank>1||r.rank===1?1:Re(r.shape.slice(1)),v=0;v<i.length;v++)for(var g=0;g<p;g++)i[v]===1?f[d++]=s[v]:f[d++]=u[v];return c},t.prototype.where=function(e){ue([e],"where");var r=this.readSync(e.dataId);return vh(e.shape,r)},t.prototype.topk=function(e,r,o){return ue(e,"topk"),m0(this.readSync(e.dataId),e.shape,e.dtype,r)},t.prototype.min=function(e,r){ue(e,"min"),Sn("min",r,e.rank);for(var o=$t(e.shape,r),i=o[0],s=o[1],u=st(i,e.dtype),c=Re(s),f=this.readSync(u.dataId),d=this.readSync(e.dataId),p=0;p<f.length;++p){for(var v=p*c,g=d[v],y=0;y<c;++y){var b=d[v+y];b<g&&(g=b)}f[p]=g}return u},t.prototype.minimum=function(e,r){return ue([e,r],"minimum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.min(o,i)})},t.prototype.mod=function(e,r){return ue([e,r],"mod"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){var s=o%i;return o<0&&i<0||o>=0&&i>=0?s:(s+i)%i})},t.prototype.max=function(e,r){ue(e,"max"),Sn("max",r,e.rank);for(var o=$t(e.shape,r),i=o[0],s=o[1],u=st(i,e.dtype),c=Re(s),f=this.readSync(u.dataId),d=this.readSync(e.dataId),p=0;p<f.length;++p){for(var v=p*c,g=d[v],y=0;y<c;++y){var b=d[v+y];b>g&&(g=b)}f[p]=g}return u},t.prototype.maximum=function(e,r){return ue([e,r],"maximum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.max(o,i)})},t.prototype.all=function(e,r){ue(e,"all"),Sn("all",r,e.rank);for(var o=$t(e.shape,r),i=o[0],s=o[1],u=st(i,e.dtype),c=Re(s),f=this.readSync(u.dataId),d=this.readSync(e.dataId),p=0;p<f.length;++p){for(var v=p*c,g=d[v],y=0;y<c;++y){var b=d[v+y];g=g&&b}f[p]=g}return u},t.prototype.any=function(e,r){ue(e,"any"),Sn("any",r,e.rank);for(var o=$t(e.shape,r),i=o[0],s=o[1],u=st(i,e.dtype),c=Re(s),f=this.readSync(u.dataId),d=this.readSync(e.dataId),p=0;p<f.length;++p){for(var v=p*c,g=d[v],y=0;y<c;++y){var b=d[v+y];g=g||b}f[p]=g}return u},t.prototype.squaredDifference=function(e,r){return ue([e,r],"squaredDifference"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){var s=o-i;return s*s})},t.prototype.ceil=function(e){ue(e,"ceil");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.ceil(r[i]);return this.makeOutput(o,e.shape,"float32")},t.prototype.floor=function(e){ue(e,"floor");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.floor(r[i]);return this.makeOutput(o,e.shape,"float32")},t.prototype.sign=function(e){ue(e,"x");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)r[i]<0?o[i]=-1:r[i]>0?o[i]=1:o[i]=0;return this.makeOutput(o,e.shape,"float32")},t.prototype.isNaN=function(e){ue(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isNaN(r[i])&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},t.prototype.isInf=function(e){ue(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Math.abs(r[i])===1/0&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},t.prototype.isFinite=function(e){ue(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isFinite(r[i])&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},t.prototype.round=function(e){ue(e,"round");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var s=Math.floor(r[i]);r[i]-s<.5?o[i]=Math.floor(r[i]):r[i]-s>.5?o[i]=Math.ceil(r[i]):o[i]=s%2==0?s:s+1}return this.makeOutput(o,e.shape,"float32")},t.prototype.exp=function(e){ue(e,"exp");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.exp(r[i]);return this.makeOutput(o,e.shape,"float32")},t.prototype.expm1=function(e){ue(e,"expm1");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.expm1(r[i]);return this.makeOutput(o,e.shape,"float32")},t.prototype.log=function(e){ue(e,"log");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var s=r[i];o[i]=Math.log(s)}return this.makeOutput(o,e.shape,"float32")},t.prototype.log1p=function(e){ue(e,"log1p");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var s=r[i];o[i]=Math.log1p(s)}return this.makeOutput(o,e.shape,"float32")},t.prototype.sqrt=function(e){ue(e,"sqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var s=r[i];o[i]=Math.sqrt(s)}return this.makeOutput(o,e.shape,"float32")},t.prototype.rsqrt=function(e){ue(e,"rsqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var s=r[i];o[i]=1/Math.sqrt(s)}return this.makeOutput(o,e.shape,"float32")},t.prototype.reciprocal=function(e){ue(e,"reciprocal");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/r[i];return this.makeOutput(o,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){ue(e,"relu");for(var r=st(e.shape,e.dtype),o=this.readSync(r.dataId),i=this.readSync(e.dataId),s=0;s<i.length;++s)o[s]=Math.max(0,i[s]);return r},t.prototype.relu6=function(e){ue(e,"relu");for(var r=st(e.shape,e.dtype),o=this.readSync(r.dataId),i=this.readSync(e.dataId),s=0;s<i.length;++s)o[s]=Math.min(Math.max(0,i[s]),6);return r},t.prototype.prelu=function(e,r){return ue([e,r],"prelu"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return o<0?i*o:o})},t.prototype.elu=function(e){ue(e,"elu");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var s=o[i];r[i]=s>=0?s:Math.exp(s)-1}return this.makeOutput(r,e.shape,"float32")},t.prototype.eluDer=function(e,r){ue([e,r],"eluDer");for(var o=new Float32Array(r.size),i=this.readSync(r.dataId),s=this.readSync(e.dataId),u=0;u<i.length;++u){var c=i[u];o[u]=c>=1?s[u]:s[u]*(c+1)}return this.makeOutput(o,r.shape,"float32")},t.prototype.selu=function(e){ue(e,"selu");for(var r=gh,o=yh,i=new Float32Array(e.size),s=this.readSync(e.dataId),u=0;u<s.length;++u){var c=s[u];i[u]=c>=0?o*c:r*(Math.exp(c)-1)}return this.makeOutput(i,e.shape,"float32")},t.prototype.clip=function(e,r,o){ue(e,"clip");for(var i=new Float32Array(e.size),s=this.readSync(e.dataId),u=0;u<s.length;++u){var c=s[u];i[u]=c>o?o:c<r?r:c}return this.makeOutput(i,e.shape,"float32")},t.prototype.abs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.abs(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<e.size;++i){var s=o[2*i],u=o[2*i+1];r[i]=Math.hypot(s,u)}return this.makeOutput(r,e.shape,"float32")},t.prototype.int=function(e){ue(e,"int");for(var r=new Int32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=o[i];return this.makeOutput(r,e.shape,"int32")},t.prototype.sigmoid=function(e){ue(e,"sigmoid");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=1/(1+Math.exp(-o[i]));return this.makeOutput(r,e.shape,"float32")},t.prototype.softplus=function(e){ue(e,"softplus");for(var r=Math.log(11920928955078125e-23)+2,o=new Float32Array(e.size),i=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s]>-r,c=i[s]<r,f=Math.exp(i[s]),d=void 0;d=c?f:u?i[s]:Math.log(1+f),o[s]=d}return this.makeOutput(o,e.shape,"float32")},t.prototype.sin=function(e){ue(e,"sin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.sin(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.cos=function(e){ue(e,"cos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.cos(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.tan=function(e){ue(e,"tan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.tan(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.asin=function(e){ue(e,"asin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.asin(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.acos=function(e){ue(e,"acos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.acos(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atan=function(e){ue(e,"atan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.atan(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atan2=function(e,r){return ue([e,r],"atan2"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.atan2(o,i)})},t.prototype.sinh=function(e){ue(e,"sinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.sinh(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.cosh=function(e){ue(e,"cosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.cosh(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.tanh=function(e){ue(e,"tanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Z2(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.asinh=function(e){ue(e,"asinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.asinh(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.acosh=function(e){ue(e,"acosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.acosh(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atanh=function(e){ue(e,"atanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.atanh(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.erf=function(e){ue(e,"erf");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var s=Math.sign(o[i]),u=Math.abs(o[i]),c=1/(1+.3275911*u);r[i]=s*(1-((((1.061405429*c-1.453152027)*c+1.421413741)*c-.284496736)*c+.254829592)*c*Math.exp(-u*u))}return this.makeOutput(r,e.shape,"float32")},t.prototype.step=function(e,r){r===void 0&&(r=0),ue(e,"step");for(var o=new Float32Array(e.size),i=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s];isNaN(u)?o[s]=NaN:o[s]=u>0?1:r}return this.makeOutput(o,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var r=e.input,o=e.filter,i=e.convInfo,s=e.bias,u=e.activation,c=e.preluActivationWeights,f=this.conv2d(r,o,i);return s&&(f=this.add(f,s)),u&&(f=fd(this,f,u,c)),f},t.prototype.conv2d=function(e,r,o){ue([e,r],"conv2d");for(var i=o.filterHeight,s=o.filterWidth,u=o.dilationHeight,c=o.dilationWidth,f=o.padInfo.left,d=o.padInfo.top,p=o.dataFormat==="channelsLast",v=Be(o.outShape,e.dtype),g=e.strides[0],y=p?e.strides[1]:e.strides[2],b=p?e.strides[2]:1,w=p?1:e.strides[1],C=v.strides[0],_=p?v.strides[1]:v.strides[2],S=p?v.strides[2]:1,k=p?1:v.strides[1],R=this.readSync(e.dataId),N=this.readSync(r.dataId),P=v.values,F=0;F<o.batchSize;++F)for(var D=F*g,A=F*C,V=0;V<o.outHeight;++V)for(var U=A+V*_,re=V*o.strideHeight-d,te=0;te<i;te++){var ee=re+te*u;if(!(ee<0||ee>=o.inHeight))for(var G=te*r.strides[0],q=D+ee*y,W=0;W<o.outWidth;++W)for(var Y=U+W*S,K=W*o.strideWidth-f,L=0;L<s;L++){var X=K+L*c;if(!(X<0||X>=o.inWidth))for(var de=q+X*b,pe=G+L*r.strides[1],me=0;me<o.inChannels;++me){for(var ge=R[de+me*w],ke=0;ke<o.outChannels;++ke)P[Y+ke*k]+=ge*N[pe+ke];pe+=o.outChannels}}}return v.toTensor()},t.prototype.conv3d=function(e,r,o){for(var i=o.filterDepth,s=o.filterHeight,u=o.filterWidth,c=o.dilationDepth,f=o.dilationHeight,d=o.dilationWidth,p=o.padInfo.front,v=o.padInfo.left,g=o.padInfo.top,y=Be(o.outShape,e.dtype),b=this.readSync(e.dataId),w=this.readSync(r.dataId),C=y.values,_=0;_<o.batchSize;++_)for(var S=_*e.strides[0],k=_*y.strides[0],R=0;R<o.outDepth;++R)for(var N=k+R*y.strides[1],P=R*o.strideDepth-p,F=0;F<i;F++){var D=P+F*c;if(!(D<0||D>=o.inDepth))for(var A=F*r.strides[0],V=S+D*e.strides[1],U=0;U<o.outHeight;++U)for(var re=N+U*y.strides[2],te=U*o.strideHeight-g,ee=0;ee<s;ee++){var G=te+ee*f;if(!(G<0||G>=o.inHeight))for(var q=A+ee*r.strides[1],W=V+G*e.strides[2],Y=0;Y<o.outWidth;++Y)for(var K=re+Y*o.outChannels,L=Y*o.strideWidth-v,X=0;X<u;X++){var de=L+X*d;if(!(de<0||de>=o.inWidth))for(var pe=q+X*r.strides[2],me=W+de*o.inChannels,ge=pe,ke=0;ke<o.inChannels;++ke){for(var be=b[me+ke],Ae=0;Ae<o.outChannels;++Ae)C[K+Ae]+=be*w[ge+Ae];ge+=o.outChannels}}}}return y.toTensor()},t.prototype.conv2dDerInput=function(e,r,o){ue([e,r],"conv2dDerInput");for(var i=Be(o.inShape,"float32"),s=i.values,u=this.readSync(e.dataId),c=this.readSync(r.dataId),f=r.strides,d=f[0],p=f[1],v=f[2],g=o.batchSize,y=o.filterHeight,b=o.filterWidth,w=o.inChannels,C=o.inHeight,_=o.inWidth,S=o.outChannels,k=o.outHeight,R=o.outWidth,N=o.strideHeight,P=o.strideWidth,F=o.dataFormat,D=y-1-o.padInfo.top,A=b-1-o.padInfo.left,V=F==="channelsLast",U=i.strides[0],re=V?i.strides[1]:i.strides[2],te=V?i.strides[2]:1,ee=V?1:i.strides[1],G=e.strides[0],q=V?e.strides[1]:e.strides[2],W=V?e.strides[2]:1,Y=V?1:e.strides[1],K=0;K<g;++K)for(var L=0;L<w;++L)for(var X=0;X<C;++X)for(var de=X-D,pe=Math.max(0,Math.ceil(de/N)),me=Math.min(k,(y+de)/N),ge=0;ge<_;++ge){for(var ke=ge-A,be=Math.max(0,Math.ceil(ke/P)),Ae=Math.min(R,(b+ke)/P),qe=0,Ue=pe;Ue<me;++Ue)for(var Ye=Ue*N-de,Ge=be;Ge<Ae;++Ge)for(var et=G*K+q*Ue+W*Ge,tt=d*(y-1-Ye)+p*(b-1-(Ge*P-ke))+v*L,nt=0;nt<S;++nt)qe+=u[et+Y*nt]*c[tt+nt];s[U*K+re*X+te*ge+ee*L]=qe}return i.toTensor()},t.prototype.conv3dDerInput=function(e,r,o){for(var i=Be(o.inShape,"float32"),s=i.values,u=i.strides,c=u[0],f=u[1],d=u[2],p=u[3],v=this.readSync(e.dataId),g=e.strides,y=g[0],b=g[1],w=g[2],C=g[3],_=this.readSync(r.dataId),S=r.strides,k=S[0],R=S[1],N=S[2],P=S[3],F=o.batchSize,D=o.filterDepth,A=o.filterHeight,V=o.filterWidth,U=o.inChannels,re=o.inDepth,te=o.inHeight,ee=o.inWidth,G=o.outChannels,q=o.outDepth,W=o.outHeight,Y=o.outWidth,K=o.strideDepth,L=o.strideHeight,X=o.strideWidth,de=D-1-o.padInfo.front,pe=A-1-o.padInfo.top,me=V-1-o.padInfo.left,ge=0;ge<F;++ge)for(var ke=0;ke<U;++ke)for(var be=0;be<re;++be)for(var Ae=be-de,qe=Math.max(0,Math.ceil(Ae/K)),Ue=Math.min(q,(D+Ae)/K),Ye=0;Ye<te;++Ye)for(var Ge=Ye-pe,et=Math.max(0,Math.ceil(Ge/L)),tt=Math.min(W,(A+Ge)/L),nt=0;nt<ee;++nt){for(var on=nt-me,wn=Math.max(0,Math.ceil(on/X)),Lt=Math.min(Y,(V+on)/X),Dn=0,jt=qe;jt<Ue;++jt)for(var An=jt*K-Ae,Pn=et;Pn<tt;++Pn)for(var Ir=Pn*L-Ge,Fn=wn;Fn<Lt;++Fn)for(var si=y*ge+b*jt+w*Pn+C*Fn,ir=k*(D-1-An)+R*(A-1-Ir)+N*(V-1-(Fn*X-on))+P*ke,tn=0;tn<G;++tn)Dn+=v[si+tn]*_[ir+tn];s[c*ge+f*be+d*Ye+p*nt+ke]=Dn}return i.toTensor()},t.prototype.conv2dDerFilter=function(e,r,o){ue([e,r],"conv2dDerFilter");for(var i=o.strideHeight,s=o.strideWidth,u=o.filterHeight,c=o.filterWidth,f=o.dataFormat==="channelsLast",d=Be(o.filterShape,"float32"),p=o.padInfo.left,v=o.padInfo.top,g=this.bufferSync(e),y=this.bufferSync(r),b=0;b<u;++b)for(var w=Math.max(0,Math.ceil((v-b)/i)),C=Math.min(o.outHeight,(o.inHeight+v-b)/i),_=0;_<c;++_)for(var S=Math.max(0,Math.ceil((p-_)/s)),k=Math.min(o.outWidth,(o.inWidth+p-_)/s),R=0;R<o.inChannels;++R)for(var N=0;N<o.outChannels;++N){for(var P=0,F=0;F<o.batchSize;++F)for(var D=w;D<C;++D)for(var A=b+D*i-v,V=S;V<k;++V){var U=_+V*s-p;P+=f?g.get(F,A,U,R)*y.get(F,D,V,N):g.get(F,R,A,U)*y.get(F,N,D,V)}d.set(P,b,_,R,N)}return d.toTensor()},t.prototype.conv3dDerFilter=function(e,r,o){for(var i=o.strideDepth,s=o.strideHeight,u=o.strideWidth,c=o.filterDepth,f=o.filterHeight,d=o.filterWidth,p=Be(o.filterShape,"float32"),v=p.values,g=p.strides,y=g[0],b=g[1],w=g[2],C=g[3],_=this.readSync(r.dataId),S=r.strides,k=S[0],R=S[1],N=S[2],P=S[3],F=this.readSync(e.dataId),D=e.strides,A=D[0],V=D[1],U=D[2],re=D[3],te=o.padInfo.front,ee=o.padInfo.left,G=o.padInfo.top,q=0;q<c;++q)for(var W=Math.max(0,Math.ceil((te-q)/i)),Y=Math.min(o.outDepth,(o.inDepth+te-q)/i),K=q*y,L=0;L<f;++L)for(var X=Math.max(0,Math.ceil((G-L)/s)),de=Math.min(o.outHeight,(o.inHeight+G-L)/s),pe=L*b+K,me=0;me<d;++me)for(var ge=Math.max(0,Math.ceil((ee-me)/u)),ke=Math.min(o.outWidth,(o.inWidth+ee-me)/u),be=me*w+pe,Ae=0;Ae<o.inChannels;++Ae)for(var qe=Ae*C+be,Ue=0;Ue<o.outChannels;++Ue){for(var Ye=0,Ge=0;Ge<o.batchSize;++Ge)for(var et=Ge*A,tt=Ge*k,nt=W;nt<Y;++nt)for(var on=(q+nt*i-te)*V+et,wn=nt*R+tt,Lt=X;Lt<de;++Lt)for(var Dn=(L+Lt*s-G)*U+on,jt=Lt*N+wn,An=ge;An<ke;++An){var Pn=An*P+jt;Ye+=F[(me+An*u-ee)*re+Dn+Ae]*_[Pn+Ue]}v[qe+Ue]=Ye}return p.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var r=e.input,o=e.filter,i=e.convInfo,s=e.bias,u=e.activation,c=e.preluActivationWeights,f=this.depthwiseConv2D(r,o,i);return s&&(f=this.add(f,s)),u&&(f=fd(this,f,u,c)),f},t.prototype.depthwiseConv2D=function(e,r,o){ue([e,r],"depthwiseConv2D");for(var i=o.filterHeight,s=o.filterWidth,u=o.dilationHeight,c=o.dilationWidth,f=o.padInfo.left,d=o.padInfo.top,p=o.outChannels/o.inChannels,v=Be(o.outShape,e.dtype),g=this.readSync(e.dataId),y=this.readSync(r.dataId),b=v.values,w=0;w<o.batchSize;++w)for(var C=w*e.strides[0],_=w*v.strides[0],S=0;S<o.outHeight;++S)for(var k=_+S*v.strides[1],R=S*o.strideHeight-f,N=0;N<i;++N){var P=R+N*u;if(!(P<0||P>=o.inHeight))for(var F=N*r.strides[0],D=C+P*e.strides[1],A=0;A<o.outWidth;++A)for(var V=k+A*v.strides[2],U=A*o.strideWidth-d,re=0;re<s;++re){var te=U+re*c;if(!(te<0||te>=o.inWidth))for(var ee=F+re*r.strides[1],G=D+te*o.inChannels,q=V,W=ee,Y=0;Y<o.inChannels;++Y){for(var K=g[G+Y],L=0;L<p;++L)b[q+L]+=K*y[W+L];q+=p,W+=p}}}return v.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,r,o){ue([e,r],"depthwiseConv2DDerInput");for(var i=Be(o.inShape,"float32"),s=i.values,u=i.strides,c=u[0],f=u[1],d=u[2],p=this.readSync(e.dataId),v=e.strides,g=v[0],y=v[1],b=v[2],w=this.readSync(r.dataId),C=r.strides,_=C[0],S=C[1],k=C[2],R=o.batchSize,N=o.filterHeight,P=o.filterWidth,F=o.inChannels,D=o.inHeight,A=o.inWidth,V=o.outChannels,U=o.outHeight,re=o.outWidth,te=o.strideHeight,ee=o.strideWidth,G=N-1-o.padInfo.top,q=P-1-o.padInfo.left,W=V/F,Y=0;Y<R;++Y)for(var K=0;K<F;++K)for(var L=0;L<D;++L)for(var X=L-G,de=Math.max(0,Math.ceil(X/te)),pe=Math.min(U,(N+X)/te),me=0;me<A;++me){for(var ge=me-q,ke=Math.max(0,Math.ceil(ge/ee)),be=Math.min(re,(P+ge)/ee),Ae=0,qe=de;qe<pe;++qe)for(var Ue=qe*te-X,Ye=ke;Ye<be;++Ye)for(var Ge=g*Y+y*qe+b*Ye,et=_*(N-1-Ue)+S*(P-1-(Ye*ee-ge))+k*K,tt=0;tt<W;++tt)Ae+=p[Ge+(K*W+tt)]*w[et+tt];s[c*Y+f*L+d*me+K]=Ae}return i.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,r,o){ue([e,r],"depthwiseConv2DDerFilter");for(var i=o.strideHeight,s=o.strideWidth,u=o.filterHeight,c=o.filterWidth,f=Be(o.filterShape,"float32"),d=o.padInfo.left,p=o.padInfo.top,v=o.outChannels/o.inChannels,g=this.bufferSync(e),y=this.bufferSync(r),b=0;b<u;++b)for(var w=Math.max(0,Math.ceil((p-b)/i)),C=Math.min(o.outHeight,(o.inHeight+p-b)/i),_=0;_<c;++_)for(var S=Math.max(0,Math.ceil((d-_)/s)),k=Math.min(o.outWidth,(o.inWidth+d-_)/s),R=0;R<o.outChannels;++R){for(var N=Math.trunc(R/v),P=R%v,F=0,D=0;D<o.batchSize;++D)for(var A=w;A<C;++A)for(var V=b+A*i-p,U=S;U<k;++U){var re=_+U*s-d;F+=g.get(D,V,re,N)*y.get(D,A,U,R)}f.set(F,b,_,N,P)}return f.toTensor()},t.prototype.tile=function(e,r){return ue(e,"tile"),v0(this.bufferSync(e),r)},t.prototype.pad=function(e,r,o){ue(e,"pad");var i=r.map(function(v,g){return v[0]+e.shape[g]+v[1]}),s=r.map(function(v){return v[0]}),u=this.bufferSync(e),c=Be(i,e.dtype);o!==0&&c.values.fill(o);for(var f=0;f<e.size;f++){var d=u.indexToLoc(f),p=d.map(function(v,g){return v+s[g]});c.set.apply(c,[u.get.apply(u,d)].concat(p))}return c.toTensor()},t.prototype.transpose=function(e,r){ue(e,"transpose");for(var o=new Array(e.rank),i=0;i<o.length;i++)o[i]=e.shape[r[i]];var s=this.readSync(e.dataId),u=Be(o,e.dtype),c=this.bufferSync(e);for(i=0;i<e.size;++i){for(var f=c.indexToLoc(i),d=new Array(f.length),p=0;p<d.length;p++)d[p]=f[r[p]];var v=u.locToIndex(d);u.values[v]=s[i]}return u.toTensor()},t.prototype.gather=function(e,r,o){ue([e,r],"gather");var i=e.shape.slice(),s=this.readSync(r.dataId);i[o]=s.length;for(var u=Be(i,e.dtype),c=this.bufferSync(e),f=0;f<u.size;++f){var d=u.indexToLoc(f),p=d.slice();p[o]=s[d[o]];var v=c.locToIndex(p);u.values[f]=c.values[v]}return u.toTensor()},t.prototype.batchToSpaceND=function(e,r,o){ue([e],"batchToSpaceND");var i=r.reduce(function(p,v){return p*v}),s=ll(e.shape,r,i),u=cl(s.length,r.length),c=fl(e.shape,r,i),f=n0(o,r.length),d=r0(c,o,r.length);return e.reshape(s).transpose(u).reshape(c).slice(f,d)},t.prototype.spaceToBatchND=function(e,r,o){ue([e],"spaceToBatchND");var i=r.reduce(function(v,g){return v*g}),s=[[0,0]];s.push.apply(s,o);for(var u=1+r.length;u<e.shape.length;++u)s.push([0,0]);var c=e.pad(s),f=ll(c.shape,r,i,!1),d=cl(f.length,r.length,!1),p=fl(c.shape,r,i,!1);return c.reshape(f).transpose(d).reshape(p)},t.prototype.pool=function(e,r,o){ue(e,"pool");for(var i=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,v=r.padInfo.left,g=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=this.readSync(e.dataId),b=Be(r.outShape,e.dtype),w=b.values,C=r.outShape[1]*r.outShape[2]*r.outShape[3],_=r.outShape[2]*r.outShape[3],S=r.outShape[3],k=0;k<r.batchSize;++k)for(var R=k*C,N=k*e.strides[0],P=0;P<r.inChannels;++P)for(var F=0;F<r.outHeight;++F)for(var D=F*i-p,A=Math.max(0,D),V=Math.min(r.inHeight,f+D),U=R+F*_,re=0;re<r.outWidth;++re){for(var te=re*s-v,ee=Math.max(0,te),G=Math.min(r.inWidth,d+te),q=g,W=0,Y=0,K=A;K<V;K+=u){for(var L=N+K*e.strides[1],X=ee;X<G;X+=c){var de=y[L+X*e.strides[2]+P];o==="max"&&de>q?q=de:o==="avg"&&(W+=de,Y++)}if(isNaN(q))break}w[U+re*S+P]=o==="avg"?W/Y:q}return b.toTensor()},t.prototype.maxPool=function(e,r){return this.pool(e,r,"max")},t.prototype.maxPoolPositions=function(e,r){for(var o=Be(r.outShape,"int32"),i=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,v=r.padInfo.left,g=this.bufferSync(e),y=0;y<r.batchSize;++y)for(var b=0;b<r.inChannels;++b)for(var w=0;w<r.outHeight;++w){for(var C=w*i-p,_=C;_<0;)_+=u;for(var S=Math.min(r.inHeight,f+C),k=0;k<r.outWidth;++k){for(var R=k*s-v,N=R;N<0;)N+=c;for(var P=Math.min(r.inWidth,d+R),F=Number.NEGATIVE_INFINITY,D=-1,A=_;A<S;A+=u)for(var V=A-C,U=N;U<P;U+=c){var re=U-R,te=g.get(y,A,U,b);te>F&&(F=te,D=V*d+re)}o.set(D,y,w,k,b)}}return o.toTensor()},t.prototype.maxPoolBackprop=function(e,r,o,i){ue([r,o],"maxPoolBackprop");for(var s=this.maxPoolPositions(r,i),u=i.strideHeight,c=i.strideWidth,f=i.dilationHeight,d=i.dilationWidth,p=i.effectiveFilterHeight,v=i.effectiveFilterWidth,g=v-1-i.padInfo.left,y=p-1-i.padInfo.top,b=Be(r.shape,"float32"),w=this.bufferSync(s),C=this.bufferSync(e),_=0;_<i.batchSize;++_)for(var S=0;S<i.inChannels;++S)for(var k=0;k<i.inHeight;++k)for(var R=0;R<i.inWidth;++R){for(var N=k-y,P=R-g,F=0,D=0;D<p;D+=f){var A=(N+D)/u;if(!(A<0||A>=i.outHeight||Math.floor(A)!==A))for(var V=0;V<v;V+=d){var U=(P+V)/c;if(!(U<0||U>=i.outWidth||Math.floor(U)!==U)){var re=p*v-1-w.get(_,A,U,S)===D*v+V?1:0;re!==0&&(F+=C.get(_,A,U,S)*re)}}}b.set(F,_,k,R,S)}return b.toTensor()},t.prototype.avgPoolBackprop=function(e,r,o){ue([e,r],"avgPoolBackprop");for(var i=o.strideHeight,s=o.strideWidth,u=o.filterHeight,c=o.filterWidth,f=o.dilationHeight,d=o.dilationWidth,p=o.effectiveFilterHeight,v=o.effectiveFilterWidth,g=v-1-o.padInfo.left,y=p-1-o.padInfo.top,b=Be(r.shape,"float32"),w=1/(u*c),C=this.bufferSync(e),_=0;_<o.batchSize;++_)for(var S=0;S<o.inChannels;++S)for(var k=0;k<o.inHeight;++k)for(var R=0;R<o.inWidth;++R){for(var N=k-y,P=R-g,F=0,D=0;D<p;D+=f){var A=(N+D)/i;if(!(A<0||A>=o.outHeight||Math.floor(A)!==A))for(var V=0;V<v;V+=d){var U=(P+V)/s;U<0||U>=o.outWidth||Math.floor(U)!==U||(F+=C.get(_,A,U,S))}}b.set(F*w,_,k,R,S)}return b.toTensor()},t.prototype.pool3d=function(e,r,o){ue(e,"pool3d");for(var i=r.strideDepth,s=r.strideHeight,u=r.strideWidth,c=r.dilationDepth,f=r.dilationHeight,d=r.dilationWidth,p=r.effectiveFilterDepth,v=r.effectiveFilterHeight,g=r.effectiveFilterWidth,y=r.padInfo.front,b=r.padInfo.top,w=r.padInfo.left,C=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,_=this.readSync(e.dataId),S=Be(r.outShape,e.dtype),k=S.values,R=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],N=r.outShape[2]*r.outShape[3]*r.outShape[4],P=r.outShape[3]*r.outShape[4],F=r.outShape[4],D=0;D<r.batchSize;++D)for(var A=D*R,V=D*e.strides[0],U=0;U<r.inChannels;++U)for(var re=0;re<r.outDepth;++re){for(var te=re*i-y,ee=te;ee<0;)ee+=c;for(var G=Math.min(r.inDepth,p+te),q=A+re*N,W=0;W<r.outHeight;++W){for(var Y=W*s-b,K=Y;K<0;)K+=f;for(var L=Math.min(r.inHeight,v+Y),X=q+W*P,de=0;de<r.outWidth;++de){for(var pe=de*u-w,me=pe;me<0;)me+=d;for(var ge=Math.min(r.inWidth,g+pe),ke=X+de*F,be=C,Ae=0,qe=0,Ue=ee;Ue<G;Ue+=c){for(var Ye=V+Ue*e.strides[1],Ge=K;Ge<L;Ge+=f){for(var et=Ye+Ge*e.strides[2],tt=me;tt<ge;tt+=d){var nt=_[et+tt*e.strides[3]+U];if(o==="max"&&nt>be?be=nt:o==="avg"&&(Ae+=nt,qe++),isNaN(be))break}if(isNaN(be))break}if(isNaN(be))break}k[ke+U]=o==="avg"?Ae/qe:be}}}return S.toTensor()},t.prototype.avgPool3d=function(e,r){return ue(e,"avgPool3d"),this.pool3d(e,r,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,r,o){ue([e,r],"avgPool3dBackprop");for(var i=o.strideDepth,s=o.strideHeight,u=o.strideWidth,c=o.filterDepth,f=o.filterHeight,d=o.filterWidth,p=o.dilationDepth,v=o.dilationHeight,g=o.dilationWidth,y=o.effectiveFilterDepth,b=o.effectiveFilterHeight,w=o.effectiveFilterWidth,C=y-1-o.padInfo.front,_=w-1-o.padInfo.left,S=b-1-o.padInfo.top,k=Be(r.shape,"float32"),R=1/(c*f*d),N=this.bufferSync(e),P=0;P<o.batchSize;++P)for(var F=0;F<o.inChannels;++F)for(var D=0;D<o.inDepth;++D)for(var A=0;A<o.inHeight;++A)for(var V=0;V<o.inWidth;++V){for(var U=D-C,re=A-S,te=V-_,ee=0,G=0;G<y;G+=p){var q=(U+G)/i;if(!(q<0||q>=o.outDepth||Math.floor(q)!==q))for(var W=0;W<b;W+=v){var Y=(re+W)/s;if(!(Y<0||Y>=o.outHeight||Math.floor(Y)!==Y))for(var K=0;K<w;K+=g){var L=(te+K)/u;L<0||L>=o.outWidth||Math.floor(L)!==L||(ee+=N.get(P,q,Y,L,F))}}}k.set(ee*R,P,D,A,V,F)}return k.toTensor()},t.prototype.maxPool3d=function(e,r){return ue(e,"maxPool3d"),this.pool3d(e,r,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,r){for(var o=Be(r.outShape,"int32"),i=r.strideDepth,s=r.strideHeight,u=r.strideWidth,c=r.dilationDepth,f=r.dilationHeight,d=r.dilationWidth,p=r.effectiveFilterDepth,v=r.effectiveFilterHeight,g=r.effectiveFilterWidth,y=r.padInfo.front,b=r.padInfo.top,w=r.padInfo.left,C=this.bufferSync(e),_=0;_<r.batchSize;++_)for(var S=0;S<r.inChannels;++S)for(var k=0;k<r.outDepth;++k){for(var R=k*i-y,N=R;N<0;)N+=c;for(var P=Math.min(r.inDepth,p+R),F=0;F<r.outHeight;++F){for(var D=F*s-b,A=D;A<0;)A+=f;for(var V=Math.min(r.inHeight,v+D),U=0;U<r.outWidth;++U){for(var re=U*u-w,te=re;te<0;)te+=d;for(var ee=Math.min(r.inWidth,g+re),G=Number.NEGATIVE_INFINITY,q=-1,W=N;W<P;W+=c)for(var Y=W-R,K=A;K<V;K+=f)for(var L=K-D,X=te;X<ee;X+=d){var de=X-re,pe=C.get(_,W,K,X,S);pe>=G&&(G=pe,q=Y*v*g+L*v+de)}o.set(q,_,k,F,U,S)}}}return o.toTensor()},t.prototype.maxPool3dBackprop=function(e,r,o,i){ue([r,o],"maxPool3dBackprop");for(var s=this.maxPool3dPositions(r,i),u=i.strideDepth,c=i.strideHeight,f=i.strideWidth,d=i.dilationDepth,p=i.dilationHeight,v=i.dilationWidth,g=i.effectiveFilterDepth,y=i.effectiveFilterHeight,b=i.effectiveFilterWidth,w=g-1-i.padInfo.front,C=b-1-i.padInfo.left,_=y-1-i.padInfo.top,S=Be(r.shape,"float32"),k=this.bufferSync(s),R=this.bufferSync(e),N=0;N<i.batchSize;++N)for(var P=0;P<i.inChannels;++P)for(var F=0;F<i.inDepth;++F)for(var D=0;D<i.inHeight;++D)for(var A=0;A<i.inWidth;++A){for(var V=F-w,U=D-_,re=A-C,te=0,ee=0;ee<g;ee+=d){var G=(V+ee)/u;if(!(G<0||G>=i.outDepth||Math.floor(G)!==G))for(var q=0;q<y;q+=p){var W=(U+q)/c;if(!(W<0||W>=i.outHeight||Math.floor(W)!==W))for(var Y=0;Y<b;Y+=v){var K=(re+Y)/f;if(!(K<0||K>=i.outWidth||Math.floor(K)!==K)){var L=g*y*b-1-k.get(N,G,W,K,P)===ee*y*b+q*b+Y?1:0;L!==0&&(te+=R.get(N,G,W,K,P)*L)}}}}S.set(te,N,F,D,A,P)}return S.toTensor()},t.prototype.cast=function(e,r){return f0(e,r,this)},t.prototype.reshape=function(e,r){return Bd(e,r)},t.prototype.avgPool=function(e,r){return ue(e,"avgPool"),this.pool(e,r,"avg").toFloat()},t.prototype.resizeBilinear=function(e,r,o,i){ue(e,"resizeBilinear");for(var s=e.shape,u=s[0],c=s[1],f=s[2],d=s[3],p=this.readSync(e.dataId),v=new Float32Array(Re([u,r,o,d])),g=[i&&r>1?c-1:c,i&&o>1?f-1:f],y=[i&&r>1?r-1:r,i&&o>1?o-1:o],b=0,w=g[0]/y[0],C=g[1]/y[1],_=0;_<u;_++)for(var S=0;S<r;S++)for(var k=w*S,R=Math.floor(k),N=k-R,P=Math.min(c-1,Math.ceil(k)),F=_*e.strides[0]+R*e.strides[1],D=_*e.strides[0]+P*e.strides[1],A=0;A<o;A++)for(var V=C*A,U=Math.floor(V),re=V-U,te=Math.min(f-1,Math.ceil(V)),ee=F+U*e.strides[2],G=D+U*e.strides[2],q=F+te*e.strides[2],W=D+te*e.strides[2],Y=0;Y<d;Y++){var K=p[ee+Y],L=p[G+Y],X=K+(p[q+Y]-K)*re,de=X+(L+(p[W+Y]-L)*re-X)*N;v[b++]=de}return Vt(v,[u,r,o,d])},t.prototype.resizeBilinearBackprop=function(e,r,o){ue([e,r],"resizeBilinearBackprop");for(var i=r.shape,s=i[0],u=i[1],c=i[2],f=i[3],d=e.shape,p=d[1],v=d[2],g=new Float32Array(s*u*c*f),y=[o&&p>1?u-1:u,o&&v>1?c-1:c],b=[o&&p>1?p-1:p,o&&v>1?v-1:v],w=y[0]/b[0],C=y[1]/b[1],_=this.readSync(e.dataId),S=0,k=0;k<s;k++)for(var R=k*r.strides[0],N=0;N<p;N++)for(var P=N*w,F=Math.floor(P),D=Math.min(Math.ceil(P),u-1),A=R+F*r.strides[1],V=R+D*r.strides[1],U=P-F,re=1-U,te=0;te<v;te++)for(var ee=te*C,G=Math.floor(ee),q=Math.min(Math.ceil(ee),c-1),W=ee-G,Y=1-W,K=A+G*r.strides[2],L=A+q*r.strides[2],X=V+G*r.strides[2],de=V+q*r.strides[2],pe=re*Y,me=re*W,ge=U*Y,ke=U*W,be=0;be<f;be++){var Ae=_[S++];g[K+be]+=Ae*pe,g[L+be]+=Ae*me,g[X+be]+=Ae*ge,g[de+be]+=Ae*ke}return dn(g,[s,c,u,f],r.dtype)},t.prototype.resizeNearestNeighbor=function(e,r,o,i){ue(e,"resizeNearestNeighbor");for(var s=e.shape,u=s[0],c=s[1],f=s[2],d=s[3],p=this.readSync(e.dataId),v=new Float32Array(u*r*o*d),g=[i&&r>1?c-1:c,i&&o>1?f-1:f],y=[i&&r>1?r-1:r,i&&o>1?o-1:o],b=g[0]/y[0],w=g[1]/y[1],C=0,_=0;_<u;_++)for(var S=_*e.strides[0],k=0;k<r;k++)for(var R=b*k,N=S+Math.min(c-1,i?Math.round(R):Math.floor(R))*e.strides[1],P=0;P<o;P++)for(var F=w*P,D=N+Math.min(f-1,i?Math.round(F):Math.floor(F))*e.strides[2],A=0;A<d;A++){var V=p[D+A];v[C++]=V}return Vt(v,[u,r,o,d],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,r,o){ue([e,r],"resizeNearestNeighborBackprop");for(var i=r.shape,s=i[0],u=i[1],c=i[2],f=i[3],d=e.shape,p=d[1],v=d[2],g=new Float32Array(s*u*c*f),y=this.readSync(e.dataId),b=[o&&p>1?u-1:u,o&&v>1?c-1:c],w=[o&&p>1?p-1:p,o&&v>1?v-1:v],C=b[0]/w[0],_=b[1]/w[1],S=1/C,k=1/_,R=2*Math.ceil(S)+2,N=2*Math.ceil(k)+2,P=0;P<s;P++)for(var F=P*r.strides[0],D=0;D<u;D++)for(var A=F+D*r.strides[1],V=Math.floor(D*S),U=Math.floor(V-R/2),re=0;re<c;re++)for(var te=A+re*r.strides[2],ee=Math.floor(re*k),G=Math.floor(ee-N/2),q=0;q<f;q++){for(var W=0,Y=0;Y<R;Y++){var K=Y+U;if(!(K<0||K>=p)){var L=F+K*e.strides[1],X=K*C;if(D===Math.min(u-1,o?Math.round(X):Math.floor(X)))for(var de=0;de<N;de++){var pe=de+G;if(!(pe<0||pe>=v)){var me=L+pe*e.strides[2],ge=pe*_;re===Math.min(c-1,o?Math.round(ge):Math.floor(ge))&&(W+=y[me+q])}}}}g[te+q]=W}return dn(g,r.shape,r.dtype)},t.prototype.batchNormalization=function(e,r,o,i,s,u){ue([e,r,o,s,u],"batchNorm");for(var c=this.readSync(e.dataId),f=this.readSync(r.dataId),d=this.readSync(o.dataId),p=s?this.readSync(s.dataId):new Float32Array([1]),v=u?this.readSync(u.dataId):new Float32Array([0]),g=new Float32Array(c.length),y=v.length,b=p.length,w=d.length,C=f.length,_=0,S=0,k=0,R=0,N=0;N<c.length;++N)g[N]=v[_++]+(c[N]-f[S++])*p[k++]/Math.sqrt(d[R++]+i),_>=y&&(_=0),S>=C&&(S=0),k>=b&&(k=0),R>=w&&(R=0);return dn(g,e.shape)},t.prototype.localResponseNormalization4D=function(e,r,o,i,s){ue(e,"localResponseNormalization4D");var u=e.shape[3],c=u-1,f=this.readSync(e.dataId),d=e.size,p=new Float32Array(d);function v(w){for(var C=w%u,_=w-C+Math.max(0,C-r),S=w-C+Math.min(C+r,c),k=0;_<=S;_++){var R=f[_];k+=R*R}return k}for(var g=0;g<d;g++){var y=v(g),b=f[g]*Math.pow(o+i*y,-s);p[g]=b}return dn(p,e.shape)},t.prototype.LRNGrad=function(e,r,o,i,s,u,c){ue(e,"LRNGrad");for(var f=e.shape[3],d=this.readSync(e.dataId),p=this.readSync(r.dataId),v=this.readSync(o.dataId),g=new Float32Array(e.size),y=e.size,b=0;b<y;b++){for(var w=b%f,C=b-w+Math.max(0,w-i),_=b-w+Math.min(f,w+i+1),S=0,k=C;k<_;k++)S+=Math.pow(p[k],2);for(S=u*S+s,k=C;k<_;k++){var R=-2*u*c*p[k]*v[b]/S;b===k&&(R+=Math.pow(S,-c)),R*=d[b],g[k]+=R}}return dn(g,e.shape)},t.prototype.multinomial=function(e,r,o,i){ue(e,"multinomial");for(var s=r?e:jr(e),u=s.shape[0],c=s.shape[1],f=st([u,o],"int32"),d=this.readSync(f.dataId),p=this.readSync(s.dataId),v=0;v<u;++v){var g=v*c,y=new Float32Array(c-1);y[0]=p[g];for(var b=1;b<y.length;++b)y[b]=y[b-1]+p[g+b];for(var w=Tl(i.toString()),C=v*o,_=0;_<o;++_){var S=w();d[C+_]=y.length;for(var k=0;k<y.length;k++)if(S<y[k]){d[C+_]=k;break}}}return f},t.prototype.oneHot=function(e,r,o,i){ue(e,"oneHot");var s=new Float32Array(e.size*r);s.fill(i);for(var u=this.readSync(e.dataId),c=0;c<e.size;++c)u[c]>=0&&u[c]<r&&(s[c*r+u[c]]=o);return xo(s,[e.size,r],"int32")},t.prototype.nonMaxSuppression=function(e,r,o,i,s){return ue(e,"nonMaxSuppression"),hh(this.readSync(e.dataId),this.readSync(r.dataId),o,i,s)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,r){for(var o=e.shape[0],i=e.shape[1],s=Be(e.shape,"float32"),u=Be(e.shape,"float32"),c=Vn(e).as2D(o,i),f=mr(e).as2D(o,i),d=0;d<o;d++)for(var p=c.slice([d,0],[1,i]),v=f.slice([d,0],[1,i]),g=zt(p,v),y=this.readSync(this.fftImpl(g,r).dataId),b=0;b<i;b++){var w=bg(y,b);s.values[d*i+b]=w.real,u.values[d*i+b]=w.imag}return zt(s.toTensor(),u.toTensor()).as2D(o,i)},t.prototype.fftImpl=function(e,r){var o=e.as1D(),i=o.size;if(this.isExponentOf2(i)){var s=this.fftRadix2(o,i,r).as2D(e.shape[0],e.shape[1]);return r&&(s=zt(Vn(s).div(ve(i)),mr(s).div(ve(i)))),s}var u=this.readSync(e.dataId),c=function(f){for(var d=new Float32Array(f.length/2),p=new Float32Array(f.length/2),v=0;v<f.length;v+=2)d[v/2]=f[v],p[v/2]=f[v+1];return{real:d,imag:p}}(this.fourierTransformByMatmul(u,i,r));return zt(c.real,c.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return(e&e-1)==0},t.prototype.fftRadix2=function(e,r,o){if(r===1)return e;var i=this.readSync(e.dataId),s=r/2,u=function(C){for(var _=Math.ceil(C.length/4),S=new Float32Array(_),k=new Float32Array(_),R=0;R<C.length;R+=4)S[Math.floor(R/4)]=C[R],k[Math.floor(R/4)]=C[R+1];return{real:S,imag:k}}(i),c=zt(u.real,u.imag).as1D(),f=function(C){for(var _=Math.floor(C.length/4),S=new Float32Array(_),k=new Float32Array(_),R=2;R<C.length;R+=4)S[Math.floor(R/4)]=C[R],k[Math.floor(R/4)]=C[R+1];return{real:S,imag:k}}(i),d=zt(f.real,f.imag).as1D();c=this.fftRadix2(c,s,o),d=this.fftRadix2(d,s,o);var p=function(C,_){for(var S=new Float32Array(C/2),k=new Float32Array(C/2),R=0;R<Math.ceil(C/2);R++){var N=(_?2:-2)*Math.PI*(R/C);S[R]=Math.cos(N),k[R]=Math.sin(N)}return{real:S,imag:k}}(r,o),v=zt(p.real,p.imag).mul(d),g=c.add(v),y=c.sub(v),b=Vn(g).concat(Vn(y)),w=mr(g).concat(mr(y));return zt(b,w).as1D()},t.prototype.fourierTransformByMatmul=function(e,r,o){for(var i=new Float32Array(2*r),s=0;s<r;s++){for(var u=0,c=0,f=0;f<r;f++){var d=AC(s*f,r,o),p=bg(e,f);u+=p.real*d.real-p.imag*d.imag,c+=p.real*d.imag+p.imag*d.real}o&&(u/=r,c/=r),DC(i,u,c,s)}return i},t.prototype.depthToSpace=function(e,r,o){O(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),O(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var i=e.shape[0],s=e.shape[1],u=e.shape[2],c=e.shape[3],f=s*r,d=u*r,p=c/(r*r),v=this.readSync(e.dataId),g=new Float32Array(i*f*d*p),y=0,b=0;b<i;++b)for(var w=0;w<f;++w)for(var C=Math.floor(w/r),_=w%r,S=0;S<d;++S)for(var k=Math.floor(S/r),R=(_*r+S%r)*p,N=0;N<p;++N){var P=N+R+c*(k+u*(C+s*b));g[y++]=v[P]}return dn(g,[i,f,d,p])},t.prototype.broadcastedBinaryOp=function(e,r,o,i){var s=He(e.shape,r.shape),u=Be(s,o),c=this.readSync(e.dataId),f=this.readSync(r.dataId),d=go(e.shape,s),p=go(r.shape,s),v=u.values;if(d.length+p.length===0)for(var g=0;g<v.length;++g)v[g]=i(c[g%c.length],f[g%f.length]);else{var y=this.bufferSync(e),b=this.bufferSync(r),w=function(C){var _=u.indexToLoc(C),S=_.slice(-e.rank);d.forEach(function(P){return S[P]=0});var k=y.locToIndex(S),R=_.slice(-r.rank);p.forEach(function(P){return R[P]=0});var N=b.locToIndex(R);v[C]=i(c[k],f[N])};for(g=0;g<v.length;++g)w(g)}return u.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,r,o){var i=He(e.shape,r.shape),s=Be(i,"float32"),u=Be(i,"float32"),c=this.readSync(e.dataId),f=this.readSync(r.dataId),d=go(e.shape,i),p=go(r.shape,i),v=s.values,g=u.values;if(d.length+p.length===0)for(var y=0;y<v.length;y++){var b=y%c.length,w=y%f.length,C=o(c[2*b],c[2*b+1],f[2*w],f[2*w+1]);v[y]=C.real,g[y]=C.imag}else{var _=this.bufferSync(this.data.get(e.dataId).complexTensors.real),S=this.bufferSync(this.data.get(r.dataId).complexTensors.real),k=function(R){var N=s.indexToLoc(R),P=N.slice(-e.rank);d.forEach(function(U){return P[U]=0});var F=_.locToIndex(P),D=N.slice(-r.rank);p.forEach(function(U){return D[U]=0});var A=S.locToIndex(D),V=o(c[2*F],c[2*F+1],f[2*A],f[2*A+1]);v[R]=V.real,g[R]=V.imag};for(y=0;y<v.length;y++)k(y)}return this.complex(s.toTensor(),u.toTensor())},t.prototype.split=function(e,r,o){return p0(e,r,o)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,r,o,i,s,u){for(var c=e.shape,f=c[0],d=c[1],p=c[2],v=c[3],g=r.shape[0],y=i[0],b=i[1],w=Be([g,y,b,v],"float32"),C=this.readSync(r.dataId),_=this.readSync(o.dataId),S=this.readSync(e.dataId),k=e.strides,R=w.strides,N=0;N<g;N++){var P=4*N,F=C[P],D=C[P+1],A=C[P+2],V=C[P+3],U=_[N];if(!(U>=f))for(var re=y>1?(A-F)*(d-1)/(y-1):0,te=b>1?(V-D)*(p-1)/(b-1):0,ee=0;ee<y;ee++){var G=y>1?F*(d-1)+ee*re:.5*(F+A)*(d-1);if(G<0||G>d-1)for(var q=0;q<b;q++)for(var W=0;W<v;W++){var Y=W+q*R[2]+ee*R[1]+N*R[0];w.values[Y]=u}else if(s==="bilinear"){var K=Math.floor(G),L=Math.ceil(G),X=G-K;for(q=0;q<b;q++)if((Ue=b>1?D*(p-1)+q*te:.5*(D+V)*(p-1))<0||Ue>p-1)for(W=0;W<v;W++)Y=W+q*R[2]+ee*R[1]+N*R[0],w.values[Y]=u;else{var de=Math.floor(Ue),pe=Math.ceil(Ue),me=Ue-de;for(W=0;W<v;W++){var ge=S[Y=W+de*k[2]+K*k[1]+U*k[0]],ke=S[Y=W+pe*k[2]+K*k[1]+U*k[0]],be=S[Y=W+de*k[2]+L*k[1]+U*k[0]],Ae=ge+(ke-ge)*me,qe=be+(S[Y=W+pe*k[2]+L*k[1]+U*k[0]]-be)*me;Y=W+q*R[2]+ee*R[1]+N*R[0],w.values[Y]=Ae+(qe-Ae)*X}}}else for(q=0;q<b;++q){var Ue;if((Ue=b>1?D*(p-1)+q*te:.5*(D+V)*(p-1))<0||Ue>p-1)for(W=0;W<v;W++)Y=W+q*R[2]+ee*R[1]+N*R[0],w.values[Y]=u;else{var Ye=Math.round(Ue),Ge=Math.round(G);for(W=0;W<v;W++){var et=W+Ye*k[2]+Ge*k[1]+U*k[0],tt=W+q*R[2]+ee*R[1]+N*R[0];w.values[tt]=S[et]}}}}}return w.toTensor()},t.prototype.sparseToDense=function(e,r,o,i){var s=dl(0,e,o),u=s.sliceRank,c=s.numUpdates,f=s.sliceSize,d=s.strides,p=s.outputSize;return this.scatter(e,r,o,p,f,c,u,d,i,!1)},t.prototype.gatherND=function(e,r){var o=r.shape,i=o[o.length-1],s=o0(e,r),u=s[0],c=s[1],f=s[2],d=s[3];if(c===0)return Vt([],u,e.dtype);for(var p=new ts([c,f],e.dtype),v=this.readSync(r.dataId),g=this.readSync(e.dataId),y=0;y<c;y++){for(var b=[],w=0,C=0;C<i;C++){var _=v[y*i+C];w+=_*d[C],b.push(_)}if(w<0||w>=e.size/f)throw new Error("Invalid indices: "+b+" does not index into "+e.shape);for(var S=0;S<f;S++)p.values[y*f+S]=g[w*f+S]}return p.toTensor().reshape(u)},t.prototype.scatterND=function(e,r,o){var i=dl(0,e,o),s=i.sliceRank,u=i.numUpdates,c=i.sliceSize,f=i.strides,d=i.outputSize,p=ve(0);return this.scatter(e,r,o,d,c,u,s,f,p,!0)},t.prototype.fill=function(e,r,o){var i=nl(o=o||ls(r),Re(e));return i.fill(r),j.makeTensor(i,e,o,this)},t.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var r=nl(e.dtype,Re(e.shape));return this.makeOutput(r,e.shape,e.dtype)},t.prototype.linspace=function(e,r,o){return d0(e,r,o)},t.prototype.scatter=function(e,r,o,i,s,u,c,f,d,p){var v=[i/s,s],g=this.readSync(e.dataId),y=this.readSync(r.dataId);if(i===0)return Vt([],o,r.dtype);var b=new ts(v,r.dtype);b.values.fill(this.readSync(d.dataId)[0]);for(var w=0;w<u;w++){for(var C=[],_=0,S=0;S<c;S++){var k=g[w*c+S];C.push(k),_+=k*f[S]}if(_<0||_>=i/s)throw new Error("Invalid indices: "+C+" does not index into "+o);for(var R=0;R<s;R++)p?b.values[_*s+R]+=y[w*s+R]:b.values[_*s+R]=r.rank===0?y[0]:y[w*s+R]}return b.toTensor().reshape(o)},t}(l0);j.registerBackend("cpu",function(){return new Jk},1);for(var dd=0,jg=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=n.attrs,o=t,i=o.boxes,s=o.scores,u=r,c=u.maxOutputSize,f=u.iouThreshold,d=u.scoreThreshold,p=u.softNmsSigma,v=e;ue(i,"NonMaxSuppressionWithScore");var g=ph(v.data.get(i.dataId).values,v.data.get(s.dataId).values,c,f,d,p);return[g.selectedIndices,g.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=t.x,o=e;ue(r,"square");for(var i=o.data.get(r.dataId).values,s=new Float32Array(i.length),u=0;u<i.length;++u){var c=i[u];s[u]=c*c}return{dataId:o.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:os,backendName:"cpu",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=t,o=r.a,i=r.b,s=e;ue([o,i],os);var u=s.data.get(o.dataId).values,c=s.data.get(i.dataId).values,f=function(v,g,y,b,w,C){var _=He(v,g),S=_.length,k=xr(_),R=es(w,Re(_)),N=v.length,P=g.length,F=xr(v),D=xr(g),A=go(v,_),V=go(g,_);if(A.length+V.length===0)for(var U=0;U<R.length;++U)R[U]=C(y[U%y.length],b[U%b.length]);else{var re=function(te){var ee=ub(te,S,k),G=ee.slice(-N);A.forEach(function(K){return G[K]=0});var q=dg(G,N,F),W=ee.slice(-P);V.forEach(function(K){return W[K]=0});var Y=dg(W,P,D);R[te]=C(y[q],b[Y])};for(U=0;U<R.length;++U)re(U)}return[R,_]}(o.shape,i.shape,u,c,o.dtype,function(v,g){var y=v-g;return y*y}),d=f[0],p=f[1];return{dataId:s.write(d,p,o.dtype),shape:p,dtype:o.dtype}}}];dd<jg.length;dd++)Ly(jg[dd]);var Mi,Zk=function(n){this.variableNames=["A"];var t=Yt(),e=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+e+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},eR=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Yt(),e=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+e+`.0);
            vec4 values = `+t.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+t.output+` = result;
      }
    `};for(var hd=0,Hg=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=n.attrs,o=t.pixels,i=r.numChannels,s=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,u=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,c=s?[o.videoWidth,o.videoHeight]:[o.width,o.height],f=c[0],d=c[1],p=[d,f],v=[d,f,i];(u||s)&&(Mi==null&&(Mi=document.createElement("canvas").getContext("2d")),Mi.canvas.width=f,Mi.canvas.height=d,Mi.drawImage(o,0,0,f,d),o=Mi.canvas);var g=e.makeTensorInfo(p,"int32");e.texData.get(g.dataId).usage=Rn.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(g.dataId),o);var y=ae().getBool("WEBGL_PACK")?new eR(v):new Zk(v),b=e.runWebGLProgram(y,[g],"int32");return e.disposeData(g.dataId),b}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=n.attrs;al("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t,i=o.boxes,s=o.scores,u=r,c=u.maxOutputSize,f=u.iouThreshold,d=u.scoreThreshold,p=u.softNmsSigma,v=e,g=ph(v.readSync(i.dataId),v.readSync(s.dataId),c,f,d,p);return[g.selectedIndices,g.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=t.x,o=e,i=new ze(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:os,backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=t,o=r.a,i=r.b,s=e,u=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Br("return (a - b) * (a - b);",o.shape,i.shape):new mt("return (a - b) * (a - b);",o.shape,i.shape);return s.compileAndRun(u,[o,i])}}];hd<Hg.length;hd++)Ly(Hg[hd]);for(var pd=0,Gg=[{kernelName:"Square",gradFunc:function(n,t){var e=t[0];return{x:function(){return n.mul(e.toFloat().mul(2))}}}},{kernelName:os,gradFunc:function(n,t){var e=t[0],r=t[1],o=ve(2);return{a:function(){return Zt(n,Zt(o,Nt(e,r)))},b:function(){return Zt(n,Zt(o,Nt(r,e)))}}}}];pd<Gg.length;pd++)Q2(Gg[pd]);var tR=function(){function n(){}return n.prototype.fetch=function(t,e){return fetch(t,e)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+e);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},n.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},n}();ae().get("IS_BROWSER")&&ae().setPlatform("browser",new tR);var vd,nR=function(){return require("node-fetch")},rR=function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(t,e){return ae().global.fetch!=null?ae().global.fetch(t,e):(vd==null&&(vd=nR()),vd(t,e))},n.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},n.prototype.encode=function(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},n.prototype.decode=function(t,e){return t.length===0?"":new this.util.TextDecoder(e).decode(t)},n}();ae().get("IS_NODE")&&ae().setPlatform("node",new rR);var Ud={float32:4,int32:4,uint16:2,uint8:1,bool:1},xl=4;function a1(n,t){for(var e={},r=0,o=function(u){var c=u.name,f=u.dtype,d=u.shape,p=Re(d),v=void 0;if("quantization"in u){var g=u.quantization;if(g.dtype!=="uint8"&&g.dtype!=="uint16")throw new Error("Weight "+u.name+" has unknown quantization dtype "+g.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var y=Ud[g.dtype],b=n.slice(r,r+p*y),w=g.dtype==="uint8"?new Uint8Array(b):new Uint16Array(b);if(f==="float32")v=Float32Array.from(w,function(N){return N*g.scale+g.min});else{if(f!=="int32")throw new Error("Unsupported dtype in weight '"+c+"': "+f);v=Int32Array.from(w,function(N){return Math.round(N*g.scale+g.min)})}r+=p*y}else if(f==="string"){var C=Re(u.shape);v=[];for(var _=0;_<C;_++){var S=new Uint32Array(n.slice(r,r+xl))[0];r+=xl;var k=new Uint8Array(n.slice(r,r+S));v.push(k),r+=S}}else{var R=Ud[f];if(b=n.slice(r,r+p*R),f==="float32")v=new Float32Array(b);else if(f==="int32")v=new Int32Array(b);else{if(f!=="bool")throw new Error("Unsupported dtype in weight '"+c+"': "+f);v=new Uint8Array(b)}r+=p*R}e[c]=Vt(v,d,f)},i=0,s=t;i<s.length;i++)o(s[i]);return e}function oR(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var t=0,e=[];n.forEach(function(i){if(t+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var r=new Uint8Array(t),o=0;return e.forEach(function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var Vd=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function qg(n){return Vd?Buffer.byteLength(n):new Blob([n]).size}function Ph(n){var t=0;n.forEach(function(o){t+=o.byteLength});var e=new Uint8Array(t),r=0;return n.forEach(function(o){e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function Kg(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var t=n.split("/");return t[t.length-1]}function ms(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:qg(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:qg(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var In=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(t){n.getInstance().saveRouters.push(t)},n.registerLoadRouter=function(t){n.getInstance().loadRouters.push(t)},n.getSaveHandlers=function(t){return n.getHandlers(t,"save")},n.getLoadHandlers=function(t,e){return n.getHandlers(t,"load",e)},n.getHandlers=function(t,e,r){var o=[];return(e==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(i){var s=i(t,r);s!==null&&o.push(s)}),o},n}(),qi="://",wo=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(t,e){O(t!=null,function(){return"scheme must not be undefined or null."}),t.endsWith(qi)&&(t=t.slice(0,t.indexOf(qi))),O(t.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();O(r.managers[t]==null,function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=e},n.getManager=function(t){var e=this.getInstance().managers[t];if(e==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function Xu(n){if(n.indexOf(qi)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+wo.getSchemes().join(","));return{scheme:n.split(qi)[0],path:n.split(qi)[1]}}function $g(n,t,e){return e===void 0&&(e=!1),Ee(this,void 0,void 0,function(){var r,o,i,s,u,c,f,d,p;return _e(this,function(v){switch(v.label){case 0:return O(n!==t,function(){return"Old path and new path are the same: '"+n+"'"}),O((r=In.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),O(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),o=r[0],O((i=In.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),O(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),s=i[0],u=Xu(n).scheme,c=Xu(n).path,f=u===Xu(n).scheme,[4,o.load()];case 1:return d=v.sent(),e&&f?[4,wo.getManager(u).removeModel(c)]:[3,3];case 2:v.sent(),v.label=3;case 3:return[4,s.save(d)];case 4:return p=v.sent(),!e||f?[3,6]:[4,wo.getManager(u).removeModel(c)];case 5:v.sent(),v.label=6;case 6:return[2,p.modelArtifactsInfo]}})})}var Ko="models_store",yo="model_info_store";function s1(){if(!ae().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function jd(n){var t=n.result;t.createObjectStore(Ko,{keyPath:"modelPath"}),t.createObjectStore(yo,{keyPath:"modelPath"})}var Ki=function(){function n(t){if(this.indexedDB=s1(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return n.prototype.save=function(t){return Ee(this,void 0,void 0,function(){return _e(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},n.prototype.load=function(){return Ee(this,void 0,void 0,function(){return _e(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(t,e){var r=this;return new Promise(function(o,i){var s=r.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return jd(s)},s.onsuccess=function(){var u=s.result;if(e==null){var c=u.transaction(Ko,"readonly"),f=c.objectStore(Ko).get(r.modelPath);f.onsuccess=function(){if(f.result==null)return u.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(f.result.modelArtifacts)},f.onerror=function(b){return u.close(),i(f.error)},c.oncomplete=function(){return u.close()}}else{var d,p=ms(e),v=u.transaction(yo,"readwrite"),g=v.objectStore(yo),y=g.put({modelPath:r.modelPath,modelArtifactsInfo:p});y.onsuccess=function(){var b=(d=u.transaction(Ko,"readwrite")).objectStore(Ko).put({modelPath:r.modelPath,modelArtifacts:e,modelArtifactsInfo:p});b.onsuccess=function(){return o({modelArtifactsInfo:p})},b.onerror=function(w){var C=(g=v.objectStore(yo)).delete(r.modelPath);C.onsuccess=function(){return u.close(),i(b.error)},C.onerror=function(_){return u.close(),i(b.error)}}},y.onerror=function(b){return u.close(),i(y.error)},v.oncomplete=function(){d==null?u.close():d.oncomplete=function(){return u.close()}}}},s.onerror=function(u){return i(s.error)}})},n.URL_SCHEME="indexeddb://",n}(),Xg=function(n){return ae().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ki.URL_SCHEME)?(t=n.slice(Ki.URL_SCHEME.length),new Ki(t)):null;var t};In.registerSaveRouter(Xg),In.registerLoadRouter(Xg);var iR=function(){function n(){this.indexedDB=s1()}return n.prototype.listModels=function(){return Ee(this,void 0,void 0,function(){var t=this;return _e(this,function(e){return[2,new Promise(function(r,o){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return jd(i)},i.onsuccess=function(){var s=i.result,u=s.transaction(yo,"readonly"),c=u.objectStore(yo).getAll();c.onsuccess=function(){for(var f={},d=0,p=c.result;d<p.length;d++){var v=p[d];f[v.modelPath]=v.modelArtifactsInfo}r(f)},c.onerror=function(f){return s.close(),o(c.error)},u.oncomplete=function(){return s.close()}},i.onerror=function(s){return o(i.error)}})]})})},n.prototype.removeModel=function(t){return Ee(this,void 0,void 0,function(){var e=this;return _e(this,function(r){var o;return t=(o=t).startsWith(Ki.URL_SCHEME)?o.slice(Ki.URL_SCHEME.length):o,[2,new Promise(function(i,s){var u=e.indexedDB.open("tensorflowjs",1);u.onupgradeneeded=function(){return jd(u)},u.onsuccess=function(){var c,f=u.result,d=f.transaction(yo,"readwrite"),p=d.objectStore(yo),v=p.get(t);v.onsuccess=function(){if(v.result==null)return f.close(),s(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var g=p.delete(t),y=function(){var b=(c=f.transaction(Ko,"readwrite")).objectStore(Ko).delete(t);b.onsuccess=function(){return i(v.result.modelArtifactsInfo)},b.onerror=function(w){return s(v.error)}};g.onsuccess=y,g.onerror=function(b){return y(),f.close(),s(v.error)}},v.onerror=function(g){return f.close(),s(v.error)},d.oncomplete=function(){c==null?f.close():c.oncomplete=function(){return f.close()}}},u.onerror=function(c){return s(u.error)}})]})})},n}();if(ae().getBool("IS_BROWSER"))try{wo.registerManager(Ki.URL_SCHEME,new iR)}catch{}var Wr="/",Vi="tensorflowjs_models",u1="info",aR="model_topology",sR="weight_specs",uR="weight_data",lR="model_metadata";function l1(n){return{info:[Vi,n,u1].join(Wr),topology:[Vi,n,aR].join(Wr),weightSpecs:[Vi,n,sR].join(Wr),weightData:[Vi,n,uR].join(Wr),modelMetadata:[Vi,n,lR].join(Wr)}}function cR(n){var t=n.split(Wr);if(t.length<3)throw new Error("Invalid key format: "+n);return t.slice(1,t.length-1).join(Wr)}var $i=function(){function n(t){if(!ae().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=l1(this.modelPath)}return n.prototype.save=function(t){return Ee(this,void 0,void 0,function(){var e,r,o;return _e(this,function(i){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),o=ms(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(s){if(Vd)return Buffer.from(s).toString("base64");for(var u=new Uint8Array(s),c="",f=0,d=u.length;f<d;f++)c+=String.fromCharCode(u[f]);return btoa(c)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return Ee(this,void 0,void 0,function(){var t,e,r,o,i,s,u;return _e(this,function(c){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=r,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=o,(i=this.LS.getItem(this.keys.modelMetadata))!=null&&(s=JSON.parse(i),e.format=s.format,e.generatedBy=s.generatedBy,e.convertedBy=s.convertedBy,e.userDefinedMetadata=s.userDefinedMetadata),(u=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(f){if(Vd){var d=Buffer.from(f,"base64");return d.buffer.slice(d.byteOffset,d.byteOffset+d.byteLength)}for(var p=atob(f),v=new Uint8Array(p.length),g=0;g<p.length;++g)v.set([p.charCodeAt(g)],g);return v.buffer}(u),[2,e]})})},n.URL_SCHEME="localstorage://",n}(),Yg=function(n){return ae().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith($i.URL_SCHEME)?(t=n.slice($i.URL_SCHEME.length),new $i(t)):null;var t};In.registerSaveRouter(Yg),In.registerLoadRouter(Yg);var fR=function(){function n(){O(ae().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),O(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return Ee(this,void 0,void 0,function(){var t,e,r,o,i,s;return _e(this,function(u){for(t={},e=Vi+Wr,r=Wr+u1,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(e)&&i.endsWith(r)&&(s=cR(i),t[s]=JSON.parse(this.LS.getItem(i)));return[2,t]})})},n.prototype.removeModel=function(t){return Ee(this,void 0,void 0,function(){var e,r;return _e(this,function(o){var i;if(t=(i=t).startsWith($i.URL_SCHEME)?i.slice($i.URL_SCHEME.length):i,e=l1(t),this.LS.getItem(e.info)==null)throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,r]})})},n}();if(ae().getBool("IS_BROWSER"))try{wo.registerManager($i.URL_SCHEME,new fR)}catch{}var dR="model",hR=".json",pR=".weights.bin";function Qg(n){return new Promise(function(t){return setTimeout(t)}).then(n)}var md=function(){function n(t){if(!ae().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(n.URL_SCHEME)&&(t=t.slice(n.URL_SCHEME.length)),t!=null&&t.length!==0||(t=dR),this.modelTopologyFileName=t+hR,this.weightDataFileName=t+pR}return n.prototype.save=function(t){return Ee(this,void 0,void 0,function(){var e,r,o,i,s,u;return _e(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},i=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(s=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=i,[4,Qg(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),t.weightData==null?[3,4]:((u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,u.href=e,[4,Qg(function(){return u.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:ms(t)}]}})})},n.URL_SCHEME="downloads://",n}(),vR=function(){function n(t){if(t==null||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return n.prototype.load=function(){return Ee(this,void 0,void 0,function(){var t,e,r=this;return _e(this,function(o){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(i,s){var u=new FileReader;u.onload=function(c){var f=JSON.parse(c.target.result),d=f.modelTopology;if(d!=null){e.length===0&&i({modelTopology:d});var p=f.weightsManifest;if(p!=null){var v;try{v=r.checkManifestAndWeightFiles(p,e)}catch(w){return void s(w)}var g=[],y=[],b=[];p.forEach(function(w){w.paths.forEach(function(C){y.push(C),b.push(null)}),g.push.apply(g,w.weights)}),p.forEach(function(w){w.paths.forEach(function(C){var _=new FileReader;_.onload=function(S){var k=S.target.result,R=y.indexOf(C);b[R]=k,b.indexOf(null)===-1&&i({modelTopology:d,weightSpecs:g,weightData:Ph(b),format:f.format,generatedBy:f.generatedBy,convertedBy:f.convertedBy,userDefinedMetadata:f.userDefinedMetadata})},_.onerror=function(S){return s("Failed to weights data from file of path '"+C+"'.")},_.readAsArrayBuffer(v[C])})})}else s(new Error("weightManifest field is missing from file "+t.name))}else s(new Error("modelTopology field is missing from file "+t.name))},u.onerror=function(c){return s("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},u.readAsText(t)})]})})},n.prototype.checkManifestAndWeightFiles=function(t,e){for(var r=[],o=e.map(function(c){return Kg(c.name)}),i={},s=0,u=t;s<u.length;s++)u[s].paths.forEach(function(c){var f=Kg(c);if(r.indexOf(f)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+f+"'");if(r.push(f),o.indexOf(f)===-1)throw new Error("Weight file with basename '"+f+"' is not provided.");i[c]=e[o.indexOf(f)]});if(r.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+e.length+").");return i},n}();function Jg(n,t,e,r){(function(i){O(i!=null&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"})})(n),function(i,s){O(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),O(s>=0&&s<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+s}),O(s>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+s})}(e=e??0,r=r??1);var o=0;return Promise.all(n.map(function(i){return i.then(function(s){var u=e+ ++o/n.length*(r-e);return t(u),s}),i}))}function c1(n,t){return Ee(this,void 0,void 0,function(){var e,r,o,i,s,u,c,f,d;return _e(this,function(p){switch(p.label){case 0:return t==null&&(t={}),e=t.fetchFunc==null?ae().platform.fetch:t.fetchFunc,r=n.map(function(v){return e(v,t.requestInit,{isBinary:!0})}),o=0,i=.5,t.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return s=p.sent(),[3,4];case 2:return[4,Jg(r,t.onProgress,o,i)];case 3:s=p.sent(),p.label=4;case 4:return u=s.map(function(v){return v.arrayBuffer()}),c=.5,f=1,t.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return d=p.sent(),[3,8];case 6:return[4,Jg(u,t.onProgress,c,f)];case 7:d=p.sent(),p.label=8;case 8:return[2,d]}})})}function Zg(n){var t=this;return function(e,r,o){return r===void 0&&(r=""),Ee(t,void 0,void 0,function(){var i,s,u,c,f,d,p,v,g,y;return _e(this,function(b){switch(b.label){case 0:if(i=e.map(function(){return!1}),s={},u=o!=null?o.map(function(){return!1}):[],c=[],e.forEach(function(w,C){var _=0;w.weights.forEach(function(S){var k="quantization"in S?S.quantization.dtype:S.dtype,R=Ud[k]*Re(S.shape),N=function(){i[C]=!0,s[C]==null&&(s[C]=[]),s[C].push({manifestEntry:S,groupOffset:_,sizeBytes:R})};o!=null?o.forEach(function(P,F){P===S.name&&(N(),u[F]=!0)}):N(),c.push(S.name),_+=R})}),!u.every(function(w){return w}))throw f=o.filter(function(w,C){return!u[C]}),new Error("Could not find weights in manifest with names: "+f.join(", ")+`. 
Manifest JSON has weights with names: `+c.join(", ")+".");return d=i.reduce(function(w,C,_){return C&&w.push(_),w},[]),p=[],d.forEach(function(w){e[w].paths.forEach(function(C){var _=r+(r.endsWith("/")?"":"/")+C;p.push(_)})}),[4,n(p)];case 1:return v=b.sent(),g={},y=0,d.forEach(function(w){for(var C=e[w].paths.length,_=0,S=0;S<C;S++)_+=v[y+S].byteLength;for(var k=new ArrayBuffer(_),R=new Uint8Array(k),N=0,P=0;P<C;P++){var F=new Uint8Array(v[y+P]);R.set(F,N),N+=F.byteLength}s[w].forEach(function(D){var A=a1(k.slice(D.groupOffset,D.groupOffset+D.sizeBytes),[D.manifestEntry]);for(var V in A)g[V]=A[V]}),y+=C}),[2,g]}})})}}In.registerSaveRouter(function(n){return ae().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(md.URL_SCHEME)?function(t){return t===void 0&&(t="model"),new md(t)}(n.slice(md.URL_SCHEME.length)):null});var f1=function(){function n(t,e){if(this.DEFAULT_METHOD="POST",e==null&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,e.fetchFunc!=null?(O(typeof e.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=ae().platform.fetch,O(t!=null&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&O(t.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,e.requestInit!=null&&e.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return n.prototype.save=function(t){return Ee(this,void 0,void 0,function(){var e,r,o,i;return _e(this,function(s){switch(s.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:r},e.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),t.weightData!=null&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((i=s.sent()).ok)return[2,{modelArtifactsInfo:ms(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},n.prototype.load=function(){return Ee(this,void 0,void 0,function(){var t,e,r,o,i,s,u,c,f,d,p,v;return _e(this,function(g){switch(g.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=g.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");g.label=2;case 2:return g.trys.push([2,4,,5]),[4,t.json()];case 3:return e=g.sent(),[3,5];case 4:throw g.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=e.modelTopology,i=e.weightsManifest,s=e.generatedBy,u=e.convertedBy,c=e.format,f=e.userDefinedMetadata,o==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return i==null?[3,7]:[4,this.loadWeights(i)];case 6:v=g.sent(),d=v[0],p=v[1],g.label=7;case 7:return[2,{modelTopology:o,weightSpecs:d,weightData:p,userDefinedMetadata:f,generatedBy:s,convertedBy:u,format:c}]}})})},n.prototype.loadWeights=function(t){return Ee(this,void 0,void 0,function(){var e,r,o,i,s,u,c,f,d,p,v;return _e(this,function(g){switch(g.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,r=function(y){var b=y.lastIndexOf("/"),w=y.lastIndexOf("?"),C=y.substring(0,b),_=w>b?y.substring(w):"";return[C+"/",_]}(e),o=r[0],i=r[1],s=this.weightPathPrefix||o,u=[],c=0,f=t;c<f.length;c++)d=f[c],u.push.apply(u,d.weights);return p=[],t.forEach(function(y){y.paths.forEach(function(b){p.push(s+b+i)})}),[4,c1(p,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return v=g.sent(),[2,[u,Ph(v)]]}})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function Hd(n){return n.match(f1.URL_SCHEME_REGEX)!=null}var ey=function(n,t){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(e){return Hd(e)}):Hd(n))?Gd(n,{onProgress:t}):null};function Gd(n,t){return new f1(n,t)}In.registerSaveRouter(ey),In.registerLoadRouter(ey);var gd=function(){function n(t){this.modelArtifacts=t}return n.prototype.load=function(){return Ee(this,void 0,void 0,function(){return _e(this,function(t){return[2,this.modelArtifacts]})})},n}(),mR=function(){function n(t){this.saveHandler=t}return n.prototype.save=function(t){return Ee(this,void 0,void 0,function(){return _e(this,function(e){return[2,this.saveHandler(t)]})})},n}(),d1=Object.freeze({browserFiles:function(n){return new vR(n)},browserHTTPRequest:function(n,t){return Gd(n,t)},concatenateArrayBuffers:Ph,decodeWeights:a1,encodeWeights:function(n,t){return Ee(this,void 0,void 0,function(){var e,r,o,i,s,u=this;return _e(this,function(c){switch(c.label){case 0:for(e=[],r=[],o=Array.isArray(n)?n.map(function(f){return f.name}):Object.keys(n),i=function(f){var d=o[f],p=Array.isArray(n)?n[f].tensor:n[d];if(p.dtype!=="float32"&&p.dtype!=="int32"&&p.dtype!=="bool"&&p.dtype!=="string")throw new Error("Unsupported dtype in weight '"+d+"': "+p.dtype);var v={name:d,shape:p.shape,dtype:p.dtype};if(p.dtype==="string"){var g=new Promise(function(y){return Ee(u,void 0,void 0,function(){var b,w,C,_,S,k,R;return _e(this,function(N){switch(N.label){case 0:return[4,p.bytes()];case 1:for(b=N.sent(),w=b.reduce(function(P,F){return P+F.length},0)+xl*b.length,C=new Uint8Array(w),_=0,S=0;S<b.length;S++)k=b[S],R=new Uint8Array(new Uint32Array([k.length]).buffer),C.set(R,_),_+=xl,C.set(k,_),_+=k.length;return y(C),[2]}})})});r.push(g)}else r.push(p.data());t!=null&&(v.group=t),e.push(v)},s=0;s<o.length;++s)i(s);return[4,Promise.all(r)];case 1:return[2,{data:oR(c.sent()),specs:e}]}})})},fromMemory:function(n,t,e,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new gd(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new gd({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new gd({modelTopology:n,weightSpecs:t,weightData:e,trainingConfig:r}))},getLoadHandlers:function(n,t){return In.getLoadHandlers(n,t)},getModelArtifactsInfoForJSON:ms,getSaveHandlers:function(n){return In.getSaveHandlers(n)},http:Gd,isHTTPScheme:Hd,loadWeights:function(n,t,e,r){return t===void 0&&(t=""),Ee(this,void 0,void 0,function(){return _e(this,function(o){return[2,Zg(function(i){return c1(i,{requestInit:r})})(n,t,e)]})})},registerLoadRouter:function(n){return In.registerLoadRouter(n)},registerSaveRouter:function(n){return In.registerSaveRouter(n)},weightsLoaderFactory:Zg,withSaveHandler:function(n){return new mR(n)},copyModel:function(n,t){return Ee(this,void 0,void 0,function(){return _e(this,function(e){return[2,$g(n,t,!1)]})})},listModels:function(){return Ee(this,void 0,void 0,function(){var n,t,e,r,o,i,s;return _e(this,function(u){switch(u.label){case 0:n=wo.getSchemes(),t={},e=0,r=n,u.label=1;case 1:return e<r.length?(o=r[e],[4,wo.getManager(o).listModels()]):[3,4];case 2:for(s in i=u.sent())t[o+qi+s]=i[s];u.label=3;case 3:return e++,[3,1];case 4:return[2,t]}})})},moveModel:function(n,t){return Ee(this,void 0,void 0,function(){return _e(this,function(e){return[2,$g(n,t,!0)]})})},removeModel:function(n){return Ee(this,void 0,void 0,function(){var t;return _e(this,function(e){return t=Xu(n),[2,wo.getManager(t.scheme).removeModel(t.path)]})})}}),Li;B({confusionMatrix_:function(n,t,e){var r=T(n,"labels","confusionMatrix"),o=T(t,"predictions","confusionMatrix");O(e==null||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),O(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),O(o.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),O(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),O(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var i=Md(r.asType("int32"),e),s=Md(o.asType("int32"),e);return i.transpose().matMul(s).asType("int32")}});var gR=B({fromPixels_:function(n,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,r=!1,o=!1,i=!1,s=!1;if(n.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);s=!0}if(o&&o&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(My("FromPixels",j.backendName)!=null)return j.runKernel("FromPixels",{pixels:n},{numChannels:t});var u,c,f=o?[n.videoWidth,n.videoHeight]:[n.width,n.height],d=f[0],p=f[1];if(s?u=n.getContext("2d").getImageData(0,0,d,p).data:r||e?u=n.data:(i||o)&&(Li==null&&(Li=document.createElement("canvas").getContext("2d")),Li.canvas.width=d,Li.canvas.height=p,Li.drawImage(n,0,0,d,p),u=Li.getImageData(0,0,d,p).data),t===4)c=new Int32Array(u);else{var v=d*p;c=new Int32Array(v*t);for(var g=0;g<v;g++)for(var y=0;y<t;++y)c[g*t+y]=u[4*g+y]}return uh(c,[p,d,t],"int32")}}),Fh=Object.freeze({toPixels:function(n,t){return Ee(this,void 0,void 0,function(){var e,r,o,i,s,u,c,f,d,p,v,g,y,b,w,C,_,S,k,R,N,P,F;return _e(this,function(D){switch(D.label){case 0:if(e=T(n,"img","toPixels"),n instanceof ft||(e=e.toInt()),e.rank!==2&&e.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(r=e.shape.slice(0,2),o=r[0],i=r[1],(s=e.rank===2?1:e.shape[2])>4||s===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,e.data()];case 1:return u=D.sent(),c=e.min(),f=e.max(),[4,Promise.all([c.data(),f.data()])];case 2:if(d=D.sent(),p=d[0],v=d[1],g=p[0],y=v[0],c.dispose(),f.dispose(),e.dtype==="float32"){if(g<0||y>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+g+" - "+y+"].")}else{if(e.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(g<0||y>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+g+" - "+y+"].")}for(b=e.dtype==="float32"?255:1,w=new Uint8ClampedArray(i*o*4),C=0;C<o*i;++C)_=void 0,S=void 0,k=void 0,R=void 0,s===1?(_=u[C]*b,S=u[C]*b,k=u[C]*b,R=255):s===3?(_=u[3*C]*b,S=u[3*C+1]*b,k=u[3*C+2]*b,R=255):s===4&&(_=u[4*C]*b,S=u[4*C+1]*b,k=u[4*C+2]*b,R=u[4*C+3]*b),w[(N=4*C)+0]=Math.round(_),w[N+1]=Math.round(S),w[N+2]=Math.round(k),w[N+3]=Math.round(R);return t!=null&&(t.width=i,t.height=o,P=t.getContext("2d"),F=new ImageData(w,i,o),P.putImageData(F,0,0)),e!==n&&e.dispose(),[2,w]}})})},fromPixels:gR}),yR=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(t,e){return new t(e)},n}(),xR=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(t){n.getMap().classNameMap[t.className]=[t,t.fromConfig]},n}();function oi(n){O(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),O(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),O(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),xR.register(n)}var ii=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return nr(t,n),t.prototype.minimize=function(e,r,o){r===void 0&&(r=!1);var i=this.computeGradients(e,o),s=i.value,u=i.grads;if(o!=null){var c=o.map(function(f){return{name:f.name,tensor:u[f.name]}});this.applyGradients(c)}else this.applyGradients(u);return vn(u),r?s:(s.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,r){return NC(e,r)},t.prototype.dispose=function(){this.iterations_!=null&&vn(this.iterations_)},t.prototype.saveIterations=function(){return Ee(this,void 0,void 0,function(){return _e(this,function(e){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:ve(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return Ee(this,void 0,void 0,function(){return _e(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return Ee(this,void 0,void 0,function(){return _e(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return Ee(this,void 0,void 0,function(){var r;return _e(this,function(o){switch(o.label){case 0:return r=this,[4,e[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,e.slice(1)]}})})},t}(yR);Object.defineProperty(ii,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var wR=function(n){function t(e,r,o){o===void 0&&(o=null);var i=n.call(this)||this;return i.learningRate=e,i.rho=r,i.epsilon=o,i.accumulatedGrads=[],i.accumulatedUpdates=[],o==null&&(i.epsilon=j.backend.epsilon()),i}return nr(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var s=j.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accum_grad",variable:xe(function(){return Ke(s).variable(!1)})}),r.accumulatedUpdates[i]==null&&(r.accumulatedUpdates[i]={originalName:o+"/accum_var",variable:xe(function(){return Ke(s).variable(!1)})});var u=Array.isArray(e)?e[i].tensor:e[o];if(u!=null){var c=r.accumulatedGrads[i].variable,f=r.accumulatedUpdates[i].variable;xe(function(){var d=c.mul(r.rho).add(u.square().mul(1-r.rho)),p=f.add(r.epsilon).sqrt().div(c.add(r.epsilon).sqrt()).mul(u),v=f.mul(r.rho).add(p.square().mul(1-r.rho));c.assign(d),f.assign(v);var g=p.mul(-r.learningRate).add(s);s.assign(g)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedUpdates!=null&&(vn(this.accumulatedGrads.map(function(e){return e.variable})),vn(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return Ee(this,void 0,void 0,function(){var e;return _e(this,function(r){switch(r.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(e){return Ee(this,void 0,void 0,function(){var r;return _e(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),r=e.length/2,this.accumulatedGrads=e.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,r){return new e(r.learningRate,r.rho,r.epsilon)},t.className="Adadelta",t}(ii);oi(wR);var bR=function(n){function t(e,r){r===void 0&&(r=.1);var o=n.call(this)||this;return o.learningRate=e,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return nr(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var s=j.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accumulator",variable:xe(function(){return wr(s.shape,r.initialAccumulatorValue).variable(!1)})});var u=Array.isArray(e)?e[i].tensor:e[o];if(u!=null){var c=r.accumulatedGrads[i].variable;xe(function(){var f=c.add(u.square());c.assign(f);var d=u.div(f.add(j.backend.epsilon()).sqrt()).mul(-r.learningRate).add(s);s.assign(d)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedGrads!=null&&vn(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Ee(this,void 0,void 0,function(){return _e(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(e){return Ee(this,void 0,void 0,function(){return _e(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulatedGrads=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,r){return new e(r.learningRate,r.initialAccumulatorValue)},t.className="Adagrad",t}(ii);oi(bR);var CR=function(n){function t(e,r,o,i){i===void 0&&(i=null);var s=n.call(this)||this;return s.learningRate=e,s.beta1=r,s.beta2=o,s.epsilon=i,s.accumulatedFirstMoment=[],s.accumulatedSecondMoment=[],xe(function(){s.accBeta1=ve(r).variable(),s.accBeta2=ve(o).variable()}),i==null&&(s.epsilon=j.backend.epsilon()),s}return nr(t,n),t.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);xe(function(){var i=Nt(1,r.accBeta1),s=Nt(1,r.accBeta2);o.forEach(function(u,c){var f=j.registeredVariables[u];r.accumulatedFirstMoment[c]==null&&(r.accumulatedFirstMoment[c]={originalName:u+"/m",variable:xe(function(){return Ke(f).variable(!1)})}),r.accumulatedSecondMoment[c]==null&&(r.accumulatedSecondMoment[c]={originalName:u+"/v",variable:xe(function(){return Ke(f).variable(!1)})});var d=Array.isArray(e)?e[c].tensor:e[u];if(d!=null){var p=r.accumulatedFirstMoment[c].variable,v=r.accumulatedSecondMoment[c].variable,g=p.mul(r.beta1).add(d.mul(1-r.beta1)),y=v.mul(r.beta2).add(d.square().mul(1-r.beta2)),b=g.div(i),w=y.div(s);p.assign(g),v.assign(y);var C=b.div(w.sqrt().add(r.epsilon)).mul(-r.learningRate).add(f);f.assign(C)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&vn(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedSecondMoment!=null&&vn(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Ee(this,void 0,void 0,function(){var e;return _e(this,function(r){switch(r.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(e){return Ee(this,void 0,void 0,function(){var r,o=this;return _e(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),xe(function(){o.accBeta1.assign(gl(o.beta1,o.iterations_+1)),o.accBeta2.assign(gl(o.beta2,o.iterations_+1))}),r=e.length/2,this.accumulatedFirstMoment=e.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="Adam",t}(ii);oi(CR);var ER=function(n){function t(e,r,o,i,s){i===void 0&&(i=null),s===void 0&&(s=0);var u=n.call(this)||this;return u.learningRate=e,u.beta1=r,u.beta2=o,u.epsilon=i,u.decay=s,u.accumulatedFirstMoment=[],u.accumulatedWeightedInfNorm=[],xe(function(){u.iteration=ve(0).variable(),u.accBeta1=ve(r).variable()}),i==null&&(u.epsilon=j.backend.epsilon()),u}return nr(t,n),t.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);xe(function(){var i=Nt(1,r.accBeta1),s=Zn(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach(function(u,c){var f=j.registeredVariables[u];r.accumulatedFirstMoment[c]==null&&(r.accumulatedFirstMoment[c]={originalName:u+"/m",variable:Ke(f).variable(!1)}),r.accumulatedWeightedInfNorm[c]==null&&(r.accumulatedWeightedInfNorm[c]={originalName:u+"/v",variable:Ke(f).variable(!1)});var d=Array.isArray(e)?e[c].tensor:e[u];if(d!=null){var p=r.accumulatedFirstMoment[c].variable,v=r.accumulatedWeightedInfNorm[c].variable,g=p.mul(r.beta1).add(d.mul(1-r.beta1)),y=v.mul(r.beta2),b=d.abs(),w=y.maximum(b);p.assign(g),v.assign(w);var C=s.div(i).mul(g.div(w.add(r.epsilon))).add(f);f.assign(C)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&vn(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedWeightedInfNorm!=null&&vn(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Ee(this,void 0,void 0,function(){return _e(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return Ee(this,void 0,void 0,function(){return _e(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="Adamax",t}(ii);oi(ER);var h1=function(n){function t(e){var r=n.call(this)||this;return r.learningRate=e,r.setLearningRate(e),r}return nr(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var s=Array.isArray(e)?e[i].tensor:e[o];if(s!=null){var u=j.registeredVariables[o];xe(function(){var c=r.c.mul(s).add(u);u.assign(c)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=jb(ve(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return Ee(this,void 0,void 0,function(){return _e(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return Ee(this,void 0,void 0,function(){return _e(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:if((e=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,r){return new e(r.learningRate)},t.className="SGD",t}(ii);oi(h1);var _R=function(n){function t(e,r,o){o===void 0&&(o=!1);var i=n.call(this,e)||this;return i.learningRate=e,i.momentum=r,i.useNesterov=o,i.accumulations=[],i.m=ve(i.momentum),i}return nr(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var s=j.registeredVariables[o];r.accumulations[i]==null&&(r.accumulations[i]={originalName:o+"/momentum",variable:xe(function(){return Ke(s).variable(!1)})});var u=r.accumulations[i].variable,c=Array.isArray(e)?e[i].tensor:e[o];c!=null&&xe(function(){var f,d=r.m.mul(u).add(c);f=r.useNesterov?r.c.mul(c.add(d.mul(r.m))).add(s):r.c.mul(d).add(s),u.assign(d),s.assign(f)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&vn(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return Ee(this,void 0,void 0,function(){return _e(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(e){return Ee(this,void 0,void 0,function(){return _e(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulations=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)},t.className="Momentum",t}(h1);oi(_R);var SR=function(n){function t(e,r,o,i,s){r===void 0&&(r=.9),o===void 0&&(o=0),i===void 0&&(i=null),s===void 0&&(s=!1);var u=n.call(this)||this;if(u.learningRate=e,u.decay=r,u.momentum=o,u.epsilon=i,u.accumulatedMeanSquares=[],u.accumulatedMoments=[],u.accumulatedMeanGrads=[],u.centered=s,i==null&&(u.epsilon=j.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return u}return nr(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var s=j.registeredVariables[o];r.accumulatedMeanSquares[i]==null&&(r.accumulatedMeanSquares[i]={originalName:o+"/rms",variable:xe(function(){return Ke(s).variable(!1)})}),r.accumulatedMoments[i]==null&&(r.accumulatedMoments[i]={originalName:o+"/momentum",variable:xe(function(){return Ke(s).variable(!1)})}),r.accumulatedMeanGrads[i]==null&&r.centered&&(r.accumulatedMeanGrads[i]={originalName:o+"/mg",variable:xe(function(){return Ke(s).variable(!1)})});var u=Array.isArray(e)?e[i].tensor:e[o];if(u!=null){var c=r.accumulatedMeanSquares[i].variable,f=r.accumulatedMoments[i].variable;xe(function(){var d=c.mul(r.decay).add(u.square().mul(1-r.decay));if(r.centered){var p=r.accumulatedMeanGrads[i].variable,v=p.mul(r.decay).add(u.mul(1-r.decay)),g=f.mul(r.momentum).add(u.mul(r.learningRate).div(d.sub(v.square().add(r.epsilon)).sqrt()));c.assign(d),p.assign(v),f.assign(g);var y=s.sub(g);s.assign(y)}else{var b=c.mul(r.decay).add(u.square().mul(1-r.decay));g=f.mul(r.momentum).add(u.mul(r.learningRate).div(b.add(r.epsilon).sqrt())),c.assign(b),f.assign(g),y=s.sub(g),s.assign(y)}})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&vn(this.accumulatedMeanSquares.map(function(e){return e.variable})),this.accumulatedMeanGrads!=null&&this.centered&&vn(this.accumulatedMeanGrads.map(function(e){return e.variable})),this.accumulatedMoments!=null&&vn(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Ee(this,void 0,void 0,function(){var e;return _e(this,function(r){switch(r.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(e){return Ee(this,void 0,void 0,function(){var r;return _e(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),r=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*r,3*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSProp",t}(ii);oi(SR);ft.prototype.squaredDifference=function(n){return I0(this,n)},ne=Qk;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var qd=function(n,t){return qd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])},qd(n,t)};function Le(n,t){qd(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Xt=function(){return Xt=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Xt.apply(this,arguments)};function Te(n,t,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function u(d){try{f(r.next(d))}catch(p){s(p)}}function c(d){try{f(r.throw(d))}catch(p){s(p)}}function f(d){d.done?i(d.value):o(d.value).then(u,c)}f((r=r.apply(n,[])).next())})}function De(n,t){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(f){return function(d){return c([f,d])}}function c(f){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,o&&(i=f[0]&2?o.return:f[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,f[1])).done)return i;switch(o=0,i&&(f=[f[0]&2,i.value]),f[0]){case 0:case 1:i=f;break;case 4:return e.label++,{value:f[1],done:!1};case 5:e.label++,o=f[1],f=[0];continue;case 7:f=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(f[0]===6||f[0]===2)){e=0;continue}if(f[0]===3&&(!i||f[1]>i[0]&&f[1]<i[3])){e.label=f[1];break}if(f[0]===6&&e.label<i[1]){e.label=i[1],i=f;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(f);break}i[2]&&e.ops.pop(),e.trys.pop();continue}f=t.call(n,e)}catch(d){f=[6,d],o=0}finally{r=i=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function Za(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;for(var r=Array(n),o=0,t=0;t<e;t++)for(var i=arguments[t],s=0,u=i.length;s<u;s++,o++)r[o]=i[s];return r}var Xi=function(){function n(t,e){if(!Yo(t)||!Yo(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}();function Bl(n,t){return n instanceof ft&&n.shape.length===t}function kR(n){return Bl(n,2)}function Wl(n){return Bl(n,3)}function bo(n){return Bl(n,4)}function RR(n){return n%1!==0}function ty(n){return n%2===0}function IR(n,t){t===void 0&&(t=2);var e=Math.pow(10,t);return Math.floor(n*e)/e}function ny(n){return n&&n.width&&n.height}function NR(n,t){var e=n.width,r=n.height,o=t/Math.max(r,e);return new Xi(Math.round(e*o),Math.round(r*o))}function Oh(n){return n.reduce(function(t,e){return t.add(e)},new Qe(0,0)).div(new Qe(n.length,n.length))}function is(n,t,e){return Array(n).fill(0).map(function(r,o){return t+o*e})}function Yo(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function ry(n){return Yo(n)&&0<=n&&n<=1}var Qe=function(){function n(t,e){this._x=t,this._y=e}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.sub=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.mul=function(t){return new n(this.x*t.x,this.y*t.y)},n.prototype.div=function(t){return new n(this.x/t.x,this.y/t.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}(),Eo=function(){function n(t,e){e===void 0&&(e=!0);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(Yo),i=[r.x,r.y,r.width,r.height].every(Yo);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var s=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],u=s[0],c=s[1],f=s[2],d=s[3];n.assertIsValidBox({x:u,y:c,width:f,height:d},"Box.constructor",e),this._x=u,this._y=c,this._width=f,this._height=d}return n.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(Yo)},n.assertIsValidBox=function(t,e,r){if(r===void 0&&(r=!1),!n.isRect(t))throw new Error(e+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(e+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Qe(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Qe(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Qe(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Qe(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(s){return Math.round(s)}),e=t[0],r=t[1],o=t[2],i=t[3];return new n({x:e,y:r,width:o,height:i})},n.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(s){return Math.floor(s)}),e=t[0],r=t[1],o=t[2],i=t[3];return new n({x:e,y:r,width:o,height:i})},n.prototype.toSquare=function(){var t=this,e=t.x,r=t.y,o=t.width,i=t.height,s=Math.abs(o-i);return o<i&&(e-=s/2,o+=s),i<o&&(r-=s/2,i+=s),new n({x:e,y:r,width:o,height:i})},n.prototype.rescale=function(t){var e=ny(t)?t.width:t,r=ny(t)?t.height:t;return new n({x:this.x*e,y:this.y*r,width:this.width*e,height:this.height*r})},n.prototype.pad=function(t,e){var r=[this.x-t/2,this.y-e/2,this.width+t,this.height+e],o=r[0],i=r[1],s=r[2],u=r[3];return new n({x:o,y:i,width:s,height:u})},n.prototype.clipAtImageBorders=function(t,e){var r=this,o=r.x,i=r.y,s=r.right,u=r.bottom,c=Math.max(o,0),f=Math.max(i,0),d=s-c,p=u-f,v=Math.min(d,t-c),g=Math.min(p,e-f);return new n({x:c,y:f,width:v,height:g}).floor()},n.prototype.shift=function(t,e){var r=this,o=r.width,i=r.height,s=this.x+t,u=this.y+e;return new n({x:s,y:u,width:o,height:i})},n.prototype.padAtBorders=function(t,e){var r=this.width+1,o=this.height+1,i=1,s=1,u=r,c=o,f=this.left,d=this.top,p=this.right,v=this.bottom;return p>e&&(u=-p+e+r,p=e),v>t&&(c=-v+t+o,v=t),f<1&&(c=2-f,f=1),d<1&&(c=2-d,d=1),{dy:s,edy:c,dx:i,edx:u,y:d,ey:v,x:f,ex:p,w:r,h:o}},n.prototype.calibrate=function(t){return new n({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},n}(),zl=function(n){Le(t,n);function t(e,r,o,i,s){return s===void 0&&(s=!1),n.call(this,{left:e,top:r,right:o,bottom:i},s)||this}return t}(Eo),p1=function(){function n(t,e,r,o,i){this._imageDims=new Xi(i.width,i.height),this._score=t,this._classScore=e,this._className=r,this._box=new Eo(o).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new Eo(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(t,e){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:e})},n}(),kr=function(n){Le(t,n);function t(e,r,o){return n.call(this,e,e,"",r,o)||this}return t.prototype.forSize=function(e,r){var o=n.prototype.forSize.call(this,e,r),i=o.score,s=o.relativeBox,u=o.imageDims;return new t(i,s,u)},t}(p1);function TR(n,t,e){e===void 0&&(e=!0);var r=Math.max(0,Math.min(n.right,t.right)-Math.max(n.left,t.left)),o=Math.max(0,Math.min(n.bottom,t.bottom)-Math.max(n.top,t.top)),i=r*o;return e?i/(n.area+t.area-i):i/Math.min(n.area,t.area)}function DR(n){var t=n.map(function(u){return u.x}),e=n.map(function(u){return u.y}),r=t.reduce(function(u,c){return c<u?c:u},1/0),o=e.reduce(function(u,c){return c<u?c:u},1/0),i=t.reduce(function(u,c){return u<c?c:u},0),s=e.reduce(function(u,c){return u<c?c:u},0);return new zl(r,o,i,s)}function as(n,t,e,r){r===void 0&&(r=!0);for(var o=t.map(function(u,c){return{score:u,boxIndex:c}}).sort(function(u,c){return u.score-c.score}).map(function(u){return u.boxIndex}),i=[],s=function(){var u=o.pop();i.push(u);for(var c=o,f=[],d=0;d<c.length;d++){var p=c[d],v=n[u],g=n[p];f.push(TR(v,g,r))}o=o.filter(function(y,b){return f[b]<=e})};o.length>0;)s();return i}function gs(n,t){return xe(function(){var e=t[0],r=t[1],o=t[2],i=wr(Za(n.shape.slice(0,3),[1]),e),s=wr(Za(n.shape.slice(0,3),[1]),r),u=wr(Za(n.shape.slice(0,3),[1]),o),c=kt([i,s,u],3);return Nt(n,c)})}function AR(n,t){return t===void 0&&(t=!1),xe(function(){var e=n.shape.slice(1),r=e[0],o=e[1];if(r===o)return n;var i=Math.abs(r-o),s=Math.round(i*(t?.5:1)),u=r>o?2:1,c=function(g){var y=n.shape.slice();return y[u]=g,wr(y,0)},f=c(s),d=i-f.shape[u],p=t&&d?c(d):null,v=[p,n,f].filter(function(g){return!!g}).map(function(g){return g.toFloat()});return kt(v,u)})}function yd(n){return 1/(1+Math.exp(-n))}var Mh=function(n){Le(t,n);function t(e,r,o,i,s){return s===void 0&&(s=!1),n.call(this,{x:e,y:r,width:o,height:i},s)||this}return t}(Eo),PR=.5,FR=.43,OR=.45,wl=function(){function n(t,e,r){r===void 0&&(r=new Qe(0,0));var o=e.width,i=e.height;this._imgDims=new Xi(o,i),this._shift=r,this._positions=t.map(function(s){return s.mul(new Qe(o,i)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Qe(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new Qe(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},n.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new Qe(t,e))},n.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},n.prototype.align=function(t,e){if(e===void 0&&(e={}),t){var r=t instanceof kr?t.box.floor():new Eo(t);return this.shiftBy(r.x,r.y).align(null,e)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),i=o.useDlibAlignment,s=o.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(s)},n.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],r=t[1],o=t[2],i=function(p){return o.sub(p).magnitude()},s=(i(e)+i(r))/2,u=Math.floor(s/OR),c=Oh(t),f=Math.floor(Math.max(0,c.x-PR*u)),d=Math.floor(Math.max(0,c.y-FR*u));return new Mh(f,d,Math.min(u,this.imageWidth+f),Math.min(u,this.imageHeight+d))},n.prototype.alignMinBbox=function(t){var e=DR(this.positions);return e.pad(e.width*t,e.height*t)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),MR=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],Oh([e[3],e[4]])]},t}(wl),LR=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Oh)},t}(wl),oy=function(){function n(t,e){this._label=t,this._distance=e}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(t){return t===void 0&&(t=!0),""+this.label+(t?" ("+IR(this.distance)+")":"")},n}(),iy=function(n){Le(t,n);function t(e,r){var o=n.call(this,e)||this;return o._label=r,o}return t.assertIsValidLabeledBox=function(e,r){if(Eo.assertIsValidBox(e,r),!Yo(e.label))throw new Error(r+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(Eo),ju=function(){function n(t,e){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},n.fromJSON=function(t){var e=t.descriptors.map(function(r){return new Float32Array(r)});return new n(t.label,e)},n}();(function(n){Le(t,n);function t(e,r,o,i){var s=n.call(this,e,r)||this;return s._score=o,s._classScore=i,s}return t.assertIsValidPredictedBox=function(e,r){if(iy.assertIsValidLabeledBox(e,r),!ry(e.score)||!ry(e.classScore))throw new Error(r+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t})(iy);function BR(n){return n.detection instanceof kr}function Lh(n,t){var e={detection:t};return Object.assign({},n,e)}function v1(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},t=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:t}}function m1(n){var t="";if(!n)try{n=require("fs")}catch(r){t=r.toString()}var e=n?function(r){return new Promise(function(o,i){n.readFile(r,function(s,u){return s?i(s):o(u)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:e}}function g1(){var n=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,e=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=m1();return Xt({Canvas:n||function(){function s(){}return s}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function s(){}return s}(),Image:t||function(){function s(){}return s}(),ImageData:global.ImageData||function(){function s(){}return s}(),Video:global.HTMLVideoElement||function(){function s(){}return s}(),createCanvasElement:e,createImageElement:r,fetch:o},i)}function y1(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function x1(){return typeof global=="object"&&typeof require=="function"&&typeof Vx<"u"&&typeof process<"u"&&!!process.version}var St;function WR(){if(!St)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return St}function Kd(n){St=n}function Bh(){y1()&&Kd(v1()),x1()&&Kd(g1())}function zR(n){if(St||Bh(),!St)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=n.Canvas,e=t===void 0?St.Canvas:t,r=n.Image,o=r===void 0?St.Image:r;St.Canvas=e,St.Image=o,St.createCanvasElement=n.createCanvasElement||function(){return new e},St.createImageElement=n.createImageElement||function(){return new o},St.ImageData=n.ImageData||St.ImageData,St.Video=n.Video||St.Video,St.fetch=n.fetch||St.fetch,St.readFile=n.readFile||St.readFile}var en={getEnv:WR,setEnv:Kd,initialize:Bh,createBrowserEnv:v1,createFileSystem:m1,createNodejsEnv:g1,monkeyPatch:zR,isBrowser:y1,isNodejs:x1};Bh();function w1(n){return!en.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function Zo(n){var t=en.getEnv(),e=t.Canvas,r=t.CanvasRenderingContext2D;if(n instanceof r)return n;var o=w1(n);if(!(o instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=o.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}var ay;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(ay||(ay={}));function b1(n){var t=en.getEnv(),e=t.Image,r=t.Video;return n instanceof e&&n.complete||n instanceof r&&n.readyState>=3}function UR(n){return new Promise(function(t,e){if(n instanceof en.getEnv().Canvas||b1(n))return t();function r(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),t(i))}function o(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),e(i))}n.addEventListener("load",r),n.addEventListener("error",o)})}function C1(n){var t=en.getEnv(),e=t.Image,r=t.Video;return n instanceof e?new Xi(n.naturalWidth,n.naturalHeight):n instanceof r?new Xi(n.videoWidth,n.videoHeight):new Xi(n.width,n.height)}function Ul(n){var t=n.width,e=n.height,r=en.getEnv().createCanvasElement,o=r();return o.width=t,o.height=e,o}function Wh(n,t){var e=en.getEnv().ImageData;if(!(n instanceof e)&&!b1(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=C1(n),o=r.width,i=r.height,s=Ul({width:o,height:i});return n instanceof e?Zo(s).putImageData(n,0,0):Zo(s).drawImage(n,0,0,o,i),s}function VR(n,t){return Te(this,void 0,void 0,function(){var e,r,o,i,s,u;return De(this,function(c){switch(c.label){case 0:return e=en.getEnv().createCanvasElement(),r=n.shape.slice(bo(n)?1:0),o=r[0],i=r[1],s=r[2],u=xe(function(){return n.as3D(o,i,s).toInt()}),[4,Fh.toPixels(u,e)];case 1:return c.sent(),u.dispose(),[2,e]}})})}function sy(n){var t=en.getEnv(),e=t.Image,r=t.Canvas,o=t.Video;return n instanceof e||n instanceof r||n instanceof o}function jR(n,t,e){e===void 0&&(e=!1);var r=en.getEnv(),o=r.Image,i=r.Canvas;if(!(n instanceof o||n instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=C1(n),u=t/Math.max(s.height,s.width),c=u*s.width,f=u*s.height,d=Ul({width:t,height:t}),p=n instanceof i?n:Wh(n),v=Math.abs(c-f)/2,g=e&&c<f?v:0,y=e&&f<c?v:0;return Zo(d).drawImage(p,g,y,c,f),d}var bl=function(){function n(t,e){var r=this;if(e===void 0&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(o,i){if(Wl(o)){r._imageTensors[i]=o,r._inputDimensions[i]=o.shape;return}if(bo(o)){var s=o.shape[0];if(s!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+s+" passed, but not supported in input array");r._imageTensors[i]=o,r._inputDimensions[i]=o.shape.slice(1);return}var u=o instanceof en.getEnv().Canvas?o:Wh(o);r._canvases[i]=u,r._inputDimensions[i]=[u.height,u.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var t=this;return is(this.batchSize,0,1).map(function(e,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},n.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},n.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},n.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},n.prototype.getReshapedInputDimensions=function(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var e=this.getInputWidth(t),r=this.getInputHeight(t);return NR({width:e,height:r},this.inputSize)},n.prototype.toBatchTensor=function(t,e){var r=this;return e===void 0&&(e=!0),this._inputSize=t,xe(function(){var o=is(r.batchSize,0,1).map(function(s){var u=r.getInput(s);if(u instanceof ft){var c=bo(u)?u:u.expandDims();return c=AR(c,e),(c.shape[1]!==t||c.shape[2]!==t)&&(c=Ih.resizeBilinear(c,[t,t])),c.as3D(t,t,3)}if(u instanceof en.getEnv().Canvas)return Fh.fromPixels(jR(u,t,e));throw new Error("toBatchTensor - at batchIdx "+s+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+u)}),i=Tn(o.map(function(s){return s.toFloat()})).as4D(r.batchSize,t,t,3);return i})},n}();function Mt(n){return Te(this,void 0,void 0,function(){var t,e,r;return De(this,function(o){switch(o.label){case 0:if(n instanceof bl)return[2,n];if(t=Array.isArray(n)?n:[n],!t.length)throw new Error("toNetInput - empty array passed as input");return e=function(i){return Array.isArray(n)?" at input index "+i+":":""},r=t.map(w1),r.forEach(function(i,s){if(!sy(i)&&!Wl(i)&&!bo(i))throw typeof t[s]=="string"?new Error("toNetInput -"+e(s)+" string passed, but could not resolve HTMLElement for element id "+t[s]):new Error("toNetInput -"+e(s)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(bo(i)){var u=i.shape[0];if(u!==1)throw new Error("toNetInput -"+e(s)+" tf.Tensor4D with batchSize "+u+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return sy(i)&&UR(i)}))];case 1:return o.sent(),[2,new bl(r,Array.isArray(n))]}})})}function zh(n,t){return Te(this,void 0,void 0,function(){var e,r,o,i,s,u,c;return De(this,function(f){switch(f.label){case 0:return e=en.getEnv().Canvas,r=n,n instanceof e?[3,5]:[4,Mt(n)];case 1:if(o=f.sent(),o.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return i=o.getInput(0),i instanceof e?(s=i,[3,4]):[3,2];case 2:return[4,VR(i)];case 3:s=f.sent(),f.label=4;case 4:r=s,f.label=5;case 5:return u=Zo(r),c=t.map(function(d){return d instanceof kr?d.forSize(r.width,r.height).box.floor():d}).map(function(d){return d.clipAtImageBorders(r.width,r.height)}),[2,c.map(function(d){var p=d.x,v=d.y,g=d.width,y=d.height,b=Ul({width:g,height:y});return Zo(b).putImageData(u.getImageData(p,v,g,y),0,0),b})]}})})}function Uh(n,t){return Te(this,void 0,void 0,function(){return De(this,function(e){if(!Wl(n)&&!bo(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(bo(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,xe(function(){var r=n.shape.slice(bo(n)?1:0),o=r[0],i=r[1],s=r[2],u=t.map(function(f){return f instanceof kr?f.forSize(i,o).box:f}).map(function(f){return f.clipAtImageBorders(i,o)}),c=u.map(function(f){var d=f.x,p=f.y,v=f.width,g=f.height;return X0(n.as3D(o,i,s),[p,d,0],[g,v,s])});return c})]})})}function HR(n,t){return Te(this,void 0,void 0,function(){var e,r;return De(this,function(o){switch(o.label){case 0:return e=en.getEnv().fetch,[4,e(n,t)];case 1:if(r=o.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function GR(n){return Te(this,void 0,void 0,function(){return De(this,function(t){switch(t.label){case 0:return[4,HR(n)];case 1:return[2,t.sent().json()]}})})}function E1(n,t){var e=t+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:e};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+e};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var o=n.split("/").filter(function(u){return u}),i=n.endsWith(".json")?o[o.length-1]:e,s=r+(n.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return s=n.startsWith("/")?"/"+s:s,{modelBaseUri:s,manifestUri:s==="/"?"/"+i:s+"/"+i}}function qR(n,t){return Te(this,void 0,void 0,function(){var e,r,o,i;return De(this,function(s){switch(s.label){case 0:return e=E1(n,t),r=e.manifestUri,o=e.modelBaseUri,[4,GR(r)];case 1:return i=s.sent(),[2,d1.loadWeights(i,o)]}})})}var Gr=function(){function n(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t),r=e.obj,o=e.objProp;return r[o]},n.prototype.reassignParamFromPath=function(t,e){var r=this.traversePropertyPath(t),o=r.obj,i=r.objProp;o[i].dispose(),o[i]=e},n.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var r=e.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof Ji})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof Ji)})},n.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){var r=e.path,o=e.tensor;t.reassignParamFromPath(r,o.variable())})},n.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var r=e.path,o=e.tensor,i=Vt(o.dataSync());o.dispose(),t.reassignParamFromPath(r,i)})},n.prototype.dispose=function(t){t===void 0&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var e=t.tensor;return Array.from(e.dataSync())}).reduce(function(t,e){return t.concat(e)}))},n.prototype.load=function(t){return Te(this,void 0,void 0,function(){return De(this,function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},n.prototype.loadFromUri=function(t){return Te(this,void 0,void 0,function(){var e;return De(this,function(r){switch(r.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,qR(t,this.getDefaultModelName())];case 1:return e=r.sent(),this.loadFromWeightMap(e),[2]}})})},n.prototype.loadFromDisk=function(t){return Te(this,void 0,void 0,function(){var e,r,o,i,s,u,c,f,d,p;return De(this,function(v){switch(v.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return e=en.getEnv().readFile,r=E1(t,this.getDefaultModelName()),o=r.manifestUri,i=r.modelBaseUri,s=function(g){return Promise.all(g.map(function(y){return e(y).then(function(b){return b.buffer})}))},u=d1.weightsLoaderFactory(s),d=(f=JSON).parse,[4,e(o)];case 1:return c=d.apply(f,[v.sent().toString()]),[4,u(c,i)];case 2:return p=v.sent(),this.loadFromWeightMap(p),[2]}})})},n.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),r=e.paramMappings,o=e.params;this._paramMappings=r,this._params=o},n.prototype.extractWeights=function(t){var e=this.extractParams(t),r=e.paramMappings,o=e.params;this._paramMappings=r,this._params=o},n.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(i,s){if(!i.nextObj.hasOwnProperty(s))throw new Error("traversePropertyPath - object does not have property "+s+", for path "+t);return{obj:i.nextObj,objProp:s,nextObj:i.nextObj[s]}},{nextObj:this.params}),r=e.obj,o=e.objProp;if(!r||!o||!(r[o]instanceof ft))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:o}},n}();function Nn(n,t,e){return xe(function(){var r=Eh(n,t.depthwise_filter,t.pointwise_filter,e,"same");return r=je(r,t.bias),r})}function xd(n,t,e){return e===void 0&&(e=!1),xe(function(){var r=dt(e?je(Hn(n,t.conv0.filters,[2,2],"same"),t.conv0.bias):Nn(n,t.conv0,[2,2])),o=Nn(r,t.conv1,[1,1]),i=dt(je(r,o)),s=Nn(i,t.conv2,[1,1]);return dt(je(r,je(o,s)))})}function Hu(n,t,e,r){return e===void 0&&(e=!1),r===void 0&&(r=!0),xe(function(){var o=dt(e?je(Hn(n,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Nn(n,t.conv0,r?[2,2]:[1,1])),i=Nn(o,t.conv1,[1,1]),s=dt(je(o,i)),u=Nn(s,t.conv2,[1,1]),c=dt(je(o,je(i,u))),f=Nn(c,t.conv3,[1,1]);return dt(je(o,je(i,je(u,f))))})}function tr(n,t,e,r){return e===void 0&&(e="same"),r===void 0&&(r=!1),xe(function(){var o=je(Hn(n,t.filters,[1,1],e),t.bias);return r?dt(o):o})}function qr(n,t){Object.keys(n).forEach(function(e){t.some(function(r){return r.originalPath===e})||n[e].dispose()})}function Vl(n,t){return function(e,r,o,i){var s=dn(n(e*r*o*o),[o,o,e,r]),u=Ct(n(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:s,bias:u}}}function Vh(n,t){return function(e,r,o){var i=xo(n(e*r),[e,r]),s=Ct(n(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:s}}}var _1=function(){function n(t,e,r){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=r}return n}();function jh(n,t){return function(e,r,o){var i=dn(n(9*e),[3,3,e,1]),s=dn(n(e*r),[1,1,e,r]),u=Ct(n(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new _1(i,s,u)}}function Hh(n){return function(t){var e=n(t+"/depthwise_filter",4),r=n(t+"/pointwise_filter",4),o=n(t+"/bias",1);return new _1(e,r,o)}}function ko(n,t){return function(e,r,o){var i=n[e];if(!Bl(i,r))throw new Error("expected weightMap["+e+"] to be a Tensor"+r+"D, instead have "+i);return t.push({originalPath:e,paramPath:o||e}),i}}function Kr(n){var t=n;function e(o){var i=t.slice(0,o);return t=t.slice(o),i}function r(){return t}return{extractWeights:e,getRemainingWeights:r}}function S1(n,t){var e=Vl(n,t),r=jh(n,t);function o(s,u,c,f){f===void 0&&(f=!1);var d=f?e(s,u,3,c+"/conv0"):r(s,u,c+"/conv0"),p=r(u,u,c+"/conv1"),v=r(u,u,c+"/conv2");return{conv0:d,conv1:p,conv2:v}}function i(s,u,c,f){f===void 0&&(f=!1);var d=o(s,u,c,f),p=d.conv0,v=d.conv1,g=d.conv2,y=r(u,u,c+"/conv3");return{conv0:p,conv1:v,conv2:g,conv3:y}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:i}}function KR(n){var t=[],e=Kr(n),r=e.extractWeights,o=e.getRemainingWeights,i=S1(r,t).extractDenseBlock4Params,s=i(3,32,"dense0",!0),u=i(32,64,"dense1"),c=i(64,128,"dense2"),f=i(128,256,"dense3");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:s,dense1:u,dense2:c,dense3:f}}}function k1(n){return function(t){var e=n(t+"/filters",4),r=n(t+"/bias",1);return{filters:e,bias:r}}}function R1(n,t){var e=ko(n,t),r=k1(e),o=Hh(e);function i(u,c){c===void 0&&(c=!1);var f=c?r(u+"/conv0"):o(u+"/conv0"),d=o(u+"/conv1"),p=o(u+"/conv2");return{conv0:f,conv1:d,conv2:p}}function s(u,c){c===void 0&&(c=!1);var f=c?r(u+"/conv0"):o(u+"/conv0"),d=o(u+"/conv1"),p=o(u+"/conv2"),v=o(u+"/conv3");return{conv0:f,conv1:d,conv2:p,conv3:v}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:s}}function $R(n){var t=[],e=R1(n,t).extractDenseBlock4Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return qr(n,t),{params:r,paramMappings:t}}var I1=function(n){Le(t,n);function t(){return n.call(this,"FaceFeatureExtractor")||this}return t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return xe(function(){var o=e.toBatchTensor(112,!0),i=[122.782,117.001,104.298],s=gs(o,i).div(ve(255)),u=Hu(s,r.dense0,!0);return u=Hu(u,r.dense1),u=Hu(u,r.dense2),u=Hu(u,r.dense3),u=vs(u,[7,7],[2,2],"valid"),u})},t.prototype.forward=function(e){return Te(this,void 0,void 0,function(){var r;return De(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return $R(e)},t.prototype.extractParams=function(e){return KR(e)},t}(Gr);function gr(n,t){return xe(function(){return je(Ol(n,t.weights),t.bias)})}function XR(n,t,e){var r=[],o=Kr(n),i=o.extractWeights,s=o.getRemainingWeights,u=Vh(i,r),c=u(t,e,"fc");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:r,params:{fc:c}}}function YR(n){var t=[],e=ko(n,t);function r(i){var s=e(i+"/weights",2),u=e(i+"/bias",1);return{weights:s,bias:u}}var o={fc:r("fc")};return qr(n,t),{params:o,paramMappings:t}}function N1(n){var t={},e={};return Object.keys(n).forEach(function(r){var o=r.startsWith("fc")?e:t;o[r]=n[r]}),{featureExtractorMap:t,classifierMap:e}}var T1=function(n){Le(t,n);function t(e,r){var o=n.call(this,e)||this;return o._faceFeatureExtractor=r,o}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return xe(function(){var i=e instanceof bl?r.faceFeatureExtractor.forwardInput(e):e;return gr(i.as2D(i.shape[0],-1),o.fc)})},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),n.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},t.prototype.extractClassifierParams=function(e){return XR(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var r=N1(e),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),YR(i)},t.prototype.extractParams=function(e){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*r+o,s=e.slice(0,e.length-i),u=e.slice(e.length-i);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(u)},t}(Gr),uy=["neutral","happy","sad","angry","fearful","disgusted","surprised"],QR=function(){function n(t){var e=this;if(t.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);uy.forEach(function(r,o){e[r]=t[o]})}return n.prototype.asSortedArray=function(){var t=this;return uy.map(function(e){return{expression:e,probability:t[e]}}).sort(function(e,r){return r.probability-e.probability})},n}(),JR=function(n){Le(t,n);function t(e){return e===void 0&&(e=new I1),n.call(this,"FaceExpressionNet",e)||this}return t.prototype.forwardInput=function(e){var r=this;return xe(function(){return jr(r.runNet(e))})},t.prototype.forward=function(e){return Te(this,void 0,void 0,function(){var r;return De(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictExpressions=function(e){return Te(this,void 0,void 0,function(){var r,o,i,s,u=this;return De(this,function(c){switch(c.label){case 0:return[4,Mt(e)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return o=c.sent(),[4,Promise.all(Rt(o).map(function(f){return Te(u,void 0,void 0,function(){var d;return De(this,function(p){switch(p.label){case 0:return[4,f.data()];case 1:return d=p.sent(),f.dispose(),[2,d]}})})}))];case 3:return i=c.sent(),o.dispose(),s=i.map(function(f){return new QR(f)}),[2,r.isBatchInput?s:s[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(T1);function D1(n,t){var e={expressions:t};return Object.assign({},n,e)}function ZR(n){return BR(n)&&n.landmarks instanceof wl&&n.unshiftedLandmarks instanceof wl&&n.alignedRect instanceof kr}function Gh(n,t){var e=n.detection.box,r=t.shiftBy(e.x,e.y),o=r.align(),i=n.detection.imageDims,s=new kr(n.detection.score,o.rescale(i.reverse()),i),u={landmarks:r,unshiftedLandmarks:t,alignedRect:s};return Object.assign({},n,u)}function e3(n,t){var e=Vl(n,t),r=jh(n,t);function o(s,u,c){var f=r(s,u,c+"/separable_conv0"),d=r(u,u,c+"/separable_conv1"),p=e(s,u,1,c+"/expansion_conv");return{separable_conv0:f,separable_conv1:d,expansion_conv:p}}function i(s,u){var c=r(s,s,u+"/separable_conv0"),f=r(s,s,u+"/separable_conv1"),d=r(s,s,u+"/separable_conv2");return{separable_conv0:c,separable_conv1:f,separable_conv2:d}}return{extractConvParams:e,extractSeparableConvParams:r,extractReductionBlockParams:o,extractMainBlockParams:i}}function t3(n,t){var e=[],r=Kr(n),o=r.extractWeights,i=r.getRemainingWeights,s=e3(o,e),u=s.extractConvParams,c=s.extractSeparableConvParams,f=s.extractReductionBlockParams,d=s.extractMainBlockParams,p=u(3,32,3,"entry_flow/conv_in"),v=f(32,64,"entry_flow/reduction_block_0"),g=f(64,128,"entry_flow/reduction_block_1"),y={conv_in:p,reduction_block_0:v,reduction_block_1:g},b={};is(t,0,1).forEach(function(S){b["main_block_"+S]=d(128,"middle_flow/main_block_"+S)});var w=f(128,256,"exit_flow/reduction_block"),C=c(256,512,"exit_flow/separable_conv"),_={reduction_block:w,separable_conv:C};if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{entry_flow:y,middle_flow:b,exit_flow:_}}}function n3(n,t){var e=ko(n,t),r=k1(e),o=Hh(e);function i(u){var c=o(u+"/separable_conv0"),f=o(u+"/separable_conv1"),d=r(u+"/expansion_conv");return{separable_conv0:c,separable_conv1:f,expansion_conv:d}}function s(u){var c=o(u+"/separable_conv0"),f=o(u+"/separable_conv1"),d=o(u+"/separable_conv2");return{separable_conv0:c,separable_conv1:f,separable_conv2:d}}return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:i,extractMainBlockParams:s}}function r3(n,t){var e=[],r=n3(n,e),o=r.extractConvParams,i=r.extractSeparableConvParams,s=r.extractReductionBlockParams,u=r.extractMainBlockParams,c=o("entry_flow/conv_in"),f=s("entry_flow/reduction_block_0"),d=s("entry_flow/reduction_block_1"),p={conv_in:c,reduction_block_0:f,reduction_block_1:d},v={};is(t,0,1).forEach(function(w){v["main_block_"+w]=u("middle_flow/main_block_"+w)});var g=s("exit_flow/reduction_block"),y=i("exit_flow/separable_conv"),b={reduction_block:g,separable_conv:y};return qr(n,e),{params:{entry_flow:p,middle_flow:v,exit_flow:b},paramMappings:e}}function A1(n,t,e){return je(Hn(n,t.filters,e,"same"),t.bias)}function wd(n,t,e){e===void 0&&(e=!0);var r=e?dt(n):n;return r=Nn(r,t.separable_conv0,[1,1]),r=Nn(dt(r),t.separable_conv1,[1,1]),r=Ft(r,[3,3],[2,2],"same"),r=je(r,A1(n,t.expansion_conv,[2,2])),r}function o3(n,t){var e=Nn(dt(n),t.separable_conv0,[1,1]);return e=Nn(dt(e),t.separable_conv1,[1,1]),e=Nn(dt(e),t.separable_conv2,[1,1]),e=je(e,n),e}var i3=function(n){Le(t,n);function t(e){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=e,r}return t.prototype.forwardInput=function(e){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return xe(function(){var i=e.toBatchTensor(112,!0),s=[122.782,117.001,104.298],u=gs(i,s).div(ve(256)),c=dt(A1(u,o.entry_flow.conv_in,[2,2]));return c=wd(c,o.entry_flow.reduction_block_0,!1),c=wd(c,o.entry_flow.reduction_block_1),is(r._numMainBlocks,0,1).forEach(function(f){c=o3(c,o.middle_flow["main_block_"+f])}),c=wd(c,o.exit_flow.reduction_block),c=dt(Nn(c,o.exit_flow.separable_conv,[1,1])),c})},t.prototype.forward=function(e){return Te(this,void 0,void 0,function(){var r;return De(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return r3(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return t3(e,this._numMainBlocks)},t}(Gr);function a3(n){var t=[],e=Kr(n),r=e.extractWeights,o=e.getRemainingWeights,i=Vh(r,t),s=i(512,1,"fc/age"),u=i(512,2,"fc/gender");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:s,gender:u}}}}function s3(n){var t=[],e=ko(n,t);function r(i){var s=e(i+"/weights",2),u=e(i+"/bias",1);return{weights:s,bias:u}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return qr(n,t),{params:o,paramMappings:t}}var Cl;(function(n){n.FEMALE="female",n.MALE="male"})(Cl||(Cl={}));var u3=function(n){Le(t,n);function t(e){e===void 0&&(e=new i3(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=e,r}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return xe(function(){var i=e instanceof bl?r.faceFeatureExtractor.forwardInput(e):e,s=vs(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1),u=gr(s,o.fc.age).as1D(),c=gr(s,o.fc.gender);return{age:u,gender:c}})},t.prototype.forwardInput=function(e){var r=this;return xe(function(){var o=r.runNet(e),i=o.age,s=o.gender;return{age:i,gender:jr(s)}})},t.prototype.forward=function(e){return Te(this,void 0,void 0,function(){var r;return De(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return Te(this,void 0,void 0,function(){var r,o,i,s,u,c,f=this;return De(this,function(d){switch(d.label){case 0:return[4,Mt(e)];case 1:return r=d.sent(),[4,this.forwardInput(r)];case 2:return o=d.sent(),i=Rt(o.age),s=Rt(o.gender),u=i.map(function(p,v){return{ageTensor:p,genderTensor:s[v]}}),[4,Promise.all(u.map(function(p){var v=p.ageTensor,g=p.genderTensor;return Te(f,void 0,void 0,function(){var y,b,w,C,_;return De(this,function(S){switch(S.label){case 0:return[4,v.data()];case 1:return y=S.sent()[0],[4,g.data()];case 2:return b=S.sent()[0],w=b>.5,C=w?Cl.MALE:Cl.FEMALE,_=w?b:1-b,v.dispose(),g.dispose(),[2,{age:y,gender:C,genderProbability:_}]}})})}))];case 3:return c=d.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?c:c[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),n.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},t.prototype.extractClassifierParams=function(e){return a3(e)},t.prototype.extractParamsFromWeigthMap=function(e){var r=N1(e),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),s3(i)},t.prototype.extractParams=function(e){var r=1539,o=e.slice(0,e.length-r),i=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},t}(Gr),P1=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.postProcess=function(e,r,o){var i=o.map(function(u){var c=u.width,f=u.height,d=r/Math.max(f,c);return{width:c*d,height:f*d}}),s=i.length;return xe(function(){var u=function(v,g){return Tn([wr([68],v),wr([68],g)],1).as2D(1,136).as1D()},c=function(v,g){var y=i[v],b=y.width,w=y.height;return g(b,w)?Math.abs(b-w)/2:0},f=function(v){return c(v,function(g,y){return g<y})},d=function(v){return c(v,function(g,y){return y<g})},p=e.mul(wr([s,136],r)).sub(Tn(Array.from(Array(s),function(v,g){return u(f(g),d(g))}))).div(Tn(Array.from(Array(s),function(v,g){return u(i[g].width,i[g].height)})));return p})},t.prototype.forwardInput=function(e){var r=this;return xe(function(){var o=r.runNet(e);return r.postProcess(o,e.inputSize,e.inputDimensions.map(function(i){var s=i[0],u=i[1];return{height:s,width:u}}))})},t.prototype.forward=function(e){return Te(this,void 0,void 0,function(){var r;return De(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.detectLandmarks=function(e){return Te(this,void 0,void 0,function(){var r,o,i,s=this;return De(this,function(u){switch(u.label){case 0:return[4,Mt(e)];case 1:return r=u.sent(),o=xe(function(){return Rt(s.forwardInput(r))}),[4,Promise.all(o.map(function(c,f){return Te(s,void 0,void 0,function(){var d,p,v,g,y;return De(this,function(b){switch(b.label){case 0:return v=(p=Array).from,[4,c.data()];case 1:return d=v.apply(p,[b.sent()]),g=d.filter(function(w,C){return ty(C)}),y=d.filter(function(w,C){return!ty(C)}),[2,new LR(Array(68).fill(0).map(function(w,C){return new Qe(g[C],y[C])}),{height:r.getInputHeight(f),width:r.getInputWidth(f)})]}})})}))];case 2:return i=u.sent(),o.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(T1),F1=function(n){Le(t,n);function t(e){return e===void 0&&(e=new I1),n.call(this,"FaceLandmark68Net",e)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(P1);function l3(n){var t=[],e=R1(n,t).extractDenseBlock3Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return qr(n,t),{params:r,paramMappings:t}}function c3(n){var t=[],e=Kr(n),r=e.extractWeights,o=e.getRemainingWeights,i=S1(r,t).extractDenseBlock3Params,s=i(3,32,"dense0",!0),u=i(32,64,"dense1"),c=i(64,128,"dense2");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:s,dense1:u,dense2:c}}}var f3=function(n){Le(t,n);function t(){return n.call(this,"TinyFaceFeatureExtractor")||this}return t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return xe(function(){var o=e.toBatchTensor(112,!0),i=[122.782,117.001,104.298],s=gs(o,i).div(ve(255)),u=xd(s,r.dense0,!0);return u=xd(u,r.dense1),u=xd(u,r.dense2),u=vs(u,[14,14],[2,2],"valid"),u})},t.prototype.forward=function(e){return Te(this,void 0,void 0,function(){var r;return De(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return l3(e)},t.prototype.extractParams=function(e){return c3(e)},t}(Gr),d3=function(n){Le(t,n);function t(e){return e===void 0&&(e=new f3),n.call(this,"FaceLandmark68TinyNet",e)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(P1);(function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t})(F1);function h3(n,t){return je(Zt(n,t.weights),t.biases)}function qh(n,t,e,r,o){o===void 0&&(o="same");var i=t.conv,s=i.filters,u=i.bias,c=Hn(n,s,e,o);return c=je(c,u),c=h3(c,t.scale),r?dt(c):c}function p3(n,t){return qh(n,t,[1,1],!0)}function O1(n,t){return qh(n,t,[1,1],!1)}function M1(n,t){return qh(n,t,[2,2],!0,"valid")}function v3(n,t){function e(u,c,f){var d=n(u),p=d.length/(c*f*f);if(RR(p))throw new Error("depth has to be an integer: "+p+", weights.length: "+d.length+", numFilters: "+c+", filterSize: "+f);return xe(function(){return Co(dn(d,[c,p,f,f]),[2,3,1,0])})}function r(u,c,f,d){var p=e(u,c,f),v=Ct(n(c));return t.push({paramPath:d+"/filters"},{paramPath:d+"/bias"}),{filters:p,bias:v}}function o(u,c){var f=Ct(n(u)),d=Ct(n(u));return t.push({paramPath:c+"/weights"},{paramPath:c+"/biases"}),{weights:f,biases:d}}function i(u,c,f,d){var p=r(u,c,f,d+"/conv"),v=o(c,d+"/scale");return{conv:p,scale:v}}function s(u,c,f,d,p){p===void 0&&(p=!1);var v=i((p?.5:1)*u,c,f,d+"/conv1"),g=i(u,c,f,d+"/conv2");return{conv1:v,conv2:g}}return{extractConvLayerParams:i,extractResidualLayerParams:s}}function m3(n){var t=Kr(n),e=t.extractWeights,r=t.getRemainingWeights,o=[],i=v3(e,o),s=i.extractConvLayerParams,u=i.extractResidualLayerParams,c=s(4704,32,7,"conv32_down"),f=u(9216,32,3,"conv32_1"),d=u(9216,32,3,"conv32_2"),p=u(9216,32,3,"conv32_3"),v=u(36864,64,3,"conv64_down",!0),g=u(36864,64,3,"conv64_1"),y=u(36864,64,3,"conv64_2"),b=u(36864,64,3,"conv64_3"),w=u(147456,128,3,"conv128_down",!0),C=u(147456,128,3,"conv128_1"),_=u(147456,128,3,"conv128_2"),S=u(589824,256,3,"conv256_down",!0),k=u(589824,256,3,"conv256_1"),R=u(589824,256,3,"conv256_2"),N=u(589824,256,3,"conv256_down_out"),P=xe(function(){return Co(xo(e(256*128),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var F={conv32_down:c,conv32_1:f,conv32_2:d,conv32_3:p,conv64_down:v,conv64_1:g,conv64_2:y,conv64_3:b,conv128_down:w,conv128_1:C,conv128_2:_,conv256_down:S,conv256_1:k,conv256_2:R,conv256_down_out:N,fc:P};return{params:F,paramMappings:o}}function g3(n,t){var e=ko(n,t);function r(s){var u=e(s+"/scale/weights",1),c=e(s+"/scale/biases",1);return{weights:u,biases:c}}function o(s){var u=e(s+"/conv/filters",4),c=e(s+"/conv/bias",1),f=r(s);return{conv:{filters:u,bias:c},scale:f}}function i(s){return{conv1:o(s+"/conv1"),conv2:o(s+"/conv2")}}return{extractConvLayerParams:o,extractResidualLayerParams:i}}function y3(n){var t=[],e=g3(n,t),r=e.extractConvLayerParams,o=e.extractResidualLayerParams,i=r("conv32_down"),s=o("conv32_1"),u=o("conv32_2"),c=o("conv32_3"),f=o("conv64_down"),d=o("conv64_1"),p=o("conv64_2"),v=o("conv64_3"),g=o("conv128_down"),y=o("conv128_1"),b=o("conv128_2"),w=o("conv256_down"),C=o("conv256_1"),_=o("conv256_2"),S=o("conv256_down_out"),k=n.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!kR(k))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+k);var R={conv32_down:i,conv32_1:s,conv32_2:u,conv32_3:c,conv64_down:f,conv64_1:d,conv64_2:p,conv64_3:v,conv128_down:g,conv128_1:y,conv128_2:b,conv256_down:w,conv256_1:C,conv256_2:_,conv256_down_out:S,fc:k};return qr(n,t),{params:R,paramMappings:t}}function fr(n,t){var e=p3(n,t.conv1);return e=O1(e,t.conv2),e=je(e,n),e=dt(e),e}function Gu(n,t){var e=M1(n,t.conv1);e=O1(e,t.conv2);var r=vs(n,2,2,"valid"),o=st(r.shape),i=r.shape[3]!==e.shape[3],s=r.shape[1]!==e.shape[1]||r.shape[2]!==e.shape[2];if(s){var u=Za(e.shape);u[1]=1;var c=st(u);e=kt([e,c],1);var f=Za(e.shape);f[2]=1;var d=st(f);e=kt([e,d],2)}return r=i?kt([r,o],3):r,e=je(r,e),e=dt(e),e}var x3=function(n){Le(t,n);function t(){return n.call(this,"FaceRecognitionNet")||this}return t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return xe(function(){var o=e.toBatchTensor(150,!0).toFloat(),i=[122.782,117.001,104.298],s=gs(o,i).div(ve(256)),u=M1(s,r.conv32_down);u=Ft(u,3,2,"valid"),u=fr(u,r.conv32_1),u=fr(u,r.conv32_2),u=fr(u,r.conv32_3),u=Gu(u,r.conv64_down),u=fr(u,r.conv64_1),u=fr(u,r.conv64_2),u=fr(u,r.conv64_3),u=Gu(u,r.conv128_down),u=fr(u,r.conv128_1),u=fr(u,r.conv128_2),u=Gu(u,r.conv256_down),u=fr(u,r.conv256_1),u=fr(u,r.conv256_2),u=Gu(u,r.conv256_down_out);var c=u.mean([1,2]),f=Ol(c,r.fc);return f})},t.prototype.forward=function(e){return Te(this,void 0,void 0,function(){var r;return De(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return Te(this,void 0,void 0,function(){var r,o,i,s=this;return De(this,function(u){switch(u.label){case 0:return[4,Mt(e)];case 1:return r=u.sent(),o=xe(function(){return Rt(s.forwardInput(r))}),[4,Promise.all(o.map(function(c){return c.data()}))];case 2:return i=u.sent(),o.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return y3(e)},t.prototype.extractParams=function(e){return m3(e)},t}(Gr);function L1(n,t){var e={descriptor:t};return Object.assign({},n,e)}function B1(n,t){var e={age:t};return Object.assign({},n,e)}function W1(n,t,e){var r={gender:t,genderProbability:e};return Object.assign({},n,r)}var z1=function(){function n(t){var e=t===void 0?{}:t,r=e.minFaceSize,o=e.scaleFactor,i=e.maxNumScales,s=e.scoreThresholds,u=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=s||[.6,.7,.7],this._scaleSteps=u,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(c){return typeof c!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(c){return typeof c!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function w3(n,t){function e(c,f){var d=dn(n(9*c),[3,3,c,1]),p=Ct(n(c)),v=Ct(n(c)),g=Ct(n(c)),y=Ct(n(c));return t.push({paramPath:f+"/filters"},{paramPath:f+"/batch_norm_scale"},{paramPath:f+"/batch_norm_offset"},{paramPath:f+"/batch_norm_mean"},{paramPath:f+"/batch_norm_variance"}),{filters:d,batch_norm_scale:p,batch_norm_offset:v,batch_norm_mean:g,batch_norm_variance:y}}function r(c,f,d,p,v){var g=dn(n(c*f*d*d),[d,d,c,f]),y=Ct(n(f));return t.push({paramPath:p+"/filters"},{paramPath:p+"/"+(v?"batch_norm_offset":"bias")}),{filters:g,bias:y}}function o(c,f,d,p){var v=r(c,f,d,p,!0),g=v.filters,y=v.bias;return{filters:g,batch_norm_offset:y}}function i(c,f,d){var p=e(c,d+"/depthwise_conv"),v=o(c,f,1,d+"/pointwise_conv");return{depthwise_conv:p,pointwise_conv:v}}function s(){var c=o(3,32,3,"mobilenetv1/conv_0"),f=i(32,64,"mobilenetv1/conv_1"),d=i(64,128,"mobilenetv1/conv_2"),p=i(128,128,"mobilenetv1/conv_3"),v=i(128,256,"mobilenetv1/conv_4"),g=i(256,256,"mobilenetv1/conv_5"),y=i(256,512,"mobilenetv1/conv_6"),b=i(512,512,"mobilenetv1/conv_7"),w=i(512,512,"mobilenetv1/conv_8"),C=i(512,512,"mobilenetv1/conv_9"),_=i(512,512,"mobilenetv1/conv_10"),S=i(512,512,"mobilenetv1/conv_11"),k=i(512,1024,"mobilenetv1/conv_12"),R=i(1024,1024,"mobilenetv1/conv_13");return{conv_0:c,conv_1:f,conv_2:d,conv_3:p,conv_4:v,conv_5:g,conv_6:y,conv_7:b,conv_8:w,conv_9:C,conv_10:_,conv_11:S,conv_12:k,conv_13:R}}function u(){var c=o(1024,256,1,"prediction_layer/conv_0"),f=o(256,512,3,"prediction_layer/conv_1"),d=o(512,128,1,"prediction_layer/conv_2"),p=o(128,256,3,"prediction_layer/conv_3"),v=o(256,128,1,"prediction_layer/conv_4"),g=o(128,256,3,"prediction_layer/conv_5"),y=o(256,64,1,"prediction_layer/conv_6"),b=o(64,128,3,"prediction_layer/conv_7"),w=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),C=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),_=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),S=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),k=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),R=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),N=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),P=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),F=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),D=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),A=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),V=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),U={box_encoding_predictor:w,class_predictor:C},re={box_encoding_predictor:_,class_predictor:S},te={box_encoding_predictor:k,class_predictor:R},ee={box_encoding_predictor:N,class_predictor:P},G={box_encoding_predictor:F,class_predictor:D},q={box_encoding_predictor:A,class_predictor:V};return{conv_0:c,conv_1:f,conv_2:d,conv_3:p,conv_4:v,conv_5:g,conv_6:y,conv_7:b,box_predictor_0:U,box_predictor_1:re,box_predictor_2:te,box_predictor_3:ee,box_predictor_4:G,box_predictor_5:q}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:u}}function b3(n){var t=[],e=Kr(n),r=e.extractWeights,o=e.getRemainingWeights,i=w3(r,t),s=i.extractMobilenetV1Params,u=i.extractPredictionLayerParams,c=s(),f=u(),d=uh(r(5118*4),[1,5118,4]),p={extra_dim:d};if(t.push({paramPath:"output_layer/extra_dim"}),o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:c,prediction_layer:f,output_layer:p},paramMappings:t}}function C3(n,t){var e=ko(n,t);function r(f,d,p){var v=e(f+"/Conv2d_"+d+"_pointwise/weights",4,p+"/filters"),g=e(f+"/Conv2d_"+d+"_pointwise/convolution_bn_offset",1,p+"/batch_norm_offset");return{filters:v,batch_norm_offset:g}}function o(f){var d="mobilenetv1/conv_"+f,p="MobilenetV1/Conv2d_"+f+"_depthwise",v=d+"/depthwise_conv",g=d+"/pointwise_conv",y=e(p+"/depthwise_weights",4,v+"/filters"),b=e(p+"/BatchNorm/gamma",1,v+"/batch_norm_scale"),w=e(p+"/BatchNorm/beta",1,v+"/batch_norm_offset"),C=e(p+"/BatchNorm/moving_mean",1,v+"/batch_norm_mean"),_=e(p+"/BatchNorm/moving_variance",1,v+"/batch_norm_variance");return{depthwise_conv:{filters:y,batch_norm_scale:b,batch_norm_offset:w,batch_norm_mean:C,batch_norm_variance:_},pointwise_conv:r("MobilenetV1",f,g)}}function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}}function s(f,d){var p=e(f+"/weights",4,d+"/filters"),v=e(f+"/biases",1,d+"/bias");return{filters:p,bias:v}}function u(f){var d=s("Prediction/BoxPredictor_"+f+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+f+"/box_encoding_predictor"),p=s("Prediction/BoxPredictor_"+f+"/ClassPredictor","prediction_layer/box_predictor_"+f+"/class_predictor");return{box_encoding_predictor:d,class_predictor:p}}function c(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:u(0),box_predictor_1:u(1),box_predictor_2:u(2),box_predictor_3:u(3),box_predictor_4:u(4),box_predictor_5:u(5)}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:c}}function E3(n){var t=[],e=C3(n,t),r=e.extractMobilenetV1Params,o=e.extractPredictionLayerParams,i=n["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Wl(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var s={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return qr(n,t),{params:s,paramMappings:t}}function hr(n,t,e){return xe(function(){var r=Hn(n,t.filters,e,"same");return r=je(r,t.batch_norm_offset),xh(r,0,6)})}var _3=.0010000000474974513;function S3(n,t,e){return xe(function(){var r=Fl(n,t.filters,e,"same");return r=F0(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,_3),xh(r,0,6)})}function k3(n){return[2,4,6,12].some(function(t){return t===n})?[2,2]:[1,1]}function R3(n,t){return xe(function(){var e=null,r=hr(n,t.conv_0,[2,2]),o=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(o.forEach(function(i,s){var u=s+1,c=k3(u);r=S3(r,i.depthwise_conv,c),r=hr(r,i.pointwise_conv,[1,1]),u===11&&(e=r)}),e===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:e}})}function I3(n,t,e,r,o){var i=n.shape[0],s=Math.min(e,i),u=t.map(function(d,p){return{score:d,boxIndex:p}}).filter(function(d){return d.score>o}).sort(function(d,p){return p.score-d.score}),c=function(d){return d<=r?1:0},f=[];return u.forEach(function(d){if(!(f.length>=s)){for(var p=d.score,v=f.length-1;v>=0;--v){var g=N3(n,d.boxIndex,f[v]);if(g!==0&&(d.score*=c(g),d.score<=o))break}p===d.score&&f.push(d.boxIndex)}}),f}function N3(n,t,e){var r=n.arraySync(),o=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),s=Math.max(r[t][0],r[t][2]),u=Math.max(r[t][1],r[t][3]),c=Math.min(r[e][0],r[e][2]),f=Math.min(r[e][1],r[e][3]),d=Math.max(r[e][0],r[e][2]),p=Math.max(r[e][1],r[e][3]),v=(s-o)*(u-i),g=(d-c)*(p-f);if(v<=0||g<=0)return 0;var y=Math.max(o,c),b=Math.max(i,f),w=Math.min(s,d),C=Math.min(u,p),_=Math.max(w-y,0)*Math.max(C-b,0);return _/(v+g-_)}function T3(n){var t=Rt(Co(n,[1,0])),e=[Nt(t[2],t[0]),Nt(t[3],t[1])],r=[je(t[0],Zn(e[0],ve(2))),je(t[1],Zn(e[1],ve(2)))];return{sizes:e,centers:r}}function D3(n,t){var e=T3(n),r=e.sizes,o=e.centers,i=Rt(Co(t,[1,0])),s=Zn(Zt(zd(Zn(i[2],ve(5))),r[0]),ve(2)),u=je(Zt(Zn(i[0],ve(10)),r[0]),o[0]),c=Zn(Zt(zd(Zn(i[3],ve(5))),r[1]),ve(2)),f=je(Zt(Zn(i[1],ve(10)),r[1]),o[1]);return Co(Tn([Nt(u,s),Nt(f,c),je(u,s),je(f,c)]),[1,0])}function A3(n,t,e){return xe(function(){var r=n.shape[0],o=D3(er(Hi(e.extra_dim,[r,1,1]),[-1,4]),er(n,[-1,4]));o=er(o,[r,o.shape[0]/r,4]);var i=T0(br(t,[0,0,1],[-1,-1,-1])),s=br(i,[0,0,0],[-1,-1,1]);s=er(s,[r,s.shape[1]]);var u=Rt(o),c=Rt(s);return{boxes:u,scores:c}})}function Bi(n,t){return xe(function(){var e=n.shape[0],r=er(tr(n,t.box_encoding_predictor),[e,-1,1,4]),o=er(tr(n,t.class_predictor),[e,-1,3]);return{boxPredictionEncoding:r,classPrediction:o}})}function P3(n,t,e){return xe(function(){var r=hr(n,e.conv_0,[1,1]),o=hr(r,e.conv_1,[2,2]),i=hr(o,e.conv_2,[1,1]),s=hr(i,e.conv_3,[2,2]),u=hr(s,e.conv_4,[1,1]),c=hr(u,e.conv_5,[2,2]),f=hr(c,e.conv_6,[1,1]),d=hr(f,e.conv_7,[2,2]),p=Bi(t,e.box_predictor_0),v=Bi(n,e.box_predictor_1),g=Bi(o,e.box_predictor_2),y=Bi(s,e.box_predictor_3),b=Bi(c,e.box_predictor_4),w=Bi(d,e.box_predictor_5),C=kt([p.boxPredictionEncoding,v.boxPredictionEncoding,g.boxPredictionEncoding,y.boxPredictionEncoding,b.boxPredictionEncoding,w.boxPredictionEncoding],1),_=kt([p.classPrediction,v.classPrediction,g.classPrediction,y.classPrediction,b.classPrediction,w.classPrediction],1);return{boxPredictions:C,classPredictions:_}})}var jl=function(){function n(t){var e=t===void 0?{}:t,r=e.minConfidence,o=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),U1=function(n){Le(t,n);function t(){return n.call(this,"SsdMobilenetv1")||this}return t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return xe(function(){var o=e.toBatchTensor(512,!1).toFloat(),i=Nt(Zt(o,ve(.007843137718737125)),ve(1)),s=R3(i,r.mobilenetv1),u=P3(s.out,s.conv11,r.prediction_layer),c=u.boxPredictions,f=u.classPredictions;return A3(c,f,r.output_layer)})},t.prototype.forward=function(e){return Te(this,void 0,void 0,function(){var r;return De(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.locateFaces=function(e,r){return r===void 0&&(r={}),Te(this,void 0,void 0,function(){var o,i,s,u,c,f,d,p,v,g,y,b,w,C,_,S,k,R,N,P,F;return De(this,function(D){switch(D.label){case 0:return o=new jl(r),i=o.maxResults,s=o.minConfidence,[4,Mt(e)];case 1:for(u=D.sent(),c=this.forwardInput(u),f=c.boxes,d=c.scores,p=f[0],v=d[0],g=1;g<f.length;g++)f[g].dispose(),d[g].dispose();return w=(b=Array).from,[4,v.data()];case 2:return y=w.apply(b,[D.sent()]),C=.5,_=I3(p,y,i,C,s),S=u.getReshapedInputDimensions(0),k=u.inputSize,R=k/S.width,N=k/S.height,P=p.arraySync(),F=_.map(function(A){var V=[Math.max(0,P[A][0]),Math.min(1,P[A][2])].map(function(q){return q*N}),U=V[0],re=V[1],te=[Math.max(0,P[A][1]),Math.min(1,P[A][3])].map(function(q){return q*R}),ee=te[0],G=te[1];return new kr(y[A],new Mh(ee,U,G-ee,re-U),{height:u.getInputHeight(0),width:u.getInputWidth(0)})}),p.dispose(),v.dispose(),[2,F]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return E3(e)},t.prototype.extractParams=function(e){return b3(e)},t}(Gr);(function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t})(U1);var F3=.4,O3=[new Qe(.738768,.874946),new Qe(2.42204,2.65704),new Qe(4.30971,7.04493),new Qe(10.246,4.59428),new Qe(12.6868,11.8741)],M3=[new Qe(1.603231,2.094468),new Qe(6.041143,7.080126),new Qe(2.882459,3.518061),new Qe(4.266906,5.178857),new Qe(9.041765,10.66308)],L3=[117.001,114.697,97.404],B3="tiny_yolov2_model",W3="tiny_yolov2_separable_conv_model",qu=function(n){return typeof n=="number"};function z3(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!qu(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(t){return typeof t=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(t){return t||{}}).every(function(t){return qu(t.x)&&qu(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(qu)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function Kh(n){return xe(function(){var t=Zt(n,ve(.10000000149011612));return je(dt(Nt(n,t)),t)})}function vo(n,t){return xe(function(){var e=ni(n,[[0,0],[1,1],[1,1],[0,0]]);return e=Hn(e,t.conv.filters,[1,1],"valid"),e=Nt(e,t.bn.sub),e=Zt(e,t.bn.truediv),e=je(e,t.conv.bias),Kh(e)})}function mo(n,t){return xe(function(){var e=ni(n,[[0,0],[1,1],[1,1],[0,0]]);return e=Eh(e,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),e=je(e,t.bias),Kh(e)})}function U3(n,t){var e=Vl(n,t);function r(s,u){var c=Ct(n(s)),f=Ct(n(s));return t.push({paramPath:u+"/sub"},{paramPath:u+"/truediv"}),{sub:c,truediv:f}}function o(s,u,c){var f=e(s,u,3,c+"/conv"),d=r(u,c+"/bn");return{conv:f,bn:d}}var i=jh(n,t);return{extractConvParams:e,extractConvWithBatchNormParams:o,extractSeparableConvParams:i}}function V3(n,t,e,r){var o=Kr(n),i=o.extractWeights,s=o.getRemainingWeights,u=[],c=U3(i,u),f=c.extractConvParams,d=c.extractConvWithBatchNormParams,p=c.extractSeparableConvParams,v;if(t.withSeparableConvs){var g=r[0],y=r[1],b=r[2],w=r[3],C=r[4],_=r[5],S=r[6],k=r[7],R=r[8],N=t.isFirstLayerConv2d?f(g,y,3,"conv0"):p(g,y,"conv0"),P=p(y,b,"conv1"),F=p(b,w,"conv2"),D=p(w,C,"conv3"),A=p(C,_,"conv4"),V=p(_,S,"conv5"),U=k?p(S,k,"conv6"):void 0,re=R?p(k,R,"conv7"):void 0,te=f(R||k||S,5*e,1,"conv8");v={conv0:N,conv1:P,conv2:F,conv3:D,conv4:A,conv5:V,conv6:U,conv7:re,conv8:te}}else{var g=r[0],y=r[1],b=r[2],w=r[3],C=r[4],_=r[5],S=r[6],k=r[7],R=r[8],N=d(g,y,"conv0"),P=d(y,b,"conv1"),F=d(b,w,"conv2"),D=d(w,C,"conv3"),A=d(C,_,"conv4"),V=d(_,S,"conv5"),U=d(S,k,"conv6"),re=d(k,R,"conv7"),te=f(R,5*e,1,"conv8");v={conv0:N,conv1:P,conv2:F,conv3:D,conv4:A,conv5:V,conv6:U,conv7:re,conv8:te}}if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{params:v,paramMappings:u}}function j3(n,t){var e=ko(n,t);function r(u){var c=e(u+"/sub",1),f=e(u+"/truediv",1);return{sub:c,truediv:f}}function o(u){var c=e(u+"/filters",4),f=e(u+"/bias",1);return{filters:c,bias:f}}function i(u){var c=o(u+"/conv"),f=r(u+"/bn");return{conv:c,bn:f}}var s=Hh(e);return{extractConvParams:o,extractConvWithBatchNormParams:i,extractSeparableConvParams:s}}function H3(n,t){var e=[],r=j3(n,e),o=r.extractConvParams,i=r.extractConvWithBatchNormParams,s=r.extractSeparableConvParams,u;if(t.withSeparableConvs){var c=t.filterSizes&&t.filterSizes.length||9;u={conv0:t.isFirstLayerConv2d?o("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:c>7?s("conv6"):void 0,conv7:c>8?s("conv7"):void 0,conv8:o("conv8")}}else u={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return qr(n,e),{params:u,paramMappings:e}}var ly;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(ly||(ly={}));var $h=function(){function n(t){var e=t===void 0?{}:t,r=e.inputSize,o=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),V1=function(n){Le(t,n);function t(e){var r=n.call(this,"TinyYolov2")||this;return z3(e),r._config=e,r}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,r){var o=vo(e,r.conv0);return o=Ft(o,[2,2],[2,2],"same"),o=vo(o,r.conv1),o=Ft(o,[2,2],[2,2],"same"),o=vo(o,r.conv2),o=Ft(o,[2,2],[2,2],"same"),o=vo(o,r.conv3),o=Ft(o,[2,2],[2,2],"same"),o=vo(o,r.conv4),o=Ft(o,[2,2],[2,2],"same"),o=vo(o,r.conv5),o=Ft(o,[2,2],[1,1],"same"),o=vo(o,r.conv6),o=vo(o,r.conv7),tr(o,r.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,r){var o=this.config.isFirstLayerConv2d?Kh(tr(e,r.conv0,"valid",!1)):mo(e,r.conv0);return o=Ft(o,[2,2],[2,2],"same"),o=mo(o,r.conv1),o=Ft(o,[2,2],[2,2],"same"),o=mo(o,r.conv2),o=Ft(o,[2,2],[2,2],"same"),o=mo(o,r.conv3),o=Ft(o,[2,2],[2,2],"same"),o=mo(o,r.conv4),o=Ft(o,[2,2],[2,2],"same"),o=mo(o,r.conv5),o=Ft(o,[2,2],[1,1],"same"),o=r.conv6?mo(o,r.conv6):o,o=r.conv7?mo(o,r.conv7):o,tr(o,r.conv8,"valid",!1)},t.prototype.forwardInput=function(e,r){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return xe(function(){var s=e.toBatchTensor(r,!1).toFloat();return s=o.config.meanRgb?gs(s,o.config.meanRgb):s,s=s.div(ve(256)),o.config.withSeparableConvs?o.runMobilenet(s,i):o.runTinyYolov2(s,i)})},t.prototype.forward=function(e,r){return Te(this,void 0,void 0,function(){var o;return De(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,Mt(e)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},t.prototype.detect=function(e,r){return r===void 0&&(r={}),Te(this,void 0,void 0,function(){var o,i,s,u,c,f,d,p,v,g,y,b,w,C,_=this;return De(this,function(S){switch(S.label){case 0:return o=new $h(r),i=o.inputSize,s=o.scoreThreshold,[4,Mt(e)];case 1:return u=S.sent(),[4,this.forwardInput(u,i)];case 2:return c=S.sent(),f=xe(function(){return Rt(c)[0].expandDims()}),d={width:u.getInputWidth(0),height:u.getInputHeight(0)},[4,this.extractBoxes(f,u.getReshapedInputDimensions(0),s)];case 3:return p=S.sent(),c.dispose(),f.dispose(),v=p.map(function(k){return k.box}),g=p.map(function(k){return k.score}),y=p.map(function(k){return k.classScore}),b=p.map(function(k){return _.config.classes[k.label]}),w=as(v.map(function(k){return k.rescale(i)}),g,this.config.iouThreshold,!0),C=w.map(function(k){return new p1(g[k],y[k],b[k],v[k],d)}),[2,C]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return H3(e,this.config)},t.prototype.extractParams=function(e){var r=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(o!==7&&o!==8&&o!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return V3(e,this.config,this.boxEncodingSize,r)},t.prototype.extractBoxes=function(e,r,o){return Te(this,void 0,void 0,function(){var i,s,u,c,f,d,p,v,g,y,b,w,C,_,S,k,R,N,P,F,D,A,V,U,re,te,ee,G,q,W=this;return De(this,function(Y){switch(Y.label){case 0:return i=r.width,s=r.height,u=Math.max(i,s),c=u/i,f=u/s,d=e.shape[1],p=this.config.anchors.length,v=xe(function(){var K=e.reshape([d,d,p,W.boxEncodingSize]),L=K.slice([0,0,0,0],[d,d,p,4]),X=K.slice([0,0,0,4],[d,d,p,1]),de=W.withClassScores?jr(K.slice([0,0,0,5],[d,d,p,W.config.classes.length]),3):ve(0);return[L,X,de]}),g=v[0],y=v[1],b=v[2],w=[],[4,y.array()];case 1:return C=Y.sent(),[4,g.array()];case 2:_=Y.sent(),S=0,Y.label=3;case 3:if(!(S<d))return[3,12];k=0,Y.label=4;case 4:if(!(k<d))return[3,11];R=0,Y.label=5;case 5:return R<p?(N=yd(C[S][k][R][0]),!o||N>o?(P=(k+yd(_[S][k][R][0]))/d*c,F=(S+yd(_[S][k][R][1]))/d*f,D=Math.exp(_[S][k][R][2])*this.config.anchors[R].x/d*c,A=Math.exp(_[S][k][R][3])*this.config.anchors[R].y/d*f,V=P-D/2,U=F-A/2,re={row:S,col:k,anchor:R},this.withClassScores?[4,this.extractPredictedClass(b,re)]:[3,7]):[3,9]):[3,10];case 6:return q=Y.sent(),[3,8];case 7:q={classScore:1,label:0},Y.label=8;case 8:te=q,ee=te.classScore,G=te.label,w.push(Xt({box:new zl(V,U,V+D,U+A),score:N,classScore:N*ee,label:G},re)),Y.label=9;case 9:return R++,[3,5];case 10:return k++,[3,4];case 11:return S++,[3,3];case 12:return g.dispose(),y.dispose(),b.dispose(),[2,w]}})})},t.prototype.extractPredictedClass=function(e,r){return Te(this,void 0,void 0,function(){var o,i,s,u;return De(this,function(c){switch(c.label){case 0:return o=r.row,i=r.col,s=r.anchor,[4,e.array()];case 1:return u=c.sent(),[2,Array(this.config.classes.length).fill(0).map(function(f,d){return u[o][i][s][d]}).map(function(f,d){return{classScore:f,label:d}}).reduce(function(f,d){return f.classScore>d.classScore?f:d})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(Gr),G3=function(n){Le(t,n);function t(e){e===void 0&&(e=!0);var r=this,o=Object.assign({},{withSeparableConvs:e,iouThreshold:F3,classes:["face"]},e?{anchors:M3,meanRgb:L3}:{anchors:O3,withClassScores:!0});return r=n.call(this,o)||this,r}return Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,r){return Te(this,void 0,void 0,function(){var o;return De(this,function(i){switch(i.label){case 0:return[4,this.detect(e,r)];case 1:return o=i.sent(),[2,o.map(function(s){return new kr(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?W3:B3},t.prototype.extractParamsFromWeigthMap=function(e){return n.prototype.extractParamsFromWeigthMap.call(this,e)},t}(V1),j1=function(n){Le(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return t}($h),ys=function(){function n(){}return n.prototype.then=function(t){return Te(this,void 0,void 0,function(){var e;return De(this,function(r){switch(r.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return Te(this,void 0,void 0,function(){return De(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},n}();function Hl(n,t,e,r,o){return o===void 0&&(o=function(i){var s=i.alignedRect;return s}),Te(this,void 0,void 0,function(){var i,s,u,c,f;return De(this,function(d){switch(d.label){case 0:return i=n.map(function(p){return ZR(p)?o(p):p.detection}),u=r,u?[3,5]:t instanceof ft?[4,Uh(t,i)]:[3,2];case 1:return c=d.sent(),[3,4];case 2:return[4,zh(t,i)];case 3:c=d.sent(),d.label=4;case 4:u=c,d.label=5;case 5:return s=u,[4,e(s)];case 6:return f=d.sent(),s.forEach(function(p){return p instanceof ft&&p.dispose()}),[2,f]}})})}function Xh(n,t,e,r,o){return Te(this,void 0,void 0,function(){var i=this;return De(this,function(s){return[2,Hl([n],t,function(u){return Te(i,void 0,void 0,function(){return De(this,function(c){return[2,e(u[0])]})})},r,o)]})})}function q3(n){return xe(function(){return Tn(Rt(n,3).reverse(),3)})}var Ku=2,El=12;function K3(n,t){var e=Vl(n,t),r=Vh(n,t);function o(f,d){var p=Ct(n(f));return t.push({paramPath:d}),p}function i(f,d,p){p===void 0&&(p=!1);var v=e(f[0],f[1],3,d+"/conv1"),g=o(f[1],d+"/prelu1_alpha"),y=e(f[1],f[2],3,d+"/conv2"),b=o(f[2],d+"/prelu2_alpha"),w=e(f[2],f[3],p?2:3,d+"/conv3"),C=o(f[3],d+"/prelu3_alpha");return{conv1:v,prelu1_alpha:g,conv2:y,prelu2_alpha:b,conv3:w,prelu3_alpha:C}}function s(){var f=i([3,10,16,32],"pnet"),d=e(32,2,1,"pnet/conv4_1"),p=e(32,4,1,"pnet/conv4_2");return Xt(Xt({},f),{conv4_1:d,conv4_2:p})}function u(){var f=i([3,28,48,64],"rnet",!0),d=r(576,128,"rnet/fc1"),p=o(128,"rnet/prelu4_alpha"),v=r(128,2,"rnet/fc2_1"),g=r(128,4,"rnet/fc2_2");return Xt(Xt({},f),{fc1:d,prelu4_alpha:p,fc2_1:v,fc2_2:g})}function c(){var f=i([3,32,64,64],"onet"),d=e(64,128,2,"onet/conv4"),p=o(128,"onet/prelu4_alpha"),v=r(1152,256,"onet/fc1"),g=o(256,"onet/prelu5_alpha"),y=r(256,2,"onet/fc2_1"),b=r(256,4,"onet/fc2_2"),w=r(256,10,"onet/fc2_3");return Xt(Xt({},f),{conv4:d,prelu4_alpha:p,fc1:v,prelu5_alpha:g,fc2_1:y,fc2_2:b,fc2_3:w})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:c}}function $3(n){var t=Kr(n),e=t.extractWeights,r=t.getRemainingWeights,o=[],i=K3(e,o),s=i.extractPNetParams,u=i.extractRNetParams,c=i.extractONetParams,f=s(),d=u(),p=c();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:f,rnet:d,onet:p},paramMappings:o}}function X3(n,t){var e=ko(n,t);function r(d){var p=e(d+"/weights",4,d+"/filters"),v=e(d+"/bias",1);return{filters:p,bias:v}}function o(d){var p=e(d+"/weights",2),v=e(d+"/bias",1);return{weights:p,bias:v}}function i(d){return e(d,1)}function s(d){var p=r(d+"/conv1"),v=i(d+"/prelu1_alpha"),g=r(d+"/conv2"),y=i(d+"/prelu2_alpha"),b=r(d+"/conv3"),w=i(d+"/prelu3_alpha");return{conv1:p,prelu1_alpha:v,conv2:g,prelu2_alpha:y,conv3:b,prelu3_alpha:w}}function u(){var d=s("pnet"),p=r("pnet/conv4_1"),v=r("pnet/conv4_2");return Xt(Xt({},d),{conv4_1:p,conv4_2:v})}function c(){var d=s("rnet"),p=o("rnet/fc1"),v=i("rnet/prelu4_alpha"),g=o("rnet/fc2_1"),y=o("rnet/fc2_2");return Xt(Xt({},d),{fc1:p,prelu4_alpha:v,fc2_1:g,fc2_2:y})}function f(){var d=s("onet"),p=r("onet/conv4"),v=i("onet/prelu4_alpha"),g=o("onet/fc1"),y=i("onet/prelu5_alpha"),b=o("onet/fc2_1"),w=o("onet/fc2_2"),C=o("onet/fc2_3");return Xt(Xt({},d),{conv4:p,prelu4_alpha:v,fc1:g,prelu5_alpha:y,fc2_1:b,fc2_2:w,fc2_3:C})}return{extractPNetParams:u,extractRNetParams:c,extractONetParams:f}}function Y3(n){var t=[],e=X3(n,t),r=e.extractPNetParams,o=e.extractRNetParams,i=e.extractONetParams,s=r(),u=o(),c=i();return qr(n,t),{params:{pnet:s,rnet:u,onet:c},paramMappings:t}}function $d(n,t){var e=t[0],r=t[1];return{height:Math.floor(e*n),width:Math.floor(r*n)}}function Q3(n,t,e){for(var r=e[0],o=e[1],i=El/n,s=[],u=Math.min(r,o)*i,c=0;u>=12;)s.push(i*Math.pow(t,c)),u=u*t,c+=1;return s}var Yh=function(n){Le(t,n);function t(e,r,o,i){return n.call(this,{left:e,top:r,right:o,bottom:i},!0)||this}return t}(Eo);function H1(n){return xe(function(){return Zt(Nt(n,ve(127.5)),ve(.0078125))})}function Yi(n,t){return xe(function(){return je(dt(n),Zt(t,ml(dt(ml(n)))))})}function Qh(n,t,e){return e===void 0&&(e=!1),xe(function(){var r=tr(n,t.conv1,"valid");return r=Yi(r,t.prelu1_alpha),r=Ft(r,e?[2,2]:[3,3],[2,2],"same"),r=tr(r,t.conv2,"valid"),r=Yi(r,t.prelu2_alpha),r=e?r:Ft(r,[3,3],[2,2],"valid"),r=tr(r,t.conv3,"valid"),r=Yi(r,t.prelu3_alpha),r})}function J3(n,t){return xe(function(){var e=Qh(n,t,!0),r=tr(e,t.conv4_1,"valid"),o=Un(Ml(r,3),3),i=jr(Nt(r,o),3),s=tr(e,t.conv4_2,"valid");return{prob:i,regions:s}})}function Z3(n,t){return xe(function(){var e=$d(t,n.shape.slice(1)),r=e.height,o=e.width,i=Ih.resizeBilinear(n,[r,o]),s=H1(i);return Co(s,[0,2,1,3])})}function eI(n,t,e,r){for(var o=[],i=n.arraySync(),s=0;s<n.shape[0];s++)for(var u=0;u<n.shape[1];u++)i[s][u]>=r&&o.push(new Qe(u,s));var c=o.map(function(f){var d=new zl(Math.round((f.y*Ku+1)/e),Math.round((f.x*Ku+1)/e),Math.round((f.y*Ku+El)/e),Math.round((f.x*Ku+El)/e)),p=i[f.y][f.x],v=t.arraySync(),g=new Yh(v[f.y][f.x][0],v[f.y][f.x][1],v[f.y][f.x][2],v[f.y][f.x][3]);return{cell:d,score:p,region:g}});return c}function tI(n,t,e,r,o){o.stage1=[];var i=t.map(function(v){return xe(function(){var g={scale:v},y=Z3(n,v),b=Date.now(),w=J3(y,r),C=w.prob,_=w.regions;g.pnet=Date.now()-b;var S=Rt(Rt(C,3)[1])[0],k=Rt(_)[0];return{scoresTensor:S,regionsTensor:k,scale:v,statsForScale:g}})}),s=i.map(function(v){var g=v.scoresTensor,y=v.regionsTensor,b=v.scale,w=v.statsForScale,C=eI(g,y,b,e);if(g.dispose(),y.dispose(),!C.length)return o.stage1.push(w),[];var _=Date.now(),S=as(C.map(function(k){return k.cell}),C.map(function(k){return k.score}),.5);return w.nms=Date.now()-_,w.numBoxes=S.length,o.stage1.push(w),S.map(function(k){return C[k]})}),u=s.reduce(function(v,g){return v.concat(g)},[]),c=[],f=[];if(u.length>0){var d=Date.now(),p=as(u.map(function(v){return v.cell}),u.map(function(v){return v.score}),.7);o.stage1_nms=Date.now()-d,f=p.map(function(v){return u[v].score}),c=p.map(function(v){return u[v]}).map(function(v){var g=v.cell,y=v.region;return new zl(g.left+y.left*g.width,g.top+y.top*g.height,g.right+y.right*g.width,g.bottom+y.bottom*g.height).toSquare().round()})}return{boxes:c,scores:f}}function G1(n,t,e){var r=e.width,o=e.height;return Te(this,void 0,void 0,function(){var i,s,u,c=this;return De(this,function(f){switch(f.label){case 0:return i=Zo(n),[4,Promise.all(t.map(function(d){return Te(c,void 0,void 0,function(){var p,v,g,y,b,w,C,_;return De(this,function(S){return p=d.padAtBorders(n.height,n.width),v=p.y,g=p.ey,y=p.x,b=p.ex,w=y-1,C=v-1,_=i.getImageData(w,C,b-w,g-C),[2,en.isNodejs()?Wh(_):createImageBitmap(_)]})})}))];case 1:return s=f.sent(),u=[],s.forEach(function(d){var p=Ul({width:r,height:o}),v=Zo(p);v.drawImage(d,0,0,r,o);for(var g=v.getImageData(0,0,r,o).data,y=[],b=0;b<g.length;b+=4)y.push(g[b+2]),y.push(g[b+1]),y.push(g[b]);u.push(y)}),[2,u.map(function(d){var p=xe(function(){var v=Co(dn(d,[1,r,o,3]),[0,2,1,3]).toFloat();return H1(v)});return p})]}})})}function nI(n,t){return xe(function(){var e=Qh(n,t),r=er(e,[e.shape[0],t.fc1.weights.shape[0]]),o=gr(r,t.fc1),i=Yi(o,t.prelu4_alpha),s=gr(i,t.fc2_1),u=Un(Ml(s,1),1),c=jr(Nt(s,u),1),f=gr(i,t.fc2_2),d=Rt(c,1)[1];return{scores:d,regions:f}})}function rI(n,t,e,r,o){return Te(this,void 0,void 0,function(){var i,s,u,c,f,d,p,v,g,y,b,w,C,_;return De(this,function(S){switch(S.label){case 0:return i=Date.now(),[4,G1(n,t,{width:24,height:24})];case 1:return s=S.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),u=s.map(function(k){var R=nI(k,r);return k.dispose(),R}),o.stage2_rnet=Date.now()-i,c=u.length>1?kt(u.map(function(k){return k.scores})):u[0].scores,p=(d=Array).from,[4,c.data()];case 2:return f=p.apply(d,[S.sent()]),c.dispose(),v=f.map(function(k,R){return{score:k,idx:R}}).filter(function(k){return k.score>e}).map(function(k){var R=k.idx;return R}),g=v.map(function(k){return t[k]}),y=v.map(function(k){return f[k]}),b=[],w=[],g.length>0&&(i=Date.now(),C=as(g,y,.7),o.stage2_nms=Date.now()-i,_=C.map(function(k){var R=u[v[k]].regions.arraySync();return new Yh(R[0][0],R[0][1],R[0][2],R[0][3])}),w=C.map(function(k){return y[k]}),b=C.map(function(k,R){return g[k].calibrate(_[R])})),u.forEach(function(k){k.regions.dispose(),k.scores.dispose()}),[2,{boxes:b,scores:w}]}})})}function oI(n,t){return xe(function(){var e=Qh(n,t);e=Ft(e,[2,2],[2,2],"same"),e=tr(e,t.conv4,"valid"),e=Yi(e,t.prelu4_alpha);var r=er(e,[e.shape[0],t.fc1.weights.shape[0]]),o=gr(r,t.fc1),i=Yi(o,t.prelu5_alpha),s=gr(i,t.fc2_1),u=Un(Ml(s,1),1),c=jr(Nt(s,u),1),f=gr(i,t.fc2_2),d=gr(i,t.fc2_3),p=Rt(c,1)[1];return{scores:p,regions:f,points:d}})}function iI(n,t,e,r,o){return Te(this,void 0,void 0,function(){var i,s,u,c,f,d,p,v,g,y,b,w,C,_,S;return De(this,function(k){switch(k.label){case 0:return i=Date.now(),[4,G1(n,t,{width:48,height:48})];case 1:return s=k.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),u=s.map(function(R){var N=oI(R,r);return R.dispose(),N}),o.stage3_onet=Date.now()-i,c=u.length>1?kt(u.map(function(R){return R.scores})):u[0].scores,p=(d=Array).from,[4,c.data()];case 2:return f=p.apply(d,[k.sent()]),c.dispose(),v=f.map(function(R,N){return{score:R,idx:N}}).filter(function(R){return R.score>e}).map(function(R){var N=R.idx;return N}),g=v.map(function(R){var N=u[R].regions.arraySync();return new Yh(N[0][0],N[0][1],N[0][2],N[0][3])}),y=v.map(function(R,N){return t[R].calibrate(g[N])}),b=v.map(function(R){return f[R]}),w=[],C=[],_=[],y.length>0&&(i=Date.now(),S=as(y,b,.7,!1),o.stage3_nms=Date.now()-i,w=S.map(function(R){return y[R]}),C=S.map(function(R){return b[R]}),_=S.map(function(R,N){return Array(5).fill(0).map(function(P,F){var D=u[R].points.arraySync();return new Qe(D[0][F]*(w[N].width+1)+w[N].left,D[0][F+5]*(w[N].height+1)+w[N].top)})})),u.forEach(function(R){R.regions.dispose(),R.scores.dispose(),R.points.dispose()}),[2,{boxes:w,scores:C,points:_}]}})})}var aI=function(n){Le(t,n);function t(){return n.call(this,"Mtcnn")||this}return t.prototype.load=function(e){return Te(this,void 0,void 0,function(){return De(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,e)]})})},t.prototype.loadFromDisk=function(e){return Te(this,void 0,void 0,function(){return De(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,e)]})})},t.prototype.forwardInput=function(e,r){return r===void 0&&(r={}),Te(this,void 0,void 0,function(){var o,i,s,u,c,f,d,p,v,g,y,b,w,C,_,S,k,R,N,P,F;return De(this,function(D){switch(D.label){case 0:if(o=this.params,!o)throw new Error("Mtcnn - load model before inference");if(i=e.canvases[0],!i)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return s={},u=Date.now(),c=xe(function(){return q3(Un(Fh.fromPixels(i)).toFloat())}),f=function(A){return c.dispose(),s.total=Date.now()-u,A},d=c.shape.slice(1),p=d[0],v=d[1],g=new z1(r),y=g.minFaceSize,b=g.scaleFactor,w=g.maxNumScales,C=g.scoreThresholds,_=g.scaleSteps,S=(_||Q3(y,b,[p,v])).filter(function(A){var V=$d(A,[p,v]);return Math.min(V.width,V.height)>El}).slice(0,w),s.scales=S,s.pyramid=S.map(function(A){return $d(A,[p,v])}),k=Date.now(),[4,tI(c,S,C[0],o.pnet,s)];case 1:return R=D.sent(),s.total_stage1=Date.now()-k,R.boxes.length?(s.stage2_numInputBoxes=R.boxes.length,k=Date.now(),[4,rI(i,R.boxes,C[1],o.rnet,s)]):[2,f({results:[],stats:s})];case 2:return N=D.sent(),s.total_stage2=Date.now()-k,N.boxes.length?(s.stage3_numInputBoxes=N.boxes.length,k=Date.now(),[4,iI(i,N.boxes,C[2],o.onet,s)]):[2,f({results:[],stats:s})];case 3:return P=D.sent(),s.total_stage3=Date.now()-k,F=P.boxes.map(function(A,V){return Gh(Lh({},new kr(P.scores[V],new Mh(A.left/v,A.top/p,A.width/v,A.height/p),{height:p,width:v})),new MR(P.points[V].map(function(U){return U.sub(new Qe(A.left,A.top)).div(new Qe(A.width,A.height))}),{width:A.width,height:A.height}))}),[2,f({results:F,stats:s})]}})})},t.prototype.forward=function(e,r){return r===void 0&&(r={}),Te(this,void 0,void 0,function(){var o;return De(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,Mt(e)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},t.prototype.forwardWithStats=function(e,r){return r===void 0&&(r={}),Te(this,void 0,void 0,function(){var o;return De(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,Mt(e)];case 1:return[2,o.apply(this,[i.sent(),r])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Y3(e)},t.prototype.extractParams=function(e){return $3(e)},t}(Gr),sI=.4,uI=[new Qe(1.603231,2.094468),new Qe(6.041143,7.080126),new Qe(2.882459,3.518061),new Qe(4.266906,5.178857),new Qe(9.041765,10.66308)],lI=[117.001,114.697,97.404],cI=function(n){Le(t,n);function t(){var e=this,r={withSeparableConvs:!0,iouThreshold:sI,classes:["face"],anchors:uI,meanRgb:lI,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e=n.call(this,r)||this,e}return Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,r){return Te(this,void 0,void 0,function(){var o;return De(this,function(i){switch(i.label){case 0:return[4,this.detect(e,r)];case 1:return o=i.sent(),[2,o.map(function(s){return new kr(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(e){return n.prototype.extractParamsFromWeigthMap.call(this,e)},t}(V1),pn={ssdMobilenetv1:new U1,tinyFaceDetector:new cI,tinyYolov2:new G3,mtcnn:new aI,faceLandmark68Net:new F1,faceLandmark68TinyNet:new d3,faceRecognitionNet:new x3,faceExpressionNet:new JR,ageGenderNet:new u3},q1=function(n){Le(t,n);function t(e,r,o){var i=n.call(this)||this;return i.parentTask=e,i.input=r,i.extractedFaces=o,i}return t}(ys),Jh=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return Te(this,void 0,void 0,function(){var e,r,o=this;return De(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),[4,Hl(e,this.input,function(s){return Te(o,void 0,void 0,function(){return De(this,function(u){switch(u.label){case 0:return[4,Promise.all(s.map(function(c){return pn.faceExpressionNet.predictExpressions(c)}))];case 1:return[2,u.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,e.map(function(s,u){return D1(s,r[u])})]}})})},t.prototype.withAgeAndGender=function(){return new np(this,this.input)},t}(q1),Zh=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return Te(this,void 0,void 0,function(){var e,r;return De(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),e?[4,Xh(e,this.input,function(i){return pn.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,D1(e,r)]}})})},t.prototype.withAgeAndGender=function(){return new rp(this,this.input)},t}(q1),ep=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new op(this,this.input)},t.prototype.withFaceDescriptors=function(){return new ap(this,this.input)},t}(Jh),tp=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new ip(this,this.input)},t.prototype.withFaceDescriptor=function(){return new sp(this,this.input)},t}(Zh),K1=function(n){Le(t,n);function t(e,r,o){var i=n.call(this)||this;return i.parentTask=e,i.input=r,i.extractedFaces=o,i}return t}(ys),np=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return Te(this,void 0,void 0,function(){var e,r,o=this;return De(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),[4,Hl(e,this.input,function(s){return Te(o,void 0,void 0,function(){return De(this,function(u){switch(u.label){case 0:return[4,Promise.all(s.map(function(c){return pn.ageGenderNet.predictAgeAndGender(c)}))];case 1:return[2,u.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,e.map(function(s,u){var c=r[u],f=c.age,d=c.gender,p=c.genderProbability;return B1(W1(s,d,p),f)})]}})})},t.prototype.withFaceExpressions=function(){return new Jh(this,this.input)},t}(K1),rp=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return Te(this,void 0,void 0,function(){var e,r,o,i,s;return De(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),e?[4,Xh(e,this.input,function(c){return pn.ageGenderNet.predictAgeAndGender(c)},this.extractedFaces)]:[2];case 2:return r=u.sent(),o=r.age,i=r.gender,s=r.genderProbability,[2,B1(W1(e,i,s),o)]}})})},t.prototype.withFaceExpressions=function(){return new Zh(this,this.input)},t}(K1),op=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new ep(this,this.input)},t.prototype.withFaceDescriptors=function(){return new ap(this,this.input)},t}(np),ip=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new tp(this,this.input)},t.prototype.withFaceDescriptor=function(){return new sp(this,this.input)},t}(rp),$1=function(n){Le(t,n);function t(e,r){var o=n.call(this)||this;return o.parentTask=e,o.input=r,o}return t}(ys),ap=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return Te(this,void 0,void 0,function(){var e,r;return De(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),[4,Hl(e,this.input,function(i){return Promise.all(i.map(function(s){return pn.faceRecognitionNet.computeFaceDescriptor(s)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=o.sent(),[2,r.map(function(i,s){return L1(e[s],i)})]}})})},t.prototype.withFaceExpressions=function(){return new ep(this,this.input)},t.prototype.withAgeAndGender=function(){return new op(this,this.input)},t}($1),sp=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return Te(this,void 0,void 0,function(){var e,r;return De(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),e?[4,Xh(e,this.input,function(i){return pn.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,L1(e,r)]}})})},t.prototype.withFaceExpressions=function(){return new tp(this,this.input)},t.prototype.withAgeAndGender=function(){return new ip(this,this.input)},t}($1),X1=function(n){Le(t,n);function t(e,r,o){var i=n.call(this)||this;return i.parentTask=e,i.input=r,i.useTinyLandmarkNet=o,i}return Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?pn.faceLandmark68TinyNet:pn.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(ys),fI=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return Te(this,void 0,void 0,function(){var e,r,o,i,s,u=this;return De(this,function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:return e=c.sent(),r=e.map(function(f){return f.detection}),this.input instanceof ft?[4,Uh(this.input,r)]:[3,3];case 2:return i=c.sent(),[3,5];case 3:return[4,zh(this.input,r)];case 4:i=c.sent(),c.label=5;case 5:return o=i,[4,Promise.all(o.map(function(f){return u.landmarkNet.detectLandmarks(f)}))];case 6:return s=c.sent(),o.forEach(function(f){return f instanceof ft&&f.dispose()}),[2,e.map(function(f,d){return Gh(f,s[d])})]}})})},t.prototype.withFaceExpressions=function(){return new ep(this,this.input)},t.prototype.withAgeAndGender=function(){return new op(this,this.input)},t.prototype.withFaceDescriptors=function(){return new ap(this,this.input)},t}(X1),dI=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return Te(this,void 0,void 0,function(){var e,r,o,i,s;return De(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),e?(r=e.detection,this.input instanceof ft?[4,Uh(this.input,[r])]:[3,3]):[2];case 2:return i=u.sent(),[3,5];case 3:return[4,zh(this.input,[r])];case 4:i=u.sent(),u.label=5;case 5:return o=i,[4,this.landmarkNet.detectLandmarks(o[0])];case 6:return s=u.sent(),o.forEach(function(c){return c instanceof ft&&c.dispose()}),[2,Gh(e,s)]}})})},t.prototype.withFaceExpressions=function(){return new tp(this,this.input)},t.prototype.withAgeAndGender=function(){return new ip(this,this.input)},t.prototype.withFaceDescriptor=function(){return new sp(this,this.input)},t}(X1),Y1=function(n){Le(t,n);function t(e,r){r===void 0&&(r=new jl);var o=n.call(this)||this;return o.input=e,o.options=r,o}return t}(ys),Q1=function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return Te(this,void 0,void 0,function(){var e,r,o,i;return De(this,function(s){switch(s.label){case 0:return e=this,r=e.input,o=e.options,o instanceof z1?[4,pn.mtcnn.forward(r,o)]:[3,2];case 1:return[2,s.sent().map(function(u){return u.detection})];case 2:if(i=o instanceof j1?function(u){return pn.tinyFaceDetector.locateFaces(u,o)}:o instanceof jl?function(u){return pn.ssdMobilenetv1.locateFaces(u,o)}:o instanceof $h?function(u){return pn.tinyYolov2.locateFaces(u,o)}:null,!i)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(r){return Te(e,void 0,void 0,function(){var o;return De(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o.map(function(s){return Lh({},s)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new fI(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new Jh(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new np(this.runAndExtendWithFaceDetections(),this.input)},t}(Y1);(function(n){Le(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return Te(this,void 0,void 0,function(){var e,r;return De(this,function(o){switch(o.label){case 0:return[4,new Q1(this.input,this.options)];case 1:return e=o.sent(),r=e[0],e.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(r){return Te(e,void 0,void 0,function(){var o;return De(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o?Lh({},o):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new dI(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new Zh(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new rp(this.runAndExtendWithFaceDetection(),this.input)},t})(Y1);function hI(n,t){return t===void 0&&(t=new jl),new Q1(n,t)}function pI(n,t){if(n.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(n),r=Array.from(t);return Math.sqrt(e.map(function(o,i){return o-r[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}(function(){function n(t,e){e===void 0&&(e=.6),this._distanceThreshold=e;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=r.map(function(s){if(s instanceof ju)return s;if(s instanceof Float32Array)return new ju(i(),[s]);if(s.descriptor&&s.descriptor instanceof Float32Array)return new ju(i(),[s.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(t,e){return e.map(function(r){return pI(r,t)}).reduce(function(r,o){return r+o},0)/(e.length||1)},n.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(r){var o=r.descriptors,i=r.label;return new oy(i,e.computeMeanDistance(t,o))}).reduce(function(r,o){return r.distance<o.distance?r:o})},n.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new oy("unknown",e.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},n.fromJSON=function(t){var e=t.labeledDescriptors.map(function(r){return ju.fromJSON(r)});return new n(e,t.distanceThreshold)},n})();function J1(n,t){return function(){return n.apply(t,arguments)}}const{toString:vI}=Object.prototype,{getPrototypeOf:up}=Object,{iterator:Gl,toStringTag:Z1}=Symbol,ql=(n=>t=>{const e=vI.call(t);return n[e]||(n[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),or=n=>(n=n.toLowerCase(),t=>ql(t)===n),Kl=n=>t=>typeof t===n,{isArray:ra}=Array,ss=Kl("undefined");function xs(n){return n!==null&&!ss(n)&&n.constructor!==null&&!ss(n.constructor)&&mn(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const ex=or("ArrayBuffer");function mI(n){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(n):t=n&&n.buffer&&ex(n.buffer),t}const gI=Kl("string"),mn=Kl("function"),tx=Kl("number"),ws=n=>n!==null&&typeof n=="object",yI=n=>n===!0||n===!1,Yu=n=>{if(ql(n)!=="object")return!1;const t=up(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Z1 in n)&&!(Gl in n)},xI=n=>{if(!ws(n)||xs(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},wI=or("Date"),bI=or("File"),CI=or("Blob"),EI=or("FileList"),_I=n=>ws(n)&&mn(n.pipe),SI=n=>{let t;return n&&(typeof FormData=="function"&&n instanceof FormData||mn(n.append)&&((t=ql(n))==="formdata"||t==="object"&&mn(n.toString)&&n.toString()==="[object FormData]"))},kI=or("URLSearchParams"),[RI,II,NI,TI]=["ReadableStream","Request","Response","Headers"].map(or),DI=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function bs(n,t,{allOwnKeys:e=!1}={}){if(n===null||typeof n>"u")return;let r,o;if(typeof n!="object"&&(n=[n]),ra(n))for(r=0,o=n.length;r<o;r++)t.call(null,n[r],r,n);else{if(xs(n))return;const i=e?Object.getOwnPropertyNames(n):Object.keys(n),s=i.length;let u;for(r=0;r<s;r++)u=i[r],t.call(null,n[u],u,n)}}function nx(n,t){if(xs(n))return null;t=t.toLowerCase();const e=Object.keys(n);let r=e.length,o;for(;r-- >0;)if(o=e[r],t===o.toLowerCase())return o;return null}const $o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,rx=n=>!ss(n)&&n!==$o;function Xd(){const{caseless:n}=rx(this)&&this||{},t={},e=(r,o)=>{const i=n&&nx(t,o)||o;Yu(t[i])&&Yu(r)?t[i]=Xd(t[i],r):Yu(r)?t[i]=Xd({},r):ra(r)?t[i]=r.slice():t[i]=r};for(let r=0,o=arguments.length;r<o;r++)arguments[r]&&bs(arguments[r],e);return t}const AI=(n,t,e,{allOwnKeys:r}={})=>(bs(t,(o,i)=>{e&&mn(o)?n[i]=J1(o,e):n[i]=o},{allOwnKeys:r}),n),PI=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),FI=(n,t,e,r)=>{n.prototype=Object.create(t.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:t.prototype}),e&&Object.assign(n.prototype,e)},OI=(n,t,e,r)=>{let o,i,s;const u={};if(t=t||{},n==null)return t;do{for(o=Object.getOwnPropertyNames(n),i=o.length;i-- >0;)s=o[i],(!r||r(s,n,t))&&!u[s]&&(t[s]=n[s],u[s]=!0);n=e!==!1&&up(n)}while(n&&(!e||e(n,t))&&n!==Object.prototype);return t},MI=(n,t,e)=>{n=String(n),(e===void 0||e>n.length)&&(e=n.length),e-=t.length;const r=n.indexOf(t,e);return r!==-1&&r===e},LI=n=>{if(!n)return null;if(ra(n))return n;let t=n.length;if(!tx(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=n[t];return e},BI=(n=>t=>n&&t instanceof n)(typeof Uint8Array<"u"&&up(Uint8Array)),WI=(n,t)=>{const r=(n&&n[Gl]).call(n);let o;for(;(o=r.next())&&!o.done;){const i=o.value;t.call(n,i[0],i[1])}},zI=(n,t)=>{let e;const r=[];for(;(e=n.exec(t))!==null;)r.push(e);return r},UI=or("HTMLFormElement"),VI=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,r,o){return r.toUpperCase()+o}),cy=(({hasOwnProperty:n})=>(t,e)=>n.call(t,e))(Object.prototype),jI=or("RegExp"),ox=(n,t)=>{const e=Object.getOwnPropertyDescriptors(n),r={};bs(e,(o,i)=>{let s;(s=t(o,i,n))!==!1&&(r[i]=s||o)}),Object.defineProperties(n,r)},HI=n=>{ox(n,(t,e)=>{if(mn(n)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const r=n[e];if(mn(r)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},GI=(n,t)=>{const e={},r=o=>{o.forEach(i=>{e[i]=!0})};return ra(n)?r(n):r(String(n).split(t)),e},qI=()=>{},KI=(n,t)=>n!=null&&Number.isFinite(n=+n)?n:t;function $I(n){return!!(n&&mn(n.append)&&n[Z1]==="FormData"&&n[Gl])}const XI=n=>{const t=new Array(10),e=(r,o)=>{if(ws(r)){if(t.indexOf(r)>=0)return;if(xs(r))return r;if(!("toJSON"in r)){t[o]=r;const i=ra(r)?[]:{};return bs(r,(s,u)=>{const c=e(s,o+1);!ss(c)&&(i[u]=c)}),t[o]=void 0,i}}return r};return e(n,0)},YI=or("AsyncFunction"),QI=n=>n&&(ws(n)||mn(n))&&mn(n.then)&&mn(n.catch),ix=((n,t)=>n?setImmediate:t?((e,r)=>($o.addEventListener("message",({source:o,data:i})=>{o===$o&&i===e&&r.length&&r.shift()()},!1),o=>{r.push(o),$o.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",mn($o.postMessage)),JI=typeof queueMicrotask<"u"?queueMicrotask.bind($o):typeof process<"u"&&process.nextTick||ix,ZI=n=>n!=null&&mn(n[Gl]),oe={isArray:ra,isArrayBuffer:ex,isBuffer:xs,isFormData:SI,isArrayBufferView:mI,isString:gI,isNumber:tx,isBoolean:yI,isObject:ws,isPlainObject:Yu,isEmptyObject:xI,isReadableStream:RI,isRequest:II,isResponse:NI,isHeaders:TI,isUndefined:ss,isDate:wI,isFile:bI,isBlob:CI,isRegExp:jI,isFunction:mn,isStream:_I,isURLSearchParams:kI,isTypedArray:BI,isFileList:EI,forEach:bs,merge:Xd,extend:AI,trim:DI,stripBOM:PI,inherits:FI,toFlatObject:OI,kindOf:ql,kindOfTest:or,endsWith:MI,toArray:LI,forEachEntry:WI,matchAll:zI,isHTMLForm:UI,hasOwnProperty:cy,hasOwnProp:cy,reduceDescriptors:ox,freezeMethods:HI,toObjectSet:GI,toCamelCase:VI,noop:qI,toFiniteNumber:KI,findKey:nx,global:$o,isContextDefined:rx,isSpecCompliantForm:$I,toJSONObject:XI,isAsyncFn:YI,isThenable:QI,setImmediate:ix,asap:JI,isIterable:ZI};function We(n,t,e,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),r&&(this.request=r),o&&(this.response=o,this.status=o.status?o.status:null)}oe.inherits(We,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:oe.toJSONObject(this.config),code:this.code,status:this.status}}});const ax=We.prototype,sx={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{sx[n]={value:n}});Object.defineProperties(We,sx);Object.defineProperty(ax,"isAxiosError",{value:!0});We.from=(n,t,e,r,o,i)=>{const s=Object.create(ax);return oe.toFlatObject(n,s,function(c){return c!==Error.prototype},u=>u!=="isAxiosError"),We.call(s,n.message,t,e,r,o),s.cause=n,s.name=n.name,i&&Object.assign(s,i),s};const e4=null;function Yd(n){return oe.isPlainObject(n)||oe.isArray(n)}function ux(n){return oe.endsWith(n,"[]")?n.slice(0,-2):n}function fy(n,t,e){return n?n.concat(t).map(function(o,i){return o=ux(o),!e&&i?"["+o+"]":o}).join(e?".":""):t}function t4(n){return oe.isArray(n)&&!n.some(Yd)}const n4=oe.toFlatObject(oe,{},null,function(t){return/^is[A-Z]/.test(t)});function $l(n,t,e){if(!oe.isObject(n))throw new TypeError("target must be an object");t=t||new FormData,e=oe.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,w){return!oe.isUndefined(w[b])});const r=e.metaTokens,o=e.visitor||d,i=e.dots,s=e.indexes,c=(e.Blob||typeof Blob<"u"&&Blob)&&oe.isSpecCompliantForm(t);if(!oe.isFunction(o))throw new TypeError("visitor must be a function");function f(y){if(y===null)return"";if(oe.isDate(y))return y.toISOString();if(oe.isBoolean(y))return y.toString();if(!c&&oe.isBlob(y))throw new We("Blob is not supported. Use a Buffer instead.");return oe.isArrayBuffer(y)||oe.isTypedArray(y)?c&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function d(y,b,w){let C=y;if(y&&!w&&typeof y=="object"){if(oe.endsWith(b,"{}"))b=r?b:b.slice(0,-2),y=JSON.stringify(y);else if(oe.isArray(y)&&t4(y)||(oe.isFileList(y)||oe.endsWith(b,"[]"))&&(C=oe.toArray(y)))return b=ux(b),C.forEach(function(S,k){!(oe.isUndefined(S)||S===null)&&t.append(s===!0?fy([b],k,i):s===null?b:b+"[]",f(S))}),!1}return Yd(y)?!0:(t.append(fy(w,b,i),f(y)),!1)}const p=[],v=Object.assign(n4,{defaultVisitor:d,convertValue:f,isVisitable:Yd});function g(y,b){if(!oe.isUndefined(y)){if(p.indexOf(y)!==-1)throw Error("Circular reference detected in "+b.join("."));p.push(y),oe.forEach(y,function(C,_){(!(oe.isUndefined(C)||C===null)&&o.call(t,C,oe.isString(_)?_.trim():_,b,v))===!0&&g(C,b?b.concat(_):[_])}),p.pop()}}if(!oe.isObject(n))throw new TypeError("data must be an object");return g(n),t}function dy(n){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function lp(n,t){this._pairs=[],n&&$l(n,this,t)}const lx=lp.prototype;lx.append=function(t,e){this._pairs.push([t,e])};lx.toString=function(t){const e=t?function(r){return t.call(this,r,dy)}:dy;return this._pairs.map(function(o){return e(o[0])+"="+e(o[1])},"").join("&")};function r4(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function cx(n,t,e){if(!t)return n;const r=e&&e.encode||r4;oe.isFunction(e)&&(e={serialize:e});const o=e&&e.serialize;let i;if(o?i=o(t,e):i=oe.isURLSearchParams(t)?t.toString():new lp(t,e).toString(r),i){const s=n.indexOf("#");s!==-1&&(n=n.slice(0,s)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class hy{constructor(){this.handlers=[]}use(t,e,r){return this.handlers.push({fulfilled:t,rejected:e,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){oe.forEach(this.handlers,function(r){r!==null&&t(r)})}}const fx={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},o4=typeof URLSearchParams<"u"?URLSearchParams:lp,i4=typeof FormData<"u"?FormData:null,a4=typeof Blob<"u"?Blob:null,s4={isBrowser:!0,classes:{URLSearchParams:o4,FormData:i4,Blob:a4},protocols:["http","https","file","blob","url","data"]},cp=typeof window<"u"&&typeof document<"u",Qd=typeof navigator=="object"&&navigator||void 0,u4=cp&&(!Qd||["ReactNative","NativeScript","NS"].indexOf(Qd.product)<0),l4=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",c4=cp&&window.location.href||"http://localhost",f4=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:cp,hasStandardBrowserEnv:u4,hasStandardBrowserWebWorkerEnv:l4,navigator:Qd,origin:c4},Symbol.toStringTag,{value:"Module"})),Jt={...f4,...s4};function d4(n,t){return $l(n,new Jt.classes.URLSearchParams,{visitor:function(e,r,o,i){return Jt.isNode&&oe.isBuffer(e)?(this.append(r,e.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...t})}function h4(n){return oe.matchAll(/\w+|\[(\w*)]/g,n).map(t=>t[0]==="[]"?"":t[1]||t[0])}function p4(n){const t={},e=Object.keys(n);let r;const o=e.length;let i;for(r=0;r<o;r++)i=e[r],t[i]=n[i];return t}function dx(n){function t(e,r,o,i){let s=e[i++];if(s==="__proto__")return!0;const u=Number.isFinite(+s),c=i>=e.length;return s=!s&&oe.isArray(o)?o.length:s,c?(oe.hasOwnProp(o,s)?o[s]=[o[s],r]:o[s]=r,!u):((!o[s]||!oe.isObject(o[s]))&&(o[s]=[]),t(e,r,o[s],i)&&oe.isArray(o[s])&&(o[s]=p4(o[s])),!u)}if(oe.isFormData(n)&&oe.isFunction(n.entries)){const e={};return oe.forEachEntry(n,(r,o)=>{t(h4(r),o,e,0)}),e}return null}function v4(n,t,e){if(oe.isString(n))try{return(t||JSON.parse)(n),oe.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(e||JSON.stringify)(n)}const Cs={transitional:fx,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const r=e.getContentType()||"",o=r.indexOf("application/json")>-1,i=oe.isObject(t);if(i&&oe.isHTMLForm(t)&&(t=new FormData(t)),oe.isFormData(t))return o?JSON.stringify(dx(t)):t;if(oe.isArrayBuffer(t)||oe.isBuffer(t)||oe.isStream(t)||oe.isFile(t)||oe.isBlob(t)||oe.isReadableStream(t))return t;if(oe.isArrayBufferView(t))return t.buffer;if(oe.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let u;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return d4(t,this.formSerializer).toString();if((u=oe.isFileList(t))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return $l(u?{"files[]":t}:t,c&&new c,this.formSerializer)}}return i||o?(e.setContentType("application/json",!1),v4(t)):t}],transformResponse:[function(t){const e=this.transitional||Cs.transitional,r=e&&e.forcedJSONParsing,o=this.responseType==="json";if(oe.isResponse(t)||oe.isReadableStream(t))return t;if(t&&oe.isString(t)&&(r&&!this.responseType||o)){const s=!(e&&e.silentJSONParsing)&&o;try{return JSON.parse(t)}catch(u){if(s)throw u.name==="SyntaxError"?We.from(u,We.ERR_BAD_RESPONSE,this,null,this.response):u}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Jt.classes.FormData,Blob:Jt.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};oe.forEach(["delete","get","head","post","put","patch"],n=>{Cs.headers[n]={}});const m4=oe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),g4=n=>{const t={};let e,r,o;return n&&n.split(`
`).forEach(function(s){o=s.indexOf(":"),e=s.substring(0,o).trim().toLowerCase(),r=s.substring(o+1).trim(),!(!e||t[e]&&m4[e])&&(e==="set-cookie"?t[e]?t[e].push(r):t[e]=[r]:t[e]=t[e]?t[e]+", "+r:r)}),t},py=Symbol("internals");function Xa(n){return n&&String(n).trim().toLowerCase()}function Qu(n){return n===!1||n==null?n:oe.isArray(n)?n.map(Qu):String(n)}function y4(n){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=e.exec(n);)t[r[1]]=r[2];return t}const x4=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function bd(n,t,e,r,o){if(oe.isFunction(r))return r.call(this,t,e);if(o&&(t=e),!!oe.isString(t)){if(oe.isString(r))return t.indexOf(r)!==-1;if(oe.isRegExp(r))return r.test(t)}}function w4(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,r)=>e.toUpperCase()+r)}function b4(n,t){const e=oe.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+e,{value:function(o,i,s){return this[r].call(this,t,o,i,s)},configurable:!0})})}let gn=class{constructor(t){t&&this.set(t)}set(t,e,r){const o=this;function i(u,c,f){const d=Xa(c);if(!d)throw new Error("header name must be a non-empty string");const p=oe.findKey(o,d);(!p||o[p]===void 0||f===!0||f===void 0&&o[p]!==!1)&&(o[p||c]=Qu(u))}const s=(u,c)=>oe.forEach(u,(f,d)=>i(f,d,c));if(oe.isPlainObject(t)||t instanceof this.constructor)s(t,e);else if(oe.isString(t)&&(t=t.trim())&&!x4(t))s(g4(t),e);else if(oe.isObject(t)&&oe.isIterable(t)){let u={},c,f;for(const d of t){if(!oe.isArray(d))throw TypeError("Object iterator must return a key-value pair");u[f=d[0]]=(c=u[f])?oe.isArray(c)?[...c,d[1]]:[c,d[1]]:d[1]}s(u,e)}else t!=null&&i(e,t,r);return this}get(t,e){if(t=Xa(t),t){const r=oe.findKey(this,t);if(r){const o=this[r];if(!e)return o;if(e===!0)return y4(o);if(oe.isFunction(e))return e.call(this,o,r);if(oe.isRegExp(e))return e.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=Xa(t),t){const r=oe.findKey(this,t);return!!(r&&this[r]!==void 0&&(!e||bd(this,this[r],r,e)))}return!1}delete(t,e){const r=this;let o=!1;function i(s){if(s=Xa(s),s){const u=oe.findKey(r,s);u&&(!e||bd(r,r[u],u,e))&&(delete r[u],o=!0)}}return oe.isArray(t)?t.forEach(i):i(t),o}clear(t){const e=Object.keys(this);let r=e.length,o=!1;for(;r--;){const i=e[r];(!t||bd(this,this[i],i,t,!0))&&(delete this[i],o=!0)}return o}normalize(t){const e=this,r={};return oe.forEach(this,(o,i)=>{const s=oe.findKey(r,i);if(s){e[s]=Qu(o),delete e[i];return}const u=t?w4(i):String(i).trim();u!==i&&delete e[i],e[u]=Qu(o),r[u]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return oe.forEach(this,(r,o)=>{r!=null&&r!==!1&&(e[o]=t&&oe.isArray(r)?r.join(", "):r)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const r=new this(t);return e.forEach(o=>r.set(o)),r}static accessor(t){const r=(this[py]=this[py]={accessors:{}}).accessors,o=this.prototype;function i(s){const u=Xa(s);r[u]||(b4(o,s),r[u]=!0)}return oe.isArray(t)?t.forEach(i):i(t),this}};gn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);oe.reduceDescriptors(gn.prototype,({value:n},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(r){this[e]=r}}});oe.freezeMethods(gn);function Cd(n,t){const e=this||Cs,r=t||e,o=gn.from(r.headers);let i=r.data;return oe.forEach(n,function(u){i=u.call(e,i,o.normalize(),t?t.status:void 0)}),o.normalize(),i}function hx(n){return!!(n&&n.__CANCEL__)}function oa(n,t,e){We.call(this,n??"canceled",We.ERR_CANCELED,t,e),this.name="CanceledError"}oe.inherits(oa,We,{__CANCEL__:!0});function px(n,t,e){const r=e.config.validateStatus;!e.status||!r||r(e.status)?n(e):t(new We("Request failed with status code "+e.status,[We.ERR_BAD_REQUEST,We.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function C4(n){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return t&&t[1]||""}function E4(n,t){n=n||10;const e=new Array(n),r=new Array(n);let o=0,i=0,s;return t=t!==void 0?t:1e3,function(c){const f=Date.now(),d=r[i];s||(s=f),e[o]=c,r[o]=f;let p=i,v=0;for(;p!==o;)v+=e[p++],p=p%n;if(o=(o+1)%n,o===i&&(i=(i+1)%n),f-s<t)return;const g=d&&f-d;return g?Math.round(v*1e3/g):void 0}}function _4(n,t){let e=0,r=1e3/t,o,i;const s=(f,d=Date.now())=>{e=d,o=null,i&&(clearTimeout(i),i=null),n(...f)};return[(...f)=>{const d=Date.now(),p=d-e;p>=r?s(f,d):(o=f,i||(i=setTimeout(()=>{i=null,s(o)},r-p)))},()=>o&&s(o)]}const _l=(n,t,e=3)=>{let r=0;const o=E4(50,250);return _4(i=>{const s=i.loaded,u=i.lengthComputable?i.total:void 0,c=s-r,f=o(c),d=s<=u;r=s;const p={loaded:s,total:u,progress:u?s/u:void 0,bytes:c,rate:f||void 0,estimated:f&&u&&d?(u-s)/f:void 0,event:i,lengthComputable:u!=null,[t?"download":"upload"]:!0};n(p)},e)},vy=(n,t)=>{const e=n!=null;return[r=>t[0]({lengthComputable:e,total:n,loaded:r}),t[1]]},my=n=>(...t)=>oe.asap(()=>n(...t)),S4=Jt.hasStandardBrowserEnv?((n,t)=>e=>(e=new URL(e,Jt.origin),n.protocol===e.protocol&&n.host===e.host&&(t||n.port===e.port)))(new URL(Jt.origin),Jt.navigator&&/(msie|trident)/i.test(Jt.navigator.userAgent)):()=>!0,k4=Jt.hasStandardBrowserEnv?{write(n,t,e,r,o,i){const s=[n+"="+encodeURIComponent(t)];oe.isNumber(e)&&s.push("expires="+new Date(e).toGMTString()),oe.isString(r)&&s.push("path="+r),oe.isString(o)&&s.push("domain="+o),i===!0&&s.push("secure"),document.cookie=s.join("; ")},read(n){const t=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function R4(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function I4(n,t){return t?n.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):n}function vx(n,t,e){let r=!R4(t);return n&&(r||e==!1)?I4(n,t):t}const gy=n=>n instanceof gn?{...n}:n;function ei(n,t){t=t||{};const e={};function r(f,d,p,v){return oe.isPlainObject(f)&&oe.isPlainObject(d)?oe.merge.call({caseless:v},f,d):oe.isPlainObject(d)?oe.merge({},d):oe.isArray(d)?d.slice():d}function o(f,d,p,v){if(oe.isUndefined(d)){if(!oe.isUndefined(f))return r(void 0,f,p,v)}else return r(f,d,p,v)}function i(f,d){if(!oe.isUndefined(d))return r(void 0,d)}function s(f,d){if(oe.isUndefined(d)){if(!oe.isUndefined(f))return r(void 0,f)}else return r(void 0,d)}function u(f,d,p){if(p in t)return r(f,d);if(p in n)return r(void 0,f)}const c={url:i,method:i,data:i,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:u,headers:(f,d,p)=>o(gy(f),gy(d),p,!0)};return oe.forEach(Object.keys({...n,...t}),function(d){const p=c[d]||o,v=p(n[d],t[d],d);oe.isUndefined(v)&&p!==u||(e[d]=v)}),e}const mx=n=>{const t=ei({},n);let{data:e,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:i,headers:s,auth:u}=t;t.headers=s=gn.from(s),t.url=cx(vx(t.baseURL,t.url,t.allowAbsoluteUrls),n.params,n.paramsSerializer),u&&s.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let c;if(oe.isFormData(e)){if(Jt.hasStandardBrowserEnv||Jt.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if((c=s.getContentType())!==!1){const[f,...d]=c?c.split(";").map(p=>p.trim()).filter(Boolean):[];s.setContentType([f||"multipart/form-data",...d].join("; "))}}if(Jt.hasStandardBrowserEnv&&(r&&oe.isFunction(r)&&(r=r(t)),r||r!==!1&&S4(t.url))){const f=o&&i&&k4.read(i);f&&s.set(o,f)}return t},N4=typeof XMLHttpRequest<"u",T4=N4&&function(n){return new Promise(function(e,r){const o=mx(n);let i=o.data;const s=gn.from(o.headers).normalize();let{responseType:u,onUploadProgress:c,onDownloadProgress:f}=o,d,p,v,g,y;function b(){g&&g(),y&&y(),o.cancelToken&&o.cancelToken.unsubscribe(d),o.signal&&o.signal.removeEventListener("abort",d)}let w=new XMLHttpRequest;w.open(o.method.toUpperCase(),o.url,!0),w.timeout=o.timeout;function C(){if(!w)return;const S=gn.from("getAllResponseHeaders"in w&&w.getAllResponseHeaders()),R={data:!u||u==="text"||u==="json"?w.responseText:w.response,status:w.status,statusText:w.statusText,headers:S,config:n,request:w};px(function(P){e(P),b()},function(P){r(P),b()},R),w=null}"onloadend"in w?w.onloadend=C:w.onreadystatechange=function(){!w||w.readyState!==4||w.status===0&&!(w.responseURL&&w.responseURL.indexOf("file:")===0)||setTimeout(C)},w.onabort=function(){w&&(r(new We("Request aborted",We.ECONNABORTED,n,w)),w=null)},w.onerror=function(){r(new We("Network Error",We.ERR_NETWORK,n,w)),w=null},w.ontimeout=function(){let k=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const R=o.transitional||fx;o.timeoutErrorMessage&&(k=o.timeoutErrorMessage),r(new We(k,R.clarifyTimeoutError?We.ETIMEDOUT:We.ECONNABORTED,n,w)),w=null},i===void 0&&s.setContentType(null),"setRequestHeader"in w&&oe.forEach(s.toJSON(),function(k,R){w.setRequestHeader(R,k)}),oe.isUndefined(o.withCredentials)||(w.withCredentials=!!o.withCredentials),u&&u!=="json"&&(w.responseType=o.responseType),f&&([v,y]=_l(f,!0),w.addEventListener("progress",v)),c&&w.upload&&([p,g]=_l(c),w.upload.addEventListener("progress",p),w.upload.addEventListener("loadend",g)),(o.cancelToken||o.signal)&&(d=S=>{w&&(r(!S||S.type?new oa(null,n,w):S),w.abort(),w=null)},o.cancelToken&&o.cancelToken.subscribe(d),o.signal&&(o.signal.aborted?d():o.signal.addEventListener("abort",d)));const _=C4(o.url);if(_&&Jt.protocols.indexOf(_)===-1){r(new We("Unsupported protocol "+_+":",We.ERR_BAD_REQUEST,n));return}w.send(i||null)})},D4=(n,t)=>{const{length:e}=n=n?n.filter(Boolean):[];if(t||e){let r=new AbortController,o;const i=function(f){if(!o){o=!0,u();const d=f instanceof Error?f:this.reason;r.abort(d instanceof We?d:new oa(d instanceof Error?d.message:d))}};let s=t&&setTimeout(()=>{s=null,i(new We(`timeout ${t} of ms exceeded`,We.ETIMEDOUT))},t);const u=()=>{n&&(s&&clearTimeout(s),s=null,n.forEach(f=>{f.unsubscribe?f.unsubscribe(i):f.removeEventListener("abort",i)}),n=null)};n.forEach(f=>f.addEventListener("abort",i));const{signal:c}=r;return c.unsubscribe=()=>oe.asap(u),c}},A4=function*(n,t){let e=n.byteLength;if(e<t){yield n;return}let r=0,o;for(;r<e;)o=r+t,yield n.slice(r,o),r=o},P4=async function*(n,t){for await(const e of F4(n))yield*A4(e,t)},F4=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const t=n.getReader();try{for(;;){const{done:e,value:r}=await t.read();if(e)break;yield r}}finally{await t.cancel()}},yy=(n,t,e,r)=>{const o=P4(n,t);let i=0,s,u=c=>{s||(s=!0,r&&r(c))};return new ReadableStream({async pull(c){try{const{done:f,value:d}=await o.next();if(f){u(),c.close();return}let p=d.byteLength;if(e){let v=i+=p;e(v)}c.enqueue(new Uint8Array(d))}catch(f){throw u(f),f}},cancel(c){return u(c),o.return()}},{highWaterMark:2})},Xl=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",gx=Xl&&typeof ReadableStream=="function",O4=Xl&&(typeof TextEncoder=="function"?(n=>t=>n.encode(t))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),yx=(n,...t)=>{try{return!!n(...t)}catch{return!1}},M4=gx&&yx(()=>{let n=!1;const t=new Request(Jt.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!t}),xy=64*1024,Jd=gx&&yx(()=>oe.isReadableStream(new Response("").body)),Sl={stream:Jd&&(n=>n.body)};Xl&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Sl[t]&&(Sl[t]=oe.isFunction(n[t])?e=>e[t]():(e,r)=>{throw new We(`Response type '${t}' is not supported`,We.ERR_NOT_SUPPORT,r)})})})(new Response);const L4=async n=>{if(n==null)return 0;if(oe.isBlob(n))return n.size;if(oe.isSpecCompliantForm(n))return(await new Request(Jt.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(oe.isArrayBufferView(n)||oe.isArrayBuffer(n))return n.byteLength;if(oe.isURLSearchParams(n)&&(n=n+""),oe.isString(n))return(await O4(n)).byteLength},B4=async(n,t)=>{const e=oe.toFiniteNumber(n.getContentLength());return e??L4(t)},W4=Xl&&(async n=>{let{url:t,method:e,data:r,signal:o,cancelToken:i,timeout:s,onDownloadProgress:u,onUploadProgress:c,responseType:f,headers:d,withCredentials:p="same-origin",fetchOptions:v}=mx(n);f=f?(f+"").toLowerCase():"text";let g=D4([o,i&&i.toAbortSignal()],s),y;const b=g&&g.unsubscribe&&(()=>{g.unsubscribe()});let w;try{if(c&&M4&&e!=="get"&&e!=="head"&&(w=await B4(d,r))!==0){let R=new Request(t,{method:"POST",body:r,duplex:"half"}),N;if(oe.isFormData(r)&&(N=R.headers.get("content-type"))&&d.setContentType(N),R.body){const[P,F]=vy(w,_l(my(c)));r=yy(R.body,xy,P,F)}}oe.isString(p)||(p=p?"include":"omit");const C="credentials"in Request.prototype;y=new Request(t,{...v,signal:g,method:e.toUpperCase(),headers:d.normalize().toJSON(),body:r,duplex:"half",credentials:C?p:void 0});let _=await fetch(y,v);const S=Jd&&(f==="stream"||f==="response");if(Jd&&(u||S&&b)){const R={};["status","statusText","headers"].forEach(D=>{R[D]=_[D]});const N=oe.toFiniteNumber(_.headers.get("content-length")),[P,F]=u&&vy(N,_l(my(u),!0))||[];_=new Response(yy(_.body,xy,P,()=>{F&&F(),b&&b()}),R)}f=f||"text";let k=await Sl[oe.findKey(Sl,f)||"text"](_,n);return!S&&b&&b(),await new Promise((R,N)=>{px(R,N,{data:k,headers:gn.from(_.headers),status:_.status,statusText:_.statusText,config:n,request:y})})}catch(C){throw b&&b(),C&&C.name==="TypeError"&&/Load failed|fetch/i.test(C.message)?Object.assign(new We("Network Error",We.ERR_NETWORK,n,y),{cause:C.cause||C}):We.from(C,C&&C.code,n,y)}}),Zd={http:e4,xhr:T4,fetch:W4};oe.forEach(Zd,(n,t)=>{if(n){try{Object.defineProperty(n,"name",{value:t})}catch{}Object.defineProperty(n,"adapterName",{value:t})}});const wy=n=>`- ${n}`,z4=n=>oe.isFunction(n)||n===null||n===!1,xx={getAdapter:n=>{n=oe.isArray(n)?n:[n];const{length:t}=n;let e,r;const o={};for(let i=0;i<t;i++){e=n[i];let s;if(r=e,!z4(e)&&(r=Zd[(s=String(e)).toLowerCase()],r===void 0))throw new We(`Unknown adapter '${s}'`);if(r)break;o[s||"#"+i]=r}if(!r){const i=Object.entries(o).map(([u,c])=>`adapter ${u} `+(c===!1?"is not supported by the environment":"is not available in the build"));let s=t?i.length>1?`since :
`+i.map(wy).join(`
`):" "+wy(i[0]):"as no adapter specified";throw new We("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return r},adapters:Zd};function Ed(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new oa(null,n)}function by(n){return Ed(n),n.headers=gn.from(n.headers),n.data=Cd.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),xx.getAdapter(n.adapter||Cs.adapter)(n).then(function(r){return Ed(n),r.data=Cd.call(n,n.transformResponse,r),r.headers=gn.from(r.headers),r},function(r){return hx(r)||(Ed(n),r&&r.response&&(r.response.data=Cd.call(n,n.transformResponse,r.response),r.response.headers=gn.from(r.response.headers))),Promise.reject(r)})}const wx="1.11.0",Yl={};["object","boolean","number","function","string","symbol"].forEach((n,t)=>{Yl[n]=function(r){return typeof r===n||"a"+(t<1?"n ":" ")+n}});const Cy={};Yl.transitional=function(t,e,r){function o(i,s){return"[Axios v"+wx+"] Transitional option '"+i+"'"+s+(r?". "+r:"")}return(i,s,u)=>{if(t===!1)throw new We(o(s," has been removed"+(e?" in "+e:"")),We.ERR_DEPRECATED);return e&&!Cy[s]&&(Cy[s]=!0,console.warn(o(s," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(i,s,u):!0}};Yl.spelling=function(t){return(e,r)=>(console.warn(`${r} is likely a misspelling of ${t}`),!0)};function U4(n,t,e){if(typeof n!="object")throw new We("options must be an object",We.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let o=r.length;for(;o-- >0;){const i=r[o],s=t[i];if(s){const u=n[i],c=u===void 0||s(u,i,n);if(c!==!0)throw new We("option "+i+" must be "+c,We.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new We("Unknown option "+i,We.ERR_BAD_OPTION)}}const Ju={assertOptions:U4,validators:Yl},dr=Ju.validators;let Qo=class{constructor(t){this.defaults=t||{},this.interceptors={request:new hy,response:new hy}}async request(t,e){try{return await this._request(t,e)}catch(r){if(r instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const i=o.stack?o.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=ei(this.defaults,e);const{transitional:r,paramsSerializer:o,headers:i}=e;r!==void 0&&Ju.assertOptions(r,{silentJSONParsing:dr.transitional(dr.boolean),forcedJSONParsing:dr.transitional(dr.boolean),clarifyTimeoutError:dr.transitional(dr.boolean)},!1),o!=null&&(oe.isFunction(o)?e.paramsSerializer={serialize:o}:Ju.assertOptions(o,{encode:dr.function,serialize:dr.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),Ju.assertOptions(e,{baseUrl:dr.spelling("baseURL"),withXsrfToken:dr.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let s=i&&oe.merge(i.common,i[e.method]);i&&oe.forEach(["delete","get","head","post","put","patch","common"],y=>{delete i[y]}),e.headers=gn.concat(s,i);const u=[];let c=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(e)===!1||(c=c&&b.synchronous,u.unshift(b.fulfilled,b.rejected))});const f=[];this.interceptors.response.forEach(function(b){f.push(b.fulfilled,b.rejected)});let d,p=0,v;if(!c){const y=[by.bind(this),void 0];for(y.unshift(...u),y.push(...f),v=y.length,d=Promise.resolve(e);p<v;)d=d.then(y[p++],y[p++]);return d}v=u.length;let g=e;for(p=0;p<v;){const y=u[p++],b=u[p++];try{g=y(g)}catch(w){b.call(this,w);break}}try{d=by.call(this,g)}catch(y){return Promise.reject(y)}for(p=0,v=f.length;p<v;)d=d.then(f[p++],f[p++]);return d}getUri(t){t=ei(this.defaults,t);const e=vx(t.baseURL,t.url,t.allowAbsoluteUrls);return cx(e,t.params,t.paramsSerializer)}};oe.forEach(["delete","get","head","options"],function(t){Qo.prototype[t]=function(e,r){return this.request(ei(r||{},{method:t,url:e,data:(r||{}).data}))}});oe.forEach(["post","put","patch"],function(t){function e(r){return function(i,s,u){return this.request(ei(u||{},{method:t,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:s}))}}Qo.prototype[t]=e(),Qo.prototype[t+"Form"]=e(!0)});let V4=class bx{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(i){e=i});const r=this;this.promise.then(o=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](o);r._listeners=null}),this.promise.then=o=>{let i;const s=new Promise(u=>{r.subscribe(u),i=u}).then(o);return s.cancel=function(){r.unsubscribe(i)},s},t(function(i,s,u){r.reason||(r.reason=new oa(i,s,u),e(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=r=>{t.abort(r)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new bx(function(o){t=o}),cancel:t}}};function j4(n){return function(e){return n.apply(null,e)}}function H4(n){return oe.isObject(n)&&n.isAxiosError===!0}const eh={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(eh).forEach(([n,t])=>{eh[t]=n});function Cx(n){const t=new Qo(n),e=J1(Qo.prototype.request,t);return oe.extend(e,Qo.prototype,t,{allOwnKeys:!0}),oe.extend(e,t,null,{allOwnKeys:!0}),e.create=function(o){return Cx(ei(n,o))},e}const wt=Cx(Cs);wt.Axios=Qo;wt.CanceledError=oa;wt.CancelToken=V4;wt.isCancel=hx;wt.VERSION=wx;wt.toFormData=$l;wt.AxiosError=We;wt.Cancel=wt.CanceledError;wt.all=function(t){return Promise.all(t)};wt.spread=j4;wt.isAxiosError=H4;wt.mergeConfig=ei;wt.AxiosHeaders=gn;wt.formToJSON=n=>dx(oe.isHTMLForm(n)?new FormData(n):n);wt.getAdapter=xx.getAdapter;wt.HttpStatusCode=eh;wt.default=wt;const{Axios:OT,AxiosError:MT,CanceledError:LT,isCancel:BT,CancelToken:WT,VERSION:zT,all:UT,Cancel:VT,isAxiosError:jT,spread:HT,toFormData:GT,AxiosHeaders:qT,HttpStatusCode:KT,formToJSON:$T,getAdapter:XT,mergeConfig:YT}=wt;/**
 * react-router v7.8.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Ey="popstate";function G4(n={}){function t(r,o){let{pathname:i,search:s,hash:u}=r.location;return th("",{pathname:i,search:s,hash:u},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function e(r,o){return typeof o=="string"?o:us(o)}return K4(t,e,null,n)}function ht(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function Cr(n,t){if(!n){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function q4(){return Math.random().toString(36).substring(2,10)}function _y(n,t){return{usr:n.state,key:n.key,idx:t}}function th(n,t,e=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof t=="string"?ia(t):t,state:e,key:t&&t.key||r||q4()}}function us({pathname:n="/",search:t="",hash:e=""}){return t&&t!=="?"&&(n+=t.charAt(0)==="?"?t:"?"+t),e&&e!=="#"&&(n+=e.charAt(0)==="#"?e:"#"+e),n}function ia(n){let t={};if(n){let e=n.indexOf("#");e>=0&&(t.hash=n.substring(e),n=n.substring(0,e));let r=n.indexOf("?");r>=0&&(t.search=n.substring(r),n=n.substring(0,r)),n&&(t.pathname=n)}return t}function K4(n,t,e,r={}){let{window:o=document.defaultView,v5Compat:i=!1}=r,s=o.history,u="POP",c=null,f=d();f==null&&(f=0,s.replaceState({...s.state,idx:f},""));function d(){return(s.state||{idx:null}).idx}function p(){u="POP";let w=d(),C=w==null?null:w-f;f=w,c&&c({action:u,location:b.location,delta:C})}function v(w,C){u="PUSH";let _=th(b.location,w,C);f=d()+1;let S=_y(_,f),k=b.createHref(_);try{s.pushState(S,"",k)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;o.location.assign(k)}i&&c&&c({action:u,location:b.location,delta:1})}function g(w,C){u="REPLACE";let _=th(b.location,w,C);f=d();let S=_y(_,f),k=b.createHref(_);s.replaceState(S,"",k),i&&c&&c({action:u,location:b.location,delta:0})}function y(w){return $4(w)}let b={get action(){return u},get location(){return n(o,s)},listen(w){if(c)throw new Error("A history only accepts one active listener");return o.addEventListener(Ey,p),c=w,()=>{o.removeEventListener(Ey,p),c=null}},createHref(w){return t(o,w)},createURL:y,encodeLocation(w){let C=y(w);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:v,replace:g,go(w){return s.go(w)}};return b}function $4(n,t=!1){let e="http://localhost";typeof window<"u"&&(e=window.location.origin!=="null"?window.location.origin:window.location.href),ht(e,"No window.location.(origin|href) available to create URL");let r=typeof n=="string"?n:us(n);return r=r.replace(/ $/,"%20"),!t&&r.startsWith("//")&&(r=e+r),new URL(r,e)}function Ex(n,t,e="/"){return X4(n,t,e,!1)}function X4(n,t,e,r){let o=typeof t=="string"?ia(t):t,i=Ur(o.pathname||"/",e);if(i==null)return null;let s=_x(n);Y4(s);let u=null;for(let c=0;u==null&&c<s.length;++c){let f=sN(i);u=iN(s[c],f,r)}return u}function _x(n,t=[],e=[],r=""){let o=(i,s,u)=>{let c={relativePath:u===void 0?i.path||"":u,caseSensitive:i.caseSensitive===!0,childrenIndex:s,route:i};c.relativePath.startsWith("/")&&(ht(c.relativePath.startsWith(r),`Absolute route path "${c.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(r.length));let f=zr([r,c.relativePath]),d=e.concat(c);i.children&&i.children.length>0&&(ht(i.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),_x(i.children,t,d,f)),!(i.path==null&&!i.index)&&t.push({path:f,score:rN(f,i.index),routesMeta:d})};return n.forEach((i,s)=>{if(i.path===""||!i.path?.includes("?"))o(i,s);else for(let u of Sx(i.path))o(i,s,u)}),t}function Sx(n){let t=n.split("/");if(t.length===0)return[];let[e,...r]=t,o=e.endsWith("?"),i=e.replace(/\?$/,"");if(r.length===0)return o?[i,""]:[i];let s=Sx(r.join("/")),u=[];return u.push(...s.map(c=>c===""?i:[i,c].join("/"))),o&&u.push(...s),u.map(c=>n.startsWith("/")&&c===""?"/":c)}function Y4(n){n.sort((t,e)=>t.score!==e.score?e.score-t.score:oN(t.routesMeta.map(r=>r.childrenIndex),e.routesMeta.map(r=>r.childrenIndex)))}var Q4=/^:[\w-]+$/,J4=3,Z4=2,eN=1,tN=10,nN=-2,Sy=n=>n==="*";function rN(n,t){let e=n.split("/"),r=e.length;return e.some(Sy)&&(r+=nN),t&&(r+=Z4),e.filter(o=>!Sy(o)).reduce((o,i)=>o+(Q4.test(i)?J4:i===""?eN:tN),r)}function oN(n,t){return n.length===t.length&&n.slice(0,-1).every((r,o)=>r===t[o])?n[n.length-1]-t[t.length-1]:0}function iN(n,t,e=!1){let{routesMeta:r}=n,o={},i="/",s=[];for(let u=0;u<r.length;++u){let c=r[u],f=u===r.length-1,d=i==="/"?t:t.slice(i.length)||"/",p=kl({path:c.relativePath,caseSensitive:c.caseSensitive,end:f},d),v=c.route;if(!p&&f&&e&&!r[r.length-1].route.index&&(p=kl({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},d)),!p)return null;Object.assign(o,p.params),s.push({params:o,pathname:zr([i,p.pathname]),pathnameBase:fN(zr([i,p.pathnameBase])),route:v}),p.pathnameBase!=="/"&&(i=zr([i,p.pathnameBase]))}return s}function kl(n,t){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[e,r]=aN(n.path,n.caseSensitive,n.end),o=t.match(e);if(!o)return null;let i=o[0],s=i.replace(/(.)\/+$/,"$1"),u=o.slice(1);return{params:r.reduce((f,{paramName:d,isOptional:p},v)=>{if(d==="*"){let y=u[v]||"";s=i.slice(0,i.length-y.length).replace(/(.)\/+$/,"$1")}const g=u[v];return p&&!g?f[d]=void 0:f[d]=(g||"").replace(/%2F/g,"/"),f},{}),pathname:i,pathnameBase:s,pattern:n}}function aN(n,t=!1,e=!0){Cr(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],o="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,u,c)=>(r.push({paramName:u,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),o+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):e?o+="\\/*$":n!==""&&n!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),r]}function sN(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Cr(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),n}}function Ur(n,t){if(t==="/")return n;if(!n.toLowerCase().startsWith(t.toLowerCase()))return null;let e=t.endsWith("/")?t.length-1:t.length,r=n.charAt(e);return r&&r!=="/"?null:n.slice(e)||"/"}function uN(n,t="/"){let{pathname:e,search:r="",hash:o=""}=typeof n=="string"?ia(n):n;return{pathname:e?e.startsWith("/")?e:lN(e,t):t,search:dN(r),hash:hN(o)}}function lN(n,t){let e=t.replace(/\/+$/,"").split("/");return n.split("/").forEach(o=>{o===".."?e.length>1&&e.pop():o!=="."&&e.push(o)}),e.length>1?e.join("/"):"/"}function _d(n,t,e,r){return`Cannot include a '${n}' character in a manually specified \`to.${t}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${e}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function cN(n){return n.filter((t,e)=>e===0||t.route.path&&t.route.path.length>0)}function kx(n){let t=cN(n);return t.map((e,r)=>r===t.length-1?e.pathname:e.pathnameBase)}function Rx(n,t,e,r=!1){let o;typeof n=="string"?o=ia(n):(o={...n},ht(!o.pathname||!o.pathname.includes("?"),_d("?","pathname","search",o)),ht(!o.pathname||!o.pathname.includes("#"),_d("#","pathname","hash",o)),ht(!o.search||!o.search.includes("#"),_d("#","search","hash",o)));let i=n===""||o.pathname==="",s=i?"/":o.pathname,u;if(s==null)u=e;else{let p=t.length-1;if(!r&&s.startsWith("..")){let v=s.split("/");for(;v[0]==="..";)v.shift(),p-=1;o.pathname=v.join("/")}u=p>=0?t[p]:"/"}let c=uN(o,u),f=s&&s!=="/"&&s.endsWith("/"),d=(i||s===".")&&e.endsWith("/");return!c.pathname.endsWith("/")&&(f||d)&&(c.pathname+="/"),c}var zr=n=>n.join("/").replace(/\/\/+/g,"/"),fN=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),dN=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,hN=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function pN(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var Ix=["POST","PUT","PATCH","DELETE"];new Set(Ix);var vN=["GET",...Ix];new Set(vN);var aa=ie.createContext(null);aa.displayName="DataRouter";var Ql=ie.createContext(null);Ql.displayName="DataRouterState";ie.createContext(!1);var Nx=ie.createContext({isTransitioning:!1});Nx.displayName="ViewTransition";var mN=ie.createContext(new Map);mN.displayName="Fetchers";var gN=ie.createContext(null);gN.displayName="Await";var Rr=ie.createContext(null);Rr.displayName="Navigation";var Es=ie.createContext(null);Es.displayName="Location";var $r=ie.createContext({outlet:null,matches:[],isDataRoute:!1});$r.displayName="Route";var fp=ie.createContext(null);fp.displayName="RouteError";function yN(n,{relative:t}={}){ht(_s(),"useHref() may be used only in the context of a <Router> component.");let{basename:e,navigator:r}=ie.useContext(Rr),{hash:o,pathname:i,search:s}=Ss(n,{relative:t}),u=i;return e!=="/"&&(u=i==="/"?e:zr([e,i])),r.createHref({pathname:u,search:s,hash:o})}function _s(){return ie.useContext(Es)!=null}function ai(){return ht(_s(),"useLocation() may be used only in the context of a <Router> component."),ie.useContext(Es).location}var Tx="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Dx(n){ie.useContext(Rr).static||ie.useLayoutEffect(n)}function dp(){let{isDataRoute:n}=ie.useContext($r);return n?DN():xN()}function xN(){ht(_s(),"useNavigate() may be used only in the context of a <Router> component.");let n=ie.useContext(aa),{basename:t,navigator:e}=ie.useContext(Rr),{matches:r}=ie.useContext($r),{pathname:o}=ai(),i=JSON.stringify(kx(r)),s=ie.useRef(!1);return Dx(()=>{s.current=!0}),ie.useCallback((c,f={})=>{if(Cr(s.current,Tx),!s.current)return;if(typeof c=="number"){e.go(c);return}let d=Rx(c,JSON.parse(i),o,f.relative==="path");n==null&&t!=="/"&&(d.pathname=d.pathname==="/"?t:zr([t,d.pathname])),(f.replace?e.replace:e.push)(d,f.state,f)},[t,e,i,o,n])}ie.createContext(null);function Ss(n,{relative:t}={}){let{matches:e}=ie.useContext($r),{pathname:r}=ai(),o=JSON.stringify(kx(e));return ie.useMemo(()=>Rx(n,JSON.parse(o),r,t==="path"),[n,o,r,t])}function wN(n,t){return Ax(n,t)}function Ax(n,t,e,r){ht(_s(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=ie.useContext(Rr),{matches:i}=ie.useContext($r),s=i[i.length-1],u=s?s.params:{},c=s?s.pathname:"/",f=s?s.pathnameBase:"/",d=s&&s.route;{let C=d&&d.path||"";Px(c,!d||C.endsWith("*")||C.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${C}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${C}"> to <Route path="${C==="/"?"*":`${C}/*`}">.`)}let p=ai(),v;if(t){let C=typeof t=="string"?ia(t):t;ht(f==="/"||C.pathname?.startsWith(f),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${C.pathname}" was given in the \`location\` prop.`),v=C}else v=p;let g=v.pathname||"/",y=g;if(f!=="/"){let C=f.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(C.length).join("/")}let b=Ex(n,{pathname:y});Cr(d||b!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),Cr(b==null||b[b.length-1].route.element!==void 0||b[b.length-1].route.Component!==void 0||b[b.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let w=SN(b&&b.map(C=>Object.assign({},C,{params:Object.assign({},u,C.params),pathname:zr([f,o.encodeLocation?o.encodeLocation(C.pathname).pathname:C.pathname]),pathnameBase:C.pathnameBase==="/"?f:zr([f,o.encodeLocation?o.encodeLocation(C.pathnameBase).pathname:C.pathnameBase])})),i,e,r);return t&&w?ie.createElement(Es.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},w):w}function bN(){let n=TN(),t=pN(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),e=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},s=null;return console.error("Error handled by React Router default ErrorBoundary:",n),s=ie.createElement(ie.Fragment,null,ie.createElement("p",null,"💿 Hey developer 👋"),ie.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ie.createElement("code",{style:i},"ErrorBoundary")," or"," ",ie.createElement("code",{style:i},"errorElement")," prop on your route.")),ie.createElement(ie.Fragment,null,ie.createElement("h2",null,"Unexpected Application Error!"),ie.createElement("h3",{style:{fontStyle:"italic"}},t),e?ie.createElement("pre",{style:o},e):null,s)}var CN=ie.createElement(bN,null),EN=class extends ie.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,t){return t.location!==n.location||t.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:t.error,location:t.location,revalidation:n.revalidation||t.revalidation}}componentDidCatch(n,t){console.error("React Router caught the following error during render",n,t)}render(){return this.state.error!==void 0?ie.createElement($r.Provider,{value:this.props.routeContext},ie.createElement(fp.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function _N({routeContext:n,match:t,children:e}){let r=ie.useContext(aa);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),ie.createElement($r.Provider,{value:n},e)}function SN(n,t=[],e=null,r=null){if(n==null){if(!e)return null;if(e.errors)n=e.matches;else if(t.length===0&&!e.initialized&&e.matches.length>0)n=e.matches;else return null}let o=n,i=e?.errors;if(i!=null){let c=o.findIndex(f=>f.route.id&&i?.[f.route.id]!==void 0);ht(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(i).join(",")}`),o=o.slice(0,Math.min(o.length,c+1))}let s=!1,u=-1;if(e)for(let c=0;c<o.length;c++){let f=o[c];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=c),f.route.id){let{loaderData:d,errors:p}=e,v=f.route.loader&&!d.hasOwnProperty(f.route.id)&&(!p||p[f.route.id]===void 0);if(f.route.lazy||v){s=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((c,f,d)=>{let p,v=!1,g=null,y=null;e&&(p=i&&f.route.id?i[f.route.id]:void 0,g=f.route.errorElement||CN,s&&(u<0&&d===0?(Px("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,y=null):u===d&&(v=!0,y=f.route.hydrateFallbackElement||null)));let b=t.concat(o.slice(0,d+1)),w=()=>{let C;return p?C=g:v?C=y:f.route.Component?C=ie.createElement(f.route.Component,null):f.route.element?C=f.route.element:C=c,ie.createElement(_N,{match:f,routeContext:{outlet:c,matches:b,isDataRoute:e!=null},children:C})};return e&&(f.route.ErrorBoundary||f.route.errorElement||d===0)?ie.createElement(EN,{location:e.location,revalidation:e.revalidation,component:g,error:p,children:w(),routeContext:{outlet:null,matches:b,isDataRoute:!0}}):w()},null)}function hp(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function kN(n){let t=ie.useContext(aa);return ht(t,hp(n)),t}function RN(n){let t=ie.useContext(Ql);return ht(t,hp(n)),t}function IN(n){let t=ie.useContext($r);return ht(t,hp(n)),t}function pp(n){let t=IN(n),e=t.matches[t.matches.length-1];return ht(e.route.id,`${n} can only be used on routes that contain a unique "id"`),e.route.id}function NN(){return pp("useRouteId")}function TN(){let n=ie.useContext(fp),t=RN("useRouteError"),e=pp("useRouteError");return n!==void 0?n:t.errors?.[e]}function DN(){let{router:n}=kN("useNavigate"),t=pp("useNavigate"),e=ie.useRef(!1);return Dx(()=>{e.current=!0}),ie.useCallback(async(o,i={})=>{Cr(e.current,Tx),e.current&&(typeof o=="number"?n.navigate(o):await n.navigate(o,{fromRouteId:t,...i}))},[n,t])}var ky={};function Px(n,t,e){!t&&!ky[n]&&(ky[n]=!0,Cr(!1,e))}ie.memo(AN);function AN({routes:n,future:t,state:e}){return Ax(n,void 0,e,t)}function nh(n){ht(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function PN({basename:n="/",children:t=null,location:e,navigationType:r="POP",navigator:o,static:i=!1}){ht(!_s(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let s=n.replace(/^\/*/,"/"),u=ie.useMemo(()=>({basename:s,navigator:o,static:i,future:{}}),[s,o,i]);typeof e=="string"&&(e=ia(e));let{pathname:c="/",search:f="",hash:d="",state:p=null,key:v="default"}=e,g=ie.useMemo(()=>{let y=Ur(c,s);return y==null?null:{location:{pathname:y,search:f,hash:d,state:p,key:v},navigationType:r}},[s,c,f,d,p,v,r]);return Cr(g!=null,`<Router basename="${s}"> is not able to match the URL "${c}${f}${d}" because it does not start with the basename, so the <Router> won't render anything.`),g==null?null:ie.createElement(Rr.Provider,{value:u},ie.createElement(Es.Provider,{children:t,value:g}))}function FN({children:n,location:t}){return wN(rh(n),t)}function rh(n,t=[]){let e=[];return ie.Children.forEach(n,(r,o)=>{if(!ie.isValidElement(r))return;let i=[...t,o];if(r.type===ie.Fragment){e.push.apply(e,rh(r.props.children,i));return}ht(r.type===nh,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ht(!r.props.index||!r.props.children,"An index route cannot have child routes.");let s={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(s.children=rh(r.props.children,i)),e.push(s)}),e}var Zu="get",el="application/x-www-form-urlencoded";function Jl(n){return n!=null&&typeof n.tagName=="string"}function ON(n){return Jl(n)&&n.tagName.toLowerCase()==="button"}function MN(n){return Jl(n)&&n.tagName.toLowerCase()==="form"}function LN(n){return Jl(n)&&n.tagName.toLowerCase()==="input"}function BN(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function WN(n,t){return n.button===0&&(!t||t==="_self")&&!BN(n)}var $u=null;function zN(){if($u===null)try{new FormData(document.createElement("form"),0),$u=!1}catch{$u=!0}return $u}var UN=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Sd(n){return n!=null&&!UN.has(n)?(Cr(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${el}"`),null):n}function VN(n,t){let e,r,o,i,s;if(MN(n)){let u=n.getAttribute("action");r=u?Ur(u,t):null,e=n.getAttribute("method")||Zu,o=Sd(n.getAttribute("enctype"))||el,i=new FormData(n)}else if(ON(n)||LN(n)&&(n.type==="submit"||n.type==="image")){let u=n.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=n.getAttribute("formaction")||u.getAttribute("action");if(r=c?Ur(c,t):null,e=n.getAttribute("formmethod")||u.getAttribute("method")||Zu,o=Sd(n.getAttribute("formenctype"))||Sd(u.getAttribute("enctype"))||el,i=new FormData(u,n),!zN()){let{name:f,type:d,value:p}=n;if(d==="image"){let v=f?`${f}.`:"";i.append(`${v}x`,"0"),i.append(`${v}y`,"0")}else f&&i.append(f,p)}}else{if(Jl(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');e=Zu,r=null,o=el,s=n}return i&&o==="text/plain"&&(s=i,i=void 0),{action:r,method:e.toLowerCase(),encType:o,formData:i,body:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function vp(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function jN(n,t,e){let r=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return r.pathname==="/"?r.pathname=`_root.${e}`:t&&Ur(r.pathname,t)==="/"?r.pathname=`${t.replace(/\/$/,"")}/_root.${e}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${e}`,r}async function HN(n,t){if(n.id in t)return t[n.id];try{let e=await import(n.module);return t[n.id]=e,e}catch(e){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(e),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function GN(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function qN(n,t,e){let r=await Promise.all(n.map(async o=>{let i=t.routes[o.route.id];if(i){let s=await HN(i,e);return s.links?s.links():[]}return[]}));return YN(r.flat(1).filter(GN).filter(o=>o.rel==="stylesheet"||o.rel==="preload").map(o=>o.rel==="stylesheet"?{...o,rel:"prefetch",as:"style"}:{...o,rel:"prefetch"}))}function Ry(n,t,e,r,o,i){let s=(c,f)=>e[f]?c.route.id!==e[f].route.id:!0,u=(c,f)=>e[f].pathname!==c.pathname||e[f].route.path?.endsWith("*")&&e[f].params["*"]!==c.params["*"];return i==="assets"?t.filter((c,f)=>s(c,f)||u(c,f)):i==="data"?t.filter((c,f)=>{let d=r.routes[c.route.id];if(!d||!d.hasLoader)return!1;if(s(c,f)||u(c,f))return!0;if(c.route.shouldRevalidate){let p=c.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:e[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function KN(n,t,{includeHydrateFallback:e}={}){return $N(n.map(r=>{let o=t.routes[r.route.id];if(!o)return[];let i=[o.module];return o.clientActionModule&&(i=i.concat(o.clientActionModule)),o.clientLoaderModule&&(i=i.concat(o.clientLoaderModule)),e&&o.hydrateFallbackModule&&(i=i.concat(o.hydrateFallbackModule)),o.imports&&(i=i.concat(o.imports)),i}).flat(1))}function $N(n){return[...new Set(n)]}function XN(n){let t={},e=Object.keys(n).sort();for(let r of e)t[r]=n[r];return t}function YN(n,t){let e=new Set;return new Set(t),n.reduce((r,o)=>{let i=JSON.stringify(XN(o));return e.has(i)||(e.add(i),r.push({key:i,link:o})),r},[])}function Fx(){let n=ie.useContext(aa);return vp(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function QN(){let n=ie.useContext(Ql);return vp(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var mp=ie.createContext(void 0);mp.displayName="FrameworkContext";function Ox(){let n=ie.useContext(mp);return vp(n,"You must render this element inside a <HydratedRouter> element"),n}function JN(n,t){let e=ie.useContext(mp),[r,o]=ie.useState(!1),[i,s]=ie.useState(!1),{onFocus:u,onBlur:c,onMouseEnter:f,onMouseLeave:d,onTouchStart:p}=t,v=ie.useRef(null);ie.useEffect(()=>{if(n==="render"&&s(!0),n==="viewport"){let b=C=>{C.forEach(_=>{s(_.isIntersecting)})},w=new IntersectionObserver(b,{threshold:.5});return v.current&&w.observe(v.current),()=>{w.disconnect()}}},[n]),ie.useEffect(()=>{if(r){let b=setTimeout(()=>{s(!0)},100);return()=>{clearTimeout(b)}}},[r]);let g=()=>{o(!0)},y=()=>{o(!1),s(!1)};return e?n!=="intent"?[i,v,{}]:[i,v,{onFocus:Ya(u,g),onBlur:Ya(c,y),onMouseEnter:Ya(f,g),onMouseLeave:Ya(d,y),onTouchStart:Ya(p,g)}]:[!1,v,{}]}function Ya(n,t){return e=>{n&&n(e),e.defaultPrevented||t(e)}}function ZN({page:n,...t}){let{router:e}=Fx(),r=ie.useMemo(()=>Ex(e.routes,n,e.basename),[e.routes,n,e.basename]);return r?ie.createElement(tT,{page:n,matches:r,...t}):null}function eT(n){let{manifest:t,routeModules:e}=Ox(),[r,o]=ie.useState([]);return ie.useEffect(()=>{let i=!1;return qN(n,t,e).then(s=>{i||o(s)}),()=>{i=!0}},[n,t,e]),r}function tT({page:n,matches:t,...e}){let r=ai(),{manifest:o,routeModules:i}=Ox(),{basename:s}=Fx(),{loaderData:u,matches:c}=QN(),f=ie.useMemo(()=>Ry(n,t,c,o,r,"data"),[n,t,c,o,r]),d=ie.useMemo(()=>Ry(n,t,c,o,r,"assets"),[n,t,c,o,r]),p=ie.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let y=new Set,b=!1;if(t.forEach(C=>{let _=o.routes[C.route.id];!_||!_.hasLoader||(!f.some(S=>S.route.id===C.route.id)&&C.route.id in u&&i[C.route.id]?.shouldRevalidate||_.hasClientLoader?b=!0:y.add(C.route.id))}),y.size===0)return[];let w=jN(n,s,"data");return b&&y.size>0&&w.searchParams.set("_routes",t.filter(C=>y.has(C.route.id)).map(C=>C.route.id).join(",")),[w.pathname+w.search]},[s,u,r,o,f,t,n,i]),v=ie.useMemo(()=>KN(d,o),[d,o]),g=eT(d);return ie.createElement(ie.Fragment,null,p.map(y=>ie.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...e})),v.map(y=>ie.createElement("link",{key:y,rel:"modulepreload",href:y,...e})),g.map(({key:y,link:b})=>ie.createElement("link",{key:y,nonce:e.nonce,...b})))}function nT(...n){return t=>{n.forEach(e=>{typeof e=="function"?e(t):e!=null&&(e.current=t)})}}var Mx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Mx&&(window.__reactRouterVersion="7.8.0")}catch{}function rT({basename:n,children:t,window:e}){let r=ie.useRef();r.current==null&&(r.current=G4({window:e,v5Compat:!0}));let o=r.current,[i,s]=ie.useState({action:o.action,location:o.location}),u=ie.useCallback(c=>{ie.startTransition(()=>s(c))},[s]);return ie.useLayoutEffect(()=>o.listen(u),[o,u]),ie.createElement(PN,{basename:n,children:t,location:i.location,navigationType:i.action,navigator:o})}var Lx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Bx=ie.forwardRef(function({onClick:t,discover:e="render",prefetch:r="none",relative:o,reloadDocument:i,replace:s,state:u,target:c,to:f,preventScrollReset:d,viewTransition:p,...v},g){let{basename:y}=ie.useContext(Rr),b=typeof f=="string"&&Lx.test(f),w,C=!1;if(typeof f=="string"&&b&&(w=f,Mx))try{let D=new URL(window.location.href),A=f.startsWith("//")?new URL(D.protocol+f):new URL(f),V=Ur(A.pathname,y);A.origin===D.origin&&V!=null?f=V+A.search+A.hash:C=!0}catch{Cr(!1,`<Link to="${f}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let _=yN(f,{relative:o}),[S,k,R]=JN(r,v),N=sT(f,{replace:s,state:u,target:c,preventScrollReset:d,relative:o,viewTransition:p});function P(D){t&&t(D),D.defaultPrevented||N(D)}let F=ie.createElement("a",{...v,...R,href:w||_,onClick:C||i?t:P,ref:nT(g,k),target:c,"data-discover":!b&&e==="render"?"true":void 0});return S&&!b?ie.createElement(ie.Fragment,null,F,ie.createElement(ZN,{page:_})):F});Bx.displayName="Link";var oT=ie.forwardRef(function({"aria-current":t="page",caseSensitive:e=!1,className:r="",end:o=!1,style:i,to:s,viewTransition:u,children:c,...f},d){let p=Ss(s,{relative:f.relative}),v=ai(),g=ie.useContext(Ql),{navigator:y,basename:b}=ie.useContext(Rr),w=g!=null&&dT(p)&&u===!0,C=y.encodeLocation?y.encodeLocation(p).pathname:p.pathname,_=v.pathname,S=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;e||(_=_.toLowerCase(),S=S?S.toLowerCase():null,C=C.toLowerCase()),S&&b&&(S=Ur(S,b)||S);const k=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let R=_===C||!o&&_.startsWith(C)&&_.charAt(k)==="/",N=S!=null&&(S===C||!o&&S.startsWith(C)&&S.charAt(C.length)==="/"),P={isActive:R,isPending:N,isTransitioning:w},F=R?t:void 0,D;typeof r=="function"?D=r(P):D=[r,R?"active":null,N?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let A=typeof i=="function"?i(P):i;return ie.createElement(Bx,{...f,"aria-current":F,className:D,ref:d,style:A,to:s,viewTransition:u},typeof c=="function"?c(P):c)});oT.displayName="NavLink";var iT=ie.forwardRef(({discover:n="render",fetcherKey:t,navigate:e,reloadDocument:r,replace:o,state:i,method:s=Zu,action:u,onSubmit:c,relative:f,preventScrollReset:d,viewTransition:p,...v},g)=>{let y=cT(),b=fT(u,{relative:f}),w=s.toLowerCase()==="get"?"get":"post",C=typeof u=="string"&&Lx.test(u),_=S=>{if(c&&c(S),S.defaultPrevented)return;S.preventDefault();let k=S.nativeEvent.submitter,R=k?.getAttribute("formmethod")||s;y(k||S.currentTarget,{fetcherKey:t,method:R,navigate:e,replace:o,state:i,relative:f,preventScrollReset:d,viewTransition:p})};return ie.createElement("form",{ref:g,method:w,action:b,onSubmit:r?c:_,...v,"data-discover":!C&&n==="render"?"true":void 0})});iT.displayName="Form";function aT(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Wx(n){let t=ie.useContext(aa);return ht(t,aT(n)),t}function sT(n,{target:t,replace:e,state:r,preventScrollReset:o,relative:i,viewTransition:s}={}){let u=dp(),c=ai(),f=Ss(n,{relative:i});return ie.useCallback(d=>{if(WN(d,t)){d.preventDefault();let p=e!==void 0?e:us(c)===us(f);u(n,{replace:p,state:r,preventScrollReset:o,relative:i,viewTransition:s})}},[c,u,f,e,r,t,n,o,i,s])}var uT=0,lT=()=>`__${String(++uT)}__`;function cT(){let{router:n}=Wx("useSubmit"),{basename:t}=ie.useContext(Rr),e=NN();return ie.useCallback(async(r,o={})=>{let{action:i,method:s,encType:u,formData:c,body:f}=VN(r,t);if(o.navigate===!1){let d=o.fetcherKey||lT();await n.fetch(d,e,o.action||i,{preventScrollReset:o.preventScrollReset,formData:c,body:f,formMethod:o.method||s,formEncType:o.encType||u,flushSync:o.flushSync})}else await n.navigate(o.action||i,{preventScrollReset:o.preventScrollReset,formData:c,body:f,formMethod:o.method||s,formEncType:o.encType||u,replace:o.replace,state:o.state,fromRouteId:e,flushSync:o.flushSync,viewTransition:o.viewTransition})},[n,t,e])}function fT(n,{relative:t}={}){let{basename:e}=ie.useContext(Rr),r=ie.useContext($r);ht(r,"useFormAction must be used inside a RouteContext");let[o]=r.matches.slice(-1),i={...Ss(n||".",{relative:t})},s=ai();if(n==null){i.search=s.search;let u=new URLSearchParams(i.search),c=u.getAll("index");if(c.some(d=>d==="")){u.delete("index"),c.filter(p=>p).forEach(p=>u.append("index",p));let d=u.toString();i.search=d?`?${d}`:""}}return(!n||n===".")&&o.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),e!=="/"&&(i.pathname=i.pathname==="/"?e:zr([e,i.pathname])),us(i)}function dT(n,{relative:t}={}){let e=ie.useContext(Nx);ht(e!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=Wx("useViewTransitionState"),o=Ss(n,{relative:t});if(!e.isTransitioning)return!1;let i=Ur(e.currentLocation.pathname,r)||e.currentLocation.pathname,s=Ur(e.nextLocation.pathname,r)||e.nextLocation.pathname;return kl(o.pathname,s)!=null||kl(o.pathname,i)!=null}function hT({setSongs:n}){const t=ie.useRef(),e=dp(),r=async()=>{const s="/models";await pn.tinyFaceDetector.loadFromUri(s),await pn.faceExpressionNet.loadFromUri(s)},o=()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(s=>{t.current.srcObject=s}).catch(s=>console.error("Error accessing webcam: ",s))};async function i(){const s=await hI(t.current,new j1).withFaceExpressions();let u=0,c="";if(!s||s.length===0){console.log("No face detected");return}for(const f of Object.keys(s[0].expressions))s[0].expressions[f]>u&&(u=s[0].expressions[f],c=f);console.log(c),await wt.get(`http://localhost:3000/api/songs?mood=${c}`).then(f=>{console.log(f.data),n(f.data.songs),e("/Songs")})}return ie.useEffect(()=>{r().then(o)},[]),se.jsxs("div",{className:"moody-player-container",children:[se.jsxs("div",{className:"background-animation",children:[se.jsxs("div",{className:"floating-shapes",children:[se.jsx("div",{className:"shape shape-1"}),se.jsx("div",{className:"shape shape-2"}),se.jsx("div",{className:"shape shape-3"}),se.jsx("div",{className:"shape shape-4"}),se.jsx("div",{className:"shape shape-5"}),se.jsx("div",{className:"shape shape-6"})]}),se.jsxs("div",{className:"gradient-orbs",children:[se.jsx("div",{className:"orb orb-1"}),se.jsx("div",{className:"orb orb-2"}),se.jsx("div",{className:"orb orb-3"})]})]}),se.jsxs("header",{className:"moody-header",children:[se.jsxs("div",{className:"logo-container",children:[se.jsx("div",{className:"logo-icon",children:"🎵"}),se.jsx("h1",{className:"site-title",children:"Moody Player"})]}),se.jsx("p",{className:"tagline",children:"AI-Powered Music That Matches Your Vibe"})]}),se.jsxs("main",{className:"hero-content",children:[se.jsxs("section",{className:"intro-section",children:[se.jsxs("h2",{className:"hero-title",children:["Your Face, Your ",se.jsx("span",{className:"gradient-text",children:"Mood"}),", Your Music"]}),se.jsx("p",{className:"hero-description",children:"Experience the magic of AI-driven music curation. Our advanced facial recognition technology analyzes your emotions in real-time and curates the perfect playlist to match your current mood. Whether you're happy, sad, excited, or relaxed - we've got the soundtrack for your life."})]}),se.jsxs("div",{className:"mood-element",children:[se.jsxs("div",{className:"video-container",children:[se.jsx("video",{ref:t,autoPlay:!0,muted:!0,className:"user-video-feed",style:{transform:"scaleX(-1)"}}),se.jsx("div",{className:"video-overlay",children:se.jsx("div",{className:"scanning-line"})})]}),se.jsxs("div",{className:"detection-panel",children:[se.jsx("h3",{className:"panel-title",children:"Ready to Discover Your Vibe?"}),se.jsx("p",{className:"panel-description",children:"Position your face in the camera frame and let our AI analyze your expression. In seconds, you'll have a personalized playlist that perfectly matches your mood!"}),se.jsxs("button",{onClick:i,className:"detect-button",children:[se.jsx("span",{className:"button-icon",children:"🎭"}),"Detect My Mood",se.jsx("span",{className:"button-sparkle",children:"✨"})]}),se.jsxs("div",{className:"mood-indicators",children:[se.jsx("div",{className:"mood-chip",children:"😊 Happy"}),se.jsx("div",{className:"mood-chip",children:"😢 Sad"}),se.jsx("div",{className:"mood-chip",children:"😤 Angry"}),se.jsx("div",{className:"mood-chip",children:"😮 Surprised"}),se.jsx("div",{className:"mood-chip",children:"😰 Fearful"}),se.jsx("div",{className:"mood-chip",children:"🤢 Disgusted"}),se.jsx("div",{className:"mood-chip",children:"😐 Neutral"})]})]})]})]}),se.jsx("footer",{className:"moody-footer",children:se.jsx("p",{children:"© 2025 Moody Player - Where Emotions Meet Music"})})]})}var zx={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Iy=Xo.createContext&&Xo.createContext(zx),pT=["attr","size","title"];function vT(n,t){if(n==null)return{};var e=mT(n,t),r,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(o=0;o<i.length;o++)r=i[o],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(e[r]=n[r])}return e}function mT(n,t){if(n==null)return{};var e={};for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){if(t.indexOf(r)>=0)continue;e[r]=n[r]}return e}function Rl(){return Rl=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},Rl.apply(this,arguments)}function Ny(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),e.push.apply(e,r)}return e}function Il(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Ny(Object(e),!0).forEach(function(r){gT(n,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Ny(Object(e)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(e,r))})}return n}function gT(n,t,e){return t=yT(t),t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function yT(n){var t=xT(n,"string");return typeof t=="symbol"?t:t+""}function xT(n,t){if(typeof n!="object"||!n)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var r=e.call(n,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function Ux(n){return n&&n.map((t,e)=>Xo.createElement(t.tag,Il({key:e},t.attr),Ux(t.child)))}function Gn(n){return t=>Xo.createElement(wT,Rl({attr:Il({},n.attr)},t),Ux(n.child))}function wT(n){var t=e=>{var{attr:r,size:o,title:i}=n,s=vT(n,pT),u=o||e.size||"1em",c;return e.className&&(c=e.className),n.className&&(c=(c?c+" ":"")+n.className),Xo.createElement("svg",Rl({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},e.attr,r,s,{className:c,style:Il(Il({color:n.color||e.color},e.style),n.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),i&&Xo.createElement("title",null,i),n.children)};return Iy!==void 0?Xo.createElement(Iy.Consumer,null,e=>t(e)):t(zx)}function bT(n){return Gn({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(n)}function Ty(n){return Gn({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(n)}function Dy(n){return Gn({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"},child:[]}]})(n)}function Ay(n){return Gn({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"},child:[]}]})(n)}function CT(n){return Gn({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504.971 359.029c9.373 9.373 9.373 24.569 0 33.941l-80 79.984c-15.01 15.01-40.971 4.49-40.971-16.971V416h-58.785a12.004 12.004 0 0 1-8.773-3.812l-70.556-75.596 53.333-57.143L352 336h32v-39.981c0-21.438 25.943-31.998 40.971-16.971l80 79.981zM12 176h84l52.781 56.551 53.333-57.143-70.556-75.596A11.999 11.999 0 0 0 122.785 96H12c-6.627 0-12 5.373-12 12v56c0 6.627 5.373 12 12 12zm372 0v39.984c0 21.46 25.961 31.98 40.971 16.971l80-79.984c9.373-9.373 9.373-24.569 0-33.941l-80-79.981C409.943 24.021 384 34.582 384 56.019V96h-58.785a12.004 12.004 0 0 0-8.773 3.812L96 336H12c-6.627 0-12 5.373-12 12v56c0 6.627 5.373 12 12 12h110.785c3.326 0 6.503-1.381 8.773-3.812L352 176h32z"},child:[]}]})(n)}function ET(n){return Gn({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M500.33 0h-47.41a12 12 0 0 0-12 12.57l4 82.76A247.42 247.42 0 0 0 256 8C119.34 8 7.9 119.53 8 256.19 8.1 393.07 119.1 504 256 504a247.1 247.1 0 0 0 166.18-63.91 12 12 0 0 0 .48-17.43l-34-34a12 12 0 0 0-16.38-.55A176 176 0 1 1 402.1 157.8l-101.53-4.87a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12h200.33a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12z"},child:[]}]})(n)}function _T(n){return Gn({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"},child:[]}]})(n)}function ST(n){return Gn({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"},child:[]}]})(n)}function kT(n){return Gn({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M215.03 72.04L126.06 161H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V89.02c0-21.47-25.96-31.98-40.97-16.98zm123.2 108.08c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 229.28 336 242.62 336 257c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.87z"},child:[]}]})(n)}function RT(n){return Gn({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"},child:[]}]})(n)}function IT(n){return Gn({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"},child:[]}]})(n)}function Py(n){return Gn({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"},child:[]}]})(n)}const NT=({Songs:n})=>{ie.useEffect(()=>{navigator.mediaDevices.getUserMedia({video:!1})},[]);const[t,e]=ie.useState(0),[r,o]=ie.useState(!1),[i,s]=ie.useState(0),[u,c]=ie.useState(0),[f,d]=ie.useState(.7),[p,v]=ie.useState(!1),[g,y]=ie.useState(!1),[b,w]=ie.useState(new Set),[C,_]=ie.useState(!1),S=ie.useRef(null),k=dp();ie.useEffect(()=>{S.current&&(S.current.volume=f)},[f]),ie.useEffect(()=>{const G=S.current;if(!G)return;const q=()=>s(G.currentTime),W=()=>c(G.duration);return G.addEventListener("timeupdate",q),G.addEventListener("loadedmetadata",W),G.addEventListener("ended",N),()=>{G.removeEventListener("timeupdate",q),G.removeEventListener("loadedmetadata",W),G.removeEventListener("ended",N)}},[t]);const R=()=>{const G=S.current;G&&(r?(G.pause(),o(!1)):(G.load(),G.play().then(()=>{o(!0)}).catch(q=>{console.error("Error playing audio:",q),o(!1)})))},N=()=>{if(g){const G=S.current;G&&(G.currentTime=0,G.play().catch(q=>{console.error("Error repeating song:",q)}))}else P()},P=()=>{let G;p?G=Math.floor(Math.random()*n.length):G=(t+1)%n.length,e(G),s(0),o(!1),setTimeout(()=>{const q=S.current;q&&n[G]?.audio&&(q.load(),q.play().then(()=>{o(!0)}).catch(W=>{console.error("Error playing next song:",W)}))},100)},F=()=>{let G;p?G=Math.floor(Math.random()*n.length):G=t===0?n.length-1:t-1,e(G),s(0),o(!1),setTimeout(()=>{const q=S.current;q&&n[G]?.audio&&(q.load(),q.play().then(()=>{o(!0)}).catch(W=>{console.error("Error playing previous song:",W)}))},100)},D=G=>{const q=S.current;if(!q)return;const W=G.nativeEvent.offsetX,Y=G.target.offsetWidth,K=W/Y*u;q.currentTime=K,s(K)},A=G=>{const q=parseFloat(G.target.value);d(q),S.current&&(S.current.volume=q)},V=G=>{const q=new Set(b);q.has(G)?q.delete(G):q.add(G),w(q)},U=G=>{e(G),s(0),setTimeout(()=>{const q=S.current;q&&n[G]?.audio&&(q.load(),q.play().then(()=>{o(!0)}).catch(W=>{console.error("Error playing selected song:",W),o(!1)}))},100)},re=G=>{if(!G||isNaN(G))return"0:00";const q=Math.floor(G/60),W=Math.floor(G%60);return`${q}:${W.toString().padStart(2,"0")}`},te=(G,q)=>{if(G.image)return se.jsx("img",{src:G.image,alt:G.title,className:"song-image"});const W=G.title?G.title.charAt(0).toUpperCase():"♪",Y=["linear-gradient(45deg, #667eea, #764ba2)","linear-gradient(45deg, #f093fb, #f5576c)","linear-gradient(45deg, #4facfe, #00f2fe)","linear-gradient(45deg, #43e97b, #38f9d7)","linear-gradient(45deg, #fa709a, #fee140)","linear-gradient(45deg, #a8edea, #fed6e3)","linear-gradient(45deg, #ffecd2, #fcb69f)","linear-gradient(45deg, #667db6, #0082c8)"];return se.jsx("div",{className:"song-image",style:{background:Y[q%Y.length]},children:W})},ee=n[t];return se.jsxs("div",{className:"mood-songs",children:[se.jsxs("div",{className:"nav",children:[se.jsx("h2",{children:"Recommended Songs"}),se.jsx("button",{onClick:()=>k("/"),className:"regenerate-btn",children:"Detect Again"})]}),ee&&se.jsxs("div",{className:"now-playing",children:[se.jsxs("div",{className:"now-playing-info",children:[te(ee,t),se.jsxs("div",{className:"current-song-details",children:[se.jsx("h3",{children:ee.title}),se.jsx("p",{children:ee.artist||"Unknown Artist"})]}),se.jsxs("div",{className:"song-actions",children:[se.jsx("button",{className:"action-btn",onClick:()=>V(ee._id),children:b.has(ee._id)?se.jsx(Ty,{className:"liked"}):se.jsx(Py,{})}),se.jsx("button",{className:"action-btn",children:se.jsx(bT,{})})]})]}),se.jsxs("div",{className:"progress-section",children:[se.jsx("span",{className:"time-display",children:re(i)}),se.jsx("div",{className:"progress-bar",onClick:D,children:se.jsx("div",{className:"progress-fill",style:{width:`${u?i/u*100:0}%`}})}),se.jsx("span",{className:"time-display",children:re(u)})]}),se.jsxs("div",{className:"player-controls",children:[se.jsx("button",{className:`control-btn ${p?"active":""}`,onClick:()=>v(!p),children:se.jsx(CT,{})}),se.jsx("button",{className:"control-btn",onClick:F,children:se.jsx(_T,{})}),se.jsx("button",{className:"play-btn",onClick:R,children:r?se.jsx(Dy,{}):se.jsx(Ay,{})}),se.jsx("button",{className:"control-btn",onClick:P,children:se.jsx(ST,{})}),se.jsx("button",{className:`control-btn ${g?"active":""}`,onClick:()=>y(!g),children:se.jsx(ET,{})}),se.jsxs("div",{className:"volume-control",children:[se.jsx("button",{className:"control-btn",onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1),children:f===0?se.jsx(RT,{}):f<.5?se.jsx(kT,{}):se.jsx(IT,{})}),C&&se.jsx("div",{className:"volume-slider",onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1),children:se.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:f,onChange:A})})]})]})]}),se.jsxs("div",{className:"songs-list",children:[se.jsx("h3",{children:"Playlist"}),n.map((G,q)=>se.jsxs("div",{className:`song ${q===t?"active":""}`,onClick:()=>U(q),children:[te(G,q),se.jsxs("div",{className:"title",children:[se.jsx("h4",{children:G.title}),se.jsx("p",{children:G.artist||"Unknown Artist"}),se.jsx("span",{className:"mood-tag",children:G.mood})]}),se.jsxs("div",{className:"song-controls",children:[se.jsx("button",{className:"like-btn",onClick:W=>{W.stopPropagation(),V(G._id)},children:b.has(G._id)?se.jsx(Ty,{className:"liked"}):se.jsx(Py,{})}),se.jsx("button",{className:"play-song-btn",onClick:W=>{W.stopPropagation(),q===t?R():U(q)},children:q===t&&r?se.jsx(Dy,{}):se.jsx(Ay,{})})]})]},G._id||q))]}),se.jsx("audio",{ref:S,src:ee?.audio,preload:"metadata",onLoadStart:()=>console.log("Loading started for:",ee?.title),onCanPlay:()=>console.log("Can play:",ee?.title),onError:G=>console.error("Audio error:",G.target.error),onPlay:()=>o(!0),onPause:()=>o(!1)})]})};function TT(){const[n,t]=ie.useState([]);return se.jsx(se.Fragment,{children:se.jsx(rT,{children:se.jsxs(FN,{children:[se.jsx(nh,{path:"/",element:se.jsx(hT,{setSongs:t})}),se.jsx(nh,{path:"/Songs",element:se.jsx(NT,{Songs:n})})]})})})}K2.createRoot(document.getElementById("root")).render(se.jsx(ie.StrictMode,{children:se.jsx(TT,{})}))});export default DT();
